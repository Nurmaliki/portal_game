/*! tweensoft.com 2014-05-21 13:34:54 */
function readStorage(){numLvl=window.localStorage.getItem("tf_numLvl")?+window.localStorage.getItem("tf_numLvl"):0,numPlay=window.localStorage.getItem("tf_numPlay")?+window.localStorage.getItem("tf_numPlay"):0,you_win=window.localStorage.getItem("tf_you_win")?+window.localStorage.getItem("tf_you_win"):0,bot_win=window.localStorage.getItem("tf_bot_win")?+window.localStorage.getItem("tf_bot_win"):0}function st_getYouWin(){return you_win}function st_getBotWin(){return bot_win}function st_getNumPlay(){return numPlay}function st_getNumLvl(){return numLvl}function st_setNumPlay(a){numPlay+=a,window.localStorage.setItem("tf_numPlay",numPlay)}function st_setNumLvl(a){numLvl+=a,window.localStorage.setItem("tf_numLvl",numLvl)}function st_setYouWin(a){you_win=a,window.localStorage.setItem("tf_you_win",you_win)}function st_setBotWin(a){bot_win=a,window.localStorage.setItem("tf_bot_win",bot_win)}function observerStorage(a){obs.push(a)}function Button(a){this.initialize();var b,c=a.pod?a.pod:null;if(c){var d=new createjs.Sprite(jsons.JSON1);d.gotoAndStop(c),this.addChild(d)}var e=a.icon?a.icon:null;if(e){var f=new createjs.Sprite(jsons.JSON1);f.gotoAndStop(e),this.addChild(f)}var g=a.font?new FontText(a.font,"Center"):null,h=a.txt?a.txt:null;g&&h&&(g.setText(h),g.x=a.txtX?a.txtX/__koefDisplay:this.getBounds().width/2,g.y=a.txtY?a.txtY/__koefDisplay:this.getBounds().height/2-g.getBounds().height,this.addChild(g));var i,j;a.on&&(i=new createjs.Sprite(jsons.JSON1),i.gotoAndStop(a.on),i.x=a.onX?a.onX/__koefDisplay:0,i.y=a.onY?a.onY/__koefDisplay:0,this.addChild(i),a.off&&(j=new createjs.Sprite(jsons.JSON1),j.gotoAndStop(a.off),j.x=a.offX?a.offX/__koefDisplay:0,j.y=a.offY?a.offY/__koefDisplay:0,this.addChild(j)));var k;a.i&&(k=new createjs.Sprite(jsons.JSON1),k.gotoAndStop(a.i),k.x=a.iconX?a.iconX/__koefDisplay:0,k.y=a.iconY?a.iconY/__koefDisplay:0,this.addChild(k)),this.changeFrame=function(a){"off"==a?(this.alpha=.5,b="off"):(this.alpha=1,b="on")},this.changeBeetweenAnim=function(){return"off"==b?(this.changeFrame("on"),"on"):(this.changeFrame("off"),"off")}}function FontText(a,b){this.initialize();var c,d=new Array,e=30/__koefDisplay;b&&(c=b),this.setText=function(b,f){if(f||this.removeAllChildren(),"string"==typeof b||"number"==typeof b){for(var g=new createjs.Container,h=b.toString(),i=0,j=f?a.lineHeight*(f-1):0,k=0;k<h.length;k++){d[k]=new createjs.Sprite(new createjs.SpriteSheet(a.ss_font)),d[k].gotoAndStop("f"+h[k]),d[k].x=i,d[k].y=j,g.addChild(d[k]);for(var l=0;l<a.kerning.length;l++)if(a.kerning[l][0]==h[k]&&!a.kerning[l][1]){e=a.kerning[l][2];break}(h.length-(k+1))%3==0&&k+1!=h.length&&"number"==typeof b&&(e=1.5*e),i+=e}g.x=0,"Center"==c&&(g.x=-i/2),this.addChild(g)}else{f=1;for(var l=0;l<b.length;l++)this.setText(b[l],f),f++}},this.setText(0)}function ProgressBar(a,b,c,d){this.initialize();var e,f;a?(b&&(f=jsons[a+__disSuffiks]?new createjs.Sprite(jsons[a+__disSuffiks]):new createjs.Bitmap(images[b]),f.gotoAndStop&&f.gotoAndStop(b),d.alphaPodl&&(f.alpha=d.alphaPodl),this.addChild(f)),e=jsons[a+__disSuffiks]?new createjs.Sprite(jsons[a+__disSuffiks]):new createjs.Bitmap(images[c]),e.gotoAndStop&&e.gotoAndStop(c),this.addChild(e)):(e=c,f=b),e.x="number"==typeof d.xf?d.xf/__koefDisplay:f.getBounds().width/__koefDisplay/2-e.getBounds().width/__koefDisplay/2,e.y="number"==typeof d.yf?d.yf/__koefDisplay:f.getBounds().height/__koefDisplay/2-e.getBounds().height/__koefDisplay/2;var g=e.getBounds().width,h=new createjs.Shape;h.graphics.beginFill("#000000").drawRect(0,0,g,this.getBounds().height),setCoor(h,-g+e.x),h.x=-g+e.x,e.mask=h,this.setLvl=function(a){a>100&&(a=100);var b=g*a/100;h.x=-g+e.x+b},this.gotoLvl=function(a,b){a>100&&(a=100);var c=g*a/100;tw_tweenTo(h,round(-g+e.x+c),h.y,null,b)}}function StoreBoard(a,b){this.initialize();var c,d={time:.2},e=!0,f=0,g=new FontText(b,"Center");setCoor(g,0,0),g.setText(f),this.addChild(g),this.start=function(a){var b=0;e=!1;var h=Math.round((a-f)*round(1/__freq)/d.time);c=function(){if(b+=round(1/__freq),!(f>=a||1==e)){var d=h;f+d>a&&(d=a-f),f+=d,g.setText(f),t_delayOn(round(1/__freq),c)}},t_delayOn(round(1/__freq),c)},this.set=function(a){g.setText(a)},this.stop=function(){e=!0}}function Text(a,b,c,d){this.initialize();var e,f=new Array,g=new createjs.Container,h=30,i=15;this.addChild(g),d&&(h=d),c&&(e=c),this.setText=function(c){g.removeAllChildren();var d=c.toString(),j=Math.floor(d.length/3);d.length%3==0&&j--;for(var k=(d.length-1)*h+j*i,l=d.length-1;l>=0;l--){f[l]||(f[l]=new createjs.Sprite(a)),f[l].gotoAndStop(b+d[l]),setCoor(f[l],k),g.addChild(f[l]);var m=0;if((d.length-l)%3==0&&(m=i,0!=l)){var n=new createjs.Bitmap(images.zpt);n.x=k-h+m/2,g.addChild(n)}k-=h+m}"Center"==e&&(g.x=-(h/__koefDisplay/2)*d.length-j/__koefDisplay/2*i)},this.setText(0)}function tw_tweenTo(a,b){if(a.x!=b.x||a.y!=b.y||a.alpha!=b.alpha||a.scaleX!=b.scaleX||a.scaleY!=b.scaleY){var c,d=b.d?b.d:1,e=b.alpha?round(b.alpha):a.alpha,f=b.scaleX?round(b.scaleX):a.scaleX,g=b.scaleY?round(b.scaleY):a.scaleY,h=b.rotate?round(b.rotate):a.rotation,i=b.call?b.call:null,j=b.pars;b.x=b.x?b.x:a.x,b.y=b.y?b.y:a.y;for(var k=(b.x-a.x)/(delay*d),l=(b.y-a.y)/(delay*d),m=(h-a.rotation)/(delay*d),n=(f-a.scaleX)/(delay*d),o=(g-a.scaleY)/(delay*d),p=(e-a.alpha)/(delay*d),q=b.impR?round(b.impR):0,r={o:a,nonSt:b.nonStop,rAl:e,sA:p,rX:b.x,rY:b.y,sX:k,sY:l,mass:b.mass,time:0,rScX:f,rScY:g,sScX:n,sScY:o,impuls:q,rRotate:h,speedRot:m,cb:i,p:j,et:b.everyTick,pet:b.pet},s=0;s<m_tweem.length;s++)m_tweem[s].o==a&&(m_tweem[s]=r,c=!0);c||m_tweem.push(r),t_addToTicker(to)}}function tw_removeTween(a){for(var b=0;b<m_tweem.length;b++)m_tweem[b].o==a&&m_tweem.splice(b,1)}function tw_removeAllTweens(){m_tweem=new Array,t_delInTicker(to)}function LogicGame(a){function b(a,b){for(var c=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],e=0;e<c.length;e++){var f=q.checkRow(a,b,c[e][0],c[e][1]),g=q.checkRow(a,b,-1*c[e][0],-1*c[e][1]);if(f>=__config.numEnd){for(var h=0;h<m.length;h++)if(m[h].gameOver){{"user"==k[d]?st_setYouWin(+st_getYouWin()+1):st_setBotWin(+st_getBotWin()+1)}m[h].gameOver(a,b,c[e][0],c[e][1],f,k[d])}return!0}if(f+g>__config.numEnd){for(var h=0;h<m.length;h++)if(m[h].gameOver){{"user"==k[d]?st_setYouWin(+st_getYouWin()+1):st_setBotWin(+st_getBotWin()+1)}m[h].gameOver(a,b,c[e][0],c[e][1],f,k[d]),m[h].gameOver(a,b,-1*c[e][0],-1*c[e][1],g,k[d])}return!0}}}function c(a){var b={kind:a};return b}this.initialize();for(var d,e=this,f=__config.timeOnMove[a-1],g=__config.delayRobot[a-1],h=__config.sizeField.width,i=__config.sizeField.height,j=__config.colors,k=["user","bot"],l=new Array,m=new Array,n=new Array,o=0;h>o;o++)n[o]=new Array;var p,q=new LogicSearch(n,h,i,a);this.init=function(){for(var a=new Array,b=0;b<k.length;b++){for(var c;!c||-1!=indexOf(a,j[c]);)c=Math.round(Math.random()*(j.length-1));l[k[b]]=j[c],a.push(j[c])}d=Math.round(Math.random()),this.switchPlayer()},this.registerObserver=function(a){-1==indexOf(m,a)&&m.push(a)},this.setСell=function(a,d,e,f){if(n[a][d])return!0;for(var g=0;g<m.length;g++)m[g].setIconToCell&&m[g].setIconToCell(a,d,l[e],f);if(!f){n[a][d]=c(e);var h=b(a,d),i=q.checkOnTie();if(h)return h;if(i){for(var j=0;j<m.length;j++)m[j].tie&&m[j].tie();return i}}},this.switchPlayer=function(){var a;k[d+1]?(d++,a=!1):(d=0,a=!0);for(var b=0;b<m.length;b++)m[b].setListeners&&m[b].setListeners(a)},this.moveRobot=function(){p=t_delayOn(g,function(){var a=q.searchOptimMove(),b=e.setСell(a.i,a.j,"bot");if(!b)for(var c=0;c<m.length;c++)m[c].switchPlayer&&m[c].switchPlayer()})},this.pauseRobot=function(a){a?t_setPause(p):t_delInPause(p)},this.getColors=function(){return l},this.getStarted=function(){return k[d]},this.getTimeMove=function(){return f}}function LogicSearch(a,b,c,d){function e(a,b,c,d){for(var e=0,f=p[a][b]?p[a][b].kind:null,g=!0;g;){if(f&&m&&m!=f?g=!1:e++,a+=c,b+=d,0>a||a>q-1||0>b||b>r-1){g=!1;break}p[a][b]&&p[a][b].kind&&!m&&(m=p[a][b].kind),f=p[a][b]?p[a][b].kind:null}return e}function f(){for(var a=new Array,b=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],c=0;r>c;c++)for(var d=0;q>d;d++)for(var e=0;e<b.length;e++)if(n.checkRow(c+b[e][0],d+b[e][1],b[e][0],b[e][1])&&!p[c][d]&&i(c,d,b[e][0],b[e][1],p[c+b[e][0]][d+b[e][1]].kind,5)){a.push({i:c,j:d});break}return a}function g(a){for(var b=new Array,c=0;c<a.length;c++){var d=h(a[c],"bot",1),e=d+h(a[c],"user",1);e&&b.push({i:a[c].i,j:a[c].j,rat:e,r:d})}return b}function h(a,b,c){c=c?c:1;for(var d=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],e=0,f=0;f<d.length;f++)if(p[a.i+d[f][0]]&&p[a.i+d[f][0]][a.j+d[f][1]]&&p[a.i+d[f][0]][a.j+d[f][1]].kind==b){var g=n.checkRow(a.i+d[f][0],a.j+d[f][1],d[f][0],d[f][1]),h=0;p[a.i+-1*d[f][0]]&&p[a.i+-1*d[f][0]][a.j+-1*d[f][1]]&&p[a.i+-1*d[f][0]][a.j+-1*d[f][1]].kind==b&&(h+=n.checkRow(a.i+-1*d[f][0],a.j+-1*d[f][1],-1*d[f][0],-1*d[f][1])),h+g>=__config.numEnd-1&&"bot"==b&&(g*=g),g=Math.pow(g,3),e+=g}return e}function i(a,b,c,d,e,f){var g=!1;if(!p[a][b]){var h=n.checkRow(a+c,b+d,c,d);h+=j(a,b,-1*c,-1*d,e),h>=f&&(g=!0)}return g}function j(a,b,c,d,e){for(var f=0,g=!0;g;)!(a>=0&&r>a&&b>=0&&q>b)||p[a]&&p[a][b]&&p[a][b].kind!=e?g=!1:f++,a+=c,b+=d;return f}function k(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function l(a){var b=k(a),c=__config.levels[o-1]*a.length;return b.splice(c,a.length),b}this.initialize();var m,n=this,o=d?d:1,p=a,q=c,r=b;this.searchRandom=function(a){for(var b,c;"number"!=typeof b||"number"!=typeof c||p[b][c]||a&&a.length>0&&-1==searchObjectWithPar(a,[["i",b],["j",c]]);)b=Math.round(Math.random()*(r-1)),c=Math.round(Math.random()*(q-1));return{i:b,j:c}},this.checkOnTie=function(){for(var a=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],b=0;r>b;b++)for(var c=0;q>c;c++)for(var d=0;d<a.length;d++){m=p[b][c]&&p[b][c].kind?p[b][c].kind:null;var f=e(b,c,a[d][0],a[d][1]);if(f+=e(b,c,-1*a[d][0],-1*a[d][1]),f--,f>=5)return!1}return!0},this.checkRow=function(a,b,c,d){if(!p[a]||!p[a][b])return 0;for(var e=0,f=p[a][b].kind,g=!0;g;)p[a]&&p[a][b]&&p[a][b].kind==f?e++:g=!1,a+=c,b+=d;return e},this.searchOptimMove=function(){var a=f();a=l(a),a=g(a),a=k(a);for(var b=0,c=this.searchRandom(),d=0;d<a.length;d++)a[d].rat>b&&(c={i:a[d].i,j:a[d].j},b=a[d].rat);return c}}function init(){readStorage(),st_setNumPlay(1),st_getNumPlay()%__config.add2home==0&&ADD_TO_HOME(),v_initLocations(),v_choiseLocation("splash"),t_delayOn(2,function(){MusicCTRL.on("sound",1),MusicCTRL.on("music"),MusicCTRL.play("music"),v_choiseLocation("menu")})}function Fruit(a){this.initialize();var b=new createjs.Sprite(jsons.JSON1);b.gotoAndStop("fruit_"+a),this.regX=b.getBounds().width/2,this.regY=b.getBounds().height/2,this.addChild(b)}function Interface(a,b){function c(a){d.removeAllChildren(),s[a]&&d.addChild(s[a])}this.initialize();var d=new createjs.Container,e=null,f=new FontText(interface,"Center"),g=new FontText(interface,"Center");setCoor(f,98,-37),setCoor(g,533,-37);var h,i=new createjs.Sprite(jsons.JSON1);i.visible=!1;var j=new createjs.Sprite(jsons.JSON1);j.gotoAndStop("frame"),setCoor(j,1,16);var k=new createjs.Sprite(jsons.JSON1);k.gotoAndStop("frame2"),setCoor(k,548,17),j.visible=!1,k.visible=!1;var l=new createjs.Sprite(jsons.JSON1);l.gotoAndStop("fruit_glow"),setCoor(l,-9,6);var m=new createjs.Sprite(jsons.JSON1);m.gotoAndStop("fruit_glow"),setCoor(m,541,6),l.visible=!1,m.visible=!1;var n=new createjs.Sprite(jsons.JSON1);n.gotoAndStop("fruit_"+a.colors.user+"_top"),setCoor(n,14,24);var o=new createjs.Sprite(jsons.JSON1);o.gotoAndStop("fruit_"+a.colors.bot+"_top"),setCoor(o,564,24);var p=new createjs.Sprite(jsons.JSON1);p.gotoAndStop("bg_points"),setCoor(p,256,3);var q=new createjs.Sprite(jsons.JSON1);q.gotoAndStop("clocks_center"),setCoor(q,256,2);var r=new createjs.Sprite(jsons.JSON1);r.gotoAndStop("btn_pause"),setCoor(r,134,3),r.addEventListener("click",function(){b.createModal("pause")});for(var s=new Array,t=0;8>t;t++)s[t]=new createjs.Sprite(jsons.JSON1),s[t].gotoAndStop("clocks_time_"+t),setCoor(s[t],256,2);dragAndDrop(n),dragAndDrop(o),this.addChild(l),this.addChild(m),this.addChild(n),this.addChild(o),this.addChild(p),this.addChild(d),this.addChild(q),this.addChild(f),this.addChild(g),this.addChild(r),this.addChild(j),this.addChild(k),this.addChild(i),this.startTimer=function(){this.delInTimer();var d=8,f=a.timeMove/9,g=function(){return 0>d?(b.createModal("timeisup"),void MusicCTRL.play("sound3")):(c(d),d--,void(e=t_delayOn(f,g)))};g()},this.stopTimer=function(){t_setPause(e)},this.resumeTimer=function(){t_delInPause(e)},this.delInTimer=function(){t_delInTicker(e)},this.update=function(){f.setText(st_getYouWin()),g.setText(st_getBotWin())},this.setActivePlayer=function(a){"user"==a&&(l.visible=!0,m.visible=!1,j.visible=!0,k.visible=!1),"bot"==a&&(l.visible=!1,m.visible=!0,j.visible=!1,k.visible=!0)},this.slideTurn=function(a){i.alpha=1,i.visible=!0,tw_removeTween(i),t_delInTicker(h),"user"==a&&(i.gotoAndStop("text_your_turn_small"),setCoor(i,225,-35)),"bot"==a&&(i.gotoAndStop("text_robot"),setCoor(i,256,-35)),tw_tweenTo(i,{x:i.x,y:35/__koefDisplay,d:.3,call:function(){h=t_delayOn(1,function(){tw_tweenTo(i,{x:i.x,y:i.y,alpha:.01,call:function(){i.visible=!1}})})}})}}function VisualGame(){this.initialize();var a=!1,b=new Array,c=new createjs.Shape;c.graphics.beginFill("#ff0000").drawRect(0,0,WIDTHGAME,HEIGHTGAME-105/__koefDisplay),c.alpha=.01;var d=new createjs.Container,e=new createjs.Container,f=new createjs.Container,g=new Border(0,0,80/__koefDisplay,639/__koefDisplay,"#ffffff");this.addChild(d),this.addChild(c),this.addChild(f),c.addEventListener("mousedown",function(c){if(a)for(var d=c.target.globalToLocal(c.stageX,c.stageY),e=div(d.x,__config.item.width),f=div(d.y,__config.item.height),g=0;g<b.length;g++)b[g].mouseDown&&b[g].mouseDown(f,e)}),c.addEventListener("pressmove",function(c){if(a)for(var d=c.target.globalToLocal(c.stageX,c.stageY),e=div(d.x,__config.item.width),f=div(d.y,__config.item.height),g=0;g<b.length;g++)b[g].pressMove&&b[g].pressMove(f,e)}),c.addEventListener("pressup",function(c){if(a)for(var d=c.target.globalToLocal(c.stageX,c.stageY),e=div(d.x,__config.item.width),f=div(d.y,__config.item.height),g=0;g<b.length;g++)b[g].pressUp&&b[g].pressUp(f,e)}),this.registerOnEvent=function(a){-1==indexOf(b,a)&&b.push(a)},this.setIconToCell=function(a,b,c,e){var f=new Fruit(c);f.scaleX=f.scaleY=.85;var g=b*__config.item.width+41/__koefDisplay,h=a*__config.item.height+39/__koefDisplay;if(f.x=g,f.y=h,e){var i=new createjs.Sprite(jsons.JSON1);i.gotoAndStop("fruit_glow"),i.x=g-55/__koefDisplay+1/__koefDisplay,i.y=h-53/__koefDisplay+0/__koefDisplay,d.addChild(i),f.alpha=.7,d.addChild(f)}else MusicCTRL.play("sound1"),this.addChild(f)},this.setBorder=function(a){d.addChild(g),g.x=__config.item.width*a},this.removeTemp=function(a){d.removeAllChildren(),a&&d.addChild(g)},this.gameOver=function(a,c,d,g,h,i){for(var j=a,k=c,l=0;h>l;l++){var m=k*__config.item.width+40/__koefDisplay,n=j*__config.item.height+38/__koefDisplay,o=(k+g)*__config.item.width+40/__koefDisplay,p=(j+d)*__config.item.height+38/__koefDisplay,q=new createjs.Sprite(jsons.JSON1);q.gotoAndStop("fruit_glow"),q.x=m-55/__koefDisplay+1/__koefDisplay,q.y=n-53/__koefDisplay+0/__koefDisplay,f.addChild(q);var r=new createjs.Shape;r.graphics.moveTo(m,n),r.graphics.setStrokeStyle(10/__koefDisplay).beginStroke("#ffffff").lineTo(o,p),h-1>l&&f.addChild(r);var s=new createjs.Sprite(jsons.JSON2,"anim_1");s.play(),s.x=m-155/__koefDisplay,s.y=n-155/__koefDisplay,s.addEventListener("animationend",function(a){a.target.stop(),a.target.play(),a.target.removeAllEventListeners(),a.target.addEventListener("animationend",function(a){a.target.stop()})}),e.addChild(s),j+=d,k+=g}s.addEventListener("animationend",function(a){a.target.stop(),a.target.play(),a.target.removeAllEventListeners(),a.target.addEventListener("animationend",function(a){a.target.stop();for(var c=0;c<b.length;c++)b[c].createModal&&b[c].createModal("gameOver",{winner:i});MusicCTRL.play("bot"==i?"sound2":"sound4")})}),this.addChild(e);for(var l=0;l<b.length;l++)b[l].stop&&b[l].stop()},this.switchPlayer=function(){for(var a=0;a<b.length;a++)b[a].switchPlayers&&b[a].switchPlayers()},this.setListeners=function(b){a=b},this.tie=function(){for(var a=0;a<b.length;a++)b[a].createModal&&b[a].createModal("tie");MusicCTRL.play("sound2")}}function Border(a,b,c,d,e){this.initialize();var f=new createjs.Shape;f.graphics.setStrokeStyle(7/__koefDisplay).beginStroke(e).drawRect(a,b,c,d),this.addChild(f)}function GameOver(a,b){function c(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}this.initialize();var d,e=this,f=new createjs.Container;this.addChild(a),this.addChild(f);var g,h=new Array,i=[[244,177],[93,270],[242,312],[369,270]],j=new createjs.Sprite(jsons.JSON1);j.gotoAndStop("text_you_lose"),setCoor(j,155,332);var k=new createjs.Sprite(jsons.JSON1);k.gotoAndStop("text_you_win"),setCoor(k,171,335);var l=new createjs.Sprite(jsons.JSON1);l.gotoAndStop("bg_points"),setCoor(l,467,246);var m=new createjs.Sprite(jsons.JSON1);m.gotoAndStop("bg_points"),setCoor(m,69,246);var n=new createjs.Sprite(jsons.JSON1);n.gotoAndStop("crown"),setCoor(n,178,99);var o=new FontText(points,"Center"),p=new FontText(points,"Center");setCoor(o,112,241),setCoor(p,511,241);var q=new Button({pod:"btn",icon:"icon_reset"});setCoor(q,400,420),q.addEventListener("click",function(){a.slideOnBottom(function(){b.hideModal(e),b.update()})});var r=new Button({pod:"btn",icon:"icon_menu"});setCoor(r,135,420),r.addEventListener("click",function(){v_choiseLocation("menu")}),a.getChanges().addChild(q),a.getChanges().addChild(r),a.getChanges().addChild(j),a.getChanges().addChild(k),a.getChanges().addChild(l),a.getChanges().addChild(m),a.getChanges().addChild(o),a.getChanges().addChild(p),a.getChanges().addChild(n),this.update=function(b){for(var e=0;4>e;e++)h[e]=new createjs.Sprite(jsons.JSON2,"anim_2"),setCoor(h[e],i[e][0],i[e][1]);var f=function(){if("bot"==b.winner)g=new createjs.Sprite(jsons.JSON2,"anim_1"),g.play(),g.addEventListener("animationend",function(a){a.target.stop()}),setCoor(g,362,134),a.getChanges().addChild(g),o.setText(+st_getYouWin()),p.setText(+st_getBotWin());else{c(h),e=0,d=0;var f=function(){e>=4||(h[e].play(),h[e].addEventListener("animationend",function(c){c.target.removeAllEventListeners(),c.target.addEventListener("animationend",function(c){c.target.stop(),d++,d>=4&&(g=new createjs.Sprite(jsons.JSON2,"anim_1"),g.play(),g.addEventListener("animationend",function(a){a.target.stop()}),"user"==b.winner&&setCoor(g,-39,134),"bot"==b.winner&&setCoor(g,362,134),a.getChanges().addChild(g),o.setText(+st_getYouWin()),p.setText(+st_getBotWin()))})}),a.getChanges().addChild(h[e]),e++,t_delayOn(.2,f))};f()}};a.slideFromTop(f),n.visible=!1,j.visible=!1,k.visible=!1,"user"==b.winner&&(k.visible=!0,n.visible=!0,o.setText(+st_getYouWin()-1),p.setText(+st_getBotWin())),"bot"==b.winner&&(j.visible=!0,o.setText(+st_getYouWin()),p.setText(+st_getBotWin()-1))}}function Modal(a,b){this.initialize();var c=new createjs.Container,d=a?a:"small",e=b?b:0,f=new createjs.Shape;f.graphics.beginFill("000").drawRect(0,0,WIDTHGAME,HEIGHTGAME),f.alpha=e;var g=new createjs.Sprite(jsons.JSON1);g.gotoAndStop("window_"+d),g.x=WIDTHGAME/2-g.getBounds().width/2,g.y=HEIGHTGAME/2-g.getBounds().height/2,this.addChild(f),this.addChild(c),c.addChild(g),dragAndDrop(g),this.slideFromTop=function(a){c.y=-HEIGHTGAME,tw_tweenTo(c,{x:c.x,y:.1,d:.5,call:a})},this.slideOnBottom=function(a){tw_tweenTo(c,{x:c.x,y:HEIGHTGAME,d:.5,call:a})},this.getChanges=function(){return c}}function Pause(a,b){this.initialize();var c=this,d=new createjs.Container;this.addChild(a),this.addChild(d);var e=new createjs.Sprite(jsons.JSON1);if(e.gotoAndStop("text_pause"),setCoor(e,212,126),__audio_supported){var f=new Button({pod:"btn",icon:"icon_music"});f.changeFrame("off"),setCoor(f,153,242),f.addEventListener("click",function(){var a=f.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("music"):(MusicCTRL.on("music"),MusicCTRL.play("music"))});var g=new Button({pod:"btn",icon:"icon_sound"});g.changeFrame("off"),g.alpha=.5,setCoor(g,379,242),g.addEventListener("click",function(){var a=g.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("sound"):MusicCTRL.on("sound",1)})}var h=new Button({pod:"btn",icon:"icon_right"});setCoor(h,379,539),h.addEventListener("click",function(){a.slideOnBottom(function(){b.hideModal(c),b.resume()})});var i=new Button({pod:"btn",icon:"icon_menu"});setCoor(i,153,539),i.addEventListener("click",function(){v_choiseLocation("menu")}),MusicCTRL.registerObserver(this),a.getChanges().addChild(e),a.getChanges().addChild(f),a.getChanges().addChild(g),a.getChanges().addChild(h),a.getChanges().addChild(i),this.off=function(a){"music"==a&&f.changeFrame("off"),"sound"==a&&g.changeFrame("off")},this.on=function(a){"music"==a&&f.changeFrame("on"),"sound"==a&&g.changeFrame("on")},this.update=function(){a.slideFromTop()}}function Tie(a,b){this.initialize();var c=this,d=new createjs.Container;this.addChild(a),this.addChild(d);var e=new createjs.Sprite(jsons.JSON1);e.gotoAndStop("text_game_is_a_tie"),setCoor(e,136,337);var f=new Button({pod:"btn",icon:"icon_menu"});setCoor(f,136,425),f.addEventListener("click",function(){v_choiseLocation("menu")});var g=new Button({pod:"btn",icon:"icon_reset"});setCoor(g,403,425),g.addEventListener("click",function(){a.slideOnBottom(function(){b.hideModal(c),b.update()})}),a.getChanges().addChild(e),a.getChanges().addChild(f),a.getChanges().addChild(g),this.update=function(){a.slideFromTop()}}function TimeIsUp(a,b){this.initialize();var c=new createjs.Container;this.addChild(a);var d=new createjs.Sprite(jsons.JSON1);d.gotoAndStop("bg_points"),setCoor(d,256,3);var e=new createjs.Sprite(jsons.JSON1);e.gotoAndStop("clocks_center"),setCoor(e,256,2);var f=new createjs.Sprite(jsons.JSON1);f.gotoAndStop("clocks_time_7"),setCoor(f,256,2);var g=new createjs.Sprite(jsons.JSON1);g.gotoAndStop("text_times_up"),setCoor(g,159,328),setCoor(c,11,410),c.addChild(d),c.addChild(e),c.addChild(f),a.getChanges().addChild(g),a.getChanges().addChild(c),this.update=function(){a.slideFromTop(function(){t_delayOn(2,function(){a.slideOnBottom(function(){b.switchPlayers()})})})}}function Turn(a,b){this.initialize();var c=this,d=new createjs.Container;this.addChild(a),this.addChild(d);var e=new createjs.Sprite(jsons.JSON1);e.gotoAndStop("text_opponents_turn"),setCoor(e,140,303);var f=new createjs.Sprite(jsons.JSON1);f.gotoAndStop("text_your turn"),setCoor(f,139,337),a.getChanges().addChild(e),a.getChanges().addChild(f),this.update=function(d){e.visible=!1,f.visible=!1,a.slideFromTop(),t_delayOn(2,function(){a.slideOnBottom(function(){b.hideModal(c),b.playAndSwitch()})}),"user"==d.turn&&(e.visible=!0),"bot"==d.turn&&(f.visible=!0)}}function WhoStart(a,b){function c(){var c=Math.round(Math.random()),g=c?"user":"bot",i=function(){"user"==e?(setCoor(h,137,306),n.visible=!0):(setCoor(h,393,306),o.visible=!0),h.visible=!0,d(e),t_delayOn(2,function(){a.slideOnBottom(function(){b.hideModal(f),b.start()})})};t_intervalOn(.02,function(){g="user"==g?"bot":"user",d(g)},null,2,i)}function d(a){"user"==a?(j.visible=!0,k.visible=!1):(j.visible=!1,k.visible=!0)}this.initialize();var e,f=this,g=new createjs.Container;this.addChild(a),this.addChild(g);var h=new createjs.Sprite(jsons.JSON1);h.gotoAndStop("fruit_glow");var i=new createjs.Sprite(jsons.JSON1);i.gotoAndStop("text_who_starts"),setCoor(i,105,239);var j=new createjs.Sprite(jsons.JSON1);j.gotoAndStop("icon_left"),setCoor(j,222,304);var k=new createjs.Sprite(jsons.JSON1);k.gotoAndStop("icon_right"),setCoor(k,311,304);var l,m,l=new createjs.Sprite(jsons.JSON1),m=new createjs.Sprite(jsons.JSON1),n=new createjs.Bitmap(images.text_you_starts),o=new createjs.Bitmap(images.text_robot_starts);setCoor(o,133,259),setCoor(n,178,259),a.getChanges().addChild(i),a.getChanges().addChild(j),a.getChanges().addChild(k),a.getChanges().addChild(h),a.getChanges().addChild(n),a.getChanges().addChild(o),this.update=function(b){n.visible=!1,o.visible=!1,h.visible=!1,e=b.started,l.gotoAndStop("fruit_"+b.colors.user+"_top"),setCoor(l,160,325),m.gotoAndStop("fruit_"+b.colors.bot+"_top"),setCoor(m,416,325),j.visible=!1,k.visible=!1,a.getChanges().addChild(l),a.getChanges().addChild(m),a.slideFromTop(c)}}function About(){this.initialize();var a=new createjs.Sprite(jsons.JSON1);a.gotoAndStop("window_big"),a.x=WIDTHGAME/2-a.getBounds().width/2,a.y=HEIGHTGAME/2-a.getBounds().height/2;var b=new createjs.Sprite(jsons.JSON1);b.gotoAndStop("Fruits-about"),setCoor(b,132,102),b.addEventListener("click",function(){window.open(__config.url,"_blank")});var c=new Button({pod:"btn",icon:"icon_left"});setCoor(c,20,618),c.addEventListener("click",function(){v_choiseLocation("setting")}),this.addChild(a),this.addChild(b),this.addChild(c)}function ChoiseLevel(){function a(a){0==st_getNumLvl()?v_choiseLocation("instructions",{game:!0,lvl:a}):v_choiseLocation("game",{lvl:a})}this.initialize();var b=new createjs.Sprite(jsons.JSON1);b.gotoAndStop("window_big"),b.x=WIDTHGAME/2-b.getBounds().width/2,b.y=HEIGHTGAME/2-b.getBounds().height/2;var c=new createjs.Sprite(jsons.JSON1);c.gotoAndStop("text_choose"),setCoor(c,173,122);var d=new Button({pod:"btn",icon:"icon_left"});setCoor(d,20,618),d.addEventListener("click",function(){v_choiseLocation("setting")});var e=new createjs.Shape;e.graphics.beginFill("#ff0000").drawRect(0,0,200,50),e.alpha=.01,e.addEventListener("click",function(){a(1)}),setCoor(e,216,220);var f=new createjs.Shape;f.graphics.beginFill("#ff0000").drawRect(0,0,200,50),f.alpha=.01,f.addEventListener("click",function(){a(2)}),setCoor(f,216,303);var g=new createjs.Shape;g.graphics.beginFill("#ff0000").drawRect(0,0,200,50),g.alpha=.01,g.addEventListener("click",function(){a(3)}),setCoor(g,216,398);var h=new createjs.Shape;h.graphics.beginFill("#ff0000").drawRect(0,0,200,50),h.alpha=.01,h.addEventListener("click",function(){a(4)}),setCoor(h,216,481),this.addChild(b),this.addChild(c),this.addChild(e),this.addChild(f),this.addChild(g),this.addChild(h)}function Game(){this.initialize();var a,b,c,d,e,f=new Array,g=1;f.pause=new Modal("big",.01),f.pause=new Pause(f.pause,this),this.pressUp=function(a,b){c.mouseChildren&&(c.removeTemp(),d.setСell(a,b,"user")||this.switchPlayers())},this.mouseDown=function(e,f){c.mouseChildren&&(c.removeTemp(),c.setBorder(f),d.setСell(e,f,"user",!0),a=f,b=e)},this.pressMove=function(e,f){c.mouseChildren&&(a&&a==f||(c.removeTemp(),c.setBorder(f),d.setСell(e,f,"user",!0),a=f),b&&b==e||(c.removeTemp(!0),d.setСell(e,f,"user",!0),b=e))},this.switchPlayers=function(){this.hideModal(),this.playAndSwitch()},this.playAndSwitch=function(){d.switchPlayer(),this.start()},this.createModal=function(a,b){f[a]||("gameOver"==a?(f[a]=new Modal(null,.5),f[a]=new GameOver(f[a],this)):"whoStart"==a?(f[a]=new Modal(null,.01),f[a]=new WhoStart(f[a],this)):"turn"==a?(f[a]=new Modal(null,.01),f[a]=new Turn(f[a],this)):"timeisup"==a?(f[a]=new Modal(null,.01),f[a]=new TimeIsUp(f[a],this)):"pause"==a?(f[a]=new Modal("big",.01),f[a]=new Pause(f[a],this)):"tie"==a&&(f[a]=new Modal(null,.01),f[a]=new Tie(f[a],this))),f[a].update&&f[a].update(b),this.addChild(f[a]),this.stop()},this.hideModal=function(a){a&&a.parent&&a.parent.removeChild(a),c.mouseChildren=!0,e.mouseChildren=!0},this.update=function(a){st_setNumLvl(1),st_getNumLvl()%__config.facebook==0&&FB_GO(),this.removeAllChildren(),g=a&&a.lvl?a.lvl:g,c=new VisualGame,d=new LogicGame(g),c.y=105/__koefDisplay,c.registerOnEvent(this),d.registerObserver(c),d.init(),e&&e.delInTimer(),e=null,e=new Interface({colors:d.getColors(),timeMove:d.getTimeMove()},this),e.update(),this.addChild(c),this.addChild(e),this.createModal("whoStart",{colors:d.getColors(),started:d.getStarted()})},this.start=function(){"user"==d.getStarted()&&(e.setActivePlayer("user"),e.slideTurn("user")),"bot"==d.getStarted()&&(e.setActivePlayer("bot"),e.slideTurn("bot")),d.pauseRobot(!1),e.setActivePlayer(d.getStarted()),e.startTimer(),"bot"==d.getStarted()&&d.moveRobot()},this.stop=function(){c.removeTemp(),c.mouseChildren=!1,e.mouseChildren=!1,e.stopTimer(),e.update(),d.pauseRobot(!0)},this.resume=function(){e.resumeTimer()},this.getLvl=function(){return g}}function Instructions(){function a(d){c.removeAllChildren(),d>=0&&2>d&&(active=d),c.addChild(e[active]),h.removeAllEventListeners(),0>active-1?b?h.addEventListener("click",function(){v_choiseLocation("chlevel")}):h.addEventListener("click",function(){v_choiseLocation("setting")}):h.addEventListener("click",function(){a(active-1)}),g.removeAllEventListeners(),active+1>=2?b?(g.changeFrame("on"),g.addEventListener("click",function(){v_choiseLocation("game",{lvl:b.lvl})})):g.changeFrame("off"):(g.changeFrame("on"),g.addEventListener("click",function(){a(active+1)}))}this.initialize();for(var b,c=new createjs.Container,d=[[36,125],[99,86]],e=new Array,f=0;2>f;f++)e[f]=new createjs.Sprite(jsons.JSON1),e[f].gotoAndStop("Fruits-Instructions-"+(f+1)),setCoor(e[f],d[f][0],d[f][1]);var g=new Button({pod:"btn",icon:"icon_right"});setCoor(g,525,618);var h=new Button({pod:"btn",icon:"icon_left"});setCoor(h,20,618);var i=new createjs.Sprite(jsons.JSON1);i.gotoAndStop("text_how_to_play"),setCoor(i,102,7),c.addChild(e[0]),c.addChild(e[1]),this.addChild(g),this.addChild(h),this.addChild(c),this.addChild(i),this.update=function(c){b=c&&c.game?c:!1,a(0)}}function Menu(){this.initialize();var a=new createjs.Bitmap(images.cover);a.y=HEIGHTGAME/2-a.getBounds().height/2;var b=new createjs.Shape;b.graphics.beginFill("#ff0000").drawRect(0,0,150,150),b.alpha=.01,b.addEventListener("click",function(){v_choiseLocation("chlevel")}),setCoor(b,260,592);var c=new createjs.Shape;c.graphics.beginFill("#ff0000").drawRect(0,0,100,100),c.alpha=.01,c.addEventListener("click",function(){v_choiseLocation("setting")}),setCoor(c,489,318);var d=new createjs.Shape;d.graphics.beginFill("#ff0000").drawRect(0,0,100,100),d.alpha=.01,d.addEventListener("click",function(){window.open(__config.url,"_blank")});var e=new createjs.Shape;e.graphics.beginFill("#ff0000").drawRect(0,0,250,100),e.alpha=.01,e.addEventListener("click",function(){window.open(__config.url,"_blank")}),setCoor(e,171,153),setCoor(d,69,398),this.addChild(a),this.addChild(b),this.addChild(c),this.addChild(d),this.addChild(e)}function Setting(){this.initialize();var a=new createjs.Sprite(jsons.JSON1);a.gotoAndStop("window_big"),a.x=WIDTHGAME/2-a.getBounds().width/2,a.y=HEIGHTGAME/2-a.getBounds().height/2;var b=new createjs.Sprite(jsons.JSON1);if(b.gotoAndStop("text_settings"),setCoor(b,164,114),__audio_supported){var c=new Button({pod:"btn",icon:"icon_music"});c.changeFrame("off"),setCoor(c,153,209),c.addEventListener("click",function(){var a=c.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("music"):(MusicCTRL.on("music"),MusicCTRL.play("music"))});var d=new Button({pod:"btn",icon:"icon_sound"});d.changeFrame("off"),d.alpha=.5,setCoor(d,376,209),d.addEventListener("click",function(){var a=d.changeBeetweenAnim("off","on");"off"==a?MusicCTRL.off("sound"):MusicCTRL.on("sound",1)})}var e=new Button({pod:"btn",icon:"icon_about"});setCoor(e,376,430),e.addEventListener("click",function(){v_choiseLocation("about")});var f=new Button({pod:"btn",icon:"icon_help"});setCoor(f,153,430),f.addEventListener("click",function(){v_choiseLocation("instructions")});var g=new Button({pod:"btn",icon:"icon_left"});setCoor(g,20,618),g.addEventListener("click",function(){v_choiseLocation("menu")}),MusicCTRL.registerObserver(this),this.addChild(a),this.addChild(b),this.addChild(c),this.addChild(d),this.addChild(e),this.addChild(f),this.addChild(g),this.off=function(a){"music"==a&&c.changeFrame("off"),"sound"==a&&d.changeFrame("off")},this.on=function(a){"music"==a&&c.changeFrame("on"),"sound"==a&&d.changeFrame("on")}}function SplashScreen(){this.initialize();var a=new createjs.Bitmap(images.splash);a.scaleX=__WIDTHBG/a.getBounds().width,a.scaleY=__HEIGHTBG/a.getBounds().height,a.y=HEIGHTGAME/2-__HEIGHTBG/2,a.addEventListener("click",function(){window.open(__config.url,"_blank")
}),this.addChild(a)}var lvls=new Array,__open=new Array,flag=new Array,numPlay,numLvl,you_win,bot_win,obs=new Array;extend(Button,createjs.Container),extend(FontText,createjs.Container),extend(ProgressBar,createjs.Container),extend(StoreBoard,createjs.Container),extend(Text,createjs.Container);var m_tweem=new Array,delay=__freq,__pause,to=function(){if(!__pause){for(var a=0;a<m_tweem.length;a++){if(Math.abs(m_tweem[a].rX-m_tweem[a].o.x)<Math.abs(m_tweem[a].sX)&&!m_tweem[a].nonSt&&(m_tweem[a].sX=m_tweem[a].rX-m_tweem[a].o.x),Math.abs(m_tweem[a].rY-m_tweem[a].o.y)<Math.abs(m_tweem[a].sY)&&!m_tweem[a].nonSt&&(m_tweem[a].sY=m_tweem[a].rY-m_tweem[a].o.y),Math.abs(m_tweem[a].rScX-m_tweem[a].o.scaleX)<Math.abs(m_tweem[a].sScX)&&(m_tweem[a].sScX=m_tweem[a].rScX-m_tweem[a].o.scaleX),Math.abs(m_tweem[a].rScY-m_tweem[a].o.scaleY)<Math.abs(m_tweem[a].sScY)&&(m_tweem[a].sScY=m_tweem[a].rScY-m_tweem[a].o.scaleY),Math.abs(m_tweem[a].rAl-m_tweem[a].o.alpha)<Math.abs(m_tweem[a].sA)&&(m_tweem[a].sA=m_tweem[a].rAl-m_tweem[a].o.alpha),m_tweem[a].mass&&(m_tweem[a].sY=m_tweem[a].time,m_tweem[a].time+=m_tweem[a].mass),m_tweem[a].o.x=m_tweem[a].o.x+m_tweem[a].sX,m_tweem[a].o.y=m_tweem[a].o.y+m_tweem[a].sY,m_tweem[a].o.scaleX=m_tweem[a].o.scaleX+m_tweem[a].sScX,m_tweem[a].o.scaleY=m_tweem[a].o.scaleY+m_tweem[a].sScY,m_tweem[a].o.alpha=m_tweem[a].o.alpha+m_tweem[a].sA,m_tweem[a].impuls)if(m_tweem[a].o.rotation=m_tweem[a].o.rotation+m_tweem[a].impuls,Math.abs(m_tweem[a].impuls)>.1){var b=.98*m_tweem[a].impuls;m_tweem[a].impuls=b}else m_tweem[a].impuls&&(m_tweem[a].impuls=!1);else m_tweem[a].speedRot&&(m_tweem[a].o.rotation=m_tweem[a].o.rotation+m_tweem[a].speedRot);if(m_tweem[a].et&&m_tweem[a].et.apply(null,m_tweem[a].pet),m_tweem[a]&&round(m_tweem[a].o.x)==round(m_tweem[a].rX)&&(round(m_tweem[a].o.y)==round(m_tweem[a].rY)||m_tweem[a].mass&&round(m_tweem[a].o.y)>=round(m_tweem[a].rY))&&round(m_tweem[a].o.alpha)==round(m_tweem[a].rAl)&&round(m_tweem[a].o.rotation)==round(m_tweem[a].rRotate)&&round(m_tweem[a].o.scaleX)==round(m_tweem[a].rScX)&&round(m_tweem[a].o.scaleY)==round(m_tweem[a].rScY)&&!m_tweem[a].impuls&&!m_tweem[a].nonSt){m_tweem[a].mass&&round(m_tweem[a].o.y)>=round(m_tweem[a].rY)&&(m_tweem[a].o.y=m_tweem[a].rY);var c,d;m_tweem[a].cb&&(c=m_tweem[a].cb,d=m_tweem[a].p),m_tweem.splice(a,1),a--,c&&c.apply(null,d)}}0==m_tweem.length&&t_delInTicker(to)}},curLang="en",loc={ru:{},en:{}};localization=loc[curLang],extend(LogicGame,createjs.Container),extend(LogicSearch,createjs.Container),extend(Fruit,createjs.Container),extend(Interface,createjs.Container),extend(VisualGame,createjs.Container),extend(Border,createjs.Container),extend(GameOver,createjs.Container),extend(Modal,createjs.Container),extend(Pause,createjs.Container),extend(Tie,createjs.Container),extend(TimeIsUp,createjs.Container),extend(Turn,createjs.Container),extend(WhoStart,createjs.Container),extend(About,createjs.Container),extend(ChoiseLevel,createjs.Container),extend(Game,createjs.Container),extend(Instructions,createjs.Container),extend(Menu,createjs.Container),extend(Setting,createjs.Container),extend(SplashScreen,createjs.Container);