var CRENDER_DEBUG=false;function ImagesPreloader()
{var self=this;this.curItem=-1;this.loadedImages={};this.data=null;this.endCallback=null;this.processCallback=null;this.load=function(data,endCallback,processCallback)
{this.data=data;this.endCallback=endCallback;this.processCallback=processCallback;for(var i=0;i<this.data.length;i++)
{var item=this.data[i];var img=new Image();img.src=item.src;this.loadedImages[item.name]=img;}
wait();};function wait()
{var itemsLoaded=0;var itemsTotal=0;for(var key in self.loadedImages)
{if(self.loadedImages[key].complete)itemsLoaded++;itemsTotal++;}
if(itemsLoaded>=itemsTotal)
{if(self.endCallback)self.endCallback(self.loadedImages);return;}
else
{if(self.processCallback)self.processCallback(Math.floor(itemsLoaded/itemsTotal*100));setTimeout(wait,50);}}}
var Utils={touchScreen:("ontouchstart"in window),globalScale:1,setCookie:function(name,value)
{window.localStorage.setItem(name,value);},getCookie:function(name)
{return window.localStorage.getItem(name);},bindEvent:function(el,eventName,eventHandler)
{if(el.addEventListener)
{el.addEventListener(eventName,eventHandler,false);}
else if(el.attachEvent)
{el.attachEvent('on'+eventName,eventHandler);}},getObjectLeft:function(element)
{var result=element.offsetLeft;if(element.offsetParent)result+=Utils.getObjectLeft(element.offsetParent);return result;},getObjectTop:function(element)
{var result=element.offsetTop;if(element.offsetParent)result+=Utils.getObjectTop(element.offsetParent);return result;},parseGet:function()
{var get={};var s=new String(window.location);var p=s.indexOf("?");var tmp,params;if(p!=-1)
{s=s.substr(p+1,s.length);params=s.split("&");for(var i=0;i<params.length;i++)
{tmp=params[i].split("=");get[tmp[0]]=tmp[1];}}
return get;},globalPixelScale:1,getMouseCoord:function(event,object)
{var e=event||window.event;if(e.touches)e=e.touches[0];if(!e)return{x:0,y:0};var x=0;var y=0;var mouseX=0;var mouseY=0;if(object)
{x=Utils.getObjectLeft(object);y=Utils.getObjectTop(object);}
if(e.pageX||e.pageY)
{mouseX=e.pageX;mouseY=e.pageY;}
else if(e.clientX||e.clientY)
{mouseX=e.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft;mouseY=e.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop;}
var retX=(mouseX-x);var retY=(mouseY-y);return{x:retX,y:retY};},extend:function(Child,Parent)
{var F=function(){};F.prototype=Parent.prototype;Child.prototype=new F();Child.prototype.constructor=Child;Child.superclass=Parent.prototype;},removeFromArray:function(arr,item)
{var tmp=[];for(var i=0;i<arr.length;i++)
{if(arr[i]!=item)tmp.push(arr[i]);}
return tmp;},showLoadProgress:function(val)
{var scl=Utils.globalScale;var s='Loading: '+val+'%';s+='<br><br>';s+='<div style="display: block; background: #000; width: '+(val*scl*2)+'px; height: '+(10*scl)+'px;">&nbsp;</div>';document.getElementById('progress').innerHTML=s;},hideAddressBarLock:false,mobileHideAddressBar:function()
{if(Utils.hideAddressBarLock)return;window.scrollTo(0,1);},mobileCheckIphone4:function()
{if(window.devicePixelRatio)
{if(navigator.userAgent.indexOf('iPhone')!=-1&&window.devicePixelRatio==2)return true;}
return false;},mobileCheckBrokenGalaxyPhones:function()
{if(window.devicePixelRatio)
{if(navigator.userAgent.indexOf('GT-I9300')!=-1||navigator.userAgent.indexOf('GT-I8190')!=-1||navigator.userAgent.indexOf('Android 4.')!=-1)return true;}
return false;},checkSpilgamesEnvironment:function()
{return(typeof ExternalAPI!="undefined"&&ExternalAPI.type=="Spilgames"&&ExternalAPI.check());},mobileCorrectPixelRatio:function()
{var meta=document.createElement('meta');meta.name="viewport";var content="target-densitydpi=device-dpi, user-scalable=0";if(Utils.checkSpilgamesEnvironment())
{if(window.devicePixelRatio>1)content+=", initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5";else content+=", initial-scale=1, maximum-scale=1, minimum-scale=1";}
else
{if(Utils.mobileCheckIphone4())content+=", initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5";else content+=", initial-scale=1, maximum-scale=1, minimum-scale=1";}
meta.content=content;document.getElementsByTagName('head')[0].appendChild(meta);},getMobileScreenResolution:function(landscape)
{var scale=1;var w=0;var h=0;var scales=[{scale:1,width:320,height:480},{scale:1.5,width:480,height:720},{scale:2,width:640,height:960}];var container={width:0,height:0};var prop="";if(Utils.touchScreen)
{container.width=Math.min(window.innerWidth,window.innerHeight);container.height=Math.max(window.innerWidth,window.innerHeight);prop="height";}
else
{container.width=window.innerWidth;container.height=window.innerHeight;prop="height";}
var min=Number.MAX_VALUE;for(var i=0;i<scales.length;i++)
{var diff=Math.abs(container[prop]-scales[i][prop]);if(min>diff)
{min=diff;scale=scales[i].scale;}}
return Utils.getScaleScreenResolution(scale,landscape);},getScaleScreenResolution:function(scale,landscape)
{var w,h;w=Math.round(320*scale);h=Math.round(480*scale);if(landscape)
{var tmp=w;w=h;h=tmp;}
return{width:w,height:h,scale:scale};},imagesRoot:'images',createLayout:function(container,resolution)
{var scl=Utils.globalScale;var height=window.innerHeight;if("orientation"in window)height=2048;else document.body.style.overflow="hidden";var s="";s+='<div id="progress_container" align="center" style="width: 100%; height: '+height+'px; display: block; width: 100%; position: absolute; left: 0px; top: 0px;">';s+='<table cellspacing="0" cellpadding="0"><tr><td id="progress" align="center" valign="middle" style="width: '+resolution.width+'px; height: '+resolution.height+'px; color: #000; background: #fff; font-weight: bold; font-family: Verdana; font-size: '+(12*scl)+'px; vertical-align: middle;"></td></tr></table>';s+='</div>';s+='<div id="screen_background_container" align="center" style="width: 100%; height: '+height+'px; position: absolute; left: 0px; top: 0px; display: none; z-index: 2;">'
s+='<div id="screen_background_wrapper" style="width: '+resolution.width+'px; height: '+resolution.height+'px; overflow: hidden; position: relative;">';s+='<canvas id="screen_background" width="'+resolution.width+'" height="'+resolution.height+'"></canvas>';s+='</div>';s+='</div>';s+='<div id="screen_container" align="center" style="width: 100%; height: '+height+'px; position: absolute; left: 0px; top: 0px; display: none; z-index: 3;">';s+='<div id="screen_wrapper" style="width: '+resolution.width+'px; height: '+resolution.height+'px; overflow: hidden; position: relative;">';s+='<canvas id="screen" style="position: absolute; left: 0px; top: 0px; z-index: 1000000;" width="'+resolution.width+'" height="'+resolution.height+'">You browser does not support this application :(</canvas>';s+='</div>';s+='</div>';container.innerHTML=s;var p=document.createElement("div");p.setAttribute("id","p2l_container");p.setAttribute("align","center");var w=resolution.width;p.setAttribute("style","width: 100%; height: "+height+"px; position: absolute; left: 0px; top: 0px; display: none; z-index: 1000; background: #fff;");p.innerHTML='<img id="p2l" src="'+Utils.imagesRoot+'/p2l.jpg" style="padding-top: '+((w-240)/2)+'px" />';document.body.appendChild(p);},preventEvent:function(e)
{e.preventDefault();e.stopPropagation();e.cancelBubble=true;e.returnValue=false;return false;},addMobileListeners:function(landscape)
{Utils.bindEvent(document.body,"touchstart",Utils.preventEvent);Utils.bindEvent(window,"scroll",function(e)
{setTimeout(Utils.mobileHideAddressBar,300);});setInterval("Utils.checkOrientation("+(landscape?"true":"false")+")",500);setTimeout(Utils.mobileHideAddressBar,500);},storeOrient:null,checkOrientation:function(landscape)
{if(!Utils.touchScreen)return;if(!document.getElementById('screen_container'))return;var getParams=Utils.parseGet();if(getParams.nocheckorient==1)return;var orient=false;if(window==window.parent)
{orient=(window.innerWidth>window.innerHeight);}
else
{var longSide=Math.max(screen.width,screen.height);var shortSide=Math.min(screen.width,screen.height);var lc=Math.abs(window.innerWidth-longSide);var sc=Math.abs(window.innerWidth-shortSide);orient=(lc<sc);}
if(Utils.storeOrient===orient)return;Utils.storeOrient=orient;var ok=(orient==landscape);if(!ok)
{Utils.dispatchEvent("lockscreen");document.getElementById('p2l_container').style.display='block';document.getElementById('screen_background_container').style.display='none';document.getElementById('screen_container').style.display='none';}
else
{Utils.dispatchEvent("unlockscreen");document.getElementById('p2l_container').style.display='none';document.getElementById('screen_background_container').style.display='block';document.getElementById('screen_container').style.display='block';}
if(Utils.checkSpilgamesEnvironment())document.getElementById('p2l_container').style.display='none';setTimeout(Utils.mobileHideAddressBar,50);setTimeout(Utils.fitLayoutToScreen,100);},fitLayoutTimer:null,addFitLayoutListeners:function()
{Utils.fitLayoutTimer=setInterval(Utils.fitLayoutToScreen,500);},removeFitLayoutListeners:function()
{clearInterval(Utils.fitLayoutTimer);},fitLayoutLock:false,fitLayoutCorrectHeight:0,fitLayoutToScreen:function(container)
{if(Utils.fitLayoutLock)return;var p,s,width,height;if(typeof container!="object"||!container.width)
{width=window.innerWidth;height=window.innerHeight;if(Utils.checkSpilgamesEnvironment())height-=25;height+=Utils.fitLayoutCorrectHeight;container={width:width,height:height};}
s=document.getElementById("screen");if(!s)return;if(!s.initWidth)
{s.initWidth=s.width;s.initHeight=s.height;}
width=s.initWidth;height=s.initHeight;var scale=1;var scaleX=container.width/width;var scaleY=container.height/height;scale=(scaleX<scaleY?scaleX:scaleY);Utils.globalPixelScale=scale;width=Math.floor(width*scale);height=Math.floor(height*scale);if(s.lastWidth==width&&s.lastHeight==height)return;s.lastWidth=width;s.lastHeight=height;Utils.resizeElement("screen",width,height);Utils.resizeElement("screen_background",width,height);s=document.getElementById("progress");if(s)
{s.style.width=(~~width)+"px";s.style.height=(~~height)+"px";}
s=document.getElementById("screen_wrapper");if(s)
{s.style.width=(~~width)+"px";s.style.height=(~~height)+"px";}
s=document.getElementById("screen_background_wrapper");if(s)
{s.style.width=(~~width)+"px";s.style.height=(~~height)+"px";}
s=document.getElementById("p2l_container");if(s)
{s.style.width=(~~window.innerWidth)+"px";s.style.height="2048px";}
Utils.dispatchEvent("fitlayout");setTimeout(Utils.mobileHideAddressBar,50);},resizeElement:function(id,width,height)
{var s=document.getElementById(id);if(!s)return;s.setAttribute("width",width);s.setAttribute("height",height);},drawIphoneLimiter:function(stage,landscape)
{if(landscape)stage.drawRectangle(240,295,480,54,"#f00",true,0.5,true);else stage.drawRectangle(160,448,320,64,"#f00",true,0.5,true);},drawGrid:function(stage,landscape,col)
{if(typeof landscape=='undefined')landscape=false;var dx=10;var dy=10;if(typeof col=='undefined')col='#FFF';var w=1/Utils.globalScale/Utils.globalPixelScale;var s={w:(landscape?480:320),h:(landscape?320:480)}
for(var x=dx;x<s.w;x+=dx)
{var o=0.1+0.1*(((x-dx)/dx)%10);stage.drawLine(x,0,x,s.h,w,col,o);}
for(var y=dy;y<s.h;y+=dy)
{var o=0.1+0.1*(((y-dy)/dy)%10);stage.drawLine(0,y,s.w,y,w,col,o);}},drawScaleFix:function(stage,landscape)
{if(Utils.globalScale==0.75)
{if(landscape)stage.drawRectangle(507,160,54,320,"#000",true,1,true);else stage.drawRectangle(160,507,320,54,"#000",true,1,true);}
if(Utils.globalScale==1.5)
{if(landscape)stage.drawRectangle(510,160,60,320,"#000",true,1,true);else stage.drawRectangle(160,510,320,60,"#000",true,1,true);}},grad2radian:function(val)
{return val/(180/Math.PI);},radian2grad:function(val)
{return val*(180/Math.PI);},eventsListeners:[],onlockscreen:null,onunlockscreen:null,onfitlayout:null,addEventListener:function(type,callback)
{EventsManager.addEvent(Utils,type,callback);},removeEventListener:function(type,callback)
{EventsManager.removeEvent(Utils,type,callback);},dispatchEvent:function(type,params)
{return EventsManager.dispatchEvent(Utils,type,params);}}
var EventsManager={addEvent:function(obj,type,callback)
{if(!obj.eventsListeners)return;for(var i=0;i<obj.eventsListeners.length;i++)
{if(obj.eventsListeners[i].type===type&&obj.eventsListeners[i].callback===callback)return;}
obj.eventsListeners.push({type:type,callback:callback});},removeEvent:function(obj,type,callback)
{if(!obj.eventsListeners)return;for(var i=0;i<obj.eventsListeners.length;i++)
{if(obj.eventsListeners[i].type===type&&obj.eventsListeners[i].callback===callback)
{obj.eventsListeners=Utils.removeFromArray(obj.eventsListeners,obj.eventsListeners[i]);return;}}},dispatchEvent:function(obj,type,params)
{if(!obj.eventsListeners)return;var ret;if(typeof obj["on"+type]=="function")
{ret=obj["on"+type](params);if(ret===false)return false;}
for(var i=0;i<obj.eventsListeners.length;i++)
{if(obj.eventsListeners[i].type===type)
{ret=obj.eventsListeners[i].callback(params);if(ret===false)return false;}}}}
var ANCHOR_ALIGN_LEFT=-1;var ANCHOR_ALIGN_CENTER=0;var ANCHOR_ALIGN_RIGHT=1;var ANCHOR_VALIGN_TOP=-1;var ANCHOR_VALIGN_MIDDLE=0;var ANCHOR_VALIGN_BOTTOM=1;function Sprite(img,w,h,f,l)
{this.uid=0;this.stage=null;this.x=0;this.y=0;this.width=w;this.height=h;this.offset={left:0,top:0};this.anchor={x:0,y:0}
this.scaleX=1;this.scaleY=1;this.rotation=0;this.zIndex=0;this.visible=true;this.opacity=1;this['static']=false;this.ignoreViewport=false;this.animated=true;this.currentFrame=0;this.totalFrames=Math.max(1,~~f);if(this.totalFrames<=1)this.animated=false;this.currentLayer=0;this.totalLayers=Math.max(1,~~l);this.bitmap=img;this.mask=null;this.fillColor=false;this.destroy=false;this.animStep=0;this.animDelay=1;this.drawAlways=false;this.dragged=false;this.dragX=0;this.dragY=0;this.getX=function()
{return Math.round(this.x*Utils.globalScale);};this.getY=function()
{return Math.round(this.y*Utils.globalScale);};this.getWidth=function()
{return this.width*Math.abs(this.scaleX)*Utils.globalScale;};this.getHeight=function()
{return this.height*Math.abs(this.scaleY)*Utils.globalScale;};this.startDrag=function(x,y)
{this.dragged=true;this.dragX=x;this.dragY=y;}
this.stopDrag=function()
{this.dragged=false;this.dragX=0;this.dragY=0;}
this.play=function()
{this.animated=true;};this.stop=function()
{this.animated=false;};this.gotoAndStop=function(frame)
{this.currentFrame=frame;this.stop();};this.gotoAndPlay=function(frame)
{this.currentFrame=frame;this.play();};this.removeTweens=function()
{if(!this.stage)return;this.stage.clearObjectTweens(this);};this.addTween=function(prop,end,duration,ease,onfinish,onchange)
{if(!this.stage)return;var val=this[prop];if(isNaN(val))return;var t=stage.createTween(this,prop,val,end,duration,ease);t.onchange=onchange;t.onfinish=onfinish;return t;};this.moveTo=function(x,y,duration,ease,onfinish,onchange)
{duration=~~duration;if(duration<=0)
{this.setPosition(x,y);}
else
{var t1=this.addTween('x',x,duration,ease,onfinish,onchange);if(t1)t1.play();var t2=this.addTween('y',y,duration,ease,(t1?null:onfinish),(t1?null:onchange));if(t2)t2.play();}
return this;}
this.moveBy=function(x,y,duration,ease,onfinish,onchange)
{return this.moveTo(this.x+x,this.y+y,duration,ease,onfinish,onchange);}
this.fadeTo=function(opacity,duration,ease,onfinish,onchange)
{duration=~~duration;if(duration<=0)
{this.opacity=opacity;}
else
{var t=this.addTween('opacity',opacity,duration,ease,onfinish,onchange);if(t)t.play();}
return this;}
this.fadeBy=function(opacity,duration,ease,onfinish,onchange)
{var val=Math.max(0,Math.min(1,this.opacity+opacity));return this.fadeTo(val,duration,ease,onfinish,onchange);}
this.rotateTo=function(rotation,duration,ease,onfinish,onchange)
{duration=~~duration;if(duration<=0)
{this.rotation=rotation;}
else
{var t=this.addTween('rotation',rotation,duration,ease,onfinish,onchange);if(t)t.play();}
return this;}
this.rotateBy=function(rotation,duration,ease,onfinish,onchange)
{return this.rotateTo(this.rotation+rotation,duration,ease,onfinish,onchange);}
this.scaleTo=function(scale,duration,ease,onfinish,onchange)
{duration=~~duration;if(duration<=0)
{this.scaleX=this.scaleY=scale;}
else
{var t1=this.addTween('scaleX',scale,duration,ease,onfinish,onchange);if(t1)t1.play();var t2=this.addTween('scaleY',scale,duration,ease,(t1?null:onfinish),(t1?null:onchange));if(t2)t2.play();}
return this;}
this.nextFrame=function()
{this.dispatchEvent("enterframe",{target:this});if(!this.history.created)this.updateHistory();if(!this.animated)return;this.animStep++;if(this.animStep>=this.animDelay)
{this.currentFrame++;this.animStep=0;}
if(this.currentFrame>=this.totalFrames)this.currentFrame=0;};this.updateHistory=function()
{this.history.x=this.getX();this.history.y=this.getY();this.history.rotation=this.rotation;this.history.frame=this.currentFrame;var rect=new Rectangle(this.history.x,this.history.y,this.getWidth(),this.getHeight(),this.rotation);rect.AABB[0].x-=1;rect.AABB[0].y-=1;rect.AABB[1].x+=1;rect.AABB[1].y+=1;this.history.AABB=rect.AABB;this.history.created=true;this.history.changed=false;};this.history={created:false,drawed:false,changed:false,x:0,y:0,rotation:0,frame:0,AABB:[]};this.eventsWhenInvisible=false;this.onmouseover=null;this.onmouseout=null;this.onmousedown=null;this.onmouseup=null;this.onclick=null;this.oncontextmenu=null;this.onmousemove=null;this.onenterframe=null;this.onrender=null;this.onadd=null;this.onremove=null;this.onbox2dsync=null;this.mouseOn=false;this.getPosition=function()
{return{x:this.x+0,y:this.y+0}}
this.setPosition=function(x,y)
{if((typeof y=='undefined')&&(typeof x['x']!='undefined')&&(typeof x['y']!='undefined'))
{return this.setPosition(x.x,x.y);}
this.x=parseFloat(x);this.y=parseFloat(y);}
this.getAnchor=function()
{return new Vector(this.anchor.x,this.anchor.y);}
this.setAnchor=function(x,y)
{if((typeof y=='undefined')&&(typeof x['x']!='undefined')&&(typeof x['y']!='undefined'))
{return this.setAnchor(x.x,x.y);}
this.anchor.x=parseFloat(x);this.anchor.y=parseFloat(y);}
this.alignAnchor=function(h,v)
{h=parseInt(h);if(isNaN(h))h=ANCHOR_ALIGN_CENTER;if(h<0)h=ANCHOR_ALIGN_LEFT;if(h>0)h=ANCHOR_ALIGN_RIGHT;v=parseInt(v);if(isNaN(v))v=ANCHOR_VALIGN_MIDDLE;if(v<0)v=ANCHOR_VALIGN_TOP;if(v>0)v=ANCHOR_VALIGN_BOTTOM;var anchor=new Vector(this.width*h/2,this.height*v/2).add(this.getPosition());this.setAnchor(anchor.x,anchor.y);return this.getAnchor();}
this.getAbsoluteAnchor=function()
{return new Vector(this.x,this.y);}
this.getRelativeCenter=function()
{var a=this.getAnchor();var c=new Vector(-this.anchor.x*this.scaleX,-this.anchor.y*this.scaleY);c.rotate(-this.rotation);return c;}
this.getAbsoluteCenter=function()
{return this.getRelativeCenter().add(this.getPosition());}
this.getCenter=function()
{return this.getAbsoluteCenter();}
this.getDrawRectangle=function()
{var c=this.getCenter(),r=new Rectangle(0,0,this.width*Math.abs(this.scaleX),this.height*Math.abs(this.scaleY),this.rotation);r.move(c.x,c.y);return r;}
this.getAABBRectangle=function()
{var r=this.getDrawRectangle(),w=r.AABB[1].x-r.AABB[0].x,h=r.AABB[1].y-r.AABB[0].y;return new Rectangle(r.AABB[0].x+(w/2),r.AABB[0].y+(h/2),w,h,0);}
this.localToGlobal=function(x,y)
{var p=((typeof x=='object')&&(typeof x['x']!='undefined')&&(typeof x['y']!='undefined'))?new Vector(x.x+0,x.y+0):new Vector(x,y);p.rotate(this.rotation).add(this.getPosition());return p;}
this.globalToLocal=function(x,y)
{var p=((typeof x=='object')&&(typeof x['x']!='undefined')&&(typeof x['y']!='undefined'))?new Vector(x.x+0,x.y+0):new Vector(x,y);p.subtract(this.getPosition()).rotate(-this.rotation);return p;}
this.allowDebugDrawing=true;this.debugDraw=function()
{if(!this.visible)return;if(!this.allowDebugDrawing)return;var a=this.getPosition(),c=this.getCenter(),r=this.getDrawRectangle(),aabb=this.getAABBRectangle();stage.drawCircle(a.x,a.y,1,1,'rgba(255,0,0,0.9)');stage.drawCircle(c.x,c.y,1,1,'rgba(0,255,0,0.9)');stage.drawLine(a.x,a.y,c.x,c.y,1,'rgba(255,255,255,0.5)');stage.drawPolygon(r.vertices,0.5,'rgba(255,0,255,0.5)',1);stage.drawLine(aabb.vertices[0].x,aabb.vertices[0].y,aabb.vertices[2].x,aabb.vertices[2].y,0.1,'rgba(255,255,255,0.5)');stage.drawLine(aabb.vertices[2].x,aabb.vertices[0].y,aabb.vertices[0].x,aabb.vertices[2].y,0.1,'rgba(255,255,255,0.5)');stage.drawPolygon(aabb.vertices,0.5,'rgba(255,255,255,0.5)');}
this.setZIndex=function(z)
{this.zIndex=~~z;if(!this.stage)return;this.stage.setZIndex(this,~~z);}
this.eventsListeners=[];this.addEventListener=function(type,callback)
{EventsManager.addEvent(this,type,callback);}
this.removeEventListener=function(type,callback)
{EventsManager.removeEvent(this,type,callback);}
this.dispatchEvent=function(type,params)
{return EventsManager.dispatchEvent(this,type,params);}
this.hitTestPoint=function(x,y,checkPixel,checkDragged,debug)
{if(!this.stage)
return false;return this.stage.hitTestPointObject(this,x,y,checkPixel,checkDragged,debug);}}
function Tween(obj,prop,start,end,duration,callback)
{var self=this;if(typeof obj!='object')obj=null;if(obj)
{if(typeof obj[prop]=='undefined')throw new Error('Trying to tween undefined property "'+prop+'"');if(isNaN(obj[prop]))throw new Error('Tweened value can not be '+(typeof obj[prop]));}
else
{if(isNaN(prop))throw new Error('Tweened value can not be '+(typeof prop));}
if(typeof callback!='function')callback=Easing.linear.easeIn;this.obj=obj;this.prop=prop;this.onchange=null;this.onfinish=null;this.start=start;this.end=end;this.duration=~~duration;this.callback=callback;this.playing=false;this._pos=-1;this.play=function()
{self.playing=true;self.tick();}
this.pause=function()
{self.playing=false;}
this.rewind=function()
{self._pos=-1;}
this.forward=function()
{self._pos=this.duration;}
this.stop=function()
{self.pause();self.rewind();}
this.updateValue=function(val)
{if(self.obj)
{self.obj[self.prop]=val;}
else
{self.prop=val;}}
this.tick=function()
{if(!self.playing)return false;self._pos++;if(self._pos<0)return false;if(self._pos>self.duration)return self.finish();var func=self.callback;var val=func(self._pos,self.start,self.end-self.start,self.duration);this.updateValue(val);self.dispatchEvent("change",{target:self,value:val});return false;}
this.finish=function()
{self.stop();self.updateValue(self.end);return self.dispatchEvent("finish",{target:self,value:self.end});}
this.eventsListeners=[];this.addEventListener=function(type,callback)
{EventsManager.addEvent(this,type,callback);}
this.removeEventListener=function(type,callback)
{EventsManager.removeEvent(this,type,callback);}
this.dispatchEvent=function(type,params)
{return EventsManager.dispatchEvent(this,type,params);}}
var Easing={back:{easeIn:function(t,b,c,d)
{var s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;},easeOut:function(t,b,c,d)
{var s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;},easeInOut:function(t,b,c,d)
{var s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b;}},bounce:{easeIn:function(t,b,c,d)
{return c-Easing.bounce.easeOut(d-t,0,c,d)+b;},easeOut:function(t,b,c,d)
{if((t/=d)<(1/2.75))return c*(7.5625*t*t)+b;else if(t<(2/2.75))return c*(7.5625*(t-=(1.5/2.75))*t+0.75)+b;else if(t<(2.5/2.75))return c*(7.5625*(t-=(2.25/2.75))*t+0.9375)+b;else return c*(7.5625*(t-=(2.625/2.75))*t+0.984375)+b;},easeInOut:function(t,b,c,d)
{if(t<d/2)return Easing.bounce.easeIn(t*2,0,c,d)*0.5+b;else return Easing.bounce.easeOut(t*2-d,0,c,d)*0.5+c*0.5+b;}},circular:{easeIn:function(t,b,c,d)
{return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;},easeOut:function(t,b,c,d)
{return c*Math.sqrt(1-(t=t/d-1)*t)+b;},easeInOut:function(t,b,c,d)
{if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;}},cubic:{easeIn:function(t,b,c,d)
{return c*(t/=d)*t*t+b;},easeOut:function(t,b,c,d)
{return c*((t=t/d-1)*t*t+1)+b;},easeInOut:function(t,b,c,d)
{if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;}},exponential:{easeIn:function(t,b,c,d)
{return t==0?b:c*Math.pow(2,10*(t/d-1))+b;},easeOut:function(t,b,c,d)
{return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;},easeInOut:function(t,b,c,d)
{if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;}},linear:{easeIn:function(t,b,c,d)
{return c*t/d+b;},easeOut:function(t,b,c,d)
{return c*t/d+b;},easeInOut:function(t,b,c,d)
{return c*t/d+b;}},quadratic:{easeIn:function(t,b,c,d)
{return c*(t/=d)*t+b;},easeOut:function(t,b,c,d)
{return-c*(t/=d)*(t-2)+b;},easeInOut:function(t,b,c,d)
{if((t/=d/2)<1)return c/2*t*t+b;return-c/2*((--t)*(t-2)-1)+b;}},quartic:{easeIn:function(t,b,c,d)
{return c*(t/=d)*t*t*t+b;},easeOut:function(t,b,c,d)
{return-c*((t=t/d-1)*t*t*t-1)+b;},easeInOut:function(t,b,c,d)
{if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;}},quintic:{easeIn:function(t,b,c,d)
{return c*(t/=d)*t*t*t*t+b;},easeOut:function(t,b,c,d)
{return c*((t=t/d-1)*t*t*t*t+1)+b;},easeInOut:function(t,b,c,d)
{if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;}},sine:{easeIn:function(t,b,c,d)
{return-c*Math.cos(t/d*(Math.PI/2))+c+b;},easeOut:function(t,b,c,d)
{return c*Math.sin(t/d*(Math.PI/2))+b;},easeInOut:function(t,b,c,d)
{return-c/2*(Math.cos(Math.PI*t/d)-1)+b;}}}
function StageTimer(callback,timeout,repeat)
{this.repeat=repeat;this.initialTimeout=timeout;this.timeout=timeout;this.callback=callback;this.paused=false;this.update=function()
{if(this.paused)return;this.timeout--;if(this.timeout==0)
{if(typeof this.callback=="function")this.callback();if(typeof this.callback=="string")eval(this.callback);if(this.repeat)this.timeout=this.initialTimeout;else return true;}
return false;};this.resume=function()
{this.paused=false;};this.pause=function()
{this.paused=true;};}
function Stage(cnsId,w,h)
{var self=this;this.canvas=document.getElementById(cnsId);this.canvas.renderController=this;this.canvas.ctx=this.canvas.getContext('2d');this.backBuffer=null;this.screenWidth=w;this.screenHeight=h;this.viewport={x:0,y:0};this.objects=[];this.objectsCounter=0;this.buffer=document.createElement('canvas');this.buffer.width=w*Utils.globalScale;this.buffer.height=h*Utils.globalScale;this.buffer.ctx=this.buffer.getContext('2d');this.delay=40;this.fillColor=false;this.started=false;this.fps=0;this.lastFPS=0;this.showFPS=false;this.pixelClickEvent=false;this.pixelMouseUpEvent=false;this.pixelMouseDownEvent=false;this.pixelMouseMoveEvent=false;this.ceilSizes=false;this.tmMain
this.tmFPS
this.partialUpdate=false;this.clearLock=false;this.destroy=function()
{clearTimeout(this.tmMain);clearTimeout(this.tmFPS);this.stop();this.clear();this.clearScreen(this.canvas);}
this.clearScreen=function(canvas)
{canvas.ctx.clearRect(0,0,this.screenWidth*Utils.globalScale*Utils.globalPixelScale,this.screenHeight*Utils.globalScale*Utils.globalPixelScale);}
this.findMaxZIndex=function()
{var max=-1;var ix=false;for(var i=0;i<this.objects.length;i++)
{if(this.objects[i].zIndex>max)
{max=this.objects[i].zIndex;ix=i;}}
return{index:ix,zIndex:max};};this.findMinZIndex=function()
{var min=-1;var ix=false;for(var i=0;i<this.objects.length;i++)
{if(i==0)
{min=this.objects[i].zIndex;ix=0;}
if(this.objects[i].zIndex<min)
{min=this.objects[i].zIndex;ix=i;}}
return{index:ix,zIndex:min};};this.addChild=function(item)
{var f=this.findMaxZIndex();var z=item.zIndex;if(f.index!==false)item.zIndex=f.zIndex+1;else item.zIndex=0;this.objectsCounter++;item.uid=this.objectsCounter;item.stage=this;this.objects.push(item);if(z!=0)
{this.setZIndex(item,~~z);}
item.dispatchEvent("add",{target:item});return item;};this.removeChild=function(item)
{if(item)
{this.clearObjectTweens(item);item.dispatchEvent("remove",{target:item});item.stage=null;this.objects=Utils.removeFromArray(this.objects,item);}};this.setZIndex=function(item,index)
{var bSort=true;var i,tmp;item.zIndex=index;while(bSort)
{bSort=false;for(i=0;i<this.objects.length-1;i++)
{if(this.objects[i].zIndex>this.objects[i+1].zIndex)
{tmp=this.objects[i];this.objects[i]=this.objects[i+1];this.objects[i+1]=tmp;bSort=true;}}}}
this.hitTestPointObject=function(obj,x,y,pixelCheck,includeDragged,debug)
{var cX,cY,cW,cH,mX,mY,r,present,imageData;cW=obj.width*Math.abs(obj.scaleX);cH=obj.height*Math.abs(obj.scaleY);cX=obj.x-cW/2;cY=obj.y-cH/2;mX=x;mY=y;if(!obj.ignoreViewport)
{mX+=this.viewport.x;mY+=this.viewport.y;}
present=false;if(obj.rotation==0)
{if(cX<=mX&&cY<=mY&&cX+cW>=mX&&cY+cH>=mY)present=true;}
else
{r=obj.getDrawRectangle();if(r.hitTestPoint(new Vector(mX,mY)))present=true;}
if(present&&pixelCheck)
{this.buffer.width=this.screenWidth*Utils.globalScale*Utils.globalPixelScale;this.buffer.height=this.screenHeight*Utils.globalScale*Utils.globalPixelScale;this.clearScreen(this.buffer);this.renderObject(this.buffer,obj);var pX=Math.floor(x*Utils.globalScale*Utils.globalPixelScale);var pY=Math.floor(y*Utils.globalScale*Utils.globalPixelScale);imageData=this.buffer.ctx.getImageData(pX,pY,1,1);if(imageData.data[3]==0)present=false;}
if(!present&&includeDragged&&obj.dragged)present=true;return present;}
this.getObjectsStackByCoord=function(x,y,pixelCheck,includeDragged,debug)
{var obj;var tmp=[];for(var i=0;i<this.objects.length;i++)
{if(this.objects[i].visible||this.objects[i].eventsWhenInvisible)
{obj=this.objects[i];if(this.hitTestPointObject(obj,x,y,pixelCheck,includeDragged,debug))
{tmp.push(obj);}}}
return tmp;};this.getMaxZIndexInStack=function(stack)
{var max=-1;var ix=0;for(var i=0;i<stack.length;i++)
{if(stack[i].zIndex>max)
{max=stack[i].zIndex;ix=i;}}
return ix;};this.sortStack=function(stack,revert)
{var bSort=true;var ok;var i,tmp;while(bSort)
{bSort=false;for(i=0;i<stack.length-1;i++)
{ok=false;if(stack[i].zIndex<stack[i+1].zIndex&&!revert)ok=true;if(stack[i].zIndex>stack[i+1].zIndex&&revert)ok=true;if(ok)
{tmp=stack[i];stack[i]=stack[i+1];stack[i+1]=tmp;bSort=true;}}}
return stack;}
this.finalizeMouseCoords=function(obj,m)
{if(!obj)return m;var eX=this.prepareMouseCoord(m.x);var eY=this.prepareMouseCoord(m.y);if(!obj.ignoreViewport)
{eX+=this.viewport.x;eY+=this.viewport.y;}
eX=eX-obj.x;eY=eY-obj.y;return{x:eX,y:eY};}
this.prepareMouseCoord=function(val)
{return val/Utils.globalScale/Utils.globalPixelScale;}
this.checkClick=function(event)
{var m=Utils.getMouseCoord(event,this.canvas);var stack=this.getObjectsStackByCoord(this.prepareMouseCoord(m.x),this.prepareMouseCoord(m.y),this.pixelClickEvent,false,true);var ret,f;if(stack.length>0)
{stack=this.sortStack(stack);for(var i=0;i<stack.length;i++)
{f=this.finalizeMouseCoords(stack[i],m);ret=stack[i].dispatchEvent("click",{target:stack[i],x:f.x,y:f.y});if(ret===false)return;}}};this.checkContextMenu=function(event)
{var m=Utils.getMouseCoord(event,this.canvas);var stack=this.getObjectsStackByCoord(this.prepareMouseCoord(m.x),this.prepareMouseCoord(m.y),this.pixelClickEvent);var ret,f;if(stack.length>0)
{stack=this.sortStack(stack);for(var i=0;i<stack.length;i++)
{f=this.finalizeMouseCoords(stack[i],m);ret=stack[i].dispatchEvent("contextmenu",{target:stack[i],x:f.x,y:f.y});if(ret===false)return;}}};this.checkMouseMove=function(event)
{var m=Utils.getMouseCoord(event,this.canvas);for(i=0;i<this.objects.length;i++)
{if(this.objects[i].dragged)
{var eX=m.x/Utils.globalScale/Utils.globalPixelScale;var eY=m.y/Utils.globalScale/Utils.globalPixelScale;if(!this.objects[i].ignoreViewport)
{eX+=this.viewport.x;eY+=this.viewport.y;}
this.objects[i].x=eX-this.objects[i].dragX;this.objects[i].y=eY-this.objects[i].dragY;}}
var stack=this.getObjectsStackByCoord(this.prepareMouseCoord(m.x),this.prepareMouseCoord(m.y),this.pixelMouseMoveEvent);var i,n,ret,bOk,f;var overStack=[];if(stack.length>0)
{stack=this.sortStack(stack);for(i=0;i<stack.length;i++)
{overStack.push(stack[i]);f=this.finalizeMouseCoords(stack[i],m);if(!stack[i].mouseOn)ret=stack[i].dispatchEvent("mouseover",{target:stack[i],x:f.x,y:f.y});stack[i].mouseOn=true;if(ret===false)break;}
for(i=0;i<stack.length;i++)
{f=this.finalizeMouseCoords(stack[i],m);ret=stack[i].dispatchEvent("mousemove",{target:stack[i],x:f.x,y:f.y});if(ret===false)break;}}
for(i=0;i<this.objects.length;i++)
{if(this.objects[i].mouseOn)
{bOk=false;for(n=0;n<overStack.length;n++)
{if(overStack[n]==this.objects[i])bOk=true;}
if(!bOk)
{this.objects[i].mouseOn=false;f=this.finalizeMouseCoords(stack[i],m);ret=this.objects[i].dispatchEvent("mouseout",{target:this.objects[i],x:f.x,y:f.y});if(ret===false)break;}}}};this.checkMouseDown=function(event)
{var m=Utils.getMouseCoord(event,this.canvas);var stack=this.getObjectsStackByCoord(this.prepareMouseCoord(m.x),this.prepareMouseCoord(m.y),this.pixelMouseDownEvent);var ret,f;if(stack.length>0)
{stack=this.sortStack(stack);for(var i=0;i<stack.length;i++)
{f=this.finalizeMouseCoords(stack[i],m);ret=stack[i].dispatchEvent("mousedown",{target:stack[i],x:f.x,y:f.y});if(ret===false)return;}}};this.checkMouseUp=function(event)
{var m=Utils.getMouseCoord(event,this.canvas);var stack=this.getObjectsStackByCoord(this.prepareMouseCoord(m.x),this.prepareMouseCoord(m.y),this.pixelMouseUpEvent,true);var ret,f;if(stack.length>0)
{stack=this.sortStack(stack);for(var i=0;i<stack.length;i++)
{f=this.finalizeMouseCoords(stack[i],m);ret=stack[i].dispatchEvent("mouseup",{target:stack[i],x:f.x,y:f.y});if(ret===false)return;}}};this.clear=function()
{for(var i=0;i<this.objects.length;i++)
{this.objects[i].dispatchEvent("remove",{target:this.objects[i]});}
this.objects=[];this.tweens=[];this.timers=[];this.eventsListeners=[];this.objectsCounter=0;};this.hitTest=function(obj1,obj2)
{if(obj1.rotation==0&&obj2.rotation==0)
{var cX1=obj1.getX()-obj1.getWidth()/2;var cY1=obj1.getY()-obj1.getHeight()/2;var cX2=obj2.getX()-obj2.getWidth()/2;var cY2=obj2.getY()-obj2.getHeight()/2;var top=Math.max(cY1,cY2);var left=Math.max(cX1,cX2);var right=Math.min(cX1+obj1.getWidth(),cX2+obj2.getWidth());var bottom=Math.min(cY1+obj1.getHeight(),cY2+obj2.getHeight());var width=right-left;var height=bottom-top;if(width>0&&height>0)return true;else return false;}
else
{var r1=obj1.getDrawRectangle(),r2=obj2.getDrawRectangle();return r1.hitTestRectangle(r2);}};this.drawRectangle=function(x,y,width,height,color,fill,opacity,ignoreViewport)
{var cns=this.canvas;if(typeof opacity!='undefined')cns.ctx.globalAlpha=opacity;else cns.ctx.globalAlpha=1;cns.ctx.fillStyle=color;cns.ctx.strokeStyle=color;if(!ignoreViewport)
{x-=this.viewport.x;y-=this.viewport.y;}
x=x*Utils.globalScale*Utils.globalPixelScale;y=y*Utils.globalScale*Utils.globalPixelScale;width=width*Utils.globalScale*Utils.globalPixelScale;height=height*Utils.globalScale*Utils.globalPixelScale;if(fill)cns.ctx.fillRect(x-width/2,y-height/2,width,height);else cns.ctx.strokeRect(x-width/2,y-height/2,width,height);};this.drawCircle=function(x,y,radius,width,color,opacity,ignoreViewport)
{this.drawArc(x,y,radius,0,Math.PI*2,false,width,color,opacity,ignoreViewport);};this.drawArc=function(x,y,radius,startAngle,endAngle,anticlockwise,width,color,opacity,ignoreViewport)
{var cns=this.canvas;var oldLW=cns.ctx.lineWidth;if(typeof color=="undefined")color="#000"
cns.ctx.strokeStyle=color;if(typeof width=="undefined")width=1;cns.ctx.lineWidth=width*Utils.globalScale*Utils.globalPixelScale;if(typeof opacity=="undefined")opacity=1;cns.ctx.globalAlpha=opacity;if(!ignoreViewport)
{x-=this.viewport.x;y-=this.viewport.y;}
x=x*Utils.globalScale*Utils.globalPixelScale;y=y*Utils.globalScale*Utils.globalPixelScale;radius=radius*Utils.globalScale*Utils.globalPixelScale;cns.ctx.beginPath();cns.ctx.arc(x,y,radius,startAngle,endAngle,anticlockwise);cns.ctx.stroke();cns.ctx.lineWidth=oldLW;};this.drawPolygon=function(points,width,color,opacity,ignoreViewport)
{if((typeof points!="object")||!(points instanceof Array)||points.length<2)return;for(var i=0;i<points.length-1;i++)
{this.drawLine(points[i].x,points[i].y,points[i+1].x,points[i+1].y,width,color,opacity,ignoreViewport);}
this.drawLine(points[i].x,points[i].y,points[0].x,points[0].y,width,color,opacity,ignoreViewport);}
this.drawLine=function(x1,y1,x2,y2,width,color,opacity,ignoreViewport)
{var cns=this.canvas;var oldLW=cns.ctx.lineWidth;if(color)cns.ctx.strokeStyle=color;else cns.ctx.strokeStyle='#000';if(width)cns.ctx.lineWidth=width*Utils.globalScale*Utils.globalPixelScale;else cns.ctx.lineWidth=1*Utils.globalScale*Utils.globalPixelScale;if(opacity)cns.ctx.globalAlpha=opacity;else cns.ctx.globalAlpha=1;if(!ignoreViewport)
{x1-=this.viewport.x;y1-=this.viewport.y;x2-=this.viewport.x;y2-=this.viewport.y;}
x1=x1*Utils.globalScale*Utils.globalPixelScale;y1=y1*Utils.globalScale*Utils.globalPixelScale;x2=x2*Utils.globalScale*Utils.globalPixelScale;y2=y2*Utils.globalScale*Utils.globalPixelScale;cns.ctx.beginPath();cns.ctx.moveTo(x1,y1);cns.ctx.lineTo(x2,y2);cns.ctx.closePath();cns.ctx.stroke();cns.ctx.lineWidth=oldLW;};this.start=function()
{if(this.started)return;this.started=true;clearFPS();render();}
this.forceRender=function()
{if(this.started)render();}
this.stop=function()
{this.started=false;}
function clearFPS()
{self.lastFPS=self.fps;self.fps=0;if(self.started)self.tmFPS=setTimeout(clearFPS,1000);}
this.setTextStyle=function(font,size,style,color,borderColor,canvas)
{var cns=(canvas?canvas:this.canvas);cns.ctx.fillStyle=color;cns.ctx.strokeStyle=borderColor;var s="";if(style)s+=style+" ";if(size)s+=Math.floor(size*Utils.globalScale*Utils.globalPixelScale)+"px ";if(font)s+=font;cns.ctx.font=s;}
this.drawText=function(text,x,y,opacity,ignoreViewport,alignCenter,canvas)
{var cns=(canvas?canvas:this.canvas);if(typeof opacity=="undefined")cns.ctx.globalAlpha=1;else cns.ctx.globalAlpha=opacity;if(!ignoreViewport)
{x-=this.viewport.x;y-=this.viewport.y;}
x=x*Utils.globalScale*Utils.globalPixelScale;y=y*Utils.globalScale*Utils.globalPixelScale;if(alignCenter)x=x-this.getTextWidth(text)/2;cns.ctx.fillText(text,x,y);}
this.strokeText=function(text,x,y,opacity,ignoreViewport,alignCenter,canvas)
{var cns=(canvas?canvas:this.canvas);if(typeof opacity=="undefined")cns.ctx.globalAlpha=1;else cns.ctx.globalAlpha=opacity;if(!ignoreViewport)
{x-=this.viewport.x;y-=this.viewport.y;}
x=x*Utils.globalScale*Utils.globalPixelScale;y=y*Utils.globalScale*Utils.globalPixelScale;if(alignCenter)x=x-this.getTextWidth(text)/2;cns.ctx.strokeText(text,x,y);}
this.getTextWidth=function(str,canvas)
{var cns=(canvas?canvas:this.canvas);return cns.ctx.measureText(str).width;}
this.allowDebugDrawing=false;this.allowStaticDebugDrawing=false;this.renderObject=function(cns,obj)
{var
r=obj.getDrawRectangle(),ow=obj.width*Utils.globalScale,oh=obj.height*Utils.globalScale,ox=r.center.x*Utils.globalPixelScale*Utils.globalScale-Math.floor(ow/2),oy=r.center.y*Utils.globalPixelScale*Utils.globalScale-Math.floor(oh/2),or=obj.rotation,scX=obj.scaleX*Utils.globalPixelScale,scY=obj.scaleY*Utils.globalPixelScale,canvasMod=Boolean(or!=0||scX!=1||scY!=1);if(!obj.ignoreViewport)
{ox-=this.viewport.x*Utils.globalPixelScale*Utils.globalScale;oy-=this.viewport.y*Utils.globalPixelScale*Utils.globalScale;}
if(canvasMod)
{cns.ctx.save();cns.ctx.translate(ox+Math.floor(ow/2),oy+Math.floor(oh/2));cns.ctx.rotate(or);cns.ctx.scale(scX,scY);ox=-Math.floor(ow/2);oy=-Math.floor(oh/2);}
cns.ctx.globalAlpha=obj.opacity;if(this.ceilSizes)
{ow=Math.ceil(ow);oh=Math.ceil(oh);}
if(obj.fillColor)
{cns.ctx.fillStyle=obj.fillColor;cns.ctx.strokeStyle=obj.fillColor;cns.ctx.fillRect(ox,oy,ow,oh);}
if(obj.bitmap)
{var iw=obj.bitmap.width,ih=obj.bitmap.height;var fx=obj.currentLayer*ow+obj.offset.left*Utils.globalScale,fy=obj.currentFrame*oh+obj.offset.top*Utils.globalScale;if(fx<iw&&fy<ih)
{var fw=ow,fh=oh,masked=false;if(fx+fw>iw)fw=iw-fx;if(fy+fh>ih)fh=ih-fy;if(obj.mask)
{this.buffer.ctx.save();this.buffer.ctx.clearRect(0,0,fw,fh);this.buffer.ctx.drawImage(obj.bitmap,fx,fy,fw,fh,0,0,fw,fh);this.buffer.ctx.globalCompositeOperation="destination-in";this.buffer.ctx.drawImage(obj.mask,0,0);fx=0;fy=0;masked=true;}
try
{cns.ctx.drawImage((masked?this.buffer:obj.bitmap),~~fx,~~fy,~~fw,~~fh,~~ox,~~oy,~~ow,~~oh);}
catch(e)
{}
if(masked)this.buffer.ctx.restore();}}
if(canvasMod)cns.ctx.restore();if(this.allowDebugDrawing&&obj.allowDebugDrawing)
{if(this.allowStaticDebugDrawing||!obj.static)
{obj.debugDraw();}}
obj.dispatchEvent("render",{target:obj,canvas:cns});}
this.clearObjectAABB=function(cns,obj)
{var w=obj.history.AABB[1].x-obj.history.AABB[0].x;var h=obj.history.AABB[1].y-obj.history.AABB[0].y;if(!this.fillColor)cns.ctx.clearRect((obj.history.AABB[0].x-this.viewport.x)*Utils.globalPixelScale,(obj.history.AABB[0].y-this.viewport.y)*Utils.globalPixelScale,w*Utils.globalPixelScale,h*Utils.globalPixelScale);else
{cns.ctx.fillStyle=this.fillColor;cns.ctx.fillRect((obj.history.AABB[0].x-this.viewport.x)*Utils.globalPixelScale,(obj.history.AABB[0].y-this.viewport.y)*Utils.globalPixelScale,w*Utils.globalPixelScale,h*Utils.globalPixelScale);}};this.addPartialDraw=function(partialDraw,obj)
{partialDraw.push(obj);obj.history.drawed=true;obj.history.changed=true;for(var i=0;i<this.objects.length;i++)
{if(!this.objects[i].history.changed&&this.objects[i].visible&&!this.objects[i]['static'])
{var top=Math.max(obj.history.AABB[0].y,this.objects[i].history.AABB[0].y);var left=Math.max(obj.history.AABB[0].x,this.objects[i].history.AABB[0].x);var right=Math.min(obj.history.AABB[1].x,this.objects[i].history.AABB[1].x);var bottom=Math.min(obj.history.AABB[1].y,this.objects[i].history.AABB[1].y);var width=right-left;var height=bottom-top;if(width>0&&height>0)this.addPartialDraw(partialDraw,this.objects[i]);}}
return partialDraw;};this.drawScenePartial=function(cns)
{var partialDraw=[];var rect,obj;if(!cns.ctx)cns.ctx=cns.getContext("2d");for(var i=0;i<this.objects.length;i++)
{this.objects[i].nextFrame();}
for(i=0;i<this.objects.length;i++)
{obj=this.objects[i];if(obj.visible&&!obj['static'])
{if(obj.destroy||obj.drawAlways||!obj.history.drawed||obj.currentFrame!=obj.history.frame||obj.getX()!=obj.history.x||obj.getY()!=obj.history.y||obj.rotation!=obj.history.rotation)
{partialDraw=this.addPartialDraw(partialDraw,obj);}}}
partialDraw=this.sortStack(partialDraw,true);var w,h;for(i=0;i<partialDraw.length;i++)
{this.clearObjectAABB(cns,partialDraw[i]);}
for(i=0;i<partialDraw.length;i++)
{obj=partialDraw[i];if(obj.destroy)
{this.removeChild(obj);}
else
{this.renderObject(cns,obj);obj.updateHistory();}}}
this.drawBackAlways=Utils.mobileCheckBrokenGalaxyPhones();this.drawBackBuffer=function(cns,drawStatic)
{if(!drawStatic&&this.backBuffer&&this.drawBackAlways)cns.ctx.drawImage(this.backBuffer,0,0,cns.width,cns.height);}
this.drawScene=function(cns,drawStatic)
{var obj,ok;if(!cns.ctx)cns.ctx=cns.getContext("2d");if(!this.fillColor)
{if(!this.clearLock)
{this.clearScreen(cns);this.drawBackBuffer(cns,drawStatic);}}
else
{cns.ctx.fillStyle=this.fillColor;cns.ctx.fillRect(0,0,this.screenWidth*Utils.globalScale*Utils.globalPixelScale,this.screenHeight*Utils.globalScale*Utils.globalPixelScale);this.drawBackBuffer(cns,drawStatic);}
for(var i=0;i<this.objects.length;i++)
{obj=this.objects[i];ok=false;if(!drawStatic&&!obj['static'])ok=true;if(drawStatic&&obj['static'])ok=true;if(ok)
{if(obj.destroy)
{this.removeChild(obj);i--;}
else
{obj.nextFrame();if(obj.visible)this.renderObject(cns,obj);}}}
if(drawStatic)
{this.backBuffer=cns;}};this.tweens=[];this.createTween=function(obj,prop,start,end,duration,ease)
{var t=new Tween(obj,prop,start,end,duration,ease);self.tweens.push(t);return t;}
this.removeTween=function(t)
{var id=null;if(isNaN(t))
{for(var i=0;i<self.tweens.length;i++)
{if(self.tweens[i]===t)
{id=i;break;}}}
else id=t;self.tweens[id].pause();self.tweens.splice(id,1);return id;}
this.clearObjectTweens=function(obj)
{for(var i=0;i<self.tweens.length;i++)
{if(self.tweens[i].obj===obj)
{i=self.removeTween(i);}}}
this.updateTweens=function()
{for(var i=0;i<self.tweens.length;i++)
{if(self.tweens[i].tick())
{i=self.removeTween(i);}}}
this.timers=[];this.setTimeout=function(callback,timeout)
{var t=new StageTimer(callback,timeout);this.timers.push(t);return t;};this.clearTimeout=function(t)
{this.timers=Utils.removeFromArray(this.timers,t);};this.setInterval=function(callback,timeout)
{var t=new StageTimer(callback,timeout,true);this.timers.push(t);return t;};this.clearInterval=function(t)
{this.clearTimeout(t);};this.updateTimers=function()
{for(var i=0;i<this.timers.length;i++)
{if(this.timers[i].update())
{this.clearTimeout(this.timers[i]);i--;}}};function render()
{clearTimeout(self.tmMain);var tm_start=new Date().getTime();self.updateTweens();self.updateTimers();self.dispatchEvent("pretick");if(self.partialUpdate)self.drawScenePartial(self.canvas);else self.drawScene(self.canvas,false);if(self.showFPS)
{self.setTextStyle("sans-serif",10,"bold","#fff","#000");self.drawText("FPS: "+self.lastFPS,2,10,1,true);}
self.dispatchEvent("posttick");var d=new Date().getTime()-tm_start;d=self.delay-d-1;if(d<1)d=1;self.fps++;if(self.started)self.tmMain=setTimeout(render,d);};this.box2dSync=function(world)
{var p;for(b=world.m_bodyList;b;b=b.m_next)
{if(b.sprite)
{b.sprite.rotation=b.GetRotation();p=b.GetPosition();b.sprite.x=p.x;b.sprite.y=p.y;b.sprite.dispatchEvent("box2dsync",{target:b.sprite});}}}
this.processTouchEvent=function(touches,controller)
{for(var i=0;i<touches.length;i++)
{var e={clientX:touches[i].clientX,clientY:touches[i].clientY};self[controller](e);}}
var ffOS=(navigator.userAgent.toLowerCase().indexOf("firefox")!=-1&&navigator.userAgent.toLowerCase().indexOf("mobile")!=-1);ffOS=false;if(("ontouchstart"in this.canvas)&&!ffOS)
{this.canvas.ontouchstart=function(event)
{this.renderController.processTouchEvent(event.touches,"checkMouseDown");this.renderController.processTouchEvent(event.touches,"checkClick");};this.canvas.ontouchmove=function(event)
{this.renderController.processTouchEvent(event.touches,"checkMouseMove");};this.canvas.ontouchend=function(event)
{this.renderController.processTouchEvent(event.changedTouches,"checkMouseUp");};}
else
{this.canvas.onclick=function(event)
{this.renderController.checkClick(event);};this.canvas.onmousemove=function(event)
{this.renderController.checkMouseMove(event);};this.canvas.onmousedown=function(event)
{if(event.button==0)this.renderController.checkMouseDown(event);};this.canvas.onmouseup=function(event)
{if(event.button==0)this.renderController.checkMouseUp(event);};this.canvas.oncontextmenu=function(event)
{this.renderController.checkContextMenu(event);};}
this.onpretick=null;this.onposttick=null;this.eventsListeners=[];this.addEventListener=function(type,callback)
{EventsManager.addEvent(this,type,callback);}
this.removeEventListener=function(type,callback)
{EventsManager.removeEvent(this,type,callback);}
this.dispatchEvent=function(type,params)
{return EventsManager.dispatchEvent(this,type,params);}}
function Vector(x,y)
{if(typeof(x)=='undefined')x=0;this.x=x;if(typeof(y)=='undefined')y=0;this.y=y;this.clone=function()
{return new Vector(this.x,this.y);}
this.add=function(p)
{this.x+=p.x;this.y+=p.y;return this;}
this.subtract=function(p)
{this.x-=p.x;this.y-=p.y;return this;}
this.mult=function(n)
{this.x*=n;this.y*=n;return this;}
this.invert=function()
{this.mult(-1);return this;}
this.rotate=function(angle,offset)
{if(typeof(offset)=='undefined')offset=new Vector(0,0);var r=this.clone();r.subtract(offset);r.x=this.x*Math.cos(angle)+this.y*Math.sin(angle);r.y=this.x*-Math.sin(angle)+this.y*Math.cos(angle);r.add(offset);this.x=r.x;this.y=r.y;return this;}
this.normalize=function(angle,offset)
{if(typeof(offset)=='undefined')offset=new Vector(0,0);this.subtract(offset);this.rotate(-angle);return this;}
this.getLength=function()
{return Math.sqrt(this.x*this.x+this.y*this.y);}
this.distanceTo=function(p)
{p2=this.clone();p2.subtract(p);return p2.getLength();}}
var Rectangle=function(x,y,w,h,angle)
{this.center=new Vector(x,y);this.width=w;this.height=h;this.angle=angle;this.vertices=[];this.AABB=[];this.clone=function()
{return new Rectangle(this.center.x,this.center.y,this.width,this.height,this.angle);}
this.refreshVertices=function()
{var w=this.width/2;var h=this.height/2;this.vertices=[];this.vertices.push(new Vector(-w,h));this.vertices.push(new Vector(w,h));this.vertices.push(new Vector(w,-h));this.vertices.push(new Vector(-w,-h));this.AABB=[this.center.clone(),this.center.clone()];for(var i=0;i<4;i++)
{this.vertices[i].rotate(-this.angle,this.center);if(this.vertices[i].x<this.AABB[0].x)this.AABB[0].x=this.vertices[i].x;if(this.vertices[i].x>this.AABB[1].x)this.AABB[1].x=this.vertices[i].x;if(this.vertices[i].y<this.AABB[0].y)this.AABB[0].y=this.vertices[i].y;if(this.vertices[i].y>this.AABB[1].y)this.AABB[1].y=this.vertices[i].y;}}
this.move=function(x,y)
{this.center.add(new Vector(x,y));this.refreshVertices();}
this.rotate=function(angle)
{this.angle+=angle;this.refreshVertices();}
this.hitTestPoint=function(point)
{var p=point.clone();p.normalize(-this.angle,this.center);return((Math.abs(p.x)<=(this.width/2))&&(Math.abs(p.y)<=(this.height/2)));}
this.hitTestRectangle=function(rect)
{var r1=this.clone();var r2=rect.clone();var len,len1,len2;r1.move(-this.center.x,-this.center.y);r2.move(-this.center.x,-this.center.y);r2.center.rotate(this.angle);r1.rotate(-this.angle);r2.rotate(-this.angle);len=Math.max(r1.AABB[0].x,r1.AABB[1].x,r2.AABB[0].x,r2.AABB[1].x)-Math.min(r1.AABB[0].x,r1.AABB[1].x,r2.AABB[0].x,r2.AABB[1].x);len1=r1.AABB[1].x-r1.AABB[0].x;len2=r2.AABB[1].x-r2.AABB[0].x;if(len>len1+len2)return false;len=Math.max(r1.AABB[0].y,r1.AABB[1].y,r2.AABB[0].y,r2.AABB[1].y)-Math.min(r1.AABB[0].y,r1.AABB[1].y,r2.AABB[0].y,r2.AABB[1].y);len1=r1.AABB[1].y-r1.AABB[0].y;len2=r2.AABB[1].y-r2.AABB[0].y;if(len>len1+len2)return false;r1.move(-r2.center.x,-r2.center.y);r2.move(-r2.center.x,-r2.center.y);r1.center.rotate(r2.angle);r1.refreshVertices();r1.rotate(-r2.angle);r2.rotate(-r2.angle);len=Math.max(r1.AABB[0].x,r1.AABB[1].x,r2.AABB[0].x,r2.AABB[1].x)-Math.min(r1.AABB[0].x,r1.AABB[1].x,r2.AABB[0].x,r2.AABB[1].x);len1=r1.AABB[1].x-r1.AABB[0].x;len2=r2.AABB[1].x-r2.AABB[0].x;if(len>len1+len2)return false;len=Math.max(r1.AABB[0].y,r1.AABB[1].y,r2.AABB[0].y,r2.AABB[1].y)-Math.min(r1.AABB[0].y,r1.AABB[1].y,r2.AABB[0].y,r2.AABB[1].y);len1=r1.AABB[1].y-r1.AABB[0].y;len2=r2.AABB[1].y-r2.AABB[0].y;if(len>len1+len2)return false;return true;}
this.refreshVertices();}
var Asset=function(name,src,w,h,f,l)
{this.name=name+'';this.src=src+'';this.width=w;this.height=h;this.frames=f;this.layers=l;this.bitmap=null;this.object=null;this.ready=(this.width&&this.height);this.detectSize=function()
{if(!this.bitmap)return false;try
{if(isNaN(this.width))
{this.width=this.bitmap.width?parseInt(this.bitmap.width):0;}
if(isNaN(this.height))
{this.height=this.bitmap.height?parseInt(this.bitmap.height):0;}}
catch(e)
{if(CRENDER_DEBUG)console.log(e);}
return(!isNaN(this.width)&&!isNaN(this.height));}
this.normalize=function(scale)
{if(this.ready)return;if(!this.detectSize())return;if(isNaN(this.frames)||this.frames<1)this.frames=1;if(isNaN(this.layers)||this.layers<1)this.layers=1;this.width=Math.ceil((this.width/this.layers)/scale);this.height=Math.ceil((this.height/this.frames)/scale);this.ready=true;}}
var AssetsLibrary=function(path,scale,assets)
{var self=this;this.path='images';this.scale=1;this.items={};this.bitmaps={};this.loaded=false;this.onload=null;this.onloadprogress=null;this.spriteClass=Sprite;this.init=function(path,scale)
{if(typeof path!='undefined')
{this.path=path+'';}
if(typeof scale!='undefined')
{this.scale=parseFloat(scale);if(isNaN(this.scale))this.scale=1;}}
this.addAssets=function(data)
{if(typeof data=='undefined')return;if(typeof data!='object')return;for(var i=0;i<data.length;i++)
{var item=data[i];item.noscale=(typeof item.noscale=='undefined')?false:item.noscale;if(!item.noscale)item.src='%SCALE%/'+item.src;this.addAsset(item.src,item.name,item.width,item.height,item.frames,item.layers);}}
this.addAsset=function(src,name,w,h,f,l)
{function src2name(src)
{var name=src.split('/');name=name.pop();name=name.split('.');name=name.shift()+'';return name;}
src=src.replace('%SCALE%','%PATH%/'+this.scale);src=src.replace('%PATH%',this.path);if(typeof name=='undefined')name=src2name(src);var asset=new Asset(name,src,w,h,f,l);this.items[name]=asset;return asset;}
this.addObject=function(obj)
{var asset=this.addAsset('%SCALE%/'+obj.image,obj.name,obj.width*this.scale,obj.height*this.scale,obj.frames,obj.layers);if(asset)asset.object=obj;return asset;}
this.load=function(onload,onloadprogress)
{this.onload=onload;this.onloadprogress=onloadprogress;var preloader=new ImagesPreloader();var data=[];for(var n in this.items)
data.push(this.items[n]);preloader.load(data,self.onLoadHandler,self.onLoadProgressHandler);}
this.onLoadProgressHandler=function(val)
{if(typeof self.onloadprogress=='function')
{self.onloadprogress(val);}}
this.onLoadHandler=function(data)
{self.loaded=true;for(var n in data)
{var bmp=data[n];var asset=self.items[n];asset.bitmap=bmp;asset.normalize(self.scale);}
if(typeof self.onload=='function')
{self.onload(self.items);}}
this.getAsset=function(name,checkLoad)
{var asset=null;if((typeof this.items[name]!='undefined')&&(this.items[name].bitmap))
{checkLoad=(typeof checkLoad=='undefined')?true:checkLoad;asset=(!checkLoad||this.items[name].ready)?this.items[name]:null;}
if(!asset)
{throw new Error('Trying to get undefined asset "'+name+'"');}
return asset;}
this.getSprite=function(name,params)
{var mc=null;try
{var asset=this.getAsset(name,true);mc=new this.spriteClass(asset.bitmap,asset.width,asset.height,asset.frames,asset.layers);}
catch(e)
{mc=new this.spriteClass(null,1,1,1,1);}
if(typeof params=='object')
{for(var prop in params)mc[prop]=params[prop];}
return mc;}
this.getBitmap=function(name)
{try
{var asset=this.getAsset(name,true);return asset.bitmap;}
catch(e)
{return null;}}
this.init(path,scale);this.addAssets(assets);}
if(typeof console=='undefined')
{console={log:function(){}}};function box2DCreateWorld(gravity)
{var g,s;var worldAABB=new b2AABB();worldAABB.minVertex.Set(-1000,-1000);worldAABB.maxVertex.Set(1000,1000);if(typeof gravity!="undefined")g=new b2Vec2(0,gravity);else g=new b2Vec2(0,300);return new b2World(worldAABB,g,true);}
function box2DCreateGround(world,restitution,y)
{var groundSd=new b2BoxDef();groundSd.extents.Set(10000,50);groundSd.restitution=restitution?restitution:0.2;var groundBd=new b2BodyDef();groundBd.AddShape(groundSd);groundBd.position.Set(-500,y?y:480);return world.CreateBody(groundBd);}
function box2DCreateCircle(world,x,y,radius,rotation,fixed,density,restitution,friction)
{if(typeof(fixed)=='undefined')fixed=true;var ballSd=new b2CircleDef();if(!fixed)
{ballSd.density=density?density:0.8;ballSd.restitution=restitution?restitution:0.1;ballSd.friction=friction?friction:3;}
ballSd.radius=radius;var ballBd=new b2BodyDef();ballBd.rotation=rotation;ballBd.AddShape(ballSd);ballBd.position.Set(x,y);return world.CreateBody(ballBd);}
function box2DCreateBox(world,x,y,width,height,rotation,fixed,density,restitution,friction)
{if(typeof(fixed)=='undefined')fixed=true;var boxSd=new b2BoxDef();if(!fixed)
{boxSd.density=density?density:1.0;boxSd.restitution=restitution?restitution:0.2;boxSd.friction=friction?friction:0.3;}
boxSd.extents.Set(width,height);var boxBd=new b2BodyDef();boxBd.rotation=rotation;boxBd.AddShape(boxSd);boxBd.position.Set(x,y);return world.CreateBody(boxBd);}
function box2DCreatePoly(world,x,y,points,rotation,fixed,density,restitution,friction)
{var polyBd=new b2BodyDef();polyBd.rotation=rotation;for(var n=0;n<points.length;n++)
{var p=points[n];var polySd=new b2PolyDef();if(!fixed)
{polySd.density=density?density:1.0;polySd.restitution=restitution?restitution:0.2;polySd.friction=friction?friction:0.3;}
polySd.vertexCount=p.length;for(var i=0;i<p.length;i++)
{polySd.vertices[i].Set(p[i][0],p[i][1]);}
polyBd.AddShape(polySd);}
polyBd.position.Set(x,y);return world.CreateBody(polyBd);};function box2DCreateRevoluteJoint(world,body1,body2,point,motor)
{var jointDef=new b2RevoluteJointDef();jointDef.body1=body1;jointDef.body2=body2;jointDef.anchorPoint=point;jointDef.collideConnected=true;if(motor)
{jointDef.motorSpeed=motor;jointDef.motorTorque=500000000;jointDef.enableMotor=true;}
return world.CreateJoint(jointDef);};function box2DCreateDistanceJoint(world,body1,body2,point1,point2)
{var jointDef=new b2DistanceJointDef();jointDef.body1=body1;jointDef.body2=body2;jointDef.anchorPoint1=point1;jointDef.anchorPoint2=point2;jointDef.collideConnected=true;return world.CreateJoint(jointDef);};function box2DCreatePrismaticJoint(world,body1,body2,point,motor)
{var jointDef=new b2PrismaticJointDef();jointDef.anchorPoint.Set(point.x,point.y);jointDef.body1=body1;jointDef.body2=body2;jointDef.axis.Set(0.0,1.0);if(motor)
{jointDef.motorSpeed=motor;jointDef.motorForce=100000.0;jointDef.enableMotor=true;}
return world.CreateJoint(jointDef);};var Prototype={Version:'1.6.0.2',Browser:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf('AppleWebKit/')>-1,Gecko:navigator.userAgent.indexOf('Gecko')>-1&&navigator.userAgent.indexOf('KHTML')==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement('div').__proto__&&document.createElement('div').__proto__!==document.createElement('form').__proto__},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;var Class={create:function()
{var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))parent=properties.shift();function klass(){this.initialize.apply(this,arguments);}
Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent)
{var subclass=function(){};subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}
for(var i=0;i<properties.length;i++)klass.addMethods(properties[i]);if(!klass.prototype.initialize)klass.prototype.initialize=Prototype.emptyFunction;klass.prototype.constructor=klass;return klass;}};Class.Methods={addMethods:function(source)
{var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length)properties.push("toString","valueOf");for(var i=0,length=properties.length;i<length;i++)
{var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames().first()=="$super")
{var method=value;value=Object.extend((function(m){return function(){return ancestor[m].apply(this,arguments)};})(property).wrap(method),{valueOf:function(){return method},toString:function(){return method.toString()}});}
this.prototype[property]=value;}
return this;}};var Abstract={};Object.extend=function(destination,source)
{for(var property in source)destination[property]=source[property];return destination;};Object.extend(Object,{inspect:function(object)
{try
{if(Object.isUndefined(object))return'undefined';if(object===null)return'null';return object.inspect?object.inspect():String(object);}
catch(e)
{if(e instanceof RangeError)return'...';throw e;}},toJSON:function(object)
{var type=typeof object;switch(type)
{case'undefined':case'function':case'unknown':return;case'boolean':return object.toString();}
if(object===null)return'null';if(object.toJSON)return object.toJSON();if(Object.isElement(object))return;var results=[];for(var property in object)
{var value=Object.toJSON(object[property]);if(!Object.isUndefined(value))
results.push(property.toJSON()+': '+value);}
return'{'+results.join(', ')+'}';},toQueryString:function(object){return $H(object).toQueryString();},toHTML:function(object){return object&&object.toHTML?object.toHTML():String.interpret(object);},keys:function(object)
{var keys=[];for(var property in object)
keys.push(property);return keys;},values:function(object)
{var values=[];for(var property in object)
values.push(object[property]);return values;},clone:function(object){return Object.extend({},object);},isElement:function(object){return object&&object.nodeType==1;},isArray:function(object)
{return object!=null&&typeof object=="object"&&'splice'in object&&'join'in object;},isHash:function(object){return object instanceof Hash;},isFunction:function(object){return typeof object=="function";},isString:function(object){return typeof object=="string";},isNumber:function(object){return typeof object=="number";},isUndefined:function(object){return typeof object=="undefined";}});Object.extend(Function.prototype,{argumentNames:function()
{var names=this.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",").invoke("strip");return names.length==1&&!names[0]?[]:names;},bind:function()
{if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var __method=this,args=$A(arguments),object=args.shift();return function(){return __method.apply(object,args.concat($A(arguments)));}},bindAsEventListener:function()
{var __method=this,args=$A(arguments),object=args.shift();return function(event){return __method.apply(object,[event||window.event].concat(args));}},curry:function()
{if(!arguments.length)return this;var __method=this,args=$A(arguments);return function(){return __method.apply(this,args.concat($A(arguments)));}},delay:function()
{var __method=this,args=$A(arguments),timeout=args.shift()*1000;return window.setTimeout(function(){return __method.apply(__method,args);},timeout);},wrap:function(wrapper)
{var __method=this;return function(){return wrapper.apply(this,[__method.bind(this)].concat($A(arguments)));}},methodize:function()
{if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){return __method.apply(null,[this].concat($A(arguments)));};}});Function.prototype.defer=Function.prototype.delay.curry(0.01);Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,{gsub:function(pattern,replacement)
{var result='',source=this,match;replacement=arguments.callee.prepareReplacement(replacement);while(source.length>0)
{if(match=source.match(pattern))
{result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}
else result+=source,source='';}
return result;},sub:function(pattern,replacement,count)
{replacement=this.gsub.prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match)
{if(--count<0)return match[0];return replacement(match);});},scan:function(pattern,iterator)
{this.gsub(pattern,iterator);return String(this);},truncate:function(length,truncation)
{length=length||30;truncation=Object.isUndefined(truncation)?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);},strip:function(){return this.replace(/^\s+/,'').replace(/\s+$/,'');},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,'');},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');},extractScripts:function()
{var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)});},escapeHTML:function()
{var self=arguments.callee;self.text.data=this;return self.div.innerHTML;},unescapeHTML:function()
{var div=new Element('div');div.innerHTML=this.stripTags();return div.childNodes[0]?(div.childNodes.length>1?$A(div.childNodes).inject('',function(memo,node){return memo+node.nodeValue}):div.childNodes[0].nodeValue):'';},toQueryParams:function(separator)
{var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair)
{if((pair=pair.split('='))[0])
{var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash)
{if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}
else hash[key]=value;}
return hash;});},toArray:function(){return this.split('');},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1);},times:function(count){return count<1?'':new Array(count+1).join(this);},camelize:function()
{var parts=this.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=this.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++)camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);return camelized;},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();},underscore:function(){return this.gsub(/::/,'/').gsub(/([A-Z]+)([A-Z][a-z])/,'#{1}_#{2}').gsub(/([a-z\d])([A-Z])/,'#{1}_#{2}').gsub(/-/,'_').toLowerCase();},dasherize:function(){return this.gsub(/_/,'-');},inspect:function(useDoubleQuotes)
{var escapedString=this.gsub(/[\x00-\x1f\\]/,function(match)
{var character=String.specialChar[match[0]];return character?character:'\\u00'+match[0].charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return'"'+escapedString.replace(/"/g,'\\"')+'"';return"'"+escapedString.replace(/'/g,'\\\'')+"'";},toJSON:function(){return this.inspect(true);},unfilterJSON:function(filter){return this.sub(filter||Prototype.JSONFilter,'#{1}');},isJSON:function()
{var str=this;if(str.blank())return false;str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);},evalJSON:function(sanitize)
{var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}
throw new SyntaxError('Badly formed JSON string: '+this.inspect());},include:function(pattern){return this.indexOf(pattern)>-1;},startsWith:function(pattern){return this.indexOf(pattern)===0;},endsWith:function(pattern)
{var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;},empty:function(){return this=='';},blank:function(){return /^\s*$/.test(this);},interpolate:function(object,pattern){return new Template(this,pattern).evaluate(object);}});if(Prototype.Browser.WebKit||Prototype.Browser.IE)Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},unescapeHTML:function(){return this.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>');}});String.prototype.gsub.prepareReplacement=function(replacement)
{if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement('div'),text:document.createTextNode('')});with(String.prototype.escapeHTML)div.appendChild(text);var Template=Class.create({initialize:function(template,pattern)
{this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object)
{if(Object.isFunction(object.toTemplateReplacements))object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match)
{if(object==null)return'';var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3];var pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null)return before;while(match!=null)
{var comp=match[1].startsWith('[')?match[2].gsub('\\\\]',']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}
return before+String.interpret(ctx);});}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable={each:function(iterator,context)
{var index=0;iterator=iterator.bind(context);try{this._each(function(value){iterator(value,index++);});}
catch(e){if(e!=$break)throw e;}
return this;},eachSlice:function(number,iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var index=-number,slices=[],array=this.toArray();while((index+=number)<array.length)
slices.push(array.slice(index,index+number));return slices.collect(iterator,context);},all:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result=true;this.each(function(value,index)
{result=result&&!!iterator(value,index);if(!result)throw $break;});return result;},any:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result=false;this.each(function(value,index)
{if(result=!!iterator(value,index))
throw $break;});return result;},collect:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var results=[];this.each(function(value,index){results.push(iterator(value,index));});return results;},detect:function(iterator,context)
{iterator=iterator.bind(context);var result;this.each(function(value,index)
{if(iterator(value,index)){result=value;throw $break;}});return result;},findAll:function(iterator,context)
{iterator=iterator.bind(context);var results=[];this.each(function(value,index)
{if(iterator(value,index))
results.push(value);});return results;},grep:function(filter,iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var results=[];if(Object.isString(filter))
filter=new RegExp(filter);this.each(function(value,index)
{if(filter.match(value))
results.push(iterator(value,index));});return results;},include:function(object)
{if(Object.isFunction(this.indexOf))
if(this.indexOf(object)!=-1)return true;var found=false;this.each(function(value)
{if(value==object){found=true;throw $break;}});return found;},inGroupsOf:function(number,fillWith)
{fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice)
{while(slice.length<number)slice.push(fillWith);return slice;});},inject:function(memo,iterator,context)
{iterator=iterator.bind(context);this.each(function(value,index){memo=iterator(memo,value,index);});return memo;},invoke:function(method)
{var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});},max:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result;this.each(function(value,index)
{value=iterator(value,index);if(result==null||value>=result)result=value;});return result;},min:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result;this.each(function(value,index)
{value=iterator(value,index);if(result==null||value<result)result=value;});return result;},partition:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var trues=[],falses=[];this.each(function(value,index)
{(iterator(value,index)?trues:falses).push(value);});return[trues,falses];},pluck:function(property)
{var results=[];this.each(function(value){results.push(value[property]);});return results;},reject:function(iterator,context)
{iterator=iterator.bind(context);var results=[];this.each(function(value,index)
{if(!iterator(value,index))results.push(value);});return results;},sortBy:function(iterator,context)
{iterator=iterator.bind(context);return this.map(function(value,index){return{value:value,criteria:iterator(value,index)};}).sort(function(left,right)
{var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}).pluck('value');},toArray:function(){return this.map();},zip:function()
{var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});},size:function(){return this.toArray().length;},inspect:function(){return'#<Enumerable:'+this.toArray().inspect()+'>';}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(iterable)
{if(!iterable)return[];if(iterable.toArray)return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;}
if(Prototype.Browser.WebKit)
{$A=function(iterable)
{if(!iterable)return[];if(!(Object.isFunction(iterable)&&iterable=='[object NodeList]')&&iterable.toArray)return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;};}
Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse)Array.prototype._reverse=Array.prototype.reverse;Object.extend(Array.prototype,{_each:function(iterator){for(var i=0,length=this.length;i<length;i++)iterator(this[i]);},clear:function(){this.length=0;return this;},first:function(){return this[0];},last:function(){return this[this.length-1];},compact:function(){return this.select(function(value){return value!=null;});},flatten:function()
{return this.inject([],function(array,value){return array.concat(Object.isArray(value)?value.flatten():[value]);});},without:function()
{var values=$A(arguments);return this.select(function(value){return!values.include(value);});},reverse:function(inline){return(inline!==false?this:this.toArray())._reverse();},reduce:function(){return this.length>1?this:this[0];},uniq:function(sorted)
{return this.inject([],function(array,value,index)
{if(0==index||(sorted?array.last()!=value:!array.include(value)))array.push(value);return array;});},intersect:function(array)
{return this.uniq().findAll(function(item){return array.detect(function(value){return item===value});});},clone:function(){return[].concat(this);},size:function(){return this.length;},inspect:function(){return'['+this.map(Object.inspect).join(', ')+']';},toJSON:function()
{var results=[];this.each(function(object)
{var value=Object.toJSON(object);if(!Object.isUndefined(value))results.push(value);});return'['+results.join(', ')+']';}});if(Object.isFunction(Array.prototype.forEach))Array.prototype._each=Array.prototype.forEach;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(item,i)
{i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)if(this[i]===item)return i;return-1;};if(!Array.prototype.lastIndexOf)Array.prototype.lastIndexOf=function(item,i)
{i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;};Array.prototype.toArray=Array.prototype.clone;var b2Settings=Class.create();b2Settings.prototype={initialize:function(){}}
b2Settings.USHRT_MAX=0x0000ffff;b2Settings.b2_pi=Math.PI;b2Settings.b2_massUnitsPerKilogram=1.0;b2Settings.b2_timeUnitsPerSecond=1.0;b2Settings.b2_lengthUnitsPerMeter=30.0;b2Settings.b2_maxManifoldPoints=2;b2Settings.b2_maxShapesPerBody=64;b2Settings.b2_maxPolyVertices=8;b2Settings.b2_maxProxies=1024;b2Settings.b2_maxPairs=8*b2Settings.b2_maxProxies;b2Settings.b2_linearSlop=0.005*b2Settings.b2_lengthUnitsPerMeter;b2Settings.b2_angularSlop=2.0/180.0*b2Settings.b2_pi;b2Settings.b2_velocityThreshold=1.0*b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_maxLinearCorrection=0.2*b2Settings.b2_lengthUnitsPerMeter;b2Settings.b2_maxAngularCorrection=8.0/180.0*b2Settings.b2_pi;b2Settings.b2_contactBaumgarte=0.2;b2Settings.b2_timeToSleep=0.5*b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_linearSleepTolerance=0.01*b2Settings.b2_lengthUnitsPerMeter/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2_angularSleepTolerance=2.0/180.0/b2Settings.b2_timeUnitsPerSecond;b2Settings.b2Assert=function(a)
{if(!a){var nullVec;nullVec.x++;}};var b2Vec2=Class.create();b2Vec2.prototype={initialize:function(x_,y_){this.x=x_;this.y=y_;},SetZero:function(){this.x=0.0;this.y=0.0;},Set:function(x_,y_){this.x=x_;this.y=y_;},SetV:function(v){this.x=v.x;this.y=v.y;},Negative:function(){return new b2Vec2(-this.x,-this.y);},Copy:function(){return new b2Vec2(this.x,this.y);},Add:function(v)
{this.x+=v.x;this.y+=v.y;},Subtract:function(v)
{this.x-=v.x;this.y-=v.y;},Multiply:function(a)
{this.x*=a;this.y*=a;},MulM:function(A)
{var tX=this.x;this.x=A.col1.x*tX+A.col2.x*this.y;this.y=A.col1.y*tX+A.col2.y*this.y;},MulTM:function(A)
{var tX=b2Math.b2Dot(this,A.col1);this.y=b2Math.b2Dot(this,A.col2);this.x=tX;},CrossVF:function(s)
{var tX=this.x;this.x=s*this.y;this.y=-s*tX;},CrossFV:function(s)
{var tX=this.x;this.x=-s*this.y;this.y=s*tX;},MinV:function(b)
{this.x=this.x<b.x?this.x:b.x;this.y=this.y<b.y?this.y:b.y;},MaxV:function(b)
{this.x=this.x>b.x?this.x:b.x;this.y=this.y>b.y?this.y:b.y;},Abs:function()
{this.x=Math.abs(this.x);this.y=Math.abs(this.y);},Length:function()
{return Math.sqrt(this.x*this.x+this.y*this.y);},Normalize:function()
{var length=this.Length();if(length<Number.MIN_VALUE)
{return 0.0;}
var invLength=1.0/length;this.x*=invLength;this.y*=invLength;return length;},IsValid:function()
{return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y);},x:null,y:null};b2Vec2.Make=function(x_,y_)
{return new b2Vec2(x_,y_);};var b2Mat22=Class.create();b2Mat22.prototype={initialize:function(angle,c1,c2)
{if(angle==null)angle=0;this.col1=new b2Vec2();this.col2=new b2Vec2();if(c1!=null&&c2!=null){this.col1.SetV(c1);this.col2.SetV(c2);}
else{var c=Math.cos(angle);var s=Math.sin(angle);this.col1.x=c;this.col2.x=-s;this.col1.y=s;this.col2.y=c;}},Set:function(angle)
{var c=Math.cos(angle);var s=Math.sin(angle);this.col1.x=c;this.col2.x=-s;this.col1.y=s;this.col2.y=c;},SetVV:function(c1,c2)
{this.col1.SetV(c1);this.col2.SetV(c2);},Copy:function(){return new b2Mat22(0,this.col1,this.col2);},SetM:function(m)
{this.col1.SetV(m.col1);this.col2.SetV(m.col2);},AddM:function(m)
{this.col1.x+=m.col1.x;this.col1.y+=m.col1.y;this.col2.x+=m.col2.x;this.col2.y+=m.col2.y;},SetIdentity:function()
{this.col1.x=1.0;this.col2.x=0.0;this.col1.y=0.0;this.col2.y=1.0;},SetZero:function()
{this.col1.x=0.0;this.col2.x=0.0;this.col1.y=0.0;this.col2.y=0.0;},Invert:function(out)
{var a=this.col1.x;var b=this.col2.x;var c=this.col1.y;var d=this.col2.y;var det=a*d-b*c;det=1.0/det;out.col1.x=det*d;out.col2.x=-det*b;out.col1.y=-det*c;out.col2.y=det*a;return out;},Solve:function(out,bX,bY)
{var a11=this.col1.x;var a12=this.col2.x;var a21=this.col1.y;var a22=this.col2.y;var det=a11*a22-a12*a21;det=1.0/det;out.x=det*(a22*bX-a12*bY);out.y=det*(a11*bY-a21*bX);return out;},Abs:function()
{this.col1.Abs();this.col2.Abs();},col1:new b2Vec2(),col2:new b2Vec2()};var b2Math=Class.create();b2Math.prototype={initialize:function(){}}
b2Math.b2IsValid=function(x)
{return isFinite(x);};b2Math.b2Dot=function(a,b)
{return a.x*b.x+a.y*b.y;};b2Math.b2CrossVV=function(a,b)
{return a.x*b.y-a.y*b.x;};b2Math.b2CrossVF=function(a,s)
{var v=new b2Vec2(s*a.y,-s*a.x);return v;};b2Math.b2CrossFV=function(s,a)
{var v=new b2Vec2(-s*a.y,s*a.x);return v;};b2Math.b2MulMV=function(A,v)
{var u=new b2Vec2(A.col1.x*v.x+A.col2.x*v.y,A.col1.y*v.x+A.col2.y*v.y);return u;};b2Math.b2MulTMV=function(A,v)
{var u=new b2Vec2(b2Math.b2Dot(v,A.col1),b2Math.b2Dot(v,A.col2));return u;};b2Math.AddVV=function(a,b)
{var v=new b2Vec2(a.x+b.x,a.y+b.y);return v;};b2Math.SubtractVV=function(a,b)
{var v=new b2Vec2(a.x-b.x,a.y-b.y);return v;};b2Math.MulFV=function(s,a)
{var v=new b2Vec2(s*a.x,s*a.y);return v;};b2Math.AddMM=function(A,B)
{var C=new b2Mat22(0,b2Math.AddVV(A.col1,B.col1),b2Math.AddVV(A.col2,B.col2));return C;};b2Math.b2MulMM=function(A,B)
{var C=new b2Mat22(0,b2Math.b2MulMV(A,B.col1),b2Math.b2MulMV(A,B.col2));return C;};b2Math.b2MulTMM=function(A,B)
{var c1=new b2Vec2(b2Math.b2Dot(A.col1,B.col1),b2Math.b2Dot(A.col2,B.col1));var c2=new b2Vec2(b2Math.b2Dot(A.col1,B.col2),b2Math.b2Dot(A.col2,B.col2));var C=new b2Mat22(0,c1,c2);return C;};b2Math.b2Abs=function(a)
{return a>0.0?a:-a;};b2Math.b2AbsV=function(a)
{var b=new b2Vec2(b2Math.b2Abs(a.x),b2Math.b2Abs(a.y));return b;};b2Math.b2AbsM=function(A)
{var B=new b2Mat22(0,b2Math.b2AbsV(A.col1),b2Math.b2AbsV(A.col2));return B;};b2Math.b2Min=function(a,b)
{return a<b?a:b;};b2Math.b2MinV=function(a,b)
{var c=new b2Vec2(b2Math.b2Min(a.x,b.x),b2Math.b2Min(a.y,b.y));return c;};b2Math.b2Max=function(a,b)
{return a>b?a:b;};b2Math.b2MaxV=function(a,b)
{var c=new b2Vec2(b2Math.b2Max(a.x,b.x),b2Math.b2Max(a.y,b.y));return c;};b2Math.b2Clamp=function(a,low,high)
{return b2Math.b2Max(low,b2Math.b2Min(a,high));};b2Math.b2ClampV=function(a,low,high)
{return b2Math.b2MaxV(low,b2Math.b2MinV(a,high));};b2Math.b2Swap=function(a,b)
{var tmp=a[0];a[0]=b[0];b[0]=tmp;};b2Math.b2Random=function()
{return Math.random()*2-1;};b2Math.b2NextPowerOfTwo=function(x)
{x|=(x>>1)&0x7FFFFFFF;x|=(x>>2)&0x3FFFFFFF;x|=(x>>4)&0x0FFFFFFF;x|=(x>>8)&0x00FFFFFF;x|=(x>>16)&0x0000FFFF;return x+1;};b2Math.b2IsPowerOfTwo=function(x)
{var result=x>0&&(x&(x-1))==0;return result;};b2Math.tempVec2=new b2Vec2();b2Math.tempVec3=new b2Vec2();b2Math.tempVec4=new b2Vec2();b2Math.tempVec5=new b2Vec2();b2Math.tempMat=new b2Mat22();var b2AABB=Class.create();b2AABB.prototype={IsValid:function(){var dX=this.maxVertex.x;var dY=this.maxVertex.y;dX=this.maxVertex.x;dY=this.maxVertex.y;dX-=this.minVertex.x;dY-=this.minVertex.y;var valid=dX>=0.0&&dY>=0.0;valid=valid&&this.minVertex.IsValid()&&this.maxVertex.IsValid();return valid;},minVertex:new b2Vec2(),maxVertex:new b2Vec2(),initialize:function(){this.minVertex=new b2Vec2();this.maxVertex=new b2Vec2();}};var b2Bound=Class.create();b2Bound.prototype={IsLower:function(){return(this.value&1)==0;},IsUpper:function(){return(this.value&1)==1;},Swap:function(b){var tempValue=this.value;var tempProxyId=this.proxyId;var tempStabbingCount=this.stabbingCount;this.value=b.value;this.proxyId=b.proxyId;this.stabbingCount=b.stabbingCount;b.value=tempValue;b.proxyId=tempProxyId;b.stabbingCount=tempStabbingCount;},value:0,proxyId:0,stabbingCount:0,initialize:function(){}}
var b2BoundValues=Class.create();b2BoundValues.prototype={lowerValues:[0,0],upperValues:[0,0],initialize:function(){this.lowerValues=[0,0];this.upperValues=[0,0];}}
var b2Pair=Class.create();b2Pair.prototype={SetBuffered:function(){this.status|=b2Pair.e_pairBuffered;},ClearBuffered:function(){this.status&=~b2Pair.e_pairBuffered;},IsBuffered:function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered;},SetRemoved:function(){this.status|=b2Pair.e_pairRemoved;},ClearRemoved:function(){this.status&=~b2Pair.e_pairRemoved;},IsRemoved:function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved;},SetFinal:function(){this.status|=b2Pair.e_pairFinal;},IsFinal:function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal;},userData:null,proxyId1:0,proxyId2:0,next:0,status:0,initialize:function(){}};b2Pair.b2_nullPair=b2Settings.USHRT_MAX;b2Pair.b2_nullProxy=b2Settings.USHRT_MAX;b2Pair.b2_tableCapacity=b2Settings.b2_maxPairs;b2Pair.b2_tableMask=b2Pair.b2_tableCapacity-1;b2Pair.e_pairBuffered=0x0001;b2Pair.e_pairRemoved=0x0002;b2Pair.e_pairFinal=0x0004;var b2PairCallback=Class.create();b2PairCallback.prototype={PairAdded:function(proxyUserData1,proxyUserData2){return null},PairRemoved:function(proxyUserData1,proxyUserData2,pairUserData){},initialize:function(){}};var b2BufferedPair=Class.create();b2BufferedPair.prototype={proxyId1:0,proxyId2:0,initialize:function(){}}
var b2PairManager=Class.create();b2PairManager.prototype={initialize:function(){var i=0;this.m_hashTable=new Array(b2Pair.b2_tableCapacity);for(i=0;i<b2Pair.b2_tableCapacity;++i)
{this.m_hashTable[i]=b2Pair.b2_nullPair;}
this.m_pairs=new Array(b2Settings.b2_maxPairs);for(i=0;i<b2Settings.b2_maxPairs;++i)
{this.m_pairs[i]=new b2Pair();}
this.m_pairBuffer=new Array(b2Settings.b2_maxPairs);for(i=0;i<b2Settings.b2_maxPairs;++i)
{this.m_pairBuffer[i]=new b2BufferedPair();}
for(i=0;i<b2Settings.b2_maxPairs;++i)
{this.m_pairs[i].proxyId1=b2Pair.b2_nullProxy;this.m_pairs[i].proxyId2=b2Pair.b2_nullProxy;this.m_pairs[i].userData=null;this.m_pairs[i].status=0;this.m_pairs[i].next=(i+1);}
this.m_pairs[b2Settings.b2_maxPairs-1].next=b2Pair.b2_nullPair;this.m_pairCount=0;},Initialize:function(broadPhase,callback){this.m_broadPhase=broadPhase;this.m_callback=callback;},AddBufferedPair:function(proxyId1,proxyId2){var pair=this.AddPair(proxyId1,proxyId2);if(pair.IsBuffered()==false)
{pair.SetBuffered();this.m_pairBuffer[this.m_pairBufferCount].proxyId1=pair.proxyId1;this.m_pairBuffer[this.m_pairBufferCount].proxyId2=pair.proxyId2;++this.m_pairBufferCount;}
pair.ClearRemoved();if(b2BroadPhase.s_validate)
{this.ValidateBuffer();}},RemoveBufferedPair:function(proxyId1,proxyId2){var pair=this.Find(proxyId1,proxyId2);if(pair==null)
{return;}
if(pair.IsBuffered()==false)
{pair.SetBuffered();this.m_pairBuffer[this.m_pairBufferCount].proxyId1=pair.proxyId1;this.m_pairBuffer[this.m_pairBufferCount].proxyId2=pair.proxyId2;++this.m_pairBufferCount;}
pair.SetRemoved();if(b2BroadPhase.s_validate)
{this.ValidateBuffer();}},Commit:function(){var i=0;var removeCount=0;var proxies=this.m_broadPhase.m_proxyPool;for(i=0;i<this.m_pairBufferCount;++i)
{var pair=this.Find(this.m_pairBuffer[i].proxyId1,this.m_pairBuffer[i].proxyId2);pair.ClearBuffered();var proxy1=proxies[pair.proxyId1];var proxy2=proxies[pair.proxyId2];if(pair.IsRemoved())
{if(pair.IsFinal()==true)
{this.m_callback.PairRemoved(proxy1.userData,proxy2.userData,pair.userData);}
this.m_pairBuffer[removeCount].proxyId1=pair.proxyId1;this.m_pairBuffer[removeCount].proxyId2=pair.proxyId2;++removeCount;}
else
{if(pair.IsFinal()==false)
{pair.userData=this.m_callback.PairAdded(proxy1.userData,proxy2.userData);pair.SetFinal();}}}
for(i=0;i<removeCount;++i)
{this.RemovePair(this.m_pairBuffer[i].proxyId1,this.m_pairBuffer[i].proxyId2);}
this.m_pairBufferCount=0;if(b2BroadPhase.s_validate)
{this.ValidateTable();}},AddPair:function(proxyId1,proxyId2){if(proxyId1>proxyId2){var temp=proxyId1;proxyId1=proxyId2;proxyId2=temp;}
var hash=b2PairManager.Hash(proxyId1,proxyId2)&b2Pair.b2_tableMask;var pair=pair=this.FindHash(proxyId1,proxyId2,hash);if(pair!=null)
{return pair;}
var pIndex=this.m_freePair;pair=this.m_pairs[pIndex];this.m_freePair=pair.next;pair.proxyId1=proxyId1;pair.proxyId2=proxyId2;pair.status=0;pair.userData=null;pair.next=this.m_hashTable[hash];this.m_hashTable[hash]=pIndex;++this.m_pairCount;return pair;},RemovePair:function(proxyId1,proxyId2){if(proxyId1>proxyId2){var temp=proxyId1;proxyId1=proxyId2;proxyId2=temp;}
var hash=b2PairManager.Hash(proxyId1,proxyId2)&b2Pair.b2_tableMask;var node=this.m_hashTable[hash];var pNode=null;while(node!=b2Pair.b2_nullPair)
{if(b2PairManager.Equals(this.m_pairs[node],proxyId1,proxyId2))
{var index=node;if(pNode){pNode.next=this.m_pairs[node].next;}
else{this.m_hashTable[hash]=this.m_pairs[node].next;}
var pair=this.m_pairs[index];var userData=pair.userData;pair.next=this.m_freePair;pair.proxyId1=b2Pair.b2_nullProxy;pair.proxyId2=b2Pair.b2_nullProxy;pair.userData=null;pair.status=0;this.m_freePair=index;--this.m_pairCount;return userData;}
else
{pNode=this.m_pairs[node];node=pNode.next;}}
return null;},Find:function(proxyId1,proxyId2){if(proxyId1>proxyId2){var temp=proxyId1;proxyId1=proxyId2;proxyId2=temp;}
var hash=b2PairManager.Hash(proxyId1,proxyId2)&b2Pair.b2_tableMask;return this.FindHash(proxyId1,proxyId2,hash);},FindHash:function(proxyId1,proxyId2,hash){var index=this.m_hashTable[hash];while(index!=b2Pair.b2_nullPair&&b2PairManager.Equals(this.m_pairs[index],proxyId1,proxyId2)==false)
{index=this.m_pairs[index].next;}
if(index==b2Pair.b2_nullPair)
{return null;}
return this.m_pairs[index];},ValidateBuffer:function(){},ValidateTable:function(){},m_broadPhase:null,m_callback:null,m_pairs:null,m_freePair:0,m_pairCount:0,m_pairBuffer:null,m_pairBufferCount:0,m_hashTable:null};b2PairManager.Hash=function(proxyId1,proxyId2)
{var key=((proxyId2<<16)&0xffff0000)|proxyId1;key=~key+((key<<15)&0xFFFF8000);key=key^((key>>12)&0x000fffff);key=key+((key<<2)&0xFFFFFFFC);key=key^((key>>4)&0x0fffffff);key=key*2057;key=key^((key>>16)&0x0000ffff);return key;};b2PairManager.Equals=function(pair,proxyId1,proxyId2)
{return(pair.proxyId1==proxyId1&&pair.proxyId2==proxyId2);};b2PairManager.EqualsPair=function(pair1,pair2)
{return pair1.proxyId1==pair2.proxyId1&&pair1.proxyId2==pair2.proxyId2;};var b2BroadPhase=Class.create();b2BroadPhase.prototype={initialize:function(worldAABB,callback){this.m_pairManager=new b2PairManager();this.m_proxyPool=new Array(b2Settings.b2_maxPairs);this.m_bounds=new Array(2*b2Settings.b2_maxProxies);this.m_queryResults=new Array(b2Settings.b2_maxProxies);this.m_quantizationFactor=new b2Vec2();var i=0;this.m_pairManager.Initialize(this,callback);this.m_worldAABB=worldAABB;this.m_proxyCount=0;for(i=0;i<b2Settings.b2_maxProxies;i++){this.m_queryResults[i]=0;}
this.m_bounds=new Array(2);for(i=0;i<2;i++){this.m_bounds[i]=new Array(2*b2Settings.b2_maxProxies);for(var j=0;j<2*b2Settings.b2_maxProxies;j++){this.m_bounds[i][j]=new b2Bound();}}
var dX=worldAABB.maxVertex.x;var dY=worldAABB.maxVertex.y;dX-=worldAABB.minVertex.x;dY-=worldAABB.minVertex.y;this.m_quantizationFactor.x=b2Settings.USHRT_MAX/dX;this.m_quantizationFactor.y=b2Settings.USHRT_MAX/dY;var tProxy;for(i=0;i<b2Settings.b2_maxProxies-1;++i)
{tProxy=new b2Proxy();this.m_proxyPool[i]=tProxy;tProxy.SetNext(i+1);tProxy.timeStamp=0;tProxy.overlapCount=b2BroadPhase.b2_invalid;tProxy.userData=null;}
tProxy=new b2Proxy();this.m_proxyPool[b2Settings.b2_maxProxies-1]=tProxy;tProxy.SetNext(b2Pair.b2_nullProxy);tProxy.timeStamp=0;tProxy.overlapCount=b2BroadPhase.b2_invalid;tProxy.userData=null;this.m_freeProxy=0;this.m_timeStamp=1;this.m_queryResultCount=0;},InRange:function(aabb){var dX;var dY;var d2X;var d2Y;dX=aabb.minVertex.x;dY=aabb.minVertex.y;dX-=this.m_worldAABB.maxVertex.x;dY-=this.m_worldAABB.maxVertex.y;d2X=this.m_worldAABB.minVertex.x;d2Y=this.m_worldAABB.minVertex.y;d2X-=aabb.maxVertex.x;d2Y-=aabb.maxVertex.y;dX=b2Math.b2Max(dX,d2X);dY=b2Math.b2Max(dY,d2Y);return b2Math.b2Max(dX,dY)<0.0;},GetProxy:function(proxyId){if(proxyId==b2Pair.b2_nullProxy||this.m_proxyPool[proxyId].IsValid()==false)
{return null;}
return this.m_proxyPool[proxyId];},CreateProxy:function(aabb,userData){var index=0;var proxy;var proxyId=this.m_freeProxy;proxy=this.m_proxyPool[proxyId];this.m_freeProxy=proxy.GetNext();proxy.overlapCount=0;proxy.userData=userData;var boundCount=2*this.m_proxyCount;var lowerValues=new Array();var upperValues=new Array();this.ComputeBounds(lowerValues,upperValues,aabb);for(var axis=0;axis<2;++axis)
{var bounds=this.m_bounds[axis];var lowerIndex=0;var upperIndex=0;var lowerIndexOut=[lowerIndex];var upperIndexOut=[upperIndex];this.Query(lowerIndexOut,upperIndexOut,lowerValues[axis],upperValues[axis],bounds,boundCount,axis);lowerIndex=lowerIndexOut[0];upperIndex=upperIndexOut[0];var tArr=new Array();var j=0;var tEnd=boundCount-upperIndex
var tBound1;var tBound2;for(j=0;j<tEnd;j++){tArr[j]=new b2Bound();tBound1=tArr[j];tBound2=bounds[upperIndex+j];tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
tEnd=tArr.length;var tIndex=upperIndex+2;for(j=0;j<tEnd;j++){tBound2=tArr[j];tBound1=bounds[tIndex+j]
tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
tArr=new Array();tEnd=upperIndex-lowerIndex;for(j=0;j<tEnd;j++){tArr[j]=new b2Bound();tBound1=tArr[j];tBound2=bounds[lowerIndex+j];tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
tEnd=tArr.length;tIndex=lowerIndex+1;for(j=0;j<tEnd;j++){tBound2=tArr[j];tBound1=bounds[tIndex+j]
tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
++upperIndex;bounds[lowerIndex].value=lowerValues[axis];bounds[lowerIndex].proxyId=proxyId;bounds[upperIndex].value=upperValues[axis];bounds[upperIndex].proxyId=proxyId;bounds[lowerIndex].stabbingCount=lowerIndex==0?0:bounds[lowerIndex-1].stabbingCount;bounds[upperIndex].stabbingCount=bounds[upperIndex-1].stabbingCount;for(index=lowerIndex;index<upperIndex;++index)
{bounds[index].stabbingCount++;}
for(index=lowerIndex;index<boundCount+2;++index)
{var proxy2=this.m_proxyPool[bounds[index].proxyId];if(bounds[index].IsLower())
{proxy2.lowerBounds[axis]=index;}
else
{proxy2.upperBounds[axis]=index;}}}
++this.m_proxyCount;for(var i=0;i<this.m_queryResultCount;++i)
{this.m_pairManager.AddBufferedPair(proxyId,this.m_queryResults[i]);}
this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();return proxyId;},DestroyProxy:function(proxyId){var proxy=this.m_proxyPool[proxyId];var boundCount=2*this.m_proxyCount;for(var axis=0;axis<2;++axis)
{var bounds=this.m_bounds[axis];var lowerIndex=proxy.lowerBounds[axis];var upperIndex=proxy.upperBounds[axis];var lowerValue=bounds[lowerIndex].value;var upperValue=bounds[upperIndex].value;var tArr=new Array();var j=0;var tEnd=upperIndex-lowerIndex-1;var tBound1;var tBound2;for(j=0;j<tEnd;j++){tArr[j]=new b2Bound();tBound1=tArr[j];tBound2=bounds[lowerIndex+1+j];tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
tEnd=tArr.length;var tIndex=lowerIndex;for(j=0;j<tEnd;j++){tBound2=tArr[j];tBound1=bounds[tIndex+j]
tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
tArr=new Array();tEnd=boundCount-upperIndex-1;for(j=0;j<tEnd;j++){tArr[j]=new b2Bound();tBound1=tArr[j];tBound2=bounds[upperIndex+1+j];tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
tEnd=tArr.length;tIndex=upperIndex-1;for(j=0;j<tEnd;j++){tBound2=tArr[j];tBound1=bounds[tIndex+j]
tBound1.value=tBound2.value;tBound1.proxyId=tBound2.proxyId;tBound1.stabbingCount=tBound2.stabbingCount;}
tEnd=boundCount-2;for(var index=lowerIndex;index<tEnd;++index)
{var proxy2=this.m_proxyPool[bounds[index].proxyId];if(bounds[index].IsLower())
{proxy2.lowerBounds[axis]=index;}
else
{proxy2.upperBounds[axis]=index;}}
tEnd=upperIndex-1;for(var index2=lowerIndex;index2<tEnd;++index2)
{bounds[index2].stabbingCount--;}
this.Query([0],[0],lowerValue,upperValue,bounds,boundCount-2,axis);}
for(var i=0;i<this.m_queryResultCount;++i)
{this.m_pairManager.RemoveBufferedPair(proxyId,this.m_queryResults[i]);}
this.m_pairManager.Commit();this.m_queryResultCount=0;this.IncrementTimeStamp();proxy.userData=null;proxy.overlapCount=b2BroadPhase.b2_invalid;proxy.lowerBounds[0]=b2BroadPhase.b2_invalid;proxy.lowerBounds[1]=b2BroadPhase.b2_invalid;proxy.upperBounds[0]=b2BroadPhase.b2_invalid;proxy.upperBounds[1]=b2BroadPhase.b2_invalid;proxy.SetNext(this.m_freeProxy);this.m_freeProxy=proxyId;--this.m_proxyCount;},MoveProxy:function(proxyId,aabb){var axis=0;var index=0;var bound;var prevBound
var nextBound
var nextProxyId=0;var nextProxy;if(proxyId==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=proxyId)
{return;}
if(aabb.IsValid()==false)
{return;}
var boundCount=2*this.m_proxyCount;var proxy=this.m_proxyPool[proxyId];var newValues=new b2BoundValues();this.ComputeBounds(newValues.lowerValues,newValues.upperValues,aabb);var oldValues=new b2BoundValues();for(axis=0;axis<2;++axis)
{oldValues.lowerValues[axis]=this.m_bounds[axis][proxy.lowerBounds[axis]].value;oldValues.upperValues[axis]=this.m_bounds[axis][proxy.upperBounds[axis]].value;}
for(axis=0;axis<2;++axis)
{var bounds=this.m_bounds[axis];var lowerIndex=proxy.lowerBounds[axis];var upperIndex=proxy.upperBounds[axis];var lowerValue=newValues.lowerValues[axis];var upperValue=newValues.upperValues[axis];var deltaLower=lowerValue-bounds[lowerIndex].value;var deltaUpper=upperValue-bounds[upperIndex].value;bounds[lowerIndex].value=lowerValue;bounds[upperIndex].value=upperValue;if(deltaLower<0)
{index=lowerIndex;while(index>0&&lowerValue<bounds[index-1].value)
{bound=bounds[index];prevBound=bounds[index-1];var prevProxyId=prevBound.proxyId;var prevProxy=this.m_proxyPool[prevBound.proxyId];prevBound.stabbingCount++;if(prevBound.IsUpper()==true)
{if(this.TestOverlap(newValues,prevProxy))
{this.m_pairManager.AddBufferedPair(proxyId,prevProxyId);}
prevProxy.upperBounds[axis]++;bound.stabbingCount++;}
else
{prevProxy.lowerBounds[axis]++;bound.stabbingCount--;}
proxy.lowerBounds[axis]--;bound.Swap(prevBound);--index;}}
if(deltaUpper>0)
{index=upperIndex;while(index<boundCount-1&&bounds[index+1].value<=upperValue)
{bound=bounds[index];nextBound=bounds[index+1];nextProxyId=nextBound.proxyId;nextProxy=this.m_proxyPool[nextProxyId];nextBound.stabbingCount++;if(nextBound.IsLower()==true)
{if(this.TestOverlap(newValues,nextProxy))
{this.m_pairManager.AddBufferedPair(proxyId,nextProxyId);}
nextProxy.lowerBounds[axis]--;bound.stabbingCount++;}
else
{nextProxy.upperBounds[axis]--;bound.stabbingCount--;}
proxy.upperBounds[axis]++;bound.Swap(nextBound);index++;}}
if(deltaLower>0)
{index=lowerIndex;while(index<boundCount-1&&bounds[index+1].value<=lowerValue)
{bound=bounds[index];nextBound=bounds[index+1];nextProxyId=nextBound.proxyId;nextProxy=this.m_proxyPool[nextProxyId];nextBound.stabbingCount--;if(nextBound.IsUpper())
{if(this.TestOverlap(oldValues,nextProxy))
{this.m_pairManager.RemoveBufferedPair(proxyId,nextProxyId);}
nextProxy.upperBounds[axis]--;bound.stabbingCount--;}
else
{nextProxy.lowerBounds[axis]--;bound.stabbingCount++;}
proxy.lowerBounds[axis]++;bound.Swap(nextBound);index++;}}
if(deltaUpper<0)
{index=upperIndex;while(index>0&&upperValue<bounds[index-1].value)
{bound=bounds[index];prevBound=bounds[index-1];prevProxyId=prevBound.proxyId;prevProxy=this.m_proxyPool[prevProxyId];prevBound.stabbingCount--;if(prevBound.IsLower()==true)
{if(this.TestOverlap(oldValues,prevProxy))
{this.m_pairManager.RemoveBufferedPair(proxyId,prevProxyId);}
prevProxy.lowerBounds[axis]++;bound.stabbingCount--;}
else
{prevProxy.upperBounds[axis]++;bound.stabbingCount++;}
proxy.upperBounds[axis]--;bound.Swap(prevBound);index--;}}}},Commit:function(){this.m_pairManager.Commit();},QueryAABB:function(aabb,userData,maxCount){var lowerValues=new Array();var upperValues=new Array();this.ComputeBounds(lowerValues,upperValues,aabb);var lowerIndex=0;var upperIndex=0;var lowerIndexOut=[lowerIndex];var upperIndexOut=[upperIndex];this.Query(lowerIndexOut,upperIndexOut,lowerValues[0],upperValues[0],this.m_bounds[0],2*this.m_proxyCount,0);this.Query(lowerIndexOut,upperIndexOut,lowerValues[1],upperValues[1],this.m_bounds[1],2*this.m_proxyCount,1);var count=0;for(var i=0;i<this.m_queryResultCount&&count<maxCount;++i,++count)
{var proxy=this.m_proxyPool[this.m_queryResults[i]];userData[i]=proxy.userData;}
this.m_queryResultCount=0;this.IncrementTimeStamp();return count;},Validate:function(){var pair;var proxy1;var proxy2;var overlap;for(var axis=0;axis<2;++axis)
{var bounds=this.m_bounds[axis];var boundCount=2*this.m_proxyCount;var stabbingCount=0;for(var i=0;i<boundCount;++i)
{var bound=bounds[i];if(bound.IsLower()==true)
{stabbingCount++;}
else
{stabbingCount--;}}}},ComputeBounds:function(lowerValues,upperValues,aabb)
{var minVertexX=aabb.minVertex.x;var minVertexY=aabb.minVertex.y;minVertexX=b2Math.b2Min(minVertexX,this.m_worldAABB.maxVertex.x);minVertexY=b2Math.b2Min(minVertexY,this.m_worldAABB.maxVertex.y);minVertexX=b2Math.b2Max(minVertexX,this.m_worldAABB.minVertex.x);minVertexY=b2Math.b2Max(minVertexY,this.m_worldAABB.minVertex.y);var maxVertexX=aabb.maxVertex.x;var maxVertexY=aabb.maxVertex.y;maxVertexX=b2Math.b2Min(maxVertexX,this.m_worldAABB.maxVertex.x);maxVertexY=b2Math.b2Min(maxVertexY,this.m_worldAABB.maxVertex.y);maxVertexX=b2Math.b2Max(maxVertexX,this.m_worldAABB.minVertex.x);maxVertexY=b2Math.b2Max(maxVertexY,this.m_worldAABB.minVertex.y);lowerValues[0]=(this.m_quantizationFactor.x*(minVertexX-this.m_worldAABB.minVertex.x))&(b2Settings.USHRT_MAX-1);upperValues[0]=((this.m_quantizationFactor.x*(maxVertexX-this.m_worldAABB.minVertex.x))&0x0000ffff)|1;lowerValues[1]=(this.m_quantizationFactor.y*(minVertexY-this.m_worldAABB.minVertex.y))&(b2Settings.USHRT_MAX-1);upperValues[1]=((this.m_quantizationFactor.y*(maxVertexY-this.m_worldAABB.minVertex.y))&0x0000ffff)|1;},TestOverlapValidate:function(p1,p2){for(var axis=0;axis<2;++axis)
{var bounds=this.m_bounds[axis];if(bounds[p1.lowerBounds[axis]].value>bounds[p2.upperBounds[axis]].value)
return false;if(bounds[p1.upperBounds[axis]].value<bounds[p2.lowerBounds[axis]].value)
return false;}
return true;},TestOverlap:function(b,p)
{for(var axis=0;axis<2;++axis)
{var bounds=this.m_bounds[axis];if(b.lowerValues[axis]>bounds[p.upperBounds[axis]].value)
return false;if(b.upperValues[axis]<bounds[p.lowerBounds[axis]].value)
return false;}
return true;},Query:function(lowerQueryOut,upperQueryOut,lowerValue,upperValue,bounds,boundCount,axis){var lowerQuery=b2BroadPhase.BinarySearch(bounds,boundCount,lowerValue);var upperQuery=b2BroadPhase.BinarySearch(bounds,boundCount,upperValue);for(var j=lowerQuery;j<upperQuery;++j)
{if(bounds[j].IsLower())
{this.IncrementOverlapCount(bounds[j].proxyId);}}
if(lowerQuery>0)
{var i=lowerQuery-1;var s=bounds[i].stabbingCount;while(s)
{if(bounds[i].IsLower())
{var proxy=this.m_proxyPool[bounds[i].proxyId];if(lowerQuery<=proxy.upperBounds[axis])
{this.IncrementOverlapCount(bounds[i].proxyId);--s;}}
--i;}}
lowerQueryOut[0]=lowerQuery;upperQueryOut[0]=upperQuery;},IncrementOverlapCount:function(proxyId){var proxy=this.m_proxyPool[proxyId];if(proxy.timeStamp<this.m_timeStamp)
{proxy.timeStamp=this.m_timeStamp;proxy.overlapCount=1;}
else
{proxy.overlapCount=2;this.m_queryResults[this.m_queryResultCount]=proxyId;++this.m_queryResultCount;}},IncrementTimeStamp:function(){if(this.m_timeStamp==b2Settings.USHRT_MAX)
{for(var i=0;i<b2Settings.b2_maxProxies;++i)
{this.m_proxyPool[i].timeStamp=0;}
this.m_timeStamp=1;}
else
{++this.m_timeStamp;}},m_pairManager:new b2PairManager(),m_proxyPool:new Array(b2Settings.b2_maxPairs),m_freeProxy:0,m_bounds:new Array(2*b2Settings.b2_maxProxies),m_queryResults:new Array(b2Settings.b2_maxProxies),m_queryResultCount:0,m_worldAABB:null,m_quantizationFactor:new b2Vec2(),m_proxyCount:0,m_timeStamp:0};b2BroadPhase.s_validate=false;b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX;b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX;b2BroadPhase.BinarySearch=function(bounds,count,value)
{var low=0;var high=count-1;while(low<=high)
{var mid=Math.floor((low+high)/2);if(bounds[mid].value>value)
{high=mid-1;}
else if(bounds[mid].value<value)
{low=mid+1;}
else
{return(mid);}}
return(low);};var b2Collision=Class.create();b2Collision.prototype={initialize:function(){}}
b2Collision.b2_nullFeature=0x000000ff;b2Collision.ClipSegmentToLine=function(vOut,vIn,normal,offset)
{var numOut=0;var vIn0=vIn[0].v;var vIn1=vIn[1].v;var distance0=b2Math.b2Dot(normal,vIn[0].v)-offset;var distance1=b2Math.b2Dot(normal,vIn[1].v)-offset;if(distance0<=0.0)vOut[numOut++]=vIn[0];if(distance1<=0.0)vOut[numOut++]=vIn[1];if(distance0*distance1<0.0)
{var interp=distance0/(distance0-distance1);var tVec=vOut[numOut].v;tVec.x=vIn0.x+interp*(vIn1.x-vIn0.x);tVec.y=vIn0.y+interp*(vIn1.y-vIn0.y);if(distance0>0.0)
{vOut[numOut].id=vIn[0].id;}
else
{vOut[numOut].id=vIn[1].id;}
++numOut;}
return numOut;};b2Collision.EdgeSeparation=function(poly1,edge1,poly2)
{var vert1s=poly1.m_vertices;var count2=poly2.m_vertexCount;var vert2s=poly2.m_vertices;var normalX=poly1.m_normals[edge1].x;var normalY=poly1.m_normals[edge1].y;var tX=normalX;var tMat=poly1.m_R;normalX=tMat.col1.x*tX+tMat.col2.x*normalY;normalY=tMat.col1.y*tX+tMat.col2.y*normalY;var normalLocal2X=normalX;var normalLocal2Y=normalY;tMat=poly2.m_R;tX=normalLocal2X*tMat.col1.x+normalLocal2Y*tMat.col1.y;normalLocal2Y=normalLocal2X*tMat.col2.x+normalLocal2Y*tMat.col2.y;normalLocal2X=tX;var vertexIndex2=0;var minDot=Number.MAX_VALUE;for(var i=0;i<count2;++i)
{var tVec=vert2s[i];var dot=tVec.x*normalLocal2X+tVec.y*normalLocal2Y;if(dot<minDot)
{minDot=dot;vertexIndex2=i;}}
tMat=poly1.m_R;var v1X=poly1.m_position.x+(tMat.col1.x*vert1s[edge1].x+tMat.col2.x*vert1s[edge1].y)
var v1Y=poly1.m_position.y+(tMat.col1.y*vert1s[edge1].x+tMat.col2.y*vert1s[edge1].y)
tMat=poly2.m_R;var v2X=poly2.m_position.x+(tMat.col1.x*vert2s[vertexIndex2].x+tMat.col2.x*vert2s[vertexIndex2].y)
var v2Y=poly2.m_position.y+(tMat.col1.y*vert2s[vertexIndex2].x+tMat.col2.y*vert2s[vertexIndex2].y)
v2X-=v1X;v2Y-=v1Y;var separation=v2X*normalX+v2Y*normalY;return separation;};b2Collision.FindMaxSeparation=function(edgeIndex,poly1,poly2,conservative)
{var count1=poly1.m_vertexCount;var dX=poly2.m_position.x-poly1.m_position.x;var dY=poly2.m_position.y-poly1.m_position.y;var dLocal1X=(dX*poly1.m_R.col1.x+dY*poly1.m_R.col1.y);var dLocal1Y=(dX*poly1.m_R.col2.x+dY*poly1.m_R.col2.y);var edge=0;var maxDot=-Number.MAX_VALUE;for(var i=0;i<count1;++i)
{var dot=(poly1.m_normals[i].x*dLocal1X+poly1.m_normals[i].y*dLocal1Y);if(dot>maxDot)
{maxDot=dot;edge=i;}}
var s=b2Collision.EdgeSeparation(poly1,edge,poly2);if(s>0.0&&conservative==false)
{return s;}
var prevEdge=edge-1>=0?edge-1:count1-1;var sPrev=b2Collision.EdgeSeparation(poly1,prevEdge,poly2);if(sPrev>0.0&&conservative==false)
{return sPrev;}
var nextEdge=edge+1<count1?edge+1:0;var sNext=b2Collision.EdgeSeparation(poly1,nextEdge,poly2);if(sNext>0.0&&conservative==false)
{return sNext;}
var bestEdge=0;var bestSeparation;var increment=0;if(sPrev>s&&sPrev>sNext)
{increment=-1;bestEdge=prevEdge;bestSeparation=sPrev;}
else if(sNext>s)
{increment=1;bestEdge=nextEdge;bestSeparation=sNext;}
else
{edgeIndex[0]=edge;return s;}
while(true)
{if(increment==-1)
edge=bestEdge-1>=0?bestEdge-1:count1-1;else
edge=bestEdge+1<count1?bestEdge+1:0;s=b2Collision.EdgeSeparation(poly1,edge,poly2);if(s>0.0&&conservative==false)
{return s;}
if(s>bestSeparation)
{bestEdge=edge;bestSeparation=s;}
else
{break;}}
edgeIndex[0]=bestEdge;return bestSeparation;};b2Collision.FindIncidentEdge=function(c,poly1,edge1,poly2)
{var count1=poly1.m_vertexCount;var vert1s=poly1.m_vertices;var count2=poly2.m_vertexCount;var vert2s=poly2.m_vertices;var vertex11=edge1;var vertex12=edge1+1==count1?0:edge1+1;var tVec=vert1s[vertex12];var normal1Local1X=tVec.x;var normal1Local1Y=tVec.y;tVec=vert1s[vertex11];normal1Local1X-=tVec.x;normal1Local1Y-=tVec.y;var tX=normal1Local1X;normal1Local1X=normal1Local1Y;normal1Local1Y=-tX;var invLength=1.0/Math.sqrt(normal1Local1X*normal1Local1X+normal1Local1Y*normal1Local1Y);normal1Local1X*=invLength;normal1Local1Y*=invLength;var normal1X=normal1Local1X;var normal1Y=normal1Local1Y;tX=normal1X;var tMat=poly1.m_R;normal1X=tMat.col1.x*tX+tMat.col2.x*normal1Y;normal1Y=tMat.col1.y*tX+tMat.col2.y*normal1Y;var normal1Local2X=normal1X;var normal1Local2Y=normal1Y;tMat=poly2.m_R;tX=normal1Local2X*tMat.col1.x+normal1Local2Y*tMat.col1.y;normal1Local2Y=normal1Local2X*tMat.col2.x+normal1Local2Y*tMat.col2.y;normal1Local2X=tX;var vertex21=0;var vertex22=0;var minDot=Number.MAX_VALUE;for(var i=0;i<count2;++i)
{var i1=i;var i2=i+1<count2?i+1:0;tVec=vert2s[i2];var normal2Local2X=tVec.x;var normal2Local2Y=tVec.y;tVec=vert2s[i1];normal2Local2X-=tVec.x;normal2Local2Y-=tVec.y;tX=normal2Local2X;normal2Local2X=normal2Local2Y;normal2Local2Y=-tX;invLength=1.0/Math.sqrt(normal2Local2X*normal2Local2X+normal2Local2Y*normal2Local2Y);normal2Local2X*=invLength;normal2Local2Y*=invLength;var dot=normal2Local2X*normal1Local2X+normal2Local2Y*normal1Local2Y;if(dot<minDot)
{minDot=dot;vertex21=i1;vertex22=i2;}}
var tClip;tClip=c[0];tVec=tClip.v;tVec.SetV(vert2s[vertex21]);tVec.MulM(poly2.m_R);tVec.Add(poly2.m_position);tClip.id.features.referenceFace=edge1;tClip.id.features.incidentEdge=vertex21;tClip.id.features.incidentVertex=vertex21;tClip=c[1];tVec=tClip.v;tVec.SetV(vert2s[vertex22]);tVec.MulM(poly2.m_R);tVec.Add(poly2.m_position);tClip.id.features.referenceFace=edge1;tClip.id.features.incidentEdge=vertex21;tClip.id.features.incidentVertex=vertex22;};b2Collision.b2CollidePolyTempVec=new b2Vec2();b2Collision.b2CollidePoly=function(manifold,polyA,polyB,conservative)
{manifold.pointCount=0;var edgeA=0;var edgeAOut=[edgeA];var separationA=b2Collision.FindMaxSeparation(edgeAOut,polyA,polyB,conservative);edgeA=edgeAOut[0];if(separationA>0.0&&conservative==false)
return;var edgeB=0;var edgeBOut=[edgeB];var separationB=b2Collision.FindMaxSeparation(edgeBOut,polyB,polyA,conservative);edgeB=edgeBOut[0];if(separationB>0.0&&conservative==false)
return;var poly1;var poly2;var edge1=0;var flip=0;var k_relativeTol=0.98;var k_absoluteTol=0.001;if(separationB>k_relativeTol*separationA+k_absoluteTol)
{poly1=polyB;poly2=polyA;edge1=edgeB;flip=1;}
else
{poly1=polyA;poly2=polyB;edge1=edgeA;flip=0;}
var incidentEdge=[new ClipVertex(),new ClipVertex()];b2Collision.FindIncidentEdge(incidentEdge,poly1,edge1,poly2);var count1=poly1.m_vertexCount;var vert1s=poly1.m_vertices;var v11=vert1s[edge1];var v12=edge1+1<count1?vert1s[edge1+1]:vert1s[0];var dvX=v12.x-v11.x;var dvY=v12.y-v11.y;var sideNormalX=v12.x-v11.x;var sideNormalY=v12.y-v11.y;var tX=sideNormalX;var tMat=poly1.m_R;sideNormalX=tMat.col1.x*tX+tMat.col2.x*sideNormalY;sideNormalY=tMat.col1.y*tX+tMat.col2.y*sideNormalY;var invLength=1.0/Math.sqrt(sideNormalX*sideNormalX+sideNormalY*sideNormalY);sideNormalX*=invLength;sideNormalY*=invLength;var frontNormalX=sideNormalX;var frontNormalY=sideNormalY;tX=frontNormalX;frontNormalX=frontNormalY;frontNormalY=-tX;var v11X=v11.x;var v11Y=v11.y;tX=v11X;tMat=poly1.m_R;v11X=tMat.col1.x*tX+tMat.col2.x*v11Y;v11Y=tMat.col1.y*tX+tMat.col2.y*v11Y;v11X+=poly1.m_position.x;v11Y+=poly1.m_position.y;var v12X=v12.x;var v12Y=v12.y;tX=v12X;tMat=poly1.m_R;v12X=tMat.col1.x*tX+tMat.col2.x*v12Y;v12Y=tMat.col1.y*tX+tMat.col2.y*v12Y;v12X+=poly1.m_position.x;v12Y+=poly1.m_position.y;var frontOffset=frontNormalX*v11X+frontNormalY*v11Y;var sideOffset1=-(sideNormalX*v11X+sideNormalY*v11Y);var sideOffset2=sideNormalX*v12X+sideNormalY*v12Y;var clipPoints1=[new ClipVertex(),new ClipVertex()];var clipPoints2=[new ClipVertex(),new ClipVertex()];var np=0;b2Collision.b2CollidePolyTempVec.Set(-sideNormalX,-sideNormalY);np=b2Collision.ClipSegmentToLine(clipPoints1,incidentEdge,b2Collision.b2CollidePolyTempVec,sideOffset1);if(np<2)
return;b2Collision.b2CollidePolyTempVec.Set(sideNormalX,sideNormalY);np=b2Collision.ClipSegmentToLine(clipPoints2,clipPoints1,b2Collision.b2CollidePolyTempVec,sideOffset2);if(np<2)
return;if(flip){manifold.normal.Set(-frontNormalX,-frontNormalY);}
else{manifold.normal.Set(frontNormalX,frontNormalY);}
var pointCount=0;for(var i=0;i<b2Settings.b2_maxManifoldPoints;++i)
{var tVec=clipPoints2[i].v;var separation=(frontNormalX*tVec.x+frontNormalY*tVec.y)-frontOffset;if(separation<=0.0||conservative==true)
{var cp=manifold.points[pointCount];cp.separation=separation;cp.position.SetV(clipPoints2[i].v);cp.id.Set(clipPoints2[i].id);cp.id.features.flip=flip;++pointCount;}}
manifold.pointCount=pointCount;};b2Collision.b2CollideCircle=function(manifold,circle1,circle2,conservative)
{manifold.pointCount=0;var dX=circle2.m_position.x-circle1.m_position.x;var dY=circle2.m_position.y-circle1.m_position.y;var distSqr=dX*dX+dY*dY;var radiusSum=circle1.m_radius+circle2.m_radius;if(distSqr>radiusSum*radiusSum&&conservative==false)
{return;}
var separation;if(distSqr<Number.MIN_VALUE)
{separation=-radiusSum;manifold.normal.Set(0.0,1.0);}
else
{var dist=Math.sqrt(distSqr);separation=dist-radiusSum;var a=1.0/dist;manifold.normal.x=a*dX;manifold.normal.y=a*dY;}
manifold.pointCount=1;var tPoint=manifold.points[0];tPoint.id.set_key(0);tPoint.separation=separation;tPoint.position.x=circle2.m_position.x-(circle2.m_radius*manifold.normal.x);tPoint.position.y=circle2.m_position.y-(circle2.m_radius*manifold.normal.y);};b2Collision.b2CollidePolyAndCircle=function(manifold,poly,circle,conservative)
{manifold.pointCount=0;var tPoint;var dX;var dY;var xLocalX=circle.m_position.x-poly.m_position.x;var xLocalY=circle.m_position.y-poly.m_position.y;var tMat=poly.m_R;var tX=xLocalX*tMat.col1.x+xLocalY*tMat.col1.y;xLocalY=xLocalX*tMat.col2.x+xLocalY*tMat.col2.y;xLocalX=tX;var dist;var normalIndex=0;var separation=-Number.MAX_VALUE;var radius=circle.m_radius;for(var i=0;i<poly.m_vertexCount;++i)
{var s=poly.m_normals[i].x*(xLocalX-poly.m_vertices[i].x)+poly.m_normals[i].y*(xLocalY-poly.m_vertices[i].y);if(s>radius)
{return;}
if(s>separation)
{separation=s;normalIndex=i;}}
if(separation<Number.MIN_VALUE)
{manifold.pointCount=1;var tVec=poly.m_normals[normalIndex];manifold.normal.x=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;manifold.normal.y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tPoint=manifold.points[0];tPoint.id.features.incidentEdge=normalIndex;tPoint.id.features.incidentVertex=b2Collision.b2_nullFeature;tPoint.id.features.referenceFace=b2Collision.b2_nullFeature;tPoint.id.features.flip=0;tPoint.position.x=circle.m_position.x-radius*manifold.normal.x;tPoint.position.y=circle.m_position.y-radius*manifold.normal.y;tPoint.separation=separation-radius;return;}
var vertIndex1=normalIndex;var vertIndex2=vertIndex1+1<poly.m_vertexCount?vertIndex1+1:0;var eX=poly.m_vertices[vertIndex2].x-poly.m_vertices[vertIndex1].x;var eY=poly.m_vertices[vertIndex2].y-poly.m_vertices[vertIndex1].y;var length=Math.sqrt(eX*eX+eY*eY);eX/=length;eY/=length;if(length<Number.MIN_VALUE)
{dX=xLocalX-poly.m_vertices[vertIndex1].x;dY=xLocalY-poly.m_vertices[vertIndex1].y;dist=Math.sqrt(dX*dX+dY*dY);dX/=dist;dY/=dist;if(dist>radius)
{return;}
manifold.pointCount=1;manifold.normal.Set(tMat.col1.x*dX+tMat.col2.x*dY,tMat.col1.y*dX+tMat.col2.y*dY);tPoint=manifold.points[0];tPoint.id.features.incidentEdge=b2Collision.b2_nullFeature;tPoint.id.features.incidentVertex=vertIndex1;tPoint.id.features.referenceFace=b2Collision.b2_nullFeature;tPoint.id.features.flip=0;tPoint.position.x=circle.m_position.x-radius*manifold.normal.x;tPoint.position.y=circle.m_position.y-radius*manifold.normal.y;tPoint.separation=dist-radius;return;}
var u=(xLocalX-poly.m_vertices[vertIndex1].x)*eX+(xLocalY-poly.m_vertices[vertIndex1].y)*eY;tPoint=manifold.points[0];tPoint.id.features.incidentEdge=b2Collision.b2_nullFeature;tPoint.id.features.incidentVertex=b2Collision.b2_nullFeature;tPoint.id.features.referenceFace=b2Collision.b2_nullFeature;tPoint.id.features.flip=0;var pX,pY;if(u<=0.0)
{pX=poly.m_vertices[vertIndex1].x;pY=poly.m_vertices[vertIndex1].y;tPoint.id.features.incidentVertex=vertIndex1;}
else if(u>=length)
{pX=poly.m_vertices[vertIndex2].x;pY=poly.m_vertices[vertIndex2].y;tPoint.id.features.incidentVertex=vertIndex2;}
else
{pX=eX*u+poly.m_vertices[vertIndex1].x;pY=eY*u+poly.m_vertices[vertIndex1].y;tPoint.id.features.incidentEdge=vertIndex1;}
dX=xLocalX-pX;dY=xLocalY-pY;dist=Math.sqrt(dX*dX+dY*dY);dX/=dist;dY/=dist;if(dist>radius)
{return;}
manifold.pointCount=1;manifold.normal.Set(tMat.col1.x*dX+tMat.col2.x*dY,tMat.col1.y*dX+tMat.col2.y*dY);tPoint.position.x=circle.m_position.x-radius*manifold.normal.x;tPoint.position.y=circle.m_position.y-radius*manifold.normal.y;tPoint.separation=dist-radius;};b2Collision.b2TestOverlap=function(a,b)
{var t1=b.minVertex;var t2=a.maxVertex;var d1X=t1.x-t2.x;var d1Y=t1.y-t2.y;t1=a.minVertex;t2=b.maxVertex;var d2X=t1.x-t2.x;var d2Y=t1.y-t2.y;if(d1X>0.0||d1Y>0.0)
return false;if(d2X>0.0||d2Y>0.0)
return false;return true;};var Features=Class.create();Features.prototype={set_referenceFace:function(value){this._referenceFace=value;this._m_id._key=(this._m_id._key&0xffffff00)|(this._referenceFace&0x000000ff)},get_referenceFace:function(){return this._referenceFace;},_referenceFace:0,set_incidentEdge:function(value){this._incidentEdge=value;this._m_id._key=(this._m_id._key&0xffff00ff)|((this._incidentEdge<<8)&0x0000ff00)},get_incidentEdge:function(){return this._incidentEdge;},_incidentEdge:0,set_incidentVertex:function(value){this._incidentVertex=value;this._m_id._key=(this._m_id._key&0xff00ffff)|((this._incidentVertex<<16)&0x00ff0000)},get_incidentVertex:function(){return this._incidentVertex;},_incidentVertex:0,set_flip:function(value){this._flip=value;this._m_id._key=(this._m_id._key&0x00ffffff)|((this._flip<<24)&0xff000000)},get_flip:function(){return this._flip;},_flip:0,_m_id:null,initialize:function(){}};var b2ContactID=Class.create();b2ContactID.prototype={initialize:function(){this.features=new Features();this.features._m_id=this;},Set:function(id){this.set_key(id._key);},Copy:function(){var id=new b2ContactID();id.set_key(this._key);return id;},get_key:function(){return this._key;},set_key:function(value){this._key=value;this.features._referenceFace=this._key&0x000000ff;this.features._incidentEdge=((this._key&0x0000ff00)>>8)&0x000000ff;this.features._incidentVertex=((this._key&0x00ff0000)>>16)&0x000000ff;this.features._flip=((this._key&0xff000000)>>24)&0x000000ff;},features:new Features(),_key:0};var b2ContactPoint=Class.create();b2ContactPoint.prototype={position:new b2Vec2(),separation:null,normalImpulse:null,tangentImpulse:null,id:new b2ContactID(),initialize:function(){this.position=new b2Vec2();this.id=new b2ContactID();}};var b2Distance=Class.create();b2Distance.prototype={initialize:function(){}};b2Distance.ProcessTwo=function(p1Out,p2Out,p1s,p2s,points)
{var rX=-points[1].x;var rY=-points[1].y;var dX=points[0].x-points[1].x;var dY=points[0].y-points[1].y;var length=Math.sqrt(dX*dX+dY*dY);dX/=length;dY/=length;var lambda=rX*dX+rY*dY;if(lambda<=0.0||length<Number.MIN_VALUE)
{p1Out.SetV(p1s[1]);p2Out.SetV(p2s[1]);p1s[0].SetV(p1s[1]);p2s[0].SetV(p2s[1]);points[0].SetV(points[1]);return 1;}
lambda/=length;p1Out.x=p1s[1].x+lambda*(p1s[0].x-p1s[1].x);p1Out.y=p1s[1].y+lambda*(p1s[0].y-p1s[1].y);p2Out.x=p2s[1].x+lambda*(p2s[0].x-p2s[1].x);p2Out.y=p2s[1].y+lambda*(p2s[0].y-p2s[1].y);return 2;};b2Distance.ProcessThree=function(p1Out,p2Out,p1s,p2s,points)
{var aX=points[0].x;var aY=points[0].y;var bX=points[1].x;var bY=points[1].y;var cX=points[2].x;var cY=points[2].y;var abX=bX-aX;var abY=bY-aY;var acX=cX-aX;var acY=cY-aY;var bcX=cX-bX;var bcY=cY-bY;var sn=-(aX*abX+aY*abY);var sd=(bX*abX+bY*abY);var tn=-(aX*acX+aY*acY);var td=(cX*acX+cY*acY);var un=-(bX*bcX+bY*bcY);var ud=(cX*bcX+cY*bcY);if(td<=0.0&&ud<=0.0)
{p1Out.SetV(p1s[2]);p2Out.SetV(p2s[2]);p1s[0].SetV(p1s[2]);p2s[0].SetV(p2s[2]);points[0].SetV(points[2]);return 1;}
var n=abX*acY-abY*acX;var vc=n*(aX*bY-aY*bX);var va=n*(bX*cY-bY*cX);if(va<=0.0&&un>=0.0&&ud>=0.0)
{var lambda=un/(un+ud);p1Out.x=p1s[1].x+lambda*(p1s[2].x-p1s[1].x);p1Out.y=p1s[1].y+lambda*(p1s[2].y-p1s[1].y);p2Out.x=p2s[1].x+lambda*(p2s[2].x-p2s[1].x);p2Out.y=p2s[1].y+lambda*(p2s[2].y-p2s[1].y);p1s[0].SetV(p1s[2]);p2s[0].SetV(p2s[2]);points[0].SetV(points[2]);return 2;}
var vb=n*(cX*aY-cY*aX);if(vb<=0.0&&tn>=0.0&&td>=0.0)
{var lambda=tn/(tn+td);p1Out.x=p1s[0].x+lambda*(p1s[2].x-p1s[0].x);p1Out.y=p1s[0].y+lambda*(p1s[2].y-p1s[0].y);p2Out.x=p2s[0].x+lambda*(p2s[2].x-p2s[0].x);p2Out.y=p2s[0].y+lambda*(p2s[2].y-p2s[0].y);p1s[1].SetV(p1s[2]);p2s[1].SetV(p2s[2]);points[1].SetV(points[2]);return 2;}
var denom=va+vb+vc;denom=1.0/denom;var u=va*denom;var v=vb*denom;var w=1.0-u-v;p1Out.x=u*p1s[0].x+v*p1s[1].x+w*p1s[2].x;p1Out.y=u*p1s[0].y+v*p1s[1].y+w*p1s[2].y;p2Out.x=u*p2s[0].x+v*p2s[1].x+w*p2s[2].x;p2Out.y=u*p2s[0].y+v*p2s[1].y+w*p2s[2].y;return 3;};b2Distance.InPoinsts=function(w,points,pointCount)
{for(var i=0;i<pointCount;++i)
{if(w.x==points[i].x&&w.y==points[i].y)
{return true;}}
return false;};b2Distance.Distance=function(p1Out,p2Out,shape1,shape2)
{var p1s=new Array(3);var p2s=new Array(3);var points=new Array(3);var pointCount=0;p1Out.SetV(shape1.m_position);p2Out.SetV(shape2.m_position);var vSqr=0.0;var maxIterations=20;for(var iter=0;iter<maxIterations;++iter)
{var vX=p2Out.x-p1Out.x;var vY=p2Out.y-p1Out.y;var w1=shape1.Support(vX,vY);var w2=shape2.Support(-vX,-vY);vSqr=(vX*vX+vY*vY);var wX=w2.x-w1.x;var wY=w2.y-w1.y;var vw=(vX*wX+vY*wY);if(vSqr-b2Dot(vX*wX+vY*wY)<=0.01*vSqr)
{if(pointCount==0)
{p1Out.SetV(w1);p2Out.SetV(w2);}
b2Distance.g_GJK_Iterations=iter;return Math.sqrt(vSqr);}
switch(pointCount)
{case 0:p1s[0].SetV(w1);p2s[0].SetV(w2);points[0]=w;p1Out.SetV(p1s[0]);p2Out.SetV(p2s[0]);++pointCount;break;case 1:p1s[1].SetV(w1);p2s[1].SetV(w2);points[1].x=wX;points[1].y=wY;pointCount=b2Distance.ProcessTwo(p1Out,p2Out,p1s,p2s,points);break;case 2:p1s[2].SetV(w1);p2s[2].SetV(w2);points[2].x=wX;points[2].y=wY;pointCount=b2Distance.ProcessThree(p1Out,p2Out,p1s,p2s,points);break;}
if(pointCount==3)
{b2Distance.g_GJK_Iterations=iter;return 0.0;}
var maxSqr=-Number.MAX_VALUE;for(var i=0;i<pointCount;++i)
{maxSqr=b2Math.b2Max(maxSqr,(points[i].x*points[i].x+points[i].y*points[i].y));}
if(pointCount==3||vSqr<=100.0*Number.MIN_VALUE*maxSqr)
{b2Distance.g_GJK_Iterations=iter;return Math.sqrt(vSqr);}}
b2Distance.g_GJK_Iterations=maxIterations;return Math.sqrt(vSqr);};b2Distance.g_GJK_Iterations=0;var b2Manifold=Class.create();b2Manifold.prototype={initialize:function(){this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++){this.points[i]=new b2ContactPoint();}
this.normal=new b2Vec2();},points:null,normal:null,pointCount:0};var b2OBB=Class.create();b2OBB.prototype={R:new b2Mat22(),center:new b2Vec2(),extents:new b2Vec2(),initialize:function(){this.R=new b2Mat22();this.center=new b2Vec2();this.extents=new b2Vec2();}};var b2Proxy=Class.create();b2Proxy.prototype={GetNext:function(){return this.lowerBounds[0];},SetNext:function(next){this.lowerBounds[0]=next;},IsValid:function(){return this.overlapCount!=b2BroadPhase.b2_invalid;},lowerBounds:[(0),(0)],upperBounds:[(0),(0)],overlapCount:0,timeStamp:0,userData:null,initialize:function(){this.lowerBounds=[(0),(0)];this.upperBounds=[(0),(0)];}}
var ClipVertex=Class.create();ClipVertex.prototype={v:new b2Vec2(),id:new b2ContactID(),initialize:function(){this.v=new b2Vec2();this.id=new b2ContactID();}};var b2Shape=Class.create();b2Shape.prototype={TestPoint:function(p){return false},GetUserData:function(){return this.m_userData;},GetType:function(){return this.m_type;},GetBody:function(){return this.m_body;},GetPosition:function(){return this.m_position;},GetRotationMatrix:function(){return this.m_R;},ResetProxy:function(broadPhase){},GetNext:function(){return this.m_next;},initialize:function(def,body){this.m_R=new b2Mat22();this.m_position=new b2Vec2();this.m_userData=def.userData;this.m_friction=def.friction;this.m_restitution=def.restitution;this.m_body=body;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0.0;this.m_categoryBits=def.categoryBits;this.m_maskBits=def.maskBits;this.m_groupIndex=def.groupIndex;},DestroyProxy:function()
{if(this.m_proxyId!=b2Pair.b2_nullProxy)
{this.m_body.m_world.m_broadPhase.DestroyProxy(this.m_proxyId);this.m_proxyId=b2Pair.b2_nullProxy;}},Synchronize:function(position1,R1,position2,R2){},QuickSync:function(position,R){},Support:function(dX,dY,out){},GetMaxRadius:function(){return this.m_maxRadius;},m_next:null,m_R:new b2Mat22(),m_position:new b2Vec2(),m_type:0,m_userData:null,m_body:null,m_friction:null,m_restitution:null,m_maxRadius:null,m_proxyId:0,m_categoryBits:0,m_maskBits:0,m_groupIndex:0};b2Shape.Create=function(def,body,center){switch(def.type)
{case b2Shape.e_circleShape:{return new b2CircleShape(def,body,center);}
case b2Shape.e_boxShape:case b2Shape.e_polyShape:{return new b2PolyShape(def,body,center);}}
return null;};b2Shape.Destroy=function(shape)
{if(shape.m_proxyId!=b2Pair.b2_nullProxy)
shape.m_body.m_world.m_broadPhase.DestroyProxy(shape.m_proxyId);};b2Shape.e_unknownShape=-1;b2Shape.e_circleShape=0;b2Shape.e_boxShape=1;b2Shape.e_polyShape=2;b2Shape.e_meshShape=3;b2Shape.e_shapeTypeCount=4;b2Shape.PolyMass=function(massData,vs,count,rho)
{var center=new b2Vec2();center.SetZero();var area=0.0;var I=0.0;var pRef=new b2Vec2(0.0,0.0);var inv3=1.0/3.0;for(var i=0;i<count;++i)
{var p1=pRef;var p2=vs[i];var p3=i+1<count?vs[i+1]:vs[0];var e1=b2Math.SubtractVV(p2,p1);var e2=b2Math.SubtractVV(p3,p1);var D=b2Math.b2CrossVV(e1,e2);var triangleArea=0.5*D;area+=triangleArea;var tVec=new b2Vec2();tVec.SetV(p1);tVec.Add(p2);tVec.Add(p3);tVec.Multiply(inv3*triangleArea);center.Add(tVec);var px=p1.x;var py=p1.y;var ex1=e1.x;var ey1=e1.y;var ex2=e2.x;var ey2=e2.y;var intx2=inv3*(0.25*(ex1*ex1+ex2*ex1+ex2*ex2)+(px*ex1+px*ex2))+0.5*px*px;var inty2=inv3*(0.25*(ey1*ey1+ey2*ey1+ey2*ey2)+(py*ey1+py*ey2))+0.5*py*py;I+=D*(intx2+inty2);}
massData.mass=rho*area;center.Multiply(1.0/area);massData.center=center;I=rho*(I-area*b2Math.b2Dot(center,center));massData.I=I;};b2Shape.PolyCentroid=function(vs,count,out)
{var cX=0.0;var cY=0.0;var area=0.0;var pRefX=0.0;var pRefY=0.0;var inv3=1.0/3.0;for(var i=0;i<count;++i)
{var p1X=pRefX;var p1Y=pRefY;var p2X=vs[i].x;var p2Y=vs[i].y;var p3X=i+1<count?vs[i+1].x:vs[0].x;var p3Y=i+1<count?vs[i+1].y:vs[0].y;var e1X=p2X-p1X;var e1Y=p2Y-p1Y;var e2X=p3X-p1X;var e2Y=p3Y-p1Y;var D=(e1X*e2Y-e1Y*e2X);var triangleArea=0.5*D;area+=triangleArea;cX+=triangleArea*inv3*(p1X+p2X+p3X);cY+=triangleArea*inv3*(p1Y+p2Y+p3Y);}
cX*=1.0/area;cY*=1.0/area;out.Set(cX,cY);};var b2ShapeDef=Class.create();b2ShapeDef.prototype={initialize:function()
{this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0.0,0.0);this.localRotation=0.0;this.friction=0.2;this.restitution=0.0;this.density=0.0;this.categoryBits=0x0001;this.maskBits=0xFFFF;this.groupIndex=0;},ComputeMass:function(massData)
{massData.center=new b2Vec2(0.0,0.0)
if(this.density==0.0)
{massData.mass=0.0;massData.center.Set(0.0,0.0);massData.I=0.0;};switch(this.type)
{case b2Shape.e_circleShape:{var circle=this;massData.mass=this.density*b2Settings.b2_pi*circle.radius*circle.radius;massData.center.Set(0.0,0.0);massData.I=0.5*(massData.mass)*circle.radius*circle.radius;}
break;case b2Shape.e_boxShape:{var box=this;massData.mass=4.0*this.density*box.extents.x*box.extents.y;massData.center.Set(0.0,0.0);massData.I=massData.mass/3.0*b2Math.b2Dot(box.extents,box.extents);}
break;case b2Shape.e_polyShape:{var poly=this;b2Shape.PolyMass(massData,poly.vertices,poly.vertexCount,this.density);}
break;default:massData.mass=0.0;massData.center.Set(0.0,0.0);massData.I=0.0;break;}},type:0,userData:null,localPosition:null,localRotation:null,friction:null,restitution:null,density:null,categoryBits:0,maskBits:0,groupIndex:0};var b2BoxDef=Class.create();Object.extend(b2BoxDef.prototype,b2ShapeDef.prototype);Object.extend(b2BoxDef.prototype,{initialize:function()
{this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0.0,0.0);this.localRotation=0.0;this.friction=0.2;this.restitution=0.0;this.density=0.0;this.categoryBits=0x0001;this.maskBits=0xFFFF;this.groupIndex=0;this.type=b2Shape.e_boxShape;this.extents=new b2Vec2(1.0,1.0);},extents:null});var b2CircleDef=Class.create();Object.extend(b2CircleDef.prototype,b2ShapeDef.prototype);Object.extend(b2CircleDef.prototype,{initialize:function()
{this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0.0,0.0);this.localRotation=0.0;this.friction=0.2;this.restitution=0.0;this.density=0.0;this.categoryBits=0x0001;this.maskBits=0xFFFF;this.groupIndex=0;this.type=b2Shape.e_circleShape;this.radius=1.0;},radius:null});var b2CircleShape=Class.create();Object.extend(b2CircleShape.prototype,b2Shape.prototype);Object.extend(b2CircleShape.prototype,{TestPoint:function(p){var d=new b2Vec2();d.SetV(p);d.Subtract(this.m_position);return b2Math.b2Dot(d,d)<=this.m_radius*this.m_radius;},initialize:function(def,body,localCenter){this.m_R=new b2Mat22();this.m_position=new b2Vec2();this.m_userData=def.userData;this.m_friction=def.friction;this.m_restitution=def.restitution;this.m_body=body;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0.0;this.m_categoryBits=def.categoryBits;this.m_maskBits=def.maskBits;this.m_groupIndex=def.groupIndex;this.m_localPosition=new b2Vec2();var circle=def;this.m_localPosition.Set(def.localPosition.x-localCenter.x,def.localPosition.y-localCenter.y);this.m_type=b2Shape.e_circleShape;this.m_radius=circle.radius;this.m_R.SetM(this.m_body.m_R);var rX=this.m_R.col1.x*this.m_localPosition.x+this.m_R.col2.x*this.m_localPosition.y;var rY=this.m_R.col1.y*this.m_localPosition.x+this.m_R.col2.y*this.m_localPosition.y;this.m_position.x=this.m_body.m_position.x+rX;this.m_position.y=this.m_body.m_position.y+rY;this.m_maxRadius=Math.sqrt(rX*rX+rY*rY)+this.m_radius;var aabb=new b2AABB();aabb.minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius);aabb.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);var broadPhase=this.m_body.m_world.m_broadPhase;if(broadPhase.InRange(aabb))
{this.m_proxyId=broadPhase.CreateProxy(aabb,this);}
else
{this.m_proxyId=b2Pair.b2_nullProxy;}
if(this.m_proxyId==b2Pair.b2_nullProxy)
{this.m_body.Freeze();}},Synchronize:function(position1,R1,position2,R2){this.m_R.SetM(R2);this.m_position.x=(R2.col1.x*this.m_localPosition.x+R2.col2.x*this.m_localPosition.y)+position2.x;this.m_position.y=(R2.col1.y*this.m_localPosition.x+R2.col2.y*this.m_localPosition.y)+position2.y;if(this.m_proxyId==b2Pair.b2_nullProxy)
{return;}
var p1X=position1.x+(R1.col1.x*this.m_localPosition.x+R1.col2.x*this.m_localPosition.y);var p1Y=position1.y+(R1.col1.y*this.m_localPosition.x+R1.col2.y*this.m_localPosition.y);var lowerX=Math.min(p1X,this.m_position.x);var lowerY=Math.min(p1Y,this.m_position.y);var upperX=Math.max(p1X,this.m_position.x);var upperY=Math.max(p1Y,this.m_position.y);var aabb=new b2AABB();aabb.minVertex.Set(lowerX-this.m_radius,lowerY-this.m_radius);aabb.maxVertex.Set(upperX+this.m_radius,upperY+this.m_radius);var broadPhase=this.m_body.m_world.m_broadPhase;if(broadPhase.InRange(aabb))
{broadPhase.MoveProxy(this.m_proxyId,aabb);}
else
{this.m_body.Freeze();}},QuickSync:function(position,R){this.m_R.SetM(R);this.m_position.x=(R.col1.x*this.m_localPosition.x+R.col2.x*this.m_localPosition.y)+position.x;this.m_position.y=(R.col1.y*this.m_localPosition.x+R.col2.y*this.m_localPosition.y)+position.y;},ResetProxy:function(broadPhase)
{if(this.m_proxyId==b2Pair.b2_nullProxy)
{return;}
var proxy=broadPhase.GetProxy(this.m_proxyId);broadPhase.DestroyProxy(this.m_proxyId);proxy=null;var aabb=new b2AABB();aabb.minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius);aabb.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);if(broadPhase.InRange(aabb))
{this.m_proxyId=broadPhase.CreateProxy(aabb,this);}
else
{this.m_proxyId=b2Pair.b2_nullProxy;}
if(this.m_proxyId==b2Pair.b2_nullProxy)
{this.m_body.Freeze();}},Support:function(dX,dY,out)
{var len=Math.sqrt(dX*dX+dY*dY);dX/=len;dY/=len;out.Set(this.m_position.x+this.m_radius*dX,this.m_position.y+this.m_radius*dY);},m_localPosition:new b2Vec2(),m_radius:null});var b2MassData=Class.create();b2MassData.prototype={mass:0.0,center:new b2Vec2(0,0),I:0.0,initialize:function(){this.center=new b2Vec2(0,0);}}
var b2PolyDef=Class.create();Object.extend(b2PolyDef.prototype,b2ShapeDef.prototype);Object.extend(b2PolyDef.prototype,{initialize:function()
{this.type=b2Shape.e_unknownShape;this.userData=null;this.localPosition=new b2Vec2(0.0,0.0);this.localRotation=0.0;this.friction=0.2;this.restitution=0.0;this.density=0.0;this.categoryBits=0x0001;this.maskBits=0xFFFF;this.groupIndex=0;this.vertices=new Array(b2Settings.b2_maxPolyVertices);this.type=b2Shape.e_polyShape;this.vertexCount=0;for(var i=0;i<b2Settings.b2_maxPolyVertices;i++){this.vertices[i]=new b2Vec2();}},vertices:new Array(b2Settings.b2_maxPolyVertices),vertexCount:0});var b2PolyShape=Class.create();Object.extend(b2PolyShape.prototype,b2Shape.prototype);Object.extend(b2PolyShape.prototype,{TestPoint:function(p){var pLocal=new b2Vec2();pLocal.SetV(p);pLocal.Subtract(this.m_position);pLocal.MulTM(this.m_R);for(var i=0;i<this.m_vertexCount;++i)
{var tVec=new b2Vec2();tVec.SetV(pLocal);tVec.Subtract(this.m_vertices[i]);var dot=b2Math.b2Dot(this.m_normals[i],tVec);if(dot>0.0)
{return false;}}
return true;},initialize:function(def,body,newOrigin){this.m_R=new b2Mat22();this.m_position=new b2Vec2();this.m_userData=def.userData;this.m_friction=def.friction;this.m_restitution=def.restitution;this.m_body=body;this.m_proxyId=b2Pair.b2_nullProxy;this.m_maxRadius=0.0;this.m_categoryBits=def.categoryBits;this.m_maskBits=def.maskBits;this.m_groupIndex=def.groupIndex;this.syncAABB=new b2AABB();this.syncMat=new b2Mat22();this.m_localCentroid=new b2Vec2();this.m_localOBB=new b2OBB();var i=0;var hX;var hY;var tVec;var aabb=new b2AABB();this.m_vertices=new Array(b2Settings.b2_maxPolyVertices);this.m_coreVertices=new Array(b2Settings.b2_maxPolyVertices);this.m_normals=new Array(b2Settings.b2_maxPolyVertices);this.m_type=b2Shape.e_polyShape;var localR=new b2Mat22(def.localRotation);if(def.type==b2Shape.e_boxShape)
{this.m_localCentroid.x=def.localPosition.x-newOrigin.x;this.m_localCentroid.y=def.localPosition.y-newOrigin.y;var box=def;this.m_vertexCount=4;hX=box.extents.x;hY=box.extents.y;var hcX=Math.max(0.0,hX-2.0*b2Settings.b2_linearSlop);var hcY=Math.max(0.0,hY-2.0*b2Settings.b2_linearSlop);tVec=this.m_vertices[0]=new b2Vec2();tVec.x=localR.col1.x*hX+localR.col2.x*hY;tVec.y=localR.col1.y*hX+localR.col2.y*hY;tVec=this.m_vertices[1]=new b2Vec2();tVec.x=localR.col1.x*-hX+localR.col2.x*hY;tVec.y=localR.col1.y*-hX+localR.col2.y*hY;tVec=this.m_vertices[2]=new b2Vec2();tVec.x=localR.col1.x*-hX+localR.col2.x*-hY;tVec.y=localR.col1.y*-hX+localR.col2.y*-hY;tVec=this.m_vertices[3]=new b2Vec2();tVec.x=localR.col1.x*hX+localR.col2.x*-hY;tVec.y=localR.col1.y*hX+localR.col2.y*-hY;tVec=this.m_coreVertices[0]=new b2Vec2();tVec.x=localR.col1.x*hcX+localR.col2.x*hcY;tVec.y=localR.col1.y*hcX+localR.col2.y*hcY;tVec=this.m_coreVertices[1]=new b2Vec2();tVec.x=localR.col1.x*-hcX+localR.col2.x*hcY;tVec.y=localR.col1.y*-hcX+localR.col2.y*hcY;tVec=this.m_coreVertices[2]=new b2Vec2();tVec.x=localR.col1.x*-hcX+localR.col2.x*-hcY;tVec.y=localR.col1.y*-hcX+localR.col2.y*-hcY;tVec=this.m_coreVertices[3]=new b2Vec2();tVec.x=localR.col1.x*hcX+localR.col2.x*-hcY;tVec.y=localR.col1.y*hcX+localR.col2.y*-hcY;}
else
{var poly=def;this.m_vertexCount=poly.vertexCount;b2Shape.PolyCentroid(poly.vertices,poly.vertexCount,b2PolyShape.tempVec);var centroidX=b2PolyShape.tempVec.x;var centroidY=b2PolyShape.tempVec.y;this.m_localCentroid.x=def.localPosition.x+(localR.col1.x*centroidX+localR.col2.x*centroidY)-newOrigin.x;this.m_localCentroid.y=def.localPosition.y+(localR.col1.y*centroidX+localR.col2.y*centroidY)-newOrigin.y;for(i=0;i<this.m_vertexCount;++i)
{this.m_vertices[i]=new b2Vec2();this.m_coreVertices[i]=new b2Vec2();hX=poly.vertices[i].x-centroidX;hY=poly.vertices[i].y-centroidY;this.m_vertices[i].x=localR.col1.x*hX+localR.col2.x*hY;this.m_vertices[i].y=localR.col1.y*hX+localR.col2.y*hY;var uX=this.m_vertices[i].x;var uY=this.m_vertices[i].y;var length=Math.sqrt(uX*uX+uY*uY);if(length>Number.MIN_VALUE)
{uX*=1.0/length;uY*=1.0/length;}
this.m_coreVertices[i].x=this.m_vertices[i].x-2.0*b2Settings.b2_linearSlop*uX;this.m_coreVertices[i].y=this.m_vertices[i].y-2.0*b2Settings.b2_linearSlop*uY;}}
var minVertexX=Number.MAX_VALUE;var minVertexY=Number.MAX_VALUE;var maxVertexX=-Number.MAX_VALUE;var maxVertexY=-Number.MAX_VALUE;this.m_maxRadius=0.0;for(i=0;i<this.m_vertexCount;++i)
{var v=this.m_vertices[i];minVertexX=Math.min(minVertexX,v.x);minVertexY=Math.min(minVertexY,v.y);maxVertexX=Math.max(maxVertexX,v.x);maxVertexY=Math.max(maxVertexY,v.y);this.m_maxRadius=Math.max(this.m_maxRadius,v.Length());}
this.m_localOBB.R.SetIdentity();this.m_localOBB.center.Set((minVertexX+maxVertexX)*0.5,(minVertexY+maxVertexY)*0.5);this.m_localOBB.extents.Set((maxVertexX-minVertexX)*0.5,(maxVertexY-minVertexY)*0.5);var i1=0;var i2=0;for(i=0;i<this.m_vertexCount;++i)
{this.m_normals[i]=new b2Vec2();i1=i;i2=i+1<this.m_vertexCount?i+1:0;this.m_normals[i].x=this.m_vertices[i2].y-this.m_vertices[i1].y;this.m_normals[i].y=-(this.m_vertices[i2].x-this.m_vertices[i1].x);this.m_normals[i].Normalize();}
for(i=0;i<this.m_vertexCount;++i)
{i1=i;i2=i+1<this.m_vertexCount?i+1:0;}
this.m_R.SetM(this.m_body.m_R);this.m_position.x=this.m_body.m_position.x+(this.m_R.col1.x*this.m_localCentroid.x+this.m_R.col2.x*this.m_localCentroid.y);this.m_position.y=this.m_body.m_position.y+(this.m_R.col1.y*this.m_localCentroid.x+this.m_R.col2.y*this.m_localCentroid.y);b2PolyShape.tAbsR.col1.x=this.m_R.col1.x*this.m_localOBB.R.col1.x+this.m_R.col2.x*this.m_localOBB.R.col1.y;b2PolyShape.tAbsR.col1.y=this.m_R.col1.y*this.m_localOBB.R.col1.x+this.m_R.col2.y*this.m_localOBB.R.col1.y;b2PolyShape.tAbsR.col2.x=this.m_R.col1.x*this.m_localOBB.R.col2.x+this.m_R.col2.x*this.m_localOBB.R.col2.y;b2PolyShape.tAbsR.col2.y=this.m_R.col1.y*this.m_localOBB.R.col2.x+this.m_R.col2.y*this.m_localOBB.R.col2.y;b2PolyShape.tAbsR.Abs()
hX=b2PolyShape.tAbsR.col1.x*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.x*this.m_localOBB.extents.y;hY=b2PolyShape.tAbsR.col1.y*this.m_localOBB.extents.x+b2PolyShape.tAbsR.col2.y*this.m_localOBB.extents.y;var positionX=this.m_position.x+(this.m_R.col1.x*this.m_localOBB.center.x+this.m_R.col2.x*this.m_localOBB.center.y);var positionY=this.m_position.y+(this.m_R.col1.y*this.m_localOBB.center.x+this.m_R.col2.y*this.m_localOBB.center.y);aabb.minVertex.x=positionX-hX;aabb.minVertex.y=positionY-hY;aabb.maxVertex.x=positionX+hX;aabb.maxVertex.y=positionY+hY;var broadPhase=this.m_body.m_world.m_broadPhase;if(broadPhase.InRange(aabb))
{this.m_proxyId=broadPhase.CreateProxy(aabb,this);}
else
{this.m_proxyId=b2Pair.b2_nullProxy;}
if(this.m_proxyId==b2Pair.b2_nullProxy)
{this.m_body.Freeze();}},syncAABB:new b2AABB(),syncMat:new b2Mat22(),Synchronize:function(position1,R1,position2,R2){this.m_R.SetM(R2);this.m_position.x=this.m_body.m_position.x+(R2.col1.x*this.m_localCentroid.x+R2.col2.x*this.m_localCentroid.y);this.m_position.y=this.m_body.m_position.y+(R2.col1.y*this.m_localCentroid.x+R2.col2.y*this.m_localCentroid.y);if(this.m_proxyId==b2Pair.b2_nullProxy)
{return;}
var hX;var hY;var v1=R1.col1;var v2=R1.col2;var v3=this.m_localOBB.R.col1;var v4=this.m_localOBB.R.col2;this.syncMat.col1.x=v1.x*v3.x+v2.x*v3.y;this.syncMat.col1.y=v1.y*v3.x+v2.y*v3.y;this.syncMat.col2.x=v1.x*v4.x+v2.x*v4.y;this.syncMat.col2.y=v1.y*v4.x+v2.y*v4.y;this.syncMat.Abs();hX=this.m_localCentroid.x+this.m_localOBB.center.x;hY=this.m_localCentroid.y+this.m_localOBB.center.y;var centerX=position1.x+(R1.col1.x*hX+R1.col2.x*hY);var centerY=position1.y+(R1.col1.y*hX+R1.col2.y*hY);hX=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y;hY=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y;this.syncAABB.minVertex.x=centerX-hX;this.syncAABB.minVertex.y=centerY-hY;this.syncAABB.maxVertex.x=centerX+hX;this.syncAABB.maxVertex.y=centerY+hY;v1=R2.col1;v2=R2.col2;v3=this.m_localOBB.R.col1;v4=this.m_localOBB.R.col2;this.syncMat.col1.x=v1.x*v3.x+v2.x*v3.y;this.syncMat.col1.y=v1.y*v3.x+v2.y*v3.y;this.syncMat.col2.x=v1.x*v4.x+v2.x*v4.y;this.syncMat.col2.y=v1.y*v4.x+v2.y*v4.y;this.syncMat.Abs();hX=this.m_localCentroid.x+this.m_localOBB.center.x;hY=this.m_localCentroid.y+this.m_localOBB.center.y;centerX=position2.x+(R2.col1.x*hX+R2.col2.x*hY);centerY=position2.y+(R2.col1.y*hX+R2.col2.y*hY);hX=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y;hY=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y;this.syncAABB.minVertex.x=Math.min(this.syncAABB.minVertex.x,centerX-hX);this.syncAABB.minVertex.y=Math.min(this.syncAABB.minVertex.y,centerY-hY);this.syncAABB.maxVertex.x=Math.max(this.syncAABB.maxVertex.x,centerX+hX);this.syncAABB.maxVertex.y=Math.max(this.syncAABB.maxVertex.y,centerY+hY);var broadPhase=this.m_body.m_world.m_broadPhase;if(broadPhase.InRange(this.syncAABB))
{broadPhase.MoveProxy(this.m_proxyId,this.syncAABB);}
else
{this.m_body.Freeze();}},QuickSync:function(position,R){this.m_R.SetM(R);this.m_position.x=position.x+(R.col1.x*this.m_localCentroid.x+R.col2.x*this.m_localCentroid.y);this.m_position.y=position.y+(R.col1.y*this.m_localCentroid.x+R.col2.y*this.m_localCentroid.y);},ResetProxy:function(broadPhase){if(this.m_proxyId==b2Pair.b2_nullProxy)
{return;}
var proxy=broadPhase.GetProxy(this.m_proxyId);broadPhase.DestroyProxy(this.m_proxyId);proxy=null;var R=b2Math.b2MulMM(this.m_R,this.m_localOBB.R);var absR=b2Math.b2AbsM(R);var h=b2Math.b2MulMV(absR,this.m_localOBB.extents);var position=b2Math.b2MulMV(this.m_R,this.m_localOBB.center);position.Add(this.m_position);var aabb=new b2AABB();aabb.minVertex.SetV(position);aabb.minVertex.Subtract(h);aabb.maxVertex.SetV(position);aabb.maxVertex.Add(h);if(broadPhase.InRange(aabb))
{this.m_proxyId=broadPhase.CreateProxy(aabb,this);}
else
{this.m_proxyId=b2Pair.b2_nullProxy;}
if(this.m_proxyId==b2Pair.b2_nullProxy)
{this.m_body.Freeze();}},Support:function(dX,dY,out)
{var dLocalX=(dX*this.m_R.col1.x+dY*this.m_R.col1.y);var dLocalY=(dX*this.m_R.col2.x+dY*this.m_R.col2.y);var bestIndex=0;var bestValue=(this.m_coreVertices[0].x*dLocalX+this.m_coreVertices[0].y*dLocalY);for(var i=1;i<this.m_vertexCount;++i)
{var value=(this.m_coreVertices[i].x*dLocalX+this.m_coreVertices[i].y*dLocalY);if(value>bestValue)
{bestIndex=i;bestValue=value;}}
out.Set(this.m_position.x+(this.m_R.col1.x*this.m_coreVertices[bestIndex].x+this.m_R.col2.x*this.m_coreVertices[bestIndex].y),this.m_position.y+(this.m_R.col1.y*this.m_coreVertices[bestIndex].x+this.m_R.col2.y*this.m_coreVertices[bestIndex].y));},m_localCentroid:new b2Vec2(),m_localOBB:new b2OBB(),m_vertices:null,m_coreVertices:null,m_vertexCount:0,m_normals:null});b2PolyShape.tempVec=new b2Vec2();b2PolyShape.tAbsR=new b2Mat22();var b2Body=Class.create();b2Body.prototype={SetOriginPosition:function(position,rotation){if(this.IsFrozen())
{return;}
this.m_rotation=rotation;this.m_R.Set(this.m_rotation);this.m_position=b2Math.AddVV(position,b2Math.b2MulMV(this.m_R,this.m_center));this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;for(var s=this.m_shapeList;s!=null;s=s.m_next)
{s.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);}
this.m_world.m_broadPhase.Commit();},GetOriginPosition:function(){return b2Math.SubtractVV(this.m_position,b2Math.b2MulMV(this.m_R,this.m_center));},SetCenterPosition:function(position,rotation){if(this.IsFrozen())
{return;}
this.m_rotation=rotation;this.m_R.Set(this.m_rotation);this.m_position.SetV(position);this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;for(var s=this.m_shapeList;s!=null;s=s.m_next)
{s.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);}
this.m_world.m_broadPhase.Commit();},GetCenterPosition:function(){return this.m_position;},GetPosition:function()
{var x,y;x=this.m_position.x;y=this.m_position.y;if((this.m_center.x!=0||this.m_center.y!=0))
{x-=this.m_center.x*Math.cos(-this.m_rotation)+this.m_center.y*Math.sin(-this.m_rotation);y-=this.m_center.x*-Math.sin(-this.m_rotation)+this.m_center.y*Math.cos(-this.m_rotation);}
return new b2Vec2(x,y);},GetRotation:function(){return this.m_rotation;},GetRotationMatrix:function(){return this.m_R;},SetLinearVelocity:function(v){this.m_linearVelocity.SetV(v);},GetLinearVelocity:function(){return this.m_linearVelocity;},SetAngularVelocity:function(w){this.m_angularVelocity=w;},GetAngularVelocity:function(){return this.m_angularVelocity;},ApplyForce:function(force,point)
{if(this.IsSleeping()==false)
{this.m_force.Add(force);this.m_torque+=b2Math.b2CrossVV(b2Math.SubtractVV(point,this.m_position),force);}},ApplyTorque:function(torque)
{if(this.IsSleeping()==false)
{this.m_torque+=torque;}},ApplyImpulse:function(impulse,point)
{if(this.IsSleeping()==false)
{this.m_linearVelocity.Add(b2Math.MulFV(this.m_invMass,impulse));this.m_angularVelocity+=(this.m_invI*b2Math.b2CrossVV(b2Math.SubtractVV(point,this.m_position),impulse));}},GetMass:function(){return this.m_mass;},GetInertia:function(){return this.m_I;},GetWorldPoint:function(localPoint){return b2Math.AddVV(this.m_position,b2Math.b2MulMV(this.m_R,localPoint));},GetWorldVector:function(localVector){return b2Math.b2MulMV(this.m_R,localVector);},GetLocalPoint:function(worldPoint){return b2Math.b2MulTMV(this.m_R,b2Math.SubtractVV(worldPoint,this.m_position));},GetLocalVector:function(worldVector){return b2Math.b2MulTMV(this.m_R,worldVector);},IsStatic:function(){return(this.m_flags&b2Body.e_staticFlag)==b2Body.e_staticFlag;},IsFrozen:function()
{return(this.m_flags&b2Body.e_frozenFlag)==b2Body.e_frozenFlag;},IsSleeping:function(){return(this.m_flags&b2Body.e_sleepFlag)==b2Body.e_sleepFlag;},AllowSleeping:function(flag)
{if(flag)
{this.m_flags|=b2Body.e_allowSleepFlag;}
else
{this.m_flags&=~b2Body.e_allowSleepFlag;this.WakeUp();}},WakeUp:function(){this.m_flags&=~b2Body.e_sleepFlag;this.m_sleepTime=0.0;},GoToSleep:function(){this.m_flags|=b2Body.e_sleepFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0.0;},GetShapeList:function(){return this.m_shapeList;},GetContactList:function()
{return this.m_contactList;},GetJointList:function()
{return this.m_jointList;},GetNext:function(){return this.m_next;},GetUserData:function(){return this.m_userData;},initialize:function(bd,world){this.sMat0=new b2Mat22();this.m_position=new b2Vec2();this.m_R=new b2Mat22(0);this.m_position0=new b2Vec2();var i=0;var sd;var massData;this.m_flags=0;this.m_position.SetV(bd.position);this.m_rotation=bd.rotation;this.m_R.Set(this.m_rotation);this.m_position0.SetV(this.m_position);this.m_rotation0=this.m_rotation;this.m_world=world;this.m_linearDamping=b2Math.b2Clamp(1.0-bd.linearDamping,0.0,1.0);this.m_angularDamping=b2Math.b2Clamp(1.0-bd.angularDamping,0.0,1.0);this.m_force=new b2Vec2(0.0,0.0);this.m_torque=0.0;this.m_mass=0.0;var massDatas=new Array(b2Settings.b2_maxShapesPerBody);for(i=0;i<b2Settings.b2_maxShapesPerBody;i++){massDatas[i]=new b2MassData();}
this.m_shapeCount=0;this.m_center=new b2Vec2(0.0,0.0);for(i=0;i<b2Settings.b2_maxShapesPerBody;++i)
{sd=bd.shapes[i];if(sd==null)break;massData=massDatas[i];sd.ComputeMass(massData);this.m_mass+=massData.mass;this.m_center.x+=massData.mass*(sd.localPosition.x+massData.center.x);this.m_center.y+=massData.mass*(sd.localPosition.y+massData.center.y);++this.m_shapeCount;}
if(this.m_mass>0.0)
{this.m_center.Multiply(1.0/this.m_mass);this.m_position.Add(b2Math.b2MulMV(this.m_R,this.m_center));}
else
{this.m_flags|=b2Body.e_staticFlag;}
this.m_I=0.0;for(i=0;i<this.m_shapeCount;++i)
{sd=bd.shapes[i];massData=massDatas[i];this.m_I+=massData.I;var r=b2Math.SubtractVV(b2Math.AddVV(sd.localPosition,massData.center),this.m_center);this.m_I+=massData.mass*b2Math.b2Dot(r,r);}
if(this.m_mass>0.0)
{this.m_invMass=1.0/this.m_mass;}
else
{this.m_invMass=0.0;}
if(this.m_I>0.0&&bd.preventRotation==false)
{this.m_invI=1.0/this.m_I;}
else
{this.m_I=0.0;this.m_invI=0.0;}
this.m_linearVelocity=b2Math.AddVV(bd.linearVelocity,b2Math.b2CrossFV(bd.angularVelocity,this.m_center));this.m_angularVelocity=bd.angularVelocity;this.m_jointList=null;this.m_contactList=null;this.m_prev=null;this.m_next=null;this.m_shapeList=null;for(i=0;i<this.m_shapeCount;++i)
{sd=bd.shapes[i];var shape=b2Shape.Create(sd,this,this.m_center);shape.m_next=this.m_shapeList;this.m_shapeList=shape;}
this.m_sleepTime=0.0;if(bd.allowSleep)
{this.m_flags|=b2Body.e_allowSleepFlag;}
if(bd.isSleeping)
{this.m_flags|=b2Body.e_sleepFlag;}
if((this.m_flags&b2Body.e_sleepFlag)||this.m_invMass==0.0)
{this.m_linearVelocity.Set(0.0,0.0);this.m_angularVelocity=0.0;}
this.m_userData=bd.userData;},Destroy:function(){var s=this.m_shapeList;while(s)
{var s0=s;s=s.m_next;b2Shape.Destroy(s0);}},sMat0:new b2Mat22(),SynchronizeShapes:function(){this.sMat0.Set(this.m_rotation0);for(var s=this.m_shapeList;s!=null;s=s.m_next)
{s.Synchronize(this.m_position0,this.sMat0,this.m_position,this.m_R);}},QuickSyncShapes:function(){for(var s=this.m_shapeList;s!=null;s=s.m_next)
{s.QuickSync(this.m_position,this.m_R);}},IsConnected:function(other){for(var jn=this.m_jointList;jn!=null;jn=jn.next)
{if(jn.other==other)
return jn.joint.m_collideConnected==false;}
return false;},Freeze:function(){this.m_flags|=b2Body.e_frozenFlag;this.m_linearVelocity.SetZero();this.m_angularVelocity=0.0;for(var s=this.m_shapeList;s!=null;s=s.m_next)
{s.DestroyProxy();}},m_flags:0,m_position:new b2Vec2(),m_rotation:null,m_R:new b2Mat22(0),m_position0:new b2Vec2(),m_rotation0:null,m_linearVelocity:null,m_angularVelocity:null,m_force:null,m_torque:null,m_center:null,m_world:null,m_prev:null,m_next:null,m_shapeList:null,m_shapeCount:0,m_jointList:null,m_contactList:null,m_mass:null,m_invMass:null,m_I:null,m_invI:null,m_linearDamping:null,m_angularDamping:null,m_sleepTime:null,m_userData:null};b2Body.e_staticFlag=0x0001;b2Body.e_frozenFlag=0x0002;b2Body.e_islandFlag=0x0004;b2Body.e_sleepFlag=0x0008;b2Body.e_allowSleepFlag=0x0010;b2Body.e_destroyFlag=0x0020;var b2BodyDef=Class.create();b2BodyDef.prototype={initialize:function()
{this.shapes=new Array();this.userData=null;for(var i=0;i<b2Settings.b2_maxShapesPerBody;i++){this.shapes[i]=null;}
this.position=new b2Vec2(0.0,0.0);this.rotation=0.0;this.linearVelocity=new b2Vec2(0.0,0.0);this.angularVelocity=0.0;this.linearDamping=0.0;this.angularDamping=0.0;this.allowSleep=true;this.isSleeping=false;this.preventRotation=false;},userData:null,shapes:new Array(),position:null,rotation:null,linearVelocity:null,angularVelocity:null,linearDamping:null,angularDamping:null,allowSleep:null,isSleeping:null,preventRotation:null,AddShape:function(shape)
{for(var i=0;i<b2Settings.b2_maxShapesPerBody;++i)
{if(this.shapes[i]==null)
{this.shapes[i]=shape;break;}}}};var b2CollisionFilter=Class.create();b2CollisionFilter.prototype={ShouldCollide:function(shape1,shape2){if(shape1.m_groupIndex==shape2.m_groupIndex&&shape1.m_groupIndex!=0)
{return shape1.m_groupIndex>0;}
var collide=(shape1.m_maskBits&shape2.m_categoryBits)!=0&&(shape1.m_categoryBits&shape2.m_maskBits)!=0;return collide;},initialize:function(){}};b2CollisionFilter.b2_defaultFilter=new b2CollisionFilter;var b2Island=Class.create();b2Island.prototype={initialize:function(bodyCapacity,contactCapacity,jointCapacity,allocator)
{var i=0;this.m_bodyCapacity=bodyCapacity;this.m_contactCapacity=contactCapacity;this.m_jointCapacity=jointCapacity;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_bodies=new Array(bodyCapacity);for(i=0;i<bodyCapacity;i++)
this.m_bodies[i]=null;this.m_contacts=new Array(contactCapacity);for(i=0;i<contactCapacity;i++)
this.m_contacts[i]=null;this.m_joints=new Array(jointCapacity);for(i=0;i<jointCapacity;i++)
this.m_joints[i]=null;this.m_allocator=allocator;},Clear:function()
{this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;},Solve:function(step,gravity)
{var i=0;var b;for(i=0;i<this.m_bodyCount;++i)
{b=this.m_bodies[i];if(b.m_invMass==0.0)
continue;b.m_linearVelocity.Add(b2Math.MulFV(step.dt,b2Math.AddVV(gravity,b2Math.MulFV(b.m_invMass,b.m_force))));b.m_angularVelocity+=step.dt*b.m_invI*b.m_torque;b.m_linearVelocity.Multiply(b.m_linearDamping);b.m_angularVelocity*=b.m_angularDamping;b.m_position0.SetV(b.m_position);b.m_rotation0=b.m_rotation;}
var contactSolver=new b2ContactSolver(this.m_contacts,this.m_contactCount,this.m_allocator);contactSolver.PreSolve();for(i=0;i<this.m_jointCount;++i)
{this.m_joints[i].PrepareVelocitySolver();}
for(i=0;i<step.iterations;++i)
{contactSolver.SolveVelocityConstraints();for(var j=0;j<this.m_jointCount;++j)
{this.m_joints[j].SolveVelocityConstraints(step);}}
for(i=0;i<this.m_bodyCount;++i)
{b=this.m_bodies[i];if(b.m_invMass==0.0)
continue;b.m_position.x+=step.dt*b.m_linearVelocity.x;b.m_position.y+=step.dt*b.m_linearVelocity.y;b.m_rotation+=step.dt*b.m_angularVelocity;b.m_R.Set(b.m_rotation);}
for(i=0;i<this.m_jointCount;++i)
{this.m_joints[i].PreparePositionSolver();}
if(b2World.s_enablePositionCorrection)
{for(b2Island.m_positionIterationCount=0;b2Island.m_positionIterationCount<step.iterations;++b2Island.m_positionIterationCount)
{var contactsOkay=contactSolver.SolvePositionConstraints(b2Settings.b2_contactBaumgarte);var jointsOkay=true;for(i=0;i<this.m_jointCount;++i)
{var jointOkay=this.m_joints[i].SolvePositionConstraints();jointsOkay=jointsOkay&&jointOkay;}
if(contactsOkay&&jointsOkay)
{break;}}}
contactSolver.PostSolve();for(i=0;i<this.m_bodyCount;++i)
{b=this.m_bodies[i];if(b.m_invMass==0.0)
continue;b.m_R.Set(b.m_rotation);b.SynchronizeShapes();b.m_force.Set(0.0,0.0);b.m_torque=0.0;}},UpdateSleep:function(dt)
{var i=0;var b;var minSleepTime=Number.MAX_VALUE;var linTolSqr=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance;var angTolSqr=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)
{b=this.m_bodies[i];if(b.m_invMass==0.0)
{continue;}
if((b.m_flags&b2Body.e_allowSleepFlag)==0)
{b.m_sleepTime=0.0;minSleepTime=0.0;}
if((b.m_flags&b2Body.e_allowSleepFlag)==0||b.m_angularVelocity*b.m_angularVelocity>angTolSqr||b2Math.b2Dot(b.m_linearVelocity,b.m_linearVelocity)>linTolSqr)
{b.m_sleepTime=0.0;minSleepTime=0.0;}
else
{b.m_sleepTime+=dt;minSleepTime=b2Math.b2Min(minSleepTime,b.m_sleepTime);}}
if(minSleepTime>=b2Settings.b2_timeToSleep)
{for(i=0;i<this.m_bodyCount;++i)
{b=this.m_bodies[i];b.m_flags|=b2Body.e_sleepFlag;b.m_linearVelocity.SetZero();b.m_angularVelocity=0.0;}}},AddBody:function(body)
{this.m_bodies[this.m_bodyCount++]=body;},AddContact:function(contact)
{this.m_contacts[this.m_contactCount++]=contact;},AddJoint:function(joint)
{this.m_joints[this.m_jointCount++]=joint;},m_allocator:null,m_bodies:null,m_contacts:null,m_joints:null,m_bodyCount:0,m_jointCount:0,m_contactCount:0,m_bodyCapacity:0,m_contactCapacity:0,m_jointCapacity:0,m_positionError:null};b2Island.m_positionIterationCount=0;var b2TimeStep=Class.create();b2TimeStep.prototype={dt:null,inv_dt:null,iterations:0,initialize:function(){}};var b2ContactNode=Class.create();b2ContactNode.prototype={other:null,contact:null,prev:null,next:null,initialize:function(){}};var b2Contact=Class.create();b2Contact.prototype={GetManifolds:function(){return null},GetManifoldCount:function()
{return this.m_manifoldCount;},GetNext:function(){return this.m_next;},GetShape1:function(){return this.m_shape1;},GetShape2:function(){return this.m_shape2;},initialize:function(s1,s2)
{this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;},Evaluate:function(){},m_flags:0,m_prev:null,m_next:null,m_node1:new b2ContactNode(),m_node2:new b2ContactNode(),m_shape1:null,m_shape2:null,m_manifoldCount:0,m_friction:null,m_restitution:null};b2Contact.e_islandFlag=0x0001;b2Contact.e_destroyFlag=0x0002;b2Contact.AddType=function(createFcn,destroyFcn,type1,type2)
{b2Contact.s_registers[type1][type2].createFcn=createFcn;b2Contact.s_registers[type1][type2].destroyFcn=destroyFcn;b2Contact.s_registers[type1][type2].primary=true;if(type1!=type2)
{b2Contact.s_registers[type2][type1].createFcn=createFcn;b2Contact.s_registers[type2][type1].destroyFcn=destroyFcn;b2Contact.s_registers[type2][type1].primary=false;}};b2Contact.InitializeRegisters=function(){b2Contact.s_registers=new Array(b2Shape.e_shapeTypeCount);for(var i=0;i<b2Shape.e_shapeTypeCount;i++){b2Contact.s_registers[i]=new Array(b2Shape.e_shapeTypeCount);for(var j=0;j<b2Shape.e_shapeTypeCount;j++){b2Contact.s_registers[i][j]=new b2ContactRegister();}}
b2Contact.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polyShape,b2Shape.e_circleShape);b2Contact.AddType(b2PolyContact.Create,b2PolyContact.Destroy,b2Shape.e_polyShape,b2Shape.e_polyShape);};b2Contact.Create=function(shape1,shape2,allocator){if(b2Contact.s_initialized==false)
{b2Contact.InitializeRegisters();b2Contact.s_initialized=true;}
var type1=shape1.m_type;var type2=shape2.m_type;var createFcn=b2Contact.s_registers[type1][type2].createFcn;if(createFcn)
{if(b2Contact.s_registers[type1][type2].primary)
{return createFcn(shape1,shape2,allocator);}
else
{var c=createFcn(shape2,shape1,allocator);for(var i=0;i<c.GetManifoldCount();++i)
{var m=c.GetManifolds()[i];m.normal=m.normal.Negative();}
return c;}}
else
{return null;}};b2Contact.Destroy=function(contact,allocator){if(contact.GetManifoldCount()>0)
{contact.m_shape1.m_body.WakeUp();contact.m_shape2.m_body.WakeUp();}
var type1=contact.m_shape1.m_type;var type2=contact.m_shape2.m_type;var destroyFcn=b2Contact.s_registers[type1][type2].destroyFcn;destroyFcn(contact,allocator);};b2Contact.s_registers=null;b2Contact.s_initialized=false;var b2ContactConstraint=Class.create();b2ContactConstraint.prototype={initialize:function(){this.normal=new b2Vec2();this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var i=0;i<b2Settings.b2_maxManifoldPoints;i++){this.points[i]=new b2ContactConstraintPoint();}},points:null,normal:new b2Vec2(),manifold:null,body1:null,body2:null,friction:null,restitution:null,pointCount:0};var b2ContactConstraintPoint=Class.create();b2ContactConstraintPoint.prototype={localAnchor1:new b2Vec2(),localAnchor2:new b2Vec2(),normalImpulse:null,tangentImpulse:null,positionImpulse:null,normalMass:null,tangentMass:null,separation:null,velocityBias:null,initialize:function(){this.localAnchor1=new b2Vec2();this.localAnchor2=new b2Vec2();}};var b2ContactRegister=Class.create();b2ContactRegister.prototype={createFcn:null,destroyFcn:null,primary:null,initialize:function(){}};var b2ContactSolver=Class.create();b2ContactSolver.prototype={initialize:function(contacts,contactCount,allocator){this.m_constraints=new Array();this.m_allocator=allocator;var i=0;var tVec;var tMat;this.m_constraintCount=0;for(i=0;i<contactCount;++i)
{this.m_constraintCount+=contacts[i].GetManifoldCount();}
for(i=0;i<this.m_constraintCount;i++){this.m_constraints[i]=new b2ContactConstraint();}
var count=0;for(i=0;i<contactCount;++i)
{var contact=contacts[i];var b1=contact.m_shape1.m_body;var b2=contact.m_shape2.m_body;var manifoldCount=contact.GetManifoldCount();var manifolds=contact.GetManifolds();var friction=contact.m_friction;var restitution=contact.m_restitution;var v1X=b1.m_linearVelocity.x;var v1Y=b1.m_linearVelocity.y;var v2X=b2.m_linearVelocity.x;var v2Y=b2.m_linearVelocity.y;var w1=b1.m_angularVelocity;var w2=b2.m_angularVelocity;for(var j=0;j<manifoldCount;++j)
{var manifold=manifolds[j];var normalX=manifold.normal.x;var normalY=manifold.normal.y;var c=this.m_constraints[count];c.body1=b1;c.body2=b2;c.manifold=manifold;c.normal.x=normalX;c.normal.y=normalY;c.pointCount=manifold.pointCount;c.friction=friction;c.restitution=restitution;for(var k=0;k<c.pointCount;++k)
{var cp=manifold.points[k];var ccp=c.points[k];ccp.normalImpulse=cp.normalImpulse;ccp.tangentImpulse=cp.tangentImpulse;ccp.separation=cp.separation;var r1X=cp.position.x-b1.m_position.x;var r1Y=cp.position.y-b1.m_position.y;var r2X=cp.position.x-b2.m_position.x;var r2Y=cp.position.y-b2.m_position.y;tVec=ccp.localAnchor1;tMat=b1.m_R;tVec.x=r1X*tMat.col1.x+r1Y*tMat.col1.y;tVec.y=r1X*tMat.col2.x+r1Y*tMat.col2.y;tVec=ccp.localAnchor2;tMat=b2.m_R;tVec.x=r2X*tMat.col1.x+r2Y*tMat.col1.y;tVec.y=r2X*tMat.col2.x+r2Y*tMat.col2.y;var r1Sqr=r1X*r1X+r1Y*r1Y;var r2Sqr=r2X*r2X+r2Y*r2Y;var rn1=r1X*normalX+r1Y*normalY;var rn2=r2X*normalX+r2Y*normalY;var kNormal=b1.m_invMass+b2.m_invMass;kNormal+=b1.m_invI*(r1Sqr-rn1*rn1)+b2.m_invI*(r2Sqr-rn2*rn2);ccp.normalMass=1.0/kNormal;var tangentX=normalY
var tangentY=-normalX;var rt1=r1X*tangentX+r1Y*tangentY;var rt2=r2X*tangentX+r2Y*tangentY;var kTangent=b1.m_invMass+b2.m_invMass;kTangent+=b1.m_invI*(r1Sqr-rt1*rt1)+b2.m_invI*(r2Sqr-rt2*rt2);ccp.tangentMass=1.0/kTangent;ccp.velocityBias=0.0;if(ccp.separation>0.0)
{ccp.velocityBias=-60.0*ccp.separation;}
var tX=v2X+(-w2*r2Y)-v1X-(-w1*r1Y);var tY=v2Y+(w2*r2X)-v1Y-(w1*r1X);var vRel=c.normal.x*tX+c.normal.y*tY;if(vRel<-b2Settings.b2_velocityThreshold)
{ccp.velocityBias+=-c.restitution*vRel;}}
++count;}}},PreSolve:function(){var tVec;var tVec2;var tMat;for(var i=0;i<this.m_constraintCount;++i)
{var c=this.m_constraints[i];var b1=c.body1;var b2=c.body2;var invMass1=b1.m_invMass;var invI1=b1.m_invI;var invMass2=b2.m_invMass;var invI2=b2.m_invI;var normalX=c.normal.x;var normalY=c.normal.y;var tangentX=normalY;var tangentY=-normalX;var j=0;var tCount=0;if(b2World.s_enableWarmStarting)
{tCount=c.pointCount;for(j=0;j<tCount;++j)
{var ccp=c.points[j];var PX=ccp.normalImpulse*normalX+ccp.tangentImpulse*tangentX;var PY=ccp.normalImpulse*normalY+ccp.tangentImpulse*tangentY;tMat=b1.m_R;tVec=ccp.localAnchor1;var r1X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;var r1Y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=b2.m_R;tVec=ccp.localAnchor2;var r2X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;var r2Y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;b1.m_angularVelocity-=invI1*(r1X*PY-r1Y*PX);b1.m_linearVelocity.x-=invMass1*PX;b1.m_linearVelocity.y-=invMass1*PY;b2.m_angularVelocity+=invI2*(r2X*PY-r2Y*PX);b2.m_linearVelocity.x+=invMass2*PX;b2.m_linearVelocity.y+=invMass2*PY;ccp.positionImpulse=0.0;}}
else{tCount=c.pointCount;for(j=0;j<tCount;++j)
{var ccp2=c.points[j];ccp2.normalImpulse=0.0;ccp2.tangentImpulse=0.0;ccp2.positionImpulse=0.0;}}}},SolveVelocityConstraints:function(){var j=0;var ccp;var r1X;var r1Y;var r2X;var r2Y;var dvX;var dvY;var lambda;var newImpulse;var PX;var PY;var tMat;var tVec;for(var i=0;i<this.m_constraintCount;++i)
{var c=this.m_constraints[i];var b1=c.body1;var b2=c.body2;var b1_angularVelocity=b1.m_angularVelocity;var b1_linearVelocity=b1.m_linearVelocity;var b2_angularVelocity=b2.m_angularVelocity;var b2_linearVelocity=b2.m_linearVelocity;var invMass1=b1.m_invMass;var invI1=b1.m_invI;var invMass2=b2.m_invMass;var invI2=b2.m_invI;var normalX=c.normal.x;var normalY=c.normal.y;var tangentX=normalY;var tangentY=-normalX;var tCount=c.pointCount;for(j=0;j<tCount;++j)
{ccp=c.points[j];tMat=b1.m_R;tVec=ccp.localAnchor1;r1X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y
r1Y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y
tMat=b2.m_R;tVec=ccp.localAnchor2;r2X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y
r2Y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y
dvX=b2_linearVelocity.x+(-b2_angularVelocity*r2Y)-b1_linearVelocity.x-(-b1_angularVelocity*r1Y);dvY=b2_linearVelocity.y+(b2_angularVelocity*r2X)-b1_linearVelocity.y-(b1_angularVelocity*r1X);var vn=dvX*normalX+dvY*normalY;lambda=-ccp.normalMass*(vn-ccp.velocityBias);newImpulse=b2Math.b2Max(ccp.normalImpulse+lambda,0.0);lambda=newImpulse-ccp.normalImpulse;PX=lambda*normalX;PY=lambda*normalY;b1_linearVelocity.x-=invMass1*PX;b1_linearVelocity.y-=invMass1*PY;b1_angularVelocity-=invI1*(r1X*PY-r1Y*PX);b2_linearVelocity.x+=invMass2*PX;b2_linearVelocity.y+=invMass2*PY;b2_angularVelocity+=invI2*(r2X*PY-r2Y*PX);ccp.normalImpulse=newImpulse;dvX=b2_linearVelocity.x+(-b2_angularVelocity*r2Y)-b1_linearVelocity.x-(-b1_angularVelocity*r1Y);dvY=b2_linearVelocity.y+(b2_angularVelocity*r2X)-b1_linearVelocity.y-(b1_angularVelocity*r1X);var vt=dvX*tangentX+dvY*tangentY;lambda=ccp.tangentMass*(-vt);var maxFriction=c.friction*ccp.normalImpulse;newImpulse=b2Math.b2Clamp(ccp.tangentImpulse+lambda,-maxFriction,maxFriction);lambda=newImpulse-ccp.tangentImpulse;PX=lambda*tangentX;PY=lambda*tangentY;b1_linearVelocity.x-=invMass1*PX;b1_linearVelocity.y-=invMass1*PY;b1_angularVelocity-=invI1*(r1X*PY-r1Y*PX);b2_linearVelocity.x+=invMass2*PX;b2_linearVelocity.y+=invMass2*PY;b2_angularVelocity+=invI2*(r2X*PY-r2Y*PX);ccp.tangentImpulse=newImpulse;}
b1.m_angularVelocity=b1_angularVelocity;b2.m_angularVelocity=b2_angularVelocity;}},SolvePositionConstraints:function(beta){var minSeparation=0.0;var tMat;var tVec;for(var i=0;i<this.m_constraintCount;++i)
{var c=this.m_constraints[i];var b1=c.body1;var b2=c.body2;var b1_position=b1.m_position;var b1_rotation=b1.m_rotation;var b2_position=b2.m_position;var b2_rotation=b2.m_rotation;var invMass1=b1.m_invMass;var invI1=b1.m_invI;var invMass2=b2.m_invMass;var invI2=b2.m_invI;var normalX=c.normal.x;var normalY=c.normal.y;var tangentX=normalY;var tangentY=-normalX;var tCount=c.pointCount;for(var j=0;j<tCount;++j)
{var ccp=c.points[j];tMat=b1.m_R;tVec=ccp.localAnchor1;var r1X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y
var r1Y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y
tMat=b2.m_R;tVec=ccp.localAnchor2;var r2X=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y
var r2Y=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y
var p1X=b1_position.x+r1X;var p1Y=b1_position.y+r1Y;var p2X=b2_position.x+r2X;var p2Y=b2_position.y+r2Y;var dpX=p2X-p1X;var dpY=p2Y-p1Y;var separation=(dpX*normalX+dpY*normalY)+ccp.separation;minSeparation=b2Math.b2Min(minSeparation,separation);var C=beta*b2Math.b2Clamp(separation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0.0);var dImpulse=-ccp.normalMass*C;var impulse0=ccp.positionImpulse;ccp.positionImpulse=b2Math.b2Max(impulse0+dImpulse,0.0);dImpulse=ccp.positionImpulse-impulse0;var impulseX=dImpulse*normalX;var impulseY=dImpulse*normalY;b1_position.x-=invMass1*impulseX;b1_position.y-=invMass1*impulseY;b1_rotation-=invI1*(r1X*impulseY-r1Y*impulseX);b1.m_R.Set(b1_rotation);b2_position.x+=invMass2*impulseX;b2_position.y+=invMass2*impulseY;b2_rotation+=invI2*(r2X*impulseY-r2Y*impulseX);b2.m_R.Set(b2_rotation);}
b1.m_rotation=b1_rotation;b2.m_rotation=b2_rotation;}
return minSeparation>=-b2Settings.b2_linearSlop;},PostSolve:function(){for(var i=0;i<this.m_constraintCount;++i)
{var c=this.m_constraints[i];var m=c.manifold;for(var j=0;j<c.pointCount;++j)
{var mPoint=m.points[j];var cPoint=c.points[j];mPoint.normalImpulse=cPoint.normalImpulse;mPoint.tangentImpulse=cPoint.tangentImpulse;}}},m_allocator:null,m_constraints:new Array(),m_constraintCount:0};var b2CircleContact=Class.create();Object.extend(b2CircleContact.prototype,b2Contact.prototype);Object.extend(b2CircleContact.prototype,{initialize:function(s1,s2){this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m_manifold=[new b2Manifold()];this.m_manifold[0].pointCount=0;this.m_manifold[0].points[0].normalImpulse=0.0;this.m_manifold[0].points[0].tangentImpulse=0.0;},Evaluate:function(){b2Collision.b2CollideCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,false);if(this.m_manifold[0].pointCount>0)
{this.m_manifoldCount=1;}
else
{this.m_manifoldCount=0;}},GetManifolds:function()
{return this.m_manifold;},m_manifold:[new b2Manifold()]});b2CircleContact.Create=function(shape1,shape2,allocator){return new b2CircleContact(shape1,shape2);};b2CircleContact.Destroy=function(contact,allocator){};var b2Conservative=Class.create();b2Conservative.prototype={initialize:function(){}}
b2Conservative.R1=new b2Mat22();b2Conservative.R2=new b2Mat22();b2Conservative.x1=new b2Vec2();b2Conservative.x2=new b2Vec2();b2Conservative.Conservative=function(shape1,shape2){var body1=shape1.GetBody();var body2=shape2.GetBody();var v1X=body1.m_position.x-body1.m_position0.x;var v1Y=body1.m_position.y-body1.m_position0.y;var omega1=body1.m_rotation-body1.m_rotation0;var v2X=body2.m_position.x-body2.m_position0.x;var v2Y=body2.m_position.y-body2.m_position0.y;var omega2=body2.m_rotation-body2.m_rotation0;var r1=shape1.GetMaxRadius();var r2=shape2.GetMaxRadius();var p1StartX=body1.m_position0.x;var p1StartY=body1.m_position0.y;var a1Start=body1.m_rotation0;var p2StartX=body2.m_position0.x;var p2StartY=body2.m_position0.y;var a2Start=body2.m_rotation0;var p1X=p1StartX;var p1Y=p1StartY;var a1=a1Start;var p2X=p2StartX;var p2Y=p2StartY;var a2=a2Start;b2Conservative.R1.Set(a1);b2Conservative.R2.Set(a2);shape1.QuickSync(p1,b2Conservative.R1);shape2.QuickSync(p2,b2Conservative.R2);var s1=0.0;var maxIterations=10;var dX;var dY;var invRelativeVelocity=0.0;var hit=true;for(var iter=0;iter<maxIterations;++iter)
{var distance=b2Distance.Distance(b2Conservative.x1,b2Conservative.x2,shape1,shape2);if(distance<b2Settings.b2_linearSlop)
{if(iter==0)
{hit=false;}
else
{hit=true;}
break;}
if(iter==0)
{dX=b2Conservative.x2.x-b2Conservative.x1.x;dY=b2Conservative.x2.y-b2Conservative.x1.y;var dLen=Math.sqrt(dX*dX+dY*dY);var relativeVelocity=(dX*(v1X-v2X)+dY*(v1Y-v2Y))+Math.abs(omega1)*r1+Math.abs(omega2)*r2;if(Math.abs(relativeVelocity)<Number.MIN_VALUE)
{hit=false;break;}
invRelativeVelocity=1.0/relativeVelocity;}
var ds=distance*invRelativeVelocity;var s2=s1+ds;if(s2<0.0||1.0<s2)
{hit=false;break;}
if(s2<(1.0+100.0*Number.MIN_VALUE)*s1)
{hit=true;break;}
s1=s2;p1X=p1StartX+s1*v1.x;p1Y=p1StartY+s1*v1.y;a1=a1Start+s1*omega1;p2X=p2StartX+s1*v2.x;p2Y=p2StartY+s1*v2.y;a2=a2Start+s1*omega2;b2Conservative.R1.Set(a1);b2Conservative.R2.Set(a2);shape1.QuickSync(p1,b2Conservative.R1);shape2.QuickSync(p2,b2Conservative.R2);}
if(hit)
{dX=b2Conservative.x2.x-b2Conservative.x1.x;dY=b2Conservative.x2.y-b2Conservative.x1.y;var length=Math.sqrt(dX*dX+dY*dY);if(length>FLT_EPSILON)
{d*=b2_linearSlop/length;}
if(body1.IsStatic())
{body1.m_position.x=p1X;body1.m_position.y=p1Y;}
else
{body1.m_position.x=p1X-dX;body1.m_position.y=p1Y-dY;}
body1.m_rotation=a1;body1.m_R.Set(a1);body1.QuickSyncShapes();if(body2.IsStatic())
{body2.m_position.x=p2X;body2.m_position.y=p2Y;}
else
{body2.m_position.x=p2X+dX;body2.m_position.y=p2Y+dY;}
body2.m_position.x=p2X+dX;body2.m_position.y=p2Y+dY;body2.m_rotation=a2;body2.m_R.Set(a2);body2.QuickSyncShapes();return true;}
shape1.QuickSync(body1.m_position,body1.m_R);shape2.QuickSync(body2.m_position,body2.m_R);return false;};var b2NullContact=Class.create();Object.extend(b2NullContact.prototype,b2Contact.prototype);Object.extend(b2NullContact.prototype,{initialize:function(s1,s2){this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;},Evaluate:function(){},GetManifolds:function(){return null;}});var b2PolyAndCircleContact=Class.create();Object.extend(b2PolyAndCircleContact.prototype,b2Contact.prototype);Object.extend(b2PolyAndCircleContact.prototype,{initialize:function(s1,s2){this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m_manifold=[new b2Manifold()];b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polyShape);b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape);this.m_manifold[0].pointCount=0;this.m_manifold[0].points[0].normalImpulse=0.0;this.m_manifold[0].points[0].tangentImpulse=0.0;},Evaluate:function(){b2Collision.b2CollidePolyAndCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,false);if(this.m_manifold[0].pointCount>0)
{this.m_manifoldCount=1;}
else
{this.m_manifoldCount=0;}},GetManifolds:function()
{return this.m_manifold;},m_manifold:[new b2Manifold()]})
b2PolyAndCircleContact.Create=function(shape1,shape2,allocator){return new b2PolyAndCircleContact(shape1,shape2);};b2PolyAndCircleContact.Destroy=function(contact,allocator){};var b2PolyContact=Class.create();Object.extend(b2PolyContact.prototype,b2Contact.prototype);Object.extend(b2PolyContact.prototype,{initialize:function(s1,s2){this.m_node1=new b2ContactNode();this.m_node2=new b2ContactNode();this.m_flags=0;if(!s1||!s2){this.m_shape1=null;this.m_shape2=null;return;}
this.m_shape1=s1;this.m_shape2=s2;this.m_manifoldCount=0;this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction);this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution);this.m_prev=null;this.m_next=null;this.m_node1.contact=null;this.m_node1.prev=null;this.m_node1.next=null;this.m_node1.other=null;this.m_node2.contact=null;this.m_node2.prev=null;this.m_node2.next=null;this.m_node2.other=null;this.m0=new b2Manifold();this.m_manifold=[new b2Manifold()];this.m_manifold[0].pointCount=0;},m0:new b2Manifold(),Evaluate:function(){var tMani=this.m_manifold[0];var tPoints=this.m0.points;for(var k=0;k<tMani.pointCount;k++){var tPoint=tPoints[k];var tPoint0=tMani.points[k];tPoint.normalImpulse=tPoint0.normalImpulse;tPoint.tangentImpulse=tPoint0.tangentImpulse;tPoint.id=tPoint0.id.Copy();}
this.m0.pointCount=tMani.pointCount;b2Collision.b2CollidePoly(tMani,this.m_shape1,this.m_shape2,false);if(tMani.pointCount>0)
{var match=[false,false];for(var i=0;i<tMani.pointCount;++i)
{var cp=tMani.points[i];cp.normalImpulse=0.0;cp.tangentImpulse=0.0;var idKey=cp.id.key;for(var j=0;j<this.m0.pointCount;++j)
{if(match[j]==true)
continue;var cp0=this.m0.points[j];var id0=cp0.id;if(id0.key==idKey)
{match[j]=true;cp.normalImpulse=cp0.normalImpulse;cp.tangentImpulse=cp0.tangentImpulse;break;}}}
this.m_manifoldCount=1;}
else
{this.m_manifoldCount=0;}},GetManifolds:function()
{return this.m_manifold;},m_manifold:[new b2Manifold()]});b2PolyContact.Create=function(shape1,shape2,allocator){return new b2PolyContact(shape1,shape2);};b2PolyContact.Destroy=function(contact,allocator){};var b2ContactManager=Class.create();Object.extend(b2ContactManager.prototype,b2PairCallback.prototype);Object.extend(b2ContactManager.prototype,{initialize:function(){this.m_nullContact=new b2NullContact();this.m_world=null;this.m_destroyImmediate=false;},PairAdded:function(proxyUserData1,proxyUserData2){var shape1=proxyUserData1;var shape2=proxyUserData2;var body1=shape1.m_body;var body2=shape2.m_body;if(body1.IsStatic()&&body2.IsStatic())
{return this.m_nullContact;}
if(shape1.m_body==shape2.m_body)
{return this.m_nullContact;}
if(body2.IsConnected(body1))
{return this.m_nullContact;}
if(this.m_world.m_filter!=null&&this.m_world.m_filter.ShouldCollide(shape1,shape2)==false)
{return this.m_nullContact;}
if(body2.m_invMass==0.0)
{var tempShape=shape1;shape1=shape2;shape2=tempShape;var tempBody=body1;body1=body2;body2=tempBody;}
var contact=b2Contact.Create(shape1,shape2,this.m_world.m_blockAllocator);if(contact==null)
{return this.m_nullContact;}
else
{contact.m_prev=null;contact.m_next=this.m_world.m_contactList;if(this.m_world.m_contactList!=null)
{this.m_world.m_contactList.m_prev=contact;}
this.m_world.m_contactList=contact;this.m_world.m_contactCount++;}
return contact;},PairRemoved:function(proxyUserData1,proxyUserData2,pairUserData){if(pairUserData==null)
{return;}
var c=pairUserData;if(c!=this.m_nullContact)
{if(this.m_destroyImmediate==true)
{this.DestroyContact(c);c=null;}
else
{c.m_flags|=b2Contact.e_destroyFlag;}}},DestroyContact:function(c)
{if(c.m_prev)
{c.m_prev.m_next=c.m_next;}
if(c.m_next)
{c.m_next.m_prev=c.m_prev;}
if(c==this.m_world.m_contactList)
{this.m_world.m_contactList=c.m_next;}
if(c.GetManifoldCount()>0)
{var body1=c.m_shape1.m_body;var body2=c.m_shape2.m_body;var node1=c.m_node1;var node2=c.m_node2;body1.WakeUp();body2.WakeUp();if(node1.prev)
{node1.prev.next=node1.next;}
if(node1.next)
{node1.next.prev=node1.prev;}
if(node1==body1.m_contactList)
{body1.m_contactList=node1.next;}
node1.prev=null;node1.next=null;if(node2.prev)
{node2.prev.next=node2.next;}
if(node2.next)
{node2.next.prev=node2.prev;}
if(node2==body2.m_contactList)
{body2.m_contactList=node2.next;}
node2.prev=null;node2.next=null;}
b2Contact.Destroy(c,this.m_world.m_blockAllocator);--this.m_world.m_contactCount;},CleanContactList:function()
{var c=this.m_world.m_contactList;while(c!=null)
{var c0=c;c=c.m_next;if(c0.m_flags&b2Contact.e_destroyFlag)
{this.DestroyContact(c0);c0=null;}}},Collide:function()
{var body1;var body2;var node1;var node2;for(var c=this.m_world.m_contactList;c!=null;c=c.m_next)
{if(c.m_shape1.m_body.IsSleeping()&&c.m_shape2.m_body.IsSleeping())
{continue;}
var oldCount=c.GetManifoldCount();c.Evaluate();var newCount=c.GetManifoldCount();if(oldCount==0&&newCount>0)
{body1=c.m_shape1.m_body;body2=c.m_shape2.m_body;node1=c.m_node1;node2=c.m_node2;node1.contact=c;node1.other=body2;node1.prev=null;node1.next=body1.m_contactList;if(node1.next!=null)
{node1.next.prev=c.m_node1;}
body1.m_contactList=c.m_node1;node2.contact=c;node2.other=body1;node2.prev=null;node2.next=body2.m_contactList;if(node2.next!=null)
{node2.next.prev=node2;}
body2.m_contactList=node2;}
else if(oldCount>0&&newCount==0)
{body1=c.m_shape1.m_body;body2=c.m_shape2.m_body;node1=c.m_node1;node2=c.m_node2;if(node1.prev)
{node1.prev.next=node1.next;}
if(node1.next)
{node1.next.prev=node1.prev;}
if(node1==body1.m_contactList)
{body1.m_contactList=node1.next;}
node1.prev=null;node1.next=null;if(node2.prev)
{node2.prev.next=node2.next;}
if(node2.next)
{node2.next.prev=node2.prev;}
if(node2==body2.m_contactList)
{body2.m_contactList=node2.next;}
node2.prev=null;node2.next=null;}}},m_world:null,m_nullContact:new b2NullContact(),m_destroyImmediate:null});var b2World=Class.create();b2World.prototype={initialize:function(worldAABB,gravity,doSleep){this.step=new b2TimeStep();this.m_contactManager=new b2ContactManager();this.m_listener=null;this.m_filter=b2CollisionFilter.b2_defaultFilter;this.m_bodyList=null;this.m_contactList=null;this.m_jointList=null;this.m_bodyCount=0;this.m_contactCount=0;this.m_jointCount=0;this.m_bodyDestroyList=null;this.m_allowSleep=doSleep;this.m_gravity=gravity;this.m_contactManager.m_world=this;this.m_broadPhase=new b2BroadPhase(worldAABB,this.m_contactManager);var bd=new b2BodyDef();this.m_groundBody=this.CreateBody(bd);},SetListener:function(listener){this.m_listener=listener;},SetFilter:function(filter){this.m_filter=filter;},CreateBody:function(def){var b=new b2Body(def,this);b.m_prev=null;b.m_next=this.m_bodyList;if(this.m_bodyList)
{this.m_bodyList.m_prev=b;}
this.m_bodyList=b;++this.m_bodyCount;return b;},DestroyBody:function(b)
{if(b.m_flags&b2Body.e_destroyFlag)
{return;}
if(b.m_prev)
{b.m_prev.m_next=b.m_next;}
if(b.m_next)
{b.m_next.m_prev=b.m_prev;}
if(b==this.m_bodyList)
{this.m_bodyList=b.m_next;}
b.m_flags|=b2Body.e_destroyFlag;--this.m_bodyCount;b.m_prev=null;b.m_next=this.m_bodyDestroyList;this.m_bodyDestroyList=b;},CleanBodyList:function()
{this.m_contactManager.m_destroyImmediate=true;var b=this.m_bodyDestroyList;while(b)
{var b0=b;b=b.m_next;var jn=b0.m_jointList;while(jn)
{var jn0=jn;jn=jn.next;if(this.m_listener)
{this.m_listener.NotifyJointDestroyed(jn0.joint);}
this.DestroyJoint(jn0.joint);}
b0.Destroy();}
this.m_bodyDestroyList=null;this.m_contactManager.m_destroyImmediate=false;},CreateJoint:function(def){var j=b2Joint.Create(def,this.m_blockAllocator);j.m_prev=null;j.m_next=this.m_jointList;if(this.m_jointList)
{this.m_jointList.m_prev=j;}
this.m_jointList=j;++this.m_jointCount;j.m_node1.joint=j;j.m_node1.other=j.m_body2;j.m_node1.prev=null;j.m_node1.next=j.m_body1.m_jointList;if(j.m_body1.m_jointList)j.m_body1.m_jointList.prev=j.m_node1;j.m_body1.m_jointList=j.m_node1;j.m_node2.joint=j;j.m_node2.other=j.m_body1;j.m_node2.prev=null;j.m_node2.next=j.m_body2.m_jointList;if(j.m_body2.m_jointList)j.m_body2.m_jointList.prev=j.m_node2;j.m_body2.m_jointList=j.m_node2;if(def.collideConnected==false)
{var b=def.body1.m_shapeCount<def.body2.m_shapeCount?def.body1:def.body2;for(var s=b.m_shapeList;s;s=s.m_next)
{s.ResetProxy(this.m_broadPhase);}}
return j;},DestroyJoint:function(j)
{var collideConnected=j.m_collideConnected;if(j.m_prev)
{j.m_prev.m_next=j.m_next;}
if(j.m_next)
{j.m_next.m_prev=j.m_prev;}
if(j==this.m_jointList)
{this.m_jointList=j.m_next;}
var body1=j.m_body1;var body2=j.m_body2;body1.WakeUp();body2.WakeUp();if(j.m_node1.prev)
{j.m_node1.prev.next=j.m_node1.next;}
if(j.m_node1.next)
{j.m_node1.next.prev=j.m_node1.prev;}
if(j.m_node1==body1.m_jointList)
{body1.m_jointList=j.m_node1.next;}
j.m_node1.prev=null;j.m_node1.next=null;if(j.m_node2.prev)
{j.m_node2.prev.next=j.m_node2.next;}
if(j.m_node2.next)
{j.m_node2.next.prev=j.m_node2.prev;}
if(j.m_node2==body2.m_jointList)
{body2.m_jointList=j.m_node2.next;}
j.m_node2.prev=null;j.m_node2.next=null;b2Joint.Destroy(j,this.m_blockAllocator);--this.m_jointCount;if(collideConnected==false)
{var b=body1.m_shapeCount<body2.m_shapeCount?body1:body2;for(var s=b.m_shapeList;s;s=s.m_next)
{s.ResetProxy(this.m_broadPhase);}}},GetGroundBody:function(){return this.m_groundBody;},step:new b2TimeStep(),Step:function(dt,iterations){var b;var other;this.step.dt=dt;this.step.iterations=iterations;if(dt>0.0)
{this.step.inv_dt=1.0/dt;}
else
{this.step.inv_dt=0.0;}
this.m_positionIterationCount=0;this.m_contactManager.CleanContactList();this.CleanBodyList();this.m_contactManager.Collide();var island=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator);for(b=this.m_bodyList;b!=null;b=b.m_next)
{b.m_flags&=~b2Body.e_islandFlag;}
for(var c=this.m_contactList;c!=null;c=c.m_next)
{c.m_flags&=~b2Contact.e_islandFlag;}
for(var j=this.m_jointList;j!=null;j=j.m_next)
{j.m_islandFlag=false;}
var stackSize=this.m_bodyCount;var stack=new Array(this.m_bodyCount);for(var k=0;k<this.m_bodyCount;k++)
stack[k]=null;for(var seed=this.m_bodyList;seed!=null;seed=seed.m_next)
{if(seed.m_flags&(b2Body.e_staticFlag|b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag))
{continue;}
island.Clear();var stackCount=0;stack[stackCount++]=seed;seed.m_flags|=b2Body.e_islandFlag;;while(stackCount>0)
{b=stack[--stackCount];island.AddBody(b);b.m_flags&=~b2Body.e_sleepFlag;if(b.m_flags&b2Body.e_staticFlag)
{continue;}
for(var cn=b.m_contactList;cn!=null;cn=cn.next)
{if(cn.contact.m_flags&b2Contact.e_islandFlag)
{continue;}
island.AddContact(cn.contact);cn.contact.m_flags|=b2Contact.e_islandFlag;other=cn.other;if(other.m_flags&b2Body.e_islandFlag)
{continue;}
stack[stackCount++]=other;other.m_flags|=b2Body.e_islandFlag;}
for(var jn=b.m_jointList;jn!=null;jn=jn.next)
{if(jn.joint.m_islandFlag==true)
{continue;}
island.AddJoint(jn.joint);jn.joint.m_islandFlag=true;other=jn.other;if(other.m_flags&b2Body.e_islandFlag)
{continue;}
stack[stackCount++]=other;other.m_flags|=b2Body.e_islandFlag;}}
island.Solve(this.step,this.m_gravity);this.m_positionIterationCount=b2Math.b2Max(this.m_positionIterationCount,b2Island.m_positionIterationCount);if(this.m_allowSleep)
{island.UpdateSleep(dt);}
for(var i=0;i<island.m_bodyCount;++i)
{b=island.m_bodies[i];if(b.m_flags&b2Body.e_staticFlag)
{b.m_flags&=~b2Body.e_islandFlag;}
if(b.IsFrozen()&&this.m_listener)
{var response=this.m_listener.NotifyBoundaryViolated(b);if(response==b2WorldListener.b2_destroyBody)
{this.DestroyBody(b);b=null;island.m_bodies[i]=null;}}}}
this.m_broadPhase.Commit();},Query:function(aabb,shapes,maxCount){var results=new Array();var count=this.m_broadPhase.QueryAABB(aabb,results,maxCount);for(var i=0;i<count;++i)
{shapes[i]=results[i];}
return count;},GetBodyList:function(){return this.m_bodyList;},GetJointList:function(){return this.m_jointList;},GetContactList:function(){return this.m_contactList;},m_blockAllocator:null,m_stackAllocator:null,m_broadPhase:null,m_contactManager:new b2ContactManager(),m_bodyList:null,m_contactList:null,m_jointList:null,m_bodyCount:0,m_contactCount:0,m_jointCount:0,m_bodyDestroyList:null,m_gravity:null,m_allowSleep:null,m_groundBody:null,m_listener:null,m_filter:null,m_positionIterationCount:0};b2World.s_enablePositionCorrection=1;b2World.s_enableWarmStarting=1;var b2WorldListener=Class.create();b2WorldListener.prototype={NotifyJointDestroyed:function(joint){},NotifyBoundaryViolated:function(body)
{return b2WorldListener.b2_freezeBody;},initialize:function(){}};b2WorldListener.b2_freezeBody=0;b2WorldListener.b2_destroyBody=1;var b2JointNode=Class.create();b2JointNode.prototype={other:null,joint:null,prev:null,next:null,initialize:function(){}}
var b2Joint=Class.create();b2Joint.prototype={GetType:function(){return this.m_type;},GetAnchor1:function(){return null},GetAnchor2:function(){return null},GetReactionForce:function(invTimeStep){return null},GetReactionTorque:function(invTimeStep){return 0.0},GetBody1:function()
{return this.m_body1;},GetBody2:function()
{return this.m_body2;},GetNext:function(){return this.m_next;},GetUserData:function(){return this.m_userData;},initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;},PrepareVelocitySolver:function(){},SolveVelocityConstraints:function(step){},PreparePositionSolver:function(){},SolvePositionConstraints:function(){return false},m_type:0,m_prev:null,m_next:null,m_node1:new b2JointNode(),m_node2:new b2JointNode(),m_body1:null,m_body2:null,m_islandFlag:null,m_collideConnected:null,m_userData:null};b2Joint.Create=function(def,allocator){var joint=null;switch(def.type)
{case b2Joint.e_distanceJoint:{joint=new b2DistanceJoint(def);}
break;case b2Joint.e_mouseJoint:{joint=new b2MouseJoint(def);}
break;case b2Joint.e_prismaticJoint:{joint=new b2PrismaticJoint(def);}
break;case b2Joint.e_revoluteJoint:{joint=new b2RevoluteJoint(def);}
break;case b2Joint.e_pulleyJoint:{joint=new b2PulleyJoint(def);}
break;case b2Joint.e_gearJoint:{joint=new b2GearJoint(def);}
break;default:break;}
return joint;};b2Joint.Destroy=function(joint,allocator){};b2Joint.e_unknownJoint=0;b2Joint.e_revoluteJoint=1;b2Joint.e_prismaticJoint=2;b2Joint.e_distanceJoint=3;b2Joint.e_pulleyJoint=4;b2Joint.e_mouseJoint=5;b2Joint.e_gearJoint=6;b2Joint.e_inactiveLimit=0;b2Joint.e_atLowerLimit=1;b2Joint.e_atUpperLimit=2;b2Joint.e_equalLimits=3;var b2JointDef=Class.create();b2JointDef.prototype={initialize:function()
{this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;},type:0,userData:null,body1:null,body2:null,collideConnected:null}
var b2DistanceJoint=Class.create();Object.extend(b2DistanceJoint.prototype,b2Joint.prototype);Object.extend(b2DistanceJoint.prototype,{initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.m_localAnchor1=new b2Vec2();this.m_localAnchor2=new b2Vec2();this.m_u=new b2Vec2();var tMat;var tX;var tY;tMat=this.m_body1.m_R;tX=def.anchorPoint1.x-this.m_body1.m_position.x;tY=def.anchorPoint1.y-this.m_body1.m_position.y;this.m_localAnchor1.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor1.y=tX*tMat.col2.x+tY*tMat.col2.y;tMat=this.m_body2.m_R;tX=def.anchorPoint2.x-this.m_body2.m_position.x;tY=def.anchorPoint2.y-this.m_body2.m_position.y;this.m_localAnchor2.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor2.y=tX*tMat.col2.x+tY*tMat.col2.y;tX=def.anchorPoint2.x-def.anchorPoint1.x;tY=def.anchorPoint2.y-def.anchorPoint1.y;this.m_length=Math.sqrt(tX*tX+tY*tY);this.m_impulse=0.0;},PrepareVelocitySolver:function(){var tMat;tMat=this.m_body1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=this.m_body2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;this.m_u.x=this.m_body2.m_position.x+r2X-this.m_body1.m_position.x-r1X;this.m_u.y=this.m_body2.m_position.y+r2Y-this.m_body1.m_position.y-r1Y;var length=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);if(length>b2Settings.b2_linearSlop)
{this.m_u.Multiply(1.0/length);}
else
{this.m_u.SetZero();}
var cr1u=(r1X*this.m_u.y-r1Y*this.m_u.x);var cr2u=(r2X*this.m_u.y-r2Y*this.m_u.x);this.m_mass=this.m_body1.m_invMass+this.m_body1.m_invI*cr1u*cr1u+this.m_body2.m_invMass+this.m_body2.m_invI*cr2u*cr2u;this.m_mass=1.0/this.m_mass;if(b2World.s_enableWarmStarting)
{var PX=this.m_impulse*this.m_u.x;var PY=this.m_impulse*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*PX;this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*PY;this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(r1X*PY-r1Y*PX);this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*PX;this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*PY;this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(r2X*PY-r2Y*PX);}
else
{this.m_impulse=0.0;}},SolveVelocityConstraints:function(step){var tMat;tMat=this.m_body1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=this.m_body2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var v1X=this.m_body1.m_linearVelocity.x+(-this.m_body1.m_angularVelocity*r1Y);var v1Y=this.m_body1.m_linearVelocity.y+(this.m_body1.m_angularVelocity*r1X);var v2X=this.m_body2.m_linearVelocity.x+(-this.m_body2.m_angularVelocity*r2Y);var v2Y=this.m_body2.m_linearVelocity.y+(this.m_body2.m_angularVelocity*r2X);var Cdot=(this.m_u.x*(v2X-v1X)+this.m_u.y*(v2Y-v1Y));var impulse=-this.m_mass*Cdot;this.m_impulse+=impulse;var PX=impulse*this.m_u.x;var PY=impulse*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*PX;this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*PY;this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(r1X*PY-r1Y*PX);this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*PX;this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*PY;this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(r2X*PY-r2Y*PX);},SolvePositionConstraints:function(){var tMat;tMat=this.m_body1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=this.m_body2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var dX=this.m_body2.m_position.x+r2X-this.m_body1.m_position.x-r1X;var dY=this.m_body2.m_position.y+r2Y-this.m_body1.m_position.y-r1Y;var length=Math.sqrt(dX*dX+dY*dY);dX/=length;dY/=length;var C=length-this.m_length;C=b2Math.b2Clamp(C,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var impulse=-this.m_mass*C;this.m_u.Set(dX,dY);var PX=impulse*this.m_u.x;var PY=impulse*this.m_u.y;this.m_body1.m_position.x-=this.m_body1.m_invMass*PX;this.m_body1.m_position.y-=this.m_body1.m_invMass*PY;this.m_body1.m_rotation-=this.m_body1.m_invI*(r1X*PY-r1Y*PX);this.m_body2.m_position.x+=this.m_body2.m_invMass*PX;this.m_body2.m_position.y+=this.m_body2.m_invMass*PY;this.m_body2.m_rotation+=this.m_body2.m_invI*(r2X*PY-r2Y*PX);this.m_body1.m_R.Set(this.m_body1.m_rotation);this.m_body2.m_R.Set(this.m_body2.m_rotation);return b2Math.b2Abs(C)<b2Settings.b2_linearSlop;},GetAnchor1:function(){return b2Math.AddVV(this.m_body1.m_position,b2Math.b2MulMV(this.m_body1.m_R,this.m_localAnchor1));},GetAnchor2:function(){return b2Math.AddVV(this.m_body2.m_position,b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor2));},GetReactionForce:function(invTimeStep)
{var F=new b2Vec2();F.SetV(this.m_u);F.Multiply(this.m_impulse*invTimeStep);return F;},GetReactionTorque:function(invTimeStep)
{return 0.0;},m_localAnchor1:new b2Vec2(),m_localAnchor2:new b2Vec2(),m_u:new b2Vec2(),m_impulse:null,m_mass:null,m_length:null});var b2DistanceJointDef=Class.create();Object.extend(b2DistanceJointDef.prototype,b2JointDef.prototype);Object.extend(b2DistanceJointDef.prototype,{initialize:function()
{this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.anchorPoint1=new b2Vec2();this.anchorPoint2=new b2Vec2();this.type=b2Joint.e_distanceJoint;},anchorPoint1:new b2Vec2(),anchorPoint2:new b2Vec2()});var b2Jacobian=Class.create();b2Jacobian.prototype={linear1:new b2Vec2(),angular1:null,linear2:new b2Vec2(),angular2:null,SetZero:function(){this.linear1.SetZero();this.angular1=0.0;this.linear2.SetZero();this.angular2=0.0;},Set:function(x1,a1,x2,a2){this.linear1.SetV(x1);this.angular1=a1;this.linear2.SetV(x2);this.angular2=a2;},Compute:function(x1,a1,x2,a2){return(this.linear1.x*x1.x+this.linear1.y*x1.y)+this.angular1*a1+(this.linear2.x*x2.x+this.linear2.y*x2.y)+this.angular2*a2;},initialize:function(){this.linear1=new b2Vec2();this.linear2=new b2Vec2();}};var b2GearJoint=Class.create();Object.extend(b2GearJoint.prototype,b2Joint.prototype);Object.extend(b2GearJoint.prototype,{GetAnchor1:function(){var tMat=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y));},GetAnchor2:function(){var tMat=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y));},GetReactionForce:function(invTimeStep){return new b2Vec2();},GetReactionTorque:function(invTimeStep){return 0.0;},GetRatio:function(){return this.m_ratio;},initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.m_groundAnchor1=new b2Vec2();this.m_groundAnchor2=new b2Vec2();this.m_localAnchor1=new b2Vec2();this.m_localAnchor2=new b2Vec2();this.m_J=new b2Jacobian();this.m_revolute1=null;this.m_prismatic1=null;this.m_revolute2=null;this.m_prismatic2=null;var coordinate1;var coordinate2;this.m_ground1=def.joint1.m_body1;this.m_body1=def.joint1.m_body2;if(def.joint1.m_type==b2Joint.e_revoluteJoint)
{this.m_revolute1=def.joint1;this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2);coordinate1=this.m_revolute1.GetJointAngle();}
else
{this.m_prismatic1=def.joint1;this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1);this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2);coordinate1=this.m_prismatic1.GetJointTranslation();}
this.m_ground2=def.joint2.m_body1;this.m_body2=def.joint2.m_body2;if(def.joint2.m_type==b2Joint.e_revoluteJoint)
{this.m_revolute2=def.joint2;this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2);coordinate2=this.m_revolute2.GetJointAngle();}
else
{this.m_prismatic2=def.joint2;this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1);this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2);coordinate2=this.m_prismatic2.GetJointTranslation();}
this.m_ratio=def.ratio;this.m_constant=coordinate1+this.m_ratio*coordinate2;this.m_impulse=0.0;},PrepareVelocitySolver:function(){var g1=this.m_ground1;var g2=this.m_ground2;var b1=this.m_body1;var b2=this.m_body2;var ugX;var ugY;var rX;var rY;var tMat;var tVec;var crug;var K=0.0;this.m_J.SetZero();if(this.m_revolute1)
{this.m_J.angular1=-1.0;K+=b1.m_invI;}
else
{tMat=g1.m_R;tVec=this.m_prismatic1.m_localXAxis1;ugX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;ugY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=b1.m_R;rX=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;rY=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;crug=rX*ugY-rY*ugX;this.m_J.linear1.Set(-ugX,-ugY);this.m_J.angular1=-crug;K+=b1.m_invMass+b1.m_invI*crug*crug;}
if(this.m_revolute2)
{this.m_J.angular2=-this.m_ratio;K+=this.m_ratio*this.m_ratio*b2.m_invI;}
else
{tMat=g2.m_R;tVec=this.m_prismatic2.m_localXAxis1;ugX=tMat.col1.x*tVec.x+tMat.col2.x*tVec.y;ugY=tMat.col1.y*tVec.x+tMat.col2.y*tVec.y;tMat=b2.m_R;rX=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;rY=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;crug=rX*ugY-rY*ugX;this.m_J.linear2.Set(-this.m_ratio*ugX,-this.m_ratio*ugY);this.m_J.angular2=-this.m_ratio*crug;K+=this.m_ratio*this.m_ratio*(b2.m_invMass+b2.m_invI*crug*crug);}
this.m_mass=1.0/K;b1.m_linearVelocity.x+=b1.m_invMass*this.m_impulse*this.m_J.linear1.x;b1.m_linearVelocity.y+=b1.m_invMass*this.m_impulse*this.m_J.linear1.y;b1.m_angularVelocity+=b1.m_invI*this.m_impulse*this.m_J.angular1;b2.m_linearVelocity.x+=b2.m_invMass*this.m_impulse*this.m_J.linear2.x;b2.m_linearVelocity.y+=b2.m_invMass*this.m_impulse*this.m_J.linear2.y;b2.m_angularVelocity+=b2.m_invI*this.m_impulse*this.m_J.angular2;},SolveVelocityConstraints:function(step){var b1=this.m_body1;var b2=this.m_body2;var Cdot=this.m_J.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity);var impulse=-this.m_mass*Cdot;this.m_impulse+=impulse;b1.m_linearVelocity.x+=b1.m_invMass*impulse*this.m_J.linear1.x;b1.m_linearVelocity.y+=b1.m_invMass*impulse*this.m_J.linear1.y;b1.m_angularVelocity+=b1.m_invI*impulse*this.m_J.angular1;b2.m_linearVelocity.x+=b2.m_invMass*impulse*this.m_J.linear2.x;b2.m_linearVelocity.y+=b2.m_invMass*impulse*this.m_J.linear2.y;b2.m_angularVelocity+=b2.m_invI*impulse*this.m_J.angular2;},SolvePositionConstraints:function(){var linearError=0.0;var b1=this.m_body1;var b2=this.m_body2;var coordinate1;var coordinate2;if(this.m_revolute1)
{coordinate1=this.m_revolute1.GetJointAngle();}
else
{coordinate1=this.m_prismatic1.GetJointTranslation();}
if(this.m_revolute2)
{coordinate2=this.m_revolute2.GetJointAngle();}
else
{coordinate2=this.m_prismatic2.GetJointTranslation();}
var C=this.m_constant-(coordinate1+this.m_ratio*coordinate2);var impulse=-this.m_mass*C;b1.m_position.x+=b1.m_invMass*impulse*this.m_J.linear1.x;b1.m_position.y+=b1.m_invMass*impulse*this.m_J.linear1.y;b1.m_rotation+=b1.m_invI*impulse*this.m_J.angular1;b2.m_position.x+=b2.m_invMass*impulse*this.m_J.linear2.x;b2.m_position.y+=b2.m_invMass*impulse*this.m_J.linear2.y;b2.m_rotation+=b2.m_invI*impulse*this.m_J.angular2;b1.m_R.Set(b1.m_rotation);b2.m_R.Set(b2.m_rotation);return linearError<b2Settings.b2_linearSlop;},m_ground1:null,m_ground2:null,m_revolute1:null,m_prismatic1:null,m_revolute2:null,m_prismatic2:null,m_groundAnchor1:new b2Vec2(),m_groundAnchor2:new b2Vec2(),m_localAnchor1:new b2Vec2(),m_localAnchor2:new b2Vec2(),m_J:new b2Jacobian(),m_constant:null,m_ratio:null,m_mass:null,m_impulse:null});var b2GearJointDef=Class.create();Object.extend(b2GearJointDef.prototype,b2JointDef.prototype);Object.extend(b2GearJointDef.prototype,{initialize:function()
{this.type=b2Joint.e_gearJoint;this.joint1=null;this.joint2=null;this.ratio=1.0;},joint1:null,joint2:null,ratio:null});var b2MouseJoint=Class.create();Object.extend(b2MouseJoint.prototype,b2Joint.prototype);Object.extend(b2MouseJoint.prototype,{GetAnchor1:function(){return this.m_target;},GetAnchor2:function(){var tVec=b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor);tVec.Add(this.m_body2.m_position);return tVec;},GetReactionForce:function(invTimeStep)
{var F=new b2Vec2();F.SetV(this.m_impulse);F.Multiply(invTimeStep);return F;},GetReactionTorque:function(invTimeStep)
{return 0.0;},SetTarget:function(target){this.m_body2.WakeUp();this.m_target=target;},initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.K=new b2Mat22();this.K1=new b2Mat22();this.K2=new b2Mat22();this.m_localAnchor=new b2Vec2();this.m_target=new b2Vec2();this.m_impulse=new b2Vec2();this.m_ptpMass=new b2Mat22();this.m_C=new b2Vec2();this.m_target.SetV(def.target);var tX=this.m_target.x-this.m_body2.m_position.x;var tY=this.m_target.y-this.m_body2.m_position.y;this.m_localAnchor.x=(tX*this.m_body2.m_R.col1.x+tY*this.m_body2.m_R.col1.y);this.m_localAnchor.y=(tX*this.m_body2.m_R.col2.x+tY*this.m_body2.m_R.col2.y);this.m_maxForce=def.maxForce;this.m_impulse.SetZero();var mass=this.m_body2.m_mass;var omega=2.0*b2Settings.b2_pi*def.frequencyHz;var d=2.0*mass*def.dampingRatio*omega;var k=mass*omega*omega;this.m_gamma=1.0/(d+def.timeStep*k);this.m_beta=def.timeStep*k/(d+def.timeStep*k);},K:new b2Mat22(),K1:new b2Mat22(),K2:new b2Mat22(),PrepareVelocitySolver:function(){var b=this.m_body2;var tMat;tMat=b.m_R;var rX=tMat.col1.x*this.m_localAnchor.x+tMat.col2.x*this.m_localAnchor.y;var rY=tMat.col1.y*this.m_localAnchor.x+tMat.col2.y*this.m_localAnchor.y;var invMass=b.m_invMass;var invI=b.m_invI;this.K1.col1.x=invMass;this.K1.col2.x=0.0;this.K1.col1.y=0.0;this.K1.col2.y=invMass;this.K2.col1.x=invI*rY*rY;this.K2.col2.x=-invI*rX*rY;this.K2.col1.y=-invI*rX*rY;this.K2.col2.y=invI*rX*rX;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.Invert(this.m_ptpMass);this.m_C.x=b.m_position.x+rX-this.m_target.x;this.m_C.y=b.m_position.y+rY-this.m_target.y;b.m_angularVelocity*=0.98;var PX=this.m_impulse.x;var PY=this.m_impulse.y;b.m_linearVelocity.x+=invMass*PX;b.m_linearVelocity.y+=invMass*PY;b.m_angularVelocity+=invI*(rX*PY-rY*PX);},SolveVelocityConstraints:function(step){var body=this.m_body2;var tMat;tMat=body.m_R;var rX=tMat.col1.x*this.m_localAnchor.x+tMat.col2.x*this.m_localAnchor.y;var rY=tMat.col1.y*this.m_localAnchor.x+tMat.col2.y*this.m_localAnchor.y;var CdotX=body.m_linearVelocity.x+(-body.m_angularVelocity*rY);var CdotY=body.m_linearVelocity.y+(body.m_angularVelocity*rX);tMat=this.m_ptpMass;var tX=CdotX+(this.m_beta*step.inv_dt)*this.m_C.x+this.m_gamma*this.m_impulse.x;var tY=CdotY+(this.m_beta*step.inv_dt)*this.m_C.y+this.m_gamma*this.m_impulse.y;var impulseX=-(tMat.col1.x*tX+tMat.col2.x*tY);var impulseY=-(tMat.col1.y*tX+tMat.col2.y*tY);var oldImpulseX=this.m_impulse.x;var oldImpulseY=this.m_impulse.y;this.m_impulse.x+=impulseX;this.m_impulse.y+=impulseY;var length=this.m_impulse.Length();if(length>step.dt*this.m_maxForce)
{this.m_impulse.Multiply(step.dt*this.m_maxForce/length);}
impulseX=this.m_impulse.x-oldImpulseX;impulseY=this.m_impulse.y-oldImpulseY;body.m_linearVelocity.x+=body.m_invMass*impulseX;body.m_linearVelocity.y+=body.m_invMass*impulseY;body.m_angularVelocity+=body.m_invI*(rX*impulseY-rY*impulseX);},SolvePositionConstraints:function(){return true;},m_localAnchor:new b2Vec2(),m_target:new b2Vec2(),m_impulse:new b2Vec2(),m_ptpMass:new b2Mat22(),m_C:new b2Vec2(),m_maxForce:null,m_beta:null,m_gamma:null});var b2MouseJointDef=Class.create();Object.extend(b2MouseJointDef.prototype,b2JointDef.prototype);Object.extend(b2MouseJointDef.prototype,{initialize:function()
{this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.target=new b2Vec2();this.type=b2Joint.e_mouseJoint;this.maxForce=0.0;this.frequencyHz=5.0;this.dampingRatio=0.7;this.timeStep=1.0/60.0;},target:new b2Vec2(),maxForce:null,frequencyHz:null,dampingRatio:null,timeStep:null});var b2PrismaticJoint=Class.create();Object.extend(b2PrismaticJoint.prototype,b2Joint.prototype);Object.extend(b2PrismaticJoint.prototype,{GetAnchor1:function(){var b1=this.m_body1;var tVec=new b2Vec2();tVec.SetV(this.m_localAnchor1);tVec.MulM(b1.m_R);tVec.Add(b1.m_position);return tVec;},GetAnchor2:function(){var b2=this.m_body2;var tVec=new b2Vec2();tVec.SetV(this.m_localAnchor2);tVec.MulM(b2.m_R);tVec.Add(b2.m_position);return tVec;},GetJointTranslation:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var dX=p2X-p1X;var dY=p2Y-p1Y;tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;var translation=ax1X*dX+ax1Y*dY;return translation;},GetJointSpeed:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var dX=p2X-p1X;var dY=p2Y-p1Y;tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;var v1=b1.m_linearVelocity;var v2=b2.m_linearVelocity;var w1=b1.m_angularVelocity;var w2=b2.m_angularVelocity;var speed=(dX*(-w1*ax1Y)+dY*(w1*ax1X))+(ax1X*(((v2.x+(-w2*r2Y))-v1.x)-(-w1*r1Y))+ax1Y*(((v2.y+(w2*r2X))-v1.y)-(w1*r1X)));return speed;},GetMotorForce:function(invTimeStep){return invTimeStep*this.m_motorImpulse;},SetMotorSpeed:function(speed)
{this.m_motorSpeed=speed;},SetMotorForce:function(force)
{this.m_maxMotorForce=force;},GetReactionForce:function(invTimeStep)
{var tImp=invTimeStep*this.m_limitImpulse;var tMat;tMat=this.m_body1.m_R;var ax1X=tImp*(tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y);var ax1Y=tImp*(tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y);var ay1X=tImp*(tMat.col1.x*this.m_localYAxis1.x+tMat.col2.x*this.m_localYAxis1.y);var ay1Y=tImp*(tMat.col1.y*this.m_localYAxis1.x+tMat.col2.y*this.m_localYAxis1.y);return new b2Vec2(ax1X+ay1X,ax1Y+ay1Y);},GetReactionTorque:function(invTimeStep)
{return invTimeStep*this.m_angularImpulse;},initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.m_localAnchor1=new b2Vec2();this.m_localAnchor2=new b2Vec2();this.m_localXAxis1=new b2Vec2();this.m_localYAxis1=new b2Vec2();this.m_linearJacobian=new b2Jacobian();this.m_motorJacobian=new b2Jacobian();var tMat;var tX;var tY;tMat=this.m_body1.m_R;tX=(def.anchorPoint.x-this.m_body1.m_position.x);tY=(def.anchorPoint.y-this.m_body1.m_position.y);this.m_localAnchor1.Set((tX*tMat.col1.x+tY*tMat.col1.y),(tX*tMat.col2.x+tY*tMat.col2.y));tMat=this.m_body2.m_R;tX=(def.anchorPoint.x-this.m_body2.m_position.x);tY=(def.anchorPoint.y-this.m_body2.m_position.y);this.m_localAnchor2.Set((tX*tMat.col1.x+tY*tMat.col1.y),(tX*tMat.col2.x+tY*tMat.col2.y));tMat=this.m_body1.m_R;tX=def.axis.x;tY=def.axis.y;this.m_localXAxis1.Set((tX*tMat.col1.x+tY*tMat.col1.y),(tX*tMat.col2.x+tY*tMat.col2.y));this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_initialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation;this.m_linearJacobian.SetZero();this.m_linearMass=0.0;this.m_linearImpulse=0.0;this.m_angularMass=0.0;this.m_angularImpulse=0.0;this.m_motorJacobian.SetZero();this.m_motorMass=0.0;this.m_motorImpulse=0.0;this.m_limitImpulse=0.0;this.m_limitPositionImpulse=0.0;this.m_lowerTranslation=def.lowerTranslation;this.m_upperTranslation=def.upperTranslation;this.m_maxMotorForce=def.motorForce;this.m_motorSpeed=def.motorSpeed;this.m_enableLimit=def.enableLimit;this.m_enableMotor=def.enableMotor;},PrepareVelocitySolver:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;tMat=b1.m_R;var ay1X=tMat.col1.x*this.m_localYAxis1.x+tMat.col2.x*this.m_localYAxis1.y;var ay1Y=tMat.col1.y*this.m_localYAxis1.x+tMat.col2.y*this.m_localYAxis1.y;var eX=b2.m_position.x+r2X-b1.m_position.x;var eY=b2.m_position.y+r2Y-b1.m_position.y;this.m_linearJacobian.linear1.x=-ay1X;this.m_linearJacobian.linear1.y=-ay1Y;this.m_linearJacobian.linear2.x=ay1X;this.m_linearJacobian.linear2.y=ay1Y;this.m_linearJacobian.angular1=-(eX*ay1Y-eY*ay1X);this.m_linearJacobian.angular2=r2X*ay1Y-r2Y*ay1X;this.m_linearMass=invMass1+invI1*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+
invMass2+invI2*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2;this.m_linearMass=1.0/this.m_linearMass;this.m_angularMass=1.0/(invI1+invI2);if(this.m_enableLimit||this.m_enableMotor)
{tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;this.m_motorJacobian.linear1.x=-ax1X;this.m_motorJacobian.linear1.y=-ax1Y;this.m_motorJacobian.linear2.x=ax1X;this.m_motorJacobian.linear2.y=ax1Y;this.m_motorJacobian.angular1=-(eX*ax1Y-eY*ax1X);this.m_motorJacobian.angular2=r2X*ax1Y-r2Y*ax1X;this.m_motorMass=invMass1+invI1*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+
invMass2+invI2*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2;this.m_motorMass=1.0/this.m_motorMass;if(this.m_enableLimit)
{var dX=eX-r1X;var dY=eY-r1Y;var jointTranslation=ax1X*dX+ax1Y*dY;if(b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2.0*b2Settings.b2_linearSlop)
{this.m_limitState=b2Joint.e_equalLimits;}
else if(jointTranslation<=this.m_lowerTranslation)
{if(this.m_limitState!=b2Joint.e_atLowerLimit)
{this.m_limitImpulse=0.0;}
this.m_limitState=b2Joint.e_atLowerLimit;}
else if(jointTranslation>=this.m_upperTranslation)
{if(this.m_limitState!=b2Joint.e_atUpperLimit)
{this.m_limitImpulse=0.0;}
this.m_limitState=b2Joint.e_atUpperLimit;}
else
{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitImpulse=0.0;}}}
if(this.m_enableMotor==false)
{this.m_motorImpulse=0.0;}
if(this.m_enableLimit==false)
{this.m_limitImpulse=0.0;}
if(b2World.s_enableWarmStarting)
{var P1X=this.m_linearImpulse*this.m_linearJacobian.linear1.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.x;var P1Y=this.m_linearImpulse*this.m_linearJacobian.linear1.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.y;var P2X=this.m_linearImpulse*this.m_linearJacobian.linear2.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.x;var P2Y=this.m_linearImpulse*this.m_linearJacobian.linear2.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.y;var L1=this.m_linearImpulse*this.m_linearJacobian.angular1-this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular1;var L2=this.m_linearImpulse*this.m_linearJacobian.angular2+this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular2;b1.m_linearVelocity.x+=invMass1*P1X;b1.m_linearVelocity.y+=invMass1*P1Y;b1.m_angularVelocity+=invI1*L1;b2.m_linearVelocity.x+=invMass2*P2X;b2.m_linearVelocity.y+=invMass2*P2Y;b2.m_angularVelocity+=invI2*L2;}
else
{this.m_linearImpulse=0.0;this.m_angularImpulse=0.0;this.m_limitImpulse=0.0;this.m_motorImpulse=0.0;}
this.m_limitPositionImpulse=0.0;},SolveVelocityConstraints:function(step){var b1=this.m_body1;var b2=this.m_body2;var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;var oldLimitImpulse;var linearCdot=this.m_linearJacobian.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity);var linearImpulse=-this.m_linearMass*linearCdot;this.m_linearImpulse+=linearImpulse;b1.m_linearVelocity.x+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.x;b1.m_linearVelocity.y+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.y;b1.m_angularVelocity+=invI1*linearImpulse*this.m_linearJacobian.angular1;b2.m_linearVelocity.x+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.x;b2.m_linearVelocity.y+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.y;b2.m_angularVelocity+=invI2*linearImpulse*this.m_linearJacobian.angular2;var angularCdot=b2.m_angularVelocity-b1.m_angularVelocity;var angularImpulse=-this.m_angularMass*angularCdot;this.m_angularImpulse+=angularImpulse;b1.m_angularVelocity-=invI1*angularImpulse;b2.m_angularVelocity+=invI2*angularImpulse;if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits)
{var motorCdot=this.m_motorJacobian.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity)-this.m_motorSpeed;var motorImpulse=-this.m_motorMass*motorCdot;var oldMotorImpulse=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+motorImpulse,-step.dt*this.m_maxMotorForce,step.dt*this.m_maxMotorForce);motorImpulse=this.m_motorImpulse-oldMotorImpulse;b1.m_linearVelocity.x+=(invMass1*motorImpulse)*this.m_motorJacobian.linear1.x;b1.m_linearVelocity.y+=(invMass1*motorImpulse)*this.m_motorJacobian.linear1.y;b1.m_angularVelocity+=invI1*motorImpulse*this.m_motorJacobian.angular1;b2.m_linearVelocity.x+=(invMass2*motorImpulse)*this.m_motorJacobian.linear2.x;b2.m_linearVelocity.y+=(invMass2*motorImpulse)*this.m_motorJacobian.linear2.y;b2.m_angularVelocity+=invI2*motorImpulse*this.m_motorJacobian.angular2;}
if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{var limitCdot=this.m_motorJacobian.Compute(b1.m_linearVelocity,b1.m_angularVelocity,b2.m_linearVelocity,b2.m_angularVelocity);var limitImpulse=-this.m_motorMass*limitCdot;if(this.m_limitState==b2Joint.e_equalLimits)
{this.m_limitImpulse+=limitImpulse;}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
b1.m_linearVelocity.x+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.x;b1.m_linearVelocity.y+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.y;b1.m_angularVelocity+=invI1*limitImpulse*this.m_motorJacobian.angular1;b2.m_linearVelocity.x+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.x;b2.m_linearVelocity.y+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.y;b2.m_angularVelocity+=invI2*limitImpulse*this.m_motorJacobian.angular2;}},SolvePositionConstraints:function(){var limitC;var oldLimitImpulse;var b1=this.m_body1;var b2=this.m_body2;var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var dX=p2X-p1X;var dY=p2Y-p1Y;tMat=b1.m_R;var ay1X=tMat.col1.x*this.m_localYAxis1.x+tMat.col2.x*this.m_localYAxis1.y;var ay1Y=tMat.col1.y*this.m_localYAxis1.x+tMat.col2.y*this.m_localYAxis1.y;var linearC=ay1X*dX+ay1Y*dY;linearC=b2Math.b2Clamp(linearC,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var linearImpulse=-this.m_linearMass*linearC;b1.m_position.x+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.x;b1.m_position.y+=(invMass1*linearImpulse)*this.m_linearJacobian.linear1.y;b1.m_rotation+=invI1*linearImpulse*this.m_linearJacobian.angular1;b2.m_position.x+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.x;b2.m_position.y+=(invMass2*linearImpulse)*this.m_linearJacobian.linear2.y;b2.m_rotation+=invI2*linearImpulse*this.m_linearJacobian.angular2;var positionError=b2Math.b2Abs(linearC);var angularC=b2.m_rotation-b1.m_rotation-this.m_initialAngle;angularC=b2Math.b2Clamp(angularC,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var angularImpulse=-this.m_angularMass*angularC;b1.m_rotation-=b1.m_invI*angularImpulse;b1.m_R.Set(b1.m_rotation);b2.m_rotation+=b2.m_invI*angularImpulse;b2.m_R.Set(b2.m_rotation);var angularError=b2Math.b2Abs(angularC);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{tMat=b1.m_R;r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;p1X=b1.m_position.x+r1X;p1Y=b1.m_position.y+r1Y;p2X=b2.m_position.x+r2X;p2Y=b2.m_position.y+r2Y;dX=p2X-p1X;dY=p2Y-p1Y;tMat=b1.m_R;var ax1X=tMat.col1.x*this.m_localXAxis1.x+tMat.col2.x*this.m_localXAxis1.y;var ax1Y=tMat.col1.y*this.m_localXAxis1.x+tMat.col2.y*this.m_localXAxis1.y;var translation=(ax1X*dX+ax1Y*dY);var limitImpulse=0.0;if(this.m_limitState==b2Joint.e_equalLimits)
{limitC=b2Math.b2Clamp(translation,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);limitImpulse=-this.m_motorMass*limitC;positionError=b2Math.b2Max(positionError,b2Math.b2Abs(angularC));}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{limitC=translation-this.m_lowerTranslation;positionError=b2Math.b2Max(positionError,-limitC);limitC=b2Math.b2Clamp(limitC+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0.0);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{limitC=translation-this.m_upperTranslation;positionError=b2Math.b2Max(positionError,limitC);limitC=b2Math.b2Clamp(limitC-b2Settings.b2_linearSlop,0.0,b2Settings.b2_maxLinearCorrection);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
b1.m_position.x+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.x;b1.m_position.y+=(invMass1*limitImpulse)*this.m_motorJacobian.linear1.y;b1.m_rotation+=invI1*limitImpulse*this.m_motorJacobian.angular1;b1.m_R.Set(b1.m_rotation);b2.m_position.x+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.x;b2.m_position.y+=(invMass2*limitImpulse)*this.m_motorJacobian.linear2.y;b2.m_rotation+=invI2*limitImpulse*this.m_motorJacobian.angular2;b2.m_R.Set(b2.m_rotation);}
return positionError<=b2Settings.b2_linearSlop&&angularError<=b2Settings.b2_angularSlop;},m_localAnchor1:new b2Vec2(),m_localAnchor2:new b2Vec2(),m_localXAxis1:new b2Vec2(),m_localYAxis1:new b2Vec2(),m_initialAngle:null,m_linearJacobian:new b2Jacobian(),m_linearMass:null,m_linearImpulse:null,m_angularMass:null,m_angularImpulse:null,m_motorJacobian:new b2Jacobian(),m_motorMass:null,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_lowerTranslation:null,m_upperTranslation:null,m_maxMotorForce:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0});var b2PrismaticJointDef=Class.create();Object.extend(b2PrismaticJointDef.prototype,b2JointDef.prototype);Object.extend(b2PrismaticJointDef.prototype,{initialize:function()
{this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.type=b2Joint.e_prismaticJoint;this.anchorPoint=new b2Vec2(0.0,0.0);this.axis=new b2Vec2(0.0,0.0);this.lowerTranslation=0.0;this.upperTranslation=0.0;this.motorForce=0.0;this.motorSpeed=0.0;this.enableLimit=false;this.enableMotor=false;},anchorPoint:null,axis:null,lowerTranslation:null,upperTranslation:null,motorForce:null,motorSpeed:null,enableLimit:null,enableMotor:null});var b2PulleyJoint=Class.create();Object.extend(b2PulleyJoint.prototype,b2Joint.prototype);Object.extend(b2PulleyJoint.prototype,{GetAnchor1:function(){var tMat=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y));},GetAnchor2:function(){var tMat=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y));},GetGroundPoint1:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor1.x,this.m_ground.m_position.y+this.m_groundAnchor1.y);},GetGroundPoint2:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor2.x,this.m_ground.m_position.y+this.m_groundAnchor2.y);},GetReactionForce:function(invTimeStep){return new b2Vec2();},GetReactionTorque:function(invTimeStep){return 0.0;},GetLength1:function(){var tMat;tMat=this.m_body1.m_R;var pX=this.m_body1.m_position.x+(tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y);var pY=this.m_body1.m_position.y+(tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y);var dX=pX-(this.m_ground.m_position.x+this.m_groundAnchor1.x);var dY=pY-(this.m_ground.m_position.y+this.m_groundAnchor1.y);return Math.sqrt(dX*dX+dY*dY);},GetLength2:function(){var tMat;tMat=this.m_body2.m_R;var pX=this.m_body2.m_position.x+(tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y);var pY=this.m_body2.m_position.y+(tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y);var dX=pX-(this.m_ground.m_position.x+this.m_groundAnchor2.x);var dY=pY-(this.m_ground.m_position.y+this.m_groundAnchor2.y);return Math.sqrt(dX*dX+dY*dY);},GetRatio:function(){return this.m_ratio;},initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.m_groundAnchor1=new b2Vec2();this.m_groundAnchor2=new b2Vec2();this.m_localAnchor1=new b2Vec2();this.m_localAnchor2=new b2Vec2();this.m_u1=new b2Vec2();this.m_u2=new b2Vec2();var tMat;var tX;var tY;this.m_ground=this.m_body1.m_world.m_groundBody;this.m_groundAnchor1.x=def.groundPoint1.x-this.m_ground.m_position.x;this.m_groundAnchor1.y=def.groundPoint1.y-this.m_ground.m_position.y;this.m_groundAnchor2.x=def.groundPoint2.x-this.m_ground.m_position.x;this.m_groundAnchor2.y=def.groundPoint2.y-this.m_ground.m_position.y;tMat=this.m_body1.m_R;tX=def.anchorPoint1.x-this.m_body1.m_position.x;tY=def.anchorPoint1.y-this.m_body1.m_position.y;this.m_localAnchor1.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor1.y=tX*tMat.col2.x+tY*tMat.col2.y;tMat=this.m_body2.m_R;tX=def.anchorPoint2.x-this.m_body2.m_position.x;tY=def.anchorPoint2.y-this.m_body2.m_position.y;this.m_localAnchor2.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor2.y=tX*tMat.col2.x+tY*tMat.col2.y;this.m_ratio=def.ratio;tX=def.groundPoint1.x-def.anchorPoint1.x;tY=def.groundPoint1.y-def.anchorPoint1.y;var d1Len=Math.sqrt(tX*tX+tY*tY);tX=def.groundPoint2.x-def.anchorPoint2.x;tY=def.groundPoint2.y-def.anchorPoint2.y;var d2Len=Math.sqrt(tX*tX+tY*tY);var length1=b2Math.b2Max(0.5*b2PulleyJoint.b2_minPulleyLength,d1Len);var length2=b2Math.b2Max(0.5*b2PulleyJoint.b2_minPulleyLength,d2Len);this.m_constant=length1+this.m_ratio*length2;this.m_maxLength1=b2Math.b2Clamp(def.maxLength1,length1,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength);this.m_maxLength2=b2Math.b2Clamp(def.maxLength2,length2,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio);this.m_pulleyImpulse=0.0;this.m_limitImpulse1=0.0;this.m_limitImpulse2=0.0;},PrepareVelocitySolver:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var s1X=this.m_ground.m_position.x+this.m_groundAnchor1.x;var s1Y=this.m_ground.m_position.y+this.m_groundAnchor1.y;var s2X=this.m_ground.m_position.x+this.m_groundAnchor2.x;var s2Y=this.m_ground.m_position.y+this.m_groundAnchor2.y;this.m_u1.Set(p1X-s1X,p1Y-s1Y);this.m_u2.Set(p2X-s2X,p2Y-s2Y);var length1=this.m_u1.Length();var length2=this.m_u2.Length();if(length1>b2Settings.b2_linearSlop)
{this.m_u1.Multiply(1.0/length1);}
else
{this.m_u1.SetZero();}
if(length2>b2Settings.b2_linearSlop)
{this.m_u2.Multiply(1.0/length2);}
else
{this.m_u2.SetZero();}
if(length1<this.m_maxLength1)
{this.m_limitState1=b2Joint.e_inactiveLimit;this.m_limitImpulse1=0.0;}
else
{this.m_limitState1=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse1=0.0;}
if(length2<this.m_maxLength2)
{this.m_limitState2=b2Joint.e_inactiveLimit;this.m_limitImpulse2=0.0;}
else
{this.m_limitState2=b2Joint.e_atUpperLimit;this.m_limitPositionImpulse2=0.0;}
var cr1u1=r1X*this.m_u1.y-r1Y*this.m_u1.x;var cr2u2=r2X*this.m_u2.y-r2Y*this.m_u2.x;this.m_limitMass1=b1.m_invMass+b1.m_invI*cr1u1*cr1u1;this.m_limitMass2=b2.m_invMass+b2.m_invI*cr2u2*cr2u2;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1.0/this.m_limitMass1;this.m_limitMass2=1.0/this.m_limitMass2;this.m_pulleyMass=1.0/this.m_pulleyMass;var P1X=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.x;var P1Y=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.y;var P2X=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.x;var P2Y=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.y;b1.m_linearVelocity.x+=b1.m_invMass*P1X;b1.m_linearVelocity.y+=b1.m_invMass*P1Y;b1.m_angularVelocity+=b1.m_invI*(r1X*P1Y-r1Y*P1X);b2.m_linearVelocity.x+=b2.m_invMass*P2X;b2.m_linearVelocity.y+=b2.m_invMass*P2Y;b2.m_angularVelocity+=b2.m_invI*(r2X*P2Y-r2Y*P2X);},SolveVelocityConstraints:function(step){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var v1X;var v1Y;var v2X;var v2Y;var P1X;var P1Y;var P2X;var P2Y;var Cdot;var impulse;var oldLimitImpulse;v1X=b1.m_linearVelocity.x+(-b1.m_angularVelocity*r1Y);v1Y=b1.m_linearVelocity.y+(b1.m_angularVelocity*r1X);v2X=b2.m_linearVelocity.x+(-b2.m_angularVelocity*r2Y);v2Y=b2.m_linearVelocity.y+(b2.m_angularVelocity*r2X);Cdot=-(this.m_u1.x*v1X+this.m_u1.y*v1Y)-this.m_ratio*(this.m_u2.x*v2X+this.m_u2.y*v2Y);impulse=-this.m_pulleyMass*Cdot;this.m_pulleyImpulse+=impulse;P1X=-impulse*this.m_u1.x;P1Y=-impulse*this.m_u1.y;P2X=-this.m_ratio*impulse*this.m_u2.x;P2Y=-this.m_ratio*impulse*this.m_u2.y;b1.m_linearVelocity.x+=b1.m_invMass*P1X;b1.m_linearVelocity.y+=b1.m_invMass*P1Y;b1.m_angularVelocity+=b1.m_invI*(r1X*P1Y-r1Y*P1X);b2.m_linearVelocity.x+=b2.m_invMass*P2X;b2.m_linearVelocity.y+=b2.m_invMass*P2Y;b2.m_angularVelocity+=b2.m_invI*(r2X*P2Y-r2Y*P2X);if(this.m_limitState1==b2Joint.e_atUpperLimit)
{v1X=b1.m_linearVelocity.x+(-b1.m_angularVelocity*r1Y);v1Y=b1.m_linearVelocity.y+(b1.m_angularVelocity*r1X);Cdot=-(this.m_u1.x*v1X+this.m_u1.y*v1Y);impulse=-this.m_limitMass1*Cdot;oldLimitImpulse=this.m_limitImpulse1;this.m_limitImpulse1=b2Math.b2Max(0.0,this.m_limitImpulse1+impulse);impulse=this.m_limitImpulse1-oldLimitImpulse;P1X=-impulse*this.m_u1.x;P1Y=-impulse*this.m_u1.y;b1.m_linearVelocity.x+=b1.m_invMass*P1X;b1.m_linearVelocity.y+=b1.m_invMass*P1Y;b1.m_angularVelocity+=b1.m_invI*(r1X*P1Y-r1Y*P1X);}
if(this.m_limitState2==b2Joint.e_atUpperLimit)
{v2X=b2.m_linearVelocity.x+(-b2.m_angularVelocity*r2Y);v2Y=b2.m_linearVelocity.y+(b2.m_angularVelocity*r2X);Cdot=-(this.m_u2.x*v2X+this.m_u2.y*v2Y);impulse=-this.m_limitMass2*Cdot;oldLimitImpulse=this.m_limitImpulse2;this.m_limitImpulse2=b2Math.b2Max(0.0,this.m_limitImpulse2+impulse);impulse=this.m_limitImpulse2-oldLimitImpulse;P2X=-impulse*this.m_u2.x;P2Y=-impulse*this.m_u2.y;b2.m_linearVelocity.x+=b2.m_invMass*P2X;b2.m_linearVelocity.y+=b2.m_invMass*P2Y;b2.m_angularVelocity+=b2.m_invI*(r2X*P2Y-r2Y*P2X);}},SolvePositionConstraints:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;var s1X=this.m_ground.m_position.x+this.m_groundAnchor1.x;var s1Y=this.m_ground.m_position.y+this.m_groundAnchor1.y;var s2X=this.m_ground.m_position.x+this.m_groundAnchor2.x;var s2Y=this.m_ground.m_position.y+this.m_groundAnchor2.y;var r1X;var r1Y;var r2X;var r2Y;var p1X;var p1Y;var p2X;var p2Y;var length1;var length2;var C;var impulse;var oldLimitPositionImpulse;var linearError=0.0;{tMat=b1.m_R;r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;p1X=b1.m_position.x+r1X;p1Y=b1.m_position.y+r1Y;p2X=b2.m_position.x+r2X;p2Y=b2.m_position.y+r2Y;this.m_u1.Set(p1X-s1X,p1Y-s1Y);this.m_u2.Set(p2X-s2X,p2Y-s2Y);length1=this.m_u1.Length();length2=this.m_u2.Length();if(length1>b2Settings.b2_linearSlop)
{this.m_u1.Multiply(1.0/length1);}
else
{this.m_u1.SetZero();}
if(length2>b2Settings.b2_linearSlop)
{this.m_u2.Multiply(1.0/length2);}
else
{this.m_u2.SetZero();}
C=this.m_constant-length1-this.m_ratio*length2;linearError=b2Math.b2Max(linearError,Math.abs(C));C=b2Math.b2Clamp(C,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);impulse=-this.m_pulleyMass*C;p1X=-impulse*this.m_u1.x;p1Y=-impulse*this.m_u1.y;p2X=-this.m_ratio*impulse*this.m_u2.x;p2Y=-this.m_ratio*impulse*this.m_u2.y;b1.m_position.x+=b1.m_invMass*p1X;b1.m_position.y+=b1.m_invMass*p1Y;b1.m_rotation+=b1.m_invI*(r1X*p1Y-r1Y*p1X);b2.m_position.x+=b2.m_invMass*p2X;b2.m_position.y+=b2.m_invMass*p2Y;b2.m_rotation+=b2.m_invI*(r2X*p2Y-r2Y*p2X);b1.m_R.Set(b1.m_rotation);b2.m_R.Set(b2.m_rotation);}
if(this.m_limitState1==b2Joint.e_atUpperLimit)
{tMat=b1.m_R;r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;p1X=b1.m_position.x+r1X;p1Y=b1.m_position.y+r1Y;this.m_u1.Set(p1X-s1X,p1Y-s1Y);length1=this.m_u1.Length();if(length1>b2Settings.b2_linearSlop)
{this.m_u1.x*=1.0/length1;this.m_u1.y*=1.0/length1;}
else
{this.m_u1.SetZero();}
C=this.m_maxLength1-length1;linearError=b2Math.b2Max(linearError,-C);C=b2Math.b2Clamp(C+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0.0);impulse=-this.m_limitMass1*C;oldLimitPositionImpulse=this.m_limitPositionImpulse1;this.m_limitPositionImpulse1=b2Math.b2Max(0.0,this.m_limitPositionImpulse1+impulse);impulse=this.m_limitPositionImpulse1-oldLimitPositionImpulse;p1X=-impulse*this.m_u1.x;p1Y=-impulse*this.m_u1.y;b1.m_position.x+=b1.m_invMass*p1X;b1.m_position.y+=b1.m_invMass*p1Y;b1.m_rotation+=b1.m_invI*(r1X*p1Y-r1Y*p1X);b1.m_R.Set(b1.m_rotation);}
if(this.m_limitState2==b2Joint.e_atUpperLimit)
{tMat=b2.m_R;r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;p2X=b2.m_position.x+r2X;p2Y=b2.m_position.y+r2Y;this.m_u2.Set(p2X-s2X,p2Y-s2Y);length2=this.m_u2.Length();if(length2>b2Settings.b2_linearSlop)
{this.m_u2.x*=1.0/length2;this.m_u2.y*=1.0/length2;}
else
{this.m_u2.SetZero();}
C=this.m_maxLength2-length2;linearError=b2Math.b2Max(linearError,-C);C=b2Math.b2Clamp(C+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0.0);impulse=-this.m_limitMass2*C;oldLimitPositionImpulse=this.m_limitPositionImpulse2;this.m_limitPositionImpulse2=b2Math.b2Max(0.0,this.m_limitPositionImpulse2+impulse);impulse=this.m_limitPositionImpulse2-oldLimitPositionImpulse;p2X=-impulse*this.m_u2.x;p2Y=-impulse*this.m_u2.y;b2.m_position.x+=b2.m_invMass*p2X;b2.m_position.y+=b2.m_invMass*p2Y;b2.m_rotation+=b2.m_invI*(r2X*p2Y-r2Y*p2X);b2.m_R.Set(b2.m_rotation);}
return linearError<b2Settings.b2_linearSlop;},m_ground:null,m_groundAnchor1:new b2Vec2(),m_groundAnchor2:new b2Vec2(),m_localAnchor1:new b2Vec2(),m_localAnchor2:new b2Vec2(),m_u1:new b2Vec2(),m_u2:new b2Vec2(),m_constant:null,m_ratio:null,m_maxLength1:null,m_maxLength2:null,m_pulleyMass:null,m_limitMass1:null,m_limitMass2:null,m_pulleyImpulse:null,m_limitImpulse1:null,m_limitImpulse2:null,m_limitPositionImpulse1:null,m_limitPositionImpulse2:null,m_limitState1:0,m_limitState2:0});b2PulleyJoint.b2_minPulleyLength=b2Settings.b2_lengthUnitsPerMeter;var b2PulleyJointDef=Class.create();Object.extend(b2PulleyJointDef.prototype,b2JointDef.prototype);Object.extend(b2PulleyJointDef.prototype,{initialize:function()
{this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.groundPoint1=new b2Vec2();this.groundPoint2=new b2Vec2();this.anchorPoint1=new b2Vec2();this.anchorPoint2=new b2Vec2();this.type=b2Joint.e_pulleyJoint;this.groundPoint1.Set(-1.0,1.0);this.groundPoint2.Set(1.0,1.0);this.anchorPoint1.Set(-1.0,0.0);this.anchorPoint2.Set(1.0,0.0);this.maxLength1=0.5*b2PulleyJoint.b2_minPulleyLength;this.maxLength2=0.5*b2PulleyJoint.b2_minPulleyLength;this.ratio=1.0;this.collideConnected=true;},groundPoint1:new b2Vec2(),groundPoint2:new b2Vec2(),anchorPoint1:new b2Vec2(),anchorPoint2:new b2Vec2(),maxLength1:null,maxLength2:null,ratio:null});var b2RevoluteJoint=Class.create();Object.extend(b2RevoluteJoint.prototype,b2Joint.prototype);Object.extend(b2RevoluteJoint.prototype,{GetAnchor1:function(){var tMat=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y));},GetAnchor2:function(){var tMat=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y));},GetJointAngle:function(){return this.m_body2.m_rotation-this.m_body1.m_rotation;},GetJointSpeed:function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity;},GetMotorTorque:function(invTimeStep){return invTimeStep*this.m_motorImpulse;},SetMotorSpeed:function(speed)
{this.m_motorSpeed=speed;},SetMotorTorque:function(torque)
{this.m_maxMotorTorque=torque;},GetReactionForce:function(invTimeStep)
{var tVec=this.m_ptpImpulse.Copy();tVec.Multiply(invTimeStep);return tVec;},GetReactionTorque:function(invTimeStep)
{return invTimeStep*this.m_limitImpulse;},initialize:function(def){this.m_node1=new b2JointNode();this.m_node2=new b2JointNode();this.m_type=def.type;this.m_prev=null;this.m_next=null;this.m_body1=def.body1;this.m_body2=def.body2;this.m_collideConnected=def.collideConnected;this.m_islandFlag=false;this.m_userData=def.userData;this.K=new b2Mat22();this.K1=new b2Mat22();this.K2=new b2Mat22();this.K3=new b2Mat22();this.m_localAnchor1=new b2Vec2();this.m_localAnchor2=new b2Vec2();this.m_ptpImpulse=new b2Vec2();this.m_ptpMass=new b2Mat22();var tMat;var tX;var tY;tMat=this.m_body1.m_R;tX=def.anchorPoint.x-this.m_body1.m_position.x;tY=def.anchorPoint.y-this.m_body1.m_position.y;this.m_localAnchor1.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor1.y=tX*tMat.col2.x+tY*tMat.col2.y;tMat=this.m_body2.m_R;tX=def.anchorPoint.x-this.m_body2.m_position.x;tY=def.anchorPoint.y-this.m_body2.m_position.y;this.m_localAnchor2.x=tX*tMat.col1.x+tY*tMat.col1.y;this.m_localAnchor2.y=tX*tMat.col2.x+tY*tMat.col2.y;this.m_intialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation;this.m_ptpImpulse.Set(0.0,0.0);this.m_motorImpulse=0.0;this.m_limitImpulse=0.0;this.m_limitPositionImpulse=0.0;this.m_lowerAngle=def.lowerAngle;this.m_upperAngle=def.upperAngle;this.m_maxMotorTorque=def.motorTorque;this.m_motorSpeed=def.motorSpeed;this.m_enableLimit=def.enableLimit;this.m_enableMotor=def.enableMotor;},K:new b2Mat22(),K1:new b2Mat22(),K2:new b2Mat22(),K3:new b2Mat22(),PrepareVelocitySolver:function(){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;this.K1.col1.x=invMass1+invMass2;this.K1.col2.x=0.0;this.K1.col1.y=0.0;this.K1.col2.y=invMass1+invMass2;this.K2.col1.x=invI1*r1Y*r1Y;this.K2.col2.x=-invI1*r1X*r1Y;this.K2.col1.y=-invI1*r1X*r1Y;this.K2.col2.y=invI1*r1X*r1X;this.K3.col1.x=invI2*r2Y*r2Y;this.K3.col2.x=-invI2*r2X*r2Y;this.K3.col1.y=-invI2*r2X*r2Y;this.K3.col2.y=invI2*r2X*r2X;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Invert(this.m_ptpMass);this.m_motorMass=1.0/(invI1+invI2);if(this.m_enableMotor==false)
{this.m_motorImpulse=0.0;}
if(this.m_enableLimit)
{var jointAngle=b2.m_rotation-b1.m_rotation-this.m_intialAngle;if(b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2.0*b2Settings.b2_angularSlop)
{this.m_limitState=b2Joint.e_equalLimits;}
else if(jointAngle<=this.m_lowerAngle)
{if(this.m_limitState!=b2Joint.e_atLowerLimit)
{this.m_limitImpulse=0.0;}
this.m_limitState=b2Joint.e_atLowerLimit;}
else if(jointAngle>=this.m_upperAngle)
{if(this.m_limitState!=b2Joint.e_atUpperLimit)
{this.m_limitImpulse=0.0;}
this.m_limitState=b2Joint.e_atUpperLimit;}
else
{this.m_limitState=b2Joint.e_inactiveLimit;this.m_limitImpulse=0.0;}}
else
{this.m_limitImpulse=0.0;}
if(b2World.s_enableWarmStarting)
{b1.m_linearVelocity.x-=invMass1*this.m_ptpImpulse.x;b1.m_linearVelocity.y-=invMass1*this.m_ptpImpulse.y;b1.m_angularVelocity-=invI1*((r1X*this.m_ptpImpulse.y-r1Y*this.m_ptpImpulse.x)+this.m_motorImpulse+this.m_limitImpulse);b2.m_linearVelocity.x+=invMass2*this.m_ptpImpulse.x;b2.m_linearVelocity.y+=invMass2*this.m_ptpImpulse.y;b2.m_angularVelocity+=invI2*((r2X*this.m_ptpImpulse.y-r2Y*this.m_ptpImpulse.x)+this.m_motorImpulse+this.m_limitImpulse);}
else{this.m_ptpImpulse.SetZero();this.m_motorImpulse=0.0;this.m_limitImpulse=0.0;}
this.m_limitPositionImpulse=0.0;},SolveVelocityConstraints:function(step){var b1=this.m_body1;var b2=this.m_body2;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var oldLimitImpulse;var ptpCdotX=b2.m_linearVelocity.x+(-b2.m_angularVelocity*r2Y)-b1.m_linearVelocity.x-(-b1.m_angularVelocity*r1Y);var ptpCdotY=b2.m_linearVelocity.y+(b2.m_angularVelocity*r2X)-b1.m_linearVelocity.y-(b1.m_angularVelocity*r1X);var ptpImpulseX=-(this.m_ptpMass.col1.x*ptpCdotX+this.m_ptpMass.col2.x*ptpCdotY);var ptpImpulseY=-(this.m_ptpMass.col1.y*ptpCdotX+this.m_ptpMass.col2.y*ptpCdotY);this.m_ptpImpulse.x+=ptpImpulseX;this.m_ptpImpulse.y+=ptpImpulseY;b1.m_linearVelocity.x-=b1.m_invMass*ptpImpulseX;b1.m_linearVelocity.y-=b1.m_invMass*ptpImpulseY;b1.m_angularVelocity-=b1.m_invI*(r1X*ptpImpulseY-r1Y*ptpImpulseX);b2.m_linearVelocity.x+=b2.m_invMass*ptpImpulseX;b2.m_linearVelocity.y+=b2.m_invMass*ptpImpulseY;b2.m_angularVelocity+=b2.m_invI*(r2X*ptpImpulseY-r2Y*ptpImpulseX);if(this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits)
{var motorCdot=b2.m_angularVelocity-b1.m_angularVelocity-this.m_motorSpeed;var motorImpulse=-this.m_motorMass*motorCdot;var oldMotorImpulse=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+motorImpulse,-step.dt*this.m_maxMotorTorque,step.dt*this.m_maxMotorTorque);motorImpulse=this.m_motorImpulse-oldMotorImpulse;b1.m_angularVelocity-=b1.m_invI*motorImpulse;b2.m_angularVelocity+=b2.m_invI*motorImpulse;}
if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{var limitCdot=b2.m_angularVelocity-b1.m_angularVelocity;var limitImpulse=-this.m_motorMass*limitCdot;if(this.m_limitState==b2Joint.e_equalLimits)
{this.m_limitImpulse+=limitImpulse;}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{oldLimitImpulse=this.m_limitImpulse;this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+limitImpulse,0.0);limitImpulse=this.m_limitImpulse-oldLimitImpulse;}
b1.m_angularVelocity-=b1.m_invI*limitImpulse;b2.m_angularVelocity+=b2.m_invI*limitImpulse;}},SolvePositionConstraints:function(){var oldLimitImpulse;var limitC;var b1=this.m_body1;var b2=this.m_body2;var positionError=0.0;var tMat;tMat=b1.m_R;var r1X=tMat.col1.x*this.m_localAnchor1.x+tMat.col2.x*this.m_localAnchor1.y;var r1Y=tMat.col1.y*this.m_localAnchor1.x+tMat.col2.y*this.m_localAnchor1.y;tMat=b2.m_R;var r2X=tMat.col1.x*this.m_localAnchor2.x+tMat.col2.x*this.m_localAnchor2.y;var r2Y=tMat.col1.y*this.m_localAnchor2.x+tMat.col2.y*this.m_localAnchor2.y;var p1X=b1.m_position.x+r1X;var p1Y=b1.m_position.y+r1Y;var p2X=b2.m_position.x+r2X;var p2Y=b2.m_position.y+r2Y;var ptpCX=p2X-p1X;var ptpCY=p2Y-p1Y;positionError=Math.sqrt(ptpCX*ptpCX+ptpCY*ptpCY);var invMass1=b1.m_invMass;var invMass2=b2.m_invMass;var invI1=b1.m_invI;var invI2=b2.m_invI;this.K1.col1.x=invMass1+invMass2;this.K1.col2.x=0.0;this.K1.col1.y=0.0;this.K1.col2.y=invMass1+invMass2;this.K2.col1.x=invI1*r1Y*r1Y;this.K2.col2.x=-invI1*r1X*r1Y;this.K2.col1.y=-invI1*r1X*r1Y;this.K2.col2.y=invI1*r1X*r1X;this.K3.col1.x=invI2*r2Y*r2Y;this.K3.col2.x=-invI2*r2X*r2Y;this.K3.col1.y=-invI2*r2X*r2Y;this.K3.col2.y=invI2*r2X*r2X;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(b2RevoluteJoint.tImpulse,-ptpCX,-ptpCY);var impulseX=b2RevoluteJoint.tImpulse.x;var impulseY=b2RevoluteJoint.tImpulse.y;b1.m_position.x-=b1.m_invMass*impulseX;b1.m_position.y-=b1.m_invMass*impulseY;b1.m_rotation-=b1.m_invI*(r1X*impulseY-r1Y*impulseX);b1.m_R.Set(b1.m_rotation);b2.m_position.x+=b2.m_invMass*impulseX;b2.m_position.y+=b2.m_invMass*impulseY;b2.m_rotation+=b2.m_invI*(r2X*impulseY-r2Y*impulseX);b2.m_R.Set(b2.m_rotation);var angularError=0.0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit)
{var angle=b2.m_rotation-b1.m_rotation-this.m_intialAngle;var limitImpulse=0.0;if(this.m_limitState==b2Joint.e_equalLimits)
{limitC=b2Math.b2Clamp(angle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);limitImpulse=-this.m_motorMass*limitC;angularError=b2Math.b2Abs(limitC);}
else if(this.m_limitState==b2Joint.e_atLowerLimit)
{limitC=angle-this.m_lowerAngle;angularError=b2Math.b2Max(0.0,-limitC);limitC=b2Math.b2Clamp(limitC+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0.0);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
else if(this.m_limitState==b2Joint.e_atUpperLimit)
{limitC=angle-this.m_upperAngle;angularError=b2Math.b2Max(0.0,limitC);limitC=b2Math.b2Clamp(limitC-b2Settings.b2_angularSlop,0.0,b2Settings.b2_maxAngularCorrection);limitImpulse=-this.m_motorMass*limitC;oldLimitImpulse=this.m_limitPositionImpulse;this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+limitImpulse,0.0);limitImpulse=this.m_limitPositionImpulse-oldLimitImpulse;}
b1.m_rotation-=b1.m_invI*limitImpulse;b1.m_R.Set(b1.m_rotation);b2.m_rotation+=b2.m_invI*limitImpulse;b2.m_R.Set(b2.m_rotation);}
return positionError<=b2Settings.b2_linearSlop&&angularError<=b2Settings.b2_angularSlop;},m_localAnchor1:new b2Vec2(),m_localAnchor2:new b2Vec2(),m_ptpImpulse:new b2Vec2(),m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_ptpMass:new b2Mat22(),m_motorMass:null,m_intialAngle:null,m_lowerAngle:null,m_upperAngle:null,m_maxMotorTorque:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0});b2RevoluteJoint.tImpulse=new b2Vec2();var b2RevoluteJointDef=Class.create();Object.extend(b2RevoluteJointDef.prototype,b2JointDef.prototype);Object.extend(b2RevoluteJointDef.prototype,{initialize:function()
{this.type=b2Joint.e_unknownJoint;this.userData=null;this.body1=null;this.body2=null;this.collideConnected=false;this.type=b2Joint.e_revoluteJoint;this.anchorPoint=new b2Vec2(0.0,0.0);this.lowerAngle=0.0;this.upperAngle=0.0;this.motorTorque=0.0;this.motorSpeed=0.0;this.enableLimit=false;this.enableMotor=false;},anchorPoint:null,lowerAngle:null,upperAngle:null,motorTorque:null,motorSpeed:null,enableLimit:null,enableMotor:null});function drawWorld(world,stage)
{for(var j=world.m_jointList;j;j=j.m_next)drawJoint(j,stage);for(var b=world.m_bodyList;b;b=b.m_next)
{for(var s=b.GetShapeList();s!=null;s=s.GetNext())drawShape(s,stage);}}
function drawJoint(joint,stage,color)
{var b1=joint.m_body1;var b2=joint.m_body2;var x1=b1.m_position;var x2=b2.m_position;var p1=joint.GetAnchor1();var p2=joint.GetAnchor2();if(!color)color='#00f';switch(joint.m_type)
{case b2Joint.e_distanceJoint:stage.drawLine(p1.x,p1.y,p2.x,p2.y,1,color);break;case b2Joint.e_pulleyJoint:break;default:if(b1==world.m_groundBody)
{stage.drawLine(p1.x,p1.y,x2.x,x2.y,1,color);}
else if(b2==world.m_groundBody)
{stage.drawLine(p1.x,p1.y,x1.x,x1.y,1,color);}
else
{stage.drawLine(x1.x,x1.y,p1.x,p1.y,1,color);stage.drawLine(p1.x,p1.y,x2.x,x2.y,1,color);stage.drawLine(x2.x,x2.y,p2.x,p2.y,1,color);}
break;}}
function drawShape(shape,stage)
{switch(shape.m_type)
{case b2Shape.e_circleShape:{var color="#33f";var circle=shape;var pos=circle.m_position;var r=circle.m_radius;var segments=16.0;var theta=0.0;var dtheta=2.0*Math.PI/segments;var x=pos.x+r;var y=pos.y;for(var i=0;i<segments;i++)
{var d=new b2Vec2(r*Math.cos(theta),r*Math.sin(theta));var v=b2Math.AddVV(pos,d);stage.drawLine(x,y,v.x,v.y,1,color);x=v.x;y=v.y;theta+=dtheta;}
stage.drawLine(x,y,pos.x+r,pos.y,1,color);var ax=circle.m_R.col1;var pos2=new b2Vec2(pos.x+r*ax.x,pos.y+r*ax.y);stage.drawLine(pos.x,pos.y,pos2.x,pos2.y,1,color);}
break;case b2Shape.e_polyShape:{var poly=shape;var tV=b2Math.AddVV(poly.m_position,b2Math.b2MulMV(poly.m_R,poly.m_vertices[0]));var x=tV.x;var y=tV.y;for(var i=0;i<poly.m_vertexCount;i++)
{var v=b2Math.AddVV(poly.m_position,b2Math.b2MulMV(poly.m_R,poly.m_vertices[i]));stage.drawLine(x,y,v.x,v.y,1,"#fff");x=v.x;y=v.y;}
stage.drawLine(x,y,tV.x,tV.y,1,"#fff");}
break;}};function box2DCreateWorld(gravity)
{var g,s;var worldAABB=new b2AABB();worldAABB.minVertex.Set(-1000,-1000);worldAABB.maxVertex.Set(1000,1000);if(typeof gravity!="undefined")g=new b2Vec2(0,gravity);else g=new b2Vec2(0,300);return new b2World(worldAABB,g,true);}
function box2DCreateGround(world,restitution,y)
{var groundSd=new b2BoxDef();groundSd.extents.Set(10000,50);groundSd.restitution=restitution?restitution:0.2;var groundBd=new b2BodyDef();groundBd.AddShape(groundSd);groundBd.position.Set(-500,y?y:480);return world.CreateBody(groundBd);}
function box2DCreateCircle(world,x,y,radius,rotation,fixed,density,restitution,friction)
{if(typeof(fixed)=='undefined')fixed=true;var ballSd=new b2CircleDef();if(!fixed)
{ballSd.density=density?density:0.8;ballSd.restitution=restitution?restitution:0.1;ballSd.friction=friction?friction:3;}
ballSd.radius=radius;var ballBd=new b2BodyDef();ballBd.rotation=rotation;ballBd.AddShape(ballSd);ballBd.position.Set(x,y);return world.CreateBody(ballBd);}
function box2DCreateBox(world,x,y,width,height,rotation,fixed,density,restitution,friction)
{if(typeof(fixed)=='undefined')fixed=true;var boxSd=new b2BoxDef();if(!fixed)
{boxSd.density=density?density:1.0;boxSd.restitution=restitution?restitution:0.2;boxSd.friction=friction?friction:0.3;}
boxSd.extents.Set(width,height);var boxBd=new b2BodyDef();boxBd.rotation=rotation;boxBd.AddShape(boxSd);boxBd.position.Set(x,y);return world.CreateBody(boxBd);}
function box2DCreatePoly(world,x,y,points,rotation,fixed,density,restitution,friction)
{var polyBd=new b2BodyDef();polyBd.rotation=rotation;for(var n=0;n<points.length;n++)
{var p=points[n];var polySd=new b2PolyDef();if(!fixed)
{polySd.density=density?density:1.0;polySd.restitution=restitution?restitution:0.2;polySd.friction=friction?friction:0.3;}
polySd.vertexCount=p.length;for(var i=0;i<p.length;i++)
{polySd.vertices[i].Set(p[i][0],p[i][1]);}
polyBd.AddShape(polySd);}
polyBd.position.Set(x,y);return world.CreateBody(polyBd);};function box2DCreateRevoluteJoint(world,body1,body2,point,motor)
{var jointDef=new b2RevoluteJointDef();jointDef.body1=body1;jointDef.body2=body2;jointDef.anchorPoint=point;jointDef.collideConnected=true;if(motor)
{jointDef.motorSpeed=motor;jointDef.motorTorque=500000000;jointDef.enableMotor=true;}
return world.CreateJoint(jointDef);};function box2DCreateDistanceJoint(world,body1,body2,point1,point2)
{var jointDef=new b2DistanceJointDef();jointDef.body1=body1;jointDef.body2=body2;jointDef.anchorPoint1=point1;jointDef.anchorPoint2=point2;jointDef.collideConnected=true;return world.CreateJoint(jointDef);};function box2DCreatePrismaticJoint(world,body1,body2,point,motor)
{var jointDef=new b2PrismaticJointDef();jointDef.anchorPoint.Set(point.x,point.y);jointDef.body1=body1;jointDef.body2=body2;jointDef.axis.Set(0.0,1.0);if(motor)
{jointDef.motorSpeed=motor;jointDef.motorForce=100000.0;jointDef.enableMotor=true;}
return world.CreateJoint(jointDef);};var Prototype={Version:'1.6.0.2',Browser:{IE:!!(window.attachEvent&&!window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf('AppleWebKit/')>-1,Gecko:navigator.userAgent.indexOf('Gecko')>-1&&navigator.userAgent.indexOf('KHTML')==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement('div').__proto__&&document.createElement('div').__proto__!==document.createElement('form').__proto__},ScriptFragment:'<script[^>]*>([\\S\\s]*?)<\/script>',JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(x){return x}};if(Prototype.Browser.MobileSafari)Prototype.BrowserFeatures.SpecificElementExtensions=false;var Class={create:function()
{var parent=null,properties=$A(arguments);if(Object.isFunction(properties[0]))parent=properties.shift();function klass(){this.initialize.apply(this,arguments);}
Object.extend(klass,Class.Methods);klass.superclass=parent;klass.subclasses=[];if(parent)
{var subclass=function(){};subclass.prototype=parent.prototype;klass.prototype=new subclass;parent.subclasses.push(klass);}
for(var i=0;i<properties.length;i++)klass.addMethods(properties[i]);if(!klass.prototype.initialize)klass.prototype.initialize=Prototype.emptyFunction;klass.prototype.constructor=klass;return klass;}};Class.Methods={addMethods:function(source)
{var ancestor=this.superclass&&this.superclass.prototype;var properties=Object.keys(source);if(!Object.keys({toString:true}).length)properties.push("toString","valueOf");for(var i=0,length=properties.length;i<length;i++)
{var property=properties[i],value=source[property];if(ancestor&&Object.isFunction(value)&&value.argumentNames().first()=="$super")
{var method=value;value=Object.extend((function(m){return function(){return ancestor[m].apply(this,arguments)};})(property).wrap(method),{valueOf:function(){return method},toString:function(){return method.toString()}});}
this.prototype[property]=value;}
return this;}};var Abstract={};Object.extend=function(destination,source)
{for(var property in source)destination[property]=source[property];return destination;};Object.extend(Object,{inspect:function(object)
{try
{if(Object.isUndefined(object))return'undefined';if(object===null)return'null';return object.inspect?object.inspect():String(object);}
catch(e)
{if(e instanceof RangeError)return'...';throw e;}},toJSON:function(object)
{var type=typeof object;switch(type)
{case'undefined':case'function':case'unknown':return;case'boolean':return object.toString();}
if(object===null)return'null';if(object.toJSON)return object.toJSON();if(Object.isElement(object))return;var results=[];for(var property in object)
{var value=Object.toJSON(object[property]);if(!Object.isUndefined(value))
results.push(property.toJSON()+': '+value);}
return'{'+results.join(', ')+'}';},toQueryString:function(object){return $H(object).toQueryString();},toHTML:function(object){return object&&object.toHTML?object.toHTML():String.interpret(object);},keys:function(object)
{var keys=[];for(var property in object)
keys.push(property);return keys;},values:function(object)
{var values=[];for(var property in object)
values.push(object[property]);return values;},clone:function(object){return Object.extend({},object);},isElement:function(object){return object&&object.nodeType==1;},isArray:function(object)
{return object!=null&&typeof object=="object"&&'splice'in object&&'join'in object;},isHash:function(object){return object instanceof Hash;},isFunction:function(object){return typeof object=="function";},isString:function(object){return typeof object=="string";},isNumber:function(object){return typeof object=="number";},isUndefined:function(object){return typeof object=="undefined";}});Object.extend(Function.prototype,{argumentNames:function()
{var names=this.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",").invoke("strip");return names.length==1&&!names[0]?[]:names;},bind:function()
{if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var __method=this,args=$A(arguments),object=args.shift();return function(){return __method.apply(object,args.concat($A(arguments)));}},bindAsEventListener:function()
{var __method=this,args=$A(arguments),object=args.shift();return function(event){return __method.apply(object,[event||window.event].concat(args));}},curry:function()
{if(!arguments.length)return this;var __method=this,args=$A(arguments);return function(){return __method.apply(this,args.concat($A(arguments)));}},delay:function()
{var __method=this,args=$A(arguments),timeout=args.shift()*1000;return window.setTimeout(function(){return __method.apply(__method,args);},timeout);},wrap:function(wrapper)
{var __method=this;return function(){return wrapper.apply(this,[__method.bind(this)].concat($A(arguments)));}},methodize:function()
{if(this._methodized)return this._methodized;var __method=this;return this._methodized=function(){return __method.apply(null,[this].concat($A(arguments)));};}});Function.prototype.defer=Function.prototype.delay.curry(0.01);Object.extend(String,{interpret:function(value){return value==null?'':String(value);},specialChar:{'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','\\':'\\\\'}});Object.extend(String.prototype,{gsub:function(pattern,replacement)
{var result='',source=this,match;replacement=arguments.callee.prepareReplacement(replacement);while(source.length>0)
{if(match=source.match(pattern))
{result+=source.slice(0,match.index);result+=String.interpret(replacement(match));source=source.slice(match.index+match[0].length);}
else result+=source,source='';}
return result;},sub:function(pattern,replacement,count)
{replacement=this.gsub.prepareReplacement(replacement);count=Object.isUndefined(count)?1:count;return this.gsub(pattern,function(match)
{if(--count<0)return match[0];return replacement(match);});},scan:function(pattern,iterator)
{this.gsub(pattern,iterator);return String(this);},truncate:function(length,truncation)
{length=length||30;truncation=Object.isUndefined(truncation)?'...':truncation;return this.length>length?this.slice(0,length-truncation.length)+truncation:String(this);},strip:function(){return this.replace(/^\s+/,'').replace(/\s+$/,'');},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,'');},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,'img'),'');},extractScripts:function()
{var matchAll=new RegExp(Prototype.ScriptFragment,'img');var matchOne=new RegExp(Prototype.ScriptFragment,'im');return(this.match(matchAll)||[]).map(function(scriptTag){return(scriptTag.match(matchOne)||['',''])[1];});},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)});},escapeHTML:function()
{var self=arguments.callee;self.text.data=this;return self.div.innerHTML;},unescapeHTML:function()
{var div=new Element('div');div.innerHTML=this.stripTags();return div.childNodes[0]?(div.childNodes.length>1?$A(div.childNodes).inject('',function(memo,node){return memo+node.nodeValue}):div.childNodes[0].nodeValue):'';},toQueryParams:function(separator)
{var match=this.strip().match(/([^?#]*)(#.*)?$/);if(!match)return{};return match[1].split(separator||'&').inject({},function(hash,pair)
{if((pair=pair.split('='))[0])
{var key=decodeURIComponent(pair.shift());var value=pair.length>1?pair.join('='):pair[0];if(value!=undefined)value=decodeURIComponent(value);if(key in hash)
{if(!Object.isArray(hash[key]))hash[key]=[hash[key]];hash[key].push(value);}
else hash[key]=value;}
return hash;});},toArray:function(){return this.split('');},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1);},times:function(count){return count<1?'':new Array(count+1).join(this);},camelize:function()
{var parts=this.split('-'),len=parts.length;if(len==1)return parts[0];var camelized=this.charAt(0)=='-'?parts[0].charAt(0).toUpperCase()+parts[0].substring(1):parts[0];for(var i=1;i<len;i++)camelized+=parts[i].charAt(0).toUpperCase()+parts[i].substring(1);return camelized;},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase();},underscore:function(){return this.gsub(/::/,'/').gsub(/([A-Z]+)([A-Z][a-z])/,'#{1}_#{2}').gsub(/([a-z\d])([A-Z])/,'#{1}_#{2}').gsub(/-/,'_').toLowerCase();},dasherize:function(){return this.gsub(/_/,'-');},inspect:function(useDoubleQuotes)
{var escapedString=this.gsub(/[\x00-\x1f\\]/,function(match)
{var character=String.specialChar[match[0]];return character?character:'\\u00'+match[0].charCodeAt().toPaddedString(2,16);});if(useDoubleQuotes)return'"'+escapedString.replace(/"/g,'\\"')+'"';return"'"+escapedString.replace(/'/g,'\\\'')+"'";},toJSON:function(){return this.inspect(true);},unfilterJSON:function(filter){return this.sub(filter||Prototype.JSONFilter,'#{1}');},isJSON:function()
{var str=this;if(str.blank())return false;str=this.replace(/\\./g,'@').replace(/"[^"\\\n\r]*"/g,'');return(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(str);},evalJSON:function(sanitize)
{var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval('('+json+')');}catch(e){}
throw new SyntaxError('Badly formed JSON string: '+this.inspect());},include:function(pattern){return this.indexOf(pattern)>-1;},startsWith:function(pattern){return this.indexOf(pattern)===0;},endsWith:function(pattern)
{var d=this.length-pattern.length;return d>=0&&this.lastIndexOf(pattern)===d;},empty:function(){return this=='';},blank:function(){return /^\s*$/.test(this);},interpolate:function(object,pattern){return new Template(this,pattern).evaluate(object);}});if(Prototype.Browser.WebKit||Prototype.Browser.IE)Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},unescapeHTML:function(){return this.replace(/&amp;/g,'&').replace(/&lt;/g,'<').replace(/&gt;/g,'>');}});String.prototype.gsub.prepareReplacement=function(replacement)
{if(Object.isFunction(replacement))return replacement;var template=new Template(replacement);return function(match){return template.evaluate(match)};};String.prototype.parseQuery=String.prototype.toQueryParams;Object.extend(String.prototype.escapeHTML,{div:document.createElement('div'),text:document.createTextNode('')});with(String.prototype.escapeHTML)div.appendChild(text);var Template=Class.create({initialize:function(template,pattern)
{this.template=template.toString();this.pattern=pattern||Template.Pattern;},evaluate:function(object)
{if(Object.isFunction(object.toTemplateReplacements))object=object.toTemplateReplacements();return this.template.gsub(this.pattern,function(match)
{if(object==null)return'';var before=match[1]||'';if(before=='\\')return match[2];var ctx=object,expr=match[3];var pattern=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;match=pattern.exec(expr);if(match==null)return before;while(match!=null)
{var comp=match[1].startsWith('[')?match[2].gsub('\\\\]',']'):match[1];ctx=ctx[comp];if(null==ctx||''==match[3])break;expr=expr.substring('['==match[3]?match[1].length:match[0].length);match=pattern.exec(expr);}
return before+String.interpret(ctx);});}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={};var Enumerable={each:function(iterator,context)
{var index=0;iterator=iterator.bind(context);try{this._each(function(value){iterator(value,index++);});}
catch(e){if(e!=$break)throw e;}
return this;},eachSlice:function(number,iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var index=-number,slices=[],array=this.toArray();while((index+=number)<array.length)
slices.push(array.slice(index,index+number));return slices.collect(iterator,context);},all:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result=true;this.each(function(value,index)
{result=result&&!!iterator(value,index);if(!result)throw $break;});return result;},any:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result=false;this.each(function(value,index)
{if(result=!!iterator(value,index))
throw $break;});return result;},collect:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var results=[];this.each(function(value,index){results.push(iterator(value,index));});return results;},detect:function(iterator,context)
{iterator=iterator.bind(context);var result;this.each(function(value,index)
{if(iterator(value,index)){result=value;throw $break;}});return result;},findAll:function(iterator,context)
{iterator=iterator.bind(context);var results=[];this.each(function(value,index)
{if(iterator(value,index))
results.push(value);});return results;},grep:function(filter,iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var results=[];if(Object.isString(filter))
filter=new RegExp(filter);this.each(function(value,index)
{if(filter.match(value))
results.push(iterator(value,index));});return results;},include:function(object)
{if(Object.isFunction(this.indexOf))
if(this.indexOf(object)!=-1)return true;var found=false;this.each(function(value)
{if(value==object){found=true;throw $break;}});return found;},inGroupsOf:function(number,fillWith)
{fillWith=Object.isUndefined(fillWith)?null:fillWith;return this.eachSlice(number,function(slice)
{while(slice.length<number)slice.push(fillWith);return slice;});},inject:function(memo,iterator,context)
{iterator=iterator.bind(context);this.each(function(value,index){memo=iterator(memo,value,index);});return memo;},invoke:function(method)
{var args=$A(arguments).slice(1);return this.map(function(value){return value[method].apply(value,args);});},max:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result;this.each(function(value,index)
{value=iterator(value,index);if(result==null||value>=result)result=value;});return result;},min:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var result;this.each(function(value,index)
{value=iterator(value,index);if(result==null||value<result)result=value;});return result;},partition:function(iterator,context)
{iterator=iterator?iterator.bind(context):Prototype.K;var trues=[],falses=[];this.each(function(value,index)
{(iterator(value,index)?trues:falses).push(value);});return[trues,falses];},pluck:function(property)
{var results=[];this.each(function(value){results.push(value[property]);});return results;},reject:function(iterator,context)
{iterator=iterator.bind(context);var results=[];this.each(function(value,index)
{if(!iterator(value,index))results.push(value);});return results;},sortBy:function(iterator,context)
{iterator=iterator.bind(context);return this.map(function(value,index){return{value:value,criteria:iterator(value,index)};}).sort(function(left,right)
{var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0;}).pluck('value');},toArray:function(){return this.map();},zip:function()
{var iterator=Prototype.K,args=$A(arguments);if(Object.isFunction(args.last()))iterator=args.pop();var collections=[this].concat(args).map($A);return this.map(function(value,index){return iterator(collections.pluck(index));});},size:function(){return this.toArray().length;},inspect:function(){return'#<Enumerable:'+this.toArray().inspect()+'>';}};Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any});function $A(iterable)
{if(!iterable)return[];if(iterable.toArray)return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;}
if(Prototype.Browser.WebKit)
{$A=function(iterable)
{if(!iterable)return[];if(!(Object.isFunction(iterable)&&iterable=='[object NodeList]')&&iterable.toArray)return iterable.toArray();var length=iterable.length||0,results=new Array(length);while(length--)results[length]=iterable[length];return results;};}
Array.from=$A;Object.extend(Array.prototype,Enumerable);if(!Array.prototype._reverse)Array.prototype._reverse=Array.prototype.reverse;Object.extend(Array.prototype,{_each:function(iterator){for(var i=0,length=this.length;i<length;i++)iterator(this[i]);},clear:function(){this.length=0;return this;},first:function(){return this[0];},last:function(){return this[this.length-1];},compact:function(){return this.select(function(value){return value!=null;});},flatten:function()
{return this.inject([],function(array,value){return array.concat(Object.isArray(value)?value.flatten():[value]);});},without:function()
{var values=$A(arguments);return this.select(function(value){return!values.include(value);});},reverse:function(inline){return(inline!==false?this:this.toArray())._reverse();},reduce:function(){return this.length>1?this:this[0];},uniq:function(sorted)
{return this.inject([],function(array,value,index)
{if(0==index||(sorted?array.last()!=value:!array.include(value)))array.push(value);return array;});},intersect:function(array)
{return this.uniq().findAll(function(item){return array.detect(function(value){return item===value});});},clone:function(){return[].concat(this);},size:function(){return this.length;},inspect:function(){return'['+this.map(Object.inspect).join(', ')+']';},toJSON:function()
{var results=[];this.each(function(object)
{var value=Object.toJSON(object);if(!Object.isUndefined(value))results.push(value);});return'['+results.join(', ')+']';}});if(Object.isFunction(Array.prototype.forEach))Array.prototype._each=Array.prototype.forEach;if(!Array.prototype.indexOf)Array.prototype.indexOf=function(item,i)
{i||(i=0);var length=this.length;if(i<0)i=length+i;for(;i<length;i++)if(this[i]===item)return i;return-1;};if(!Array.prototype.lastIndexOf)Array.prototype.lastIndexOf=function(item,i)
{i=isNaN(i)?this.length:(i<0?this.length+i:i)+1;var n=this.slice(0,i).reverse().indexOf(item);return(n<0)?n:i-n-1;};Array.prototype.toArray=Array.prototype.clone;;function AudioPlayer()
{var self=this;this.disabled=false;this.basePath="";this.mp3Support=true;this.delayPlay=false;this.audioWrapper=null;this.locked=false;this.busy=false;this.startPlayTime=0;this.onend=null;this.createNewAudio=function()
{return document.createElement('audio');};this.init=function(path)
{this.basePath=path?path:"";this.delayPlay=("ontouchstart"in window);this.audioWrapper=this.createNewAudio();if(this.audioWrapper.canPlayType)this.mp3Support=this.audioWrapper.canPlayType('audio/mpeg')!="";else this.disabled=true;return!this.disabled;};this.play=function(file,loop)
{if(this.disabled)return false;var url=this.basePath+"/"+file+(this.mp3Support?".mp3":".ogg");this.stop();this.audioWrapper=this.createNewAudio();this.audioWrapper.src=url;this.audioWrapper.type=(this.mp3Support?"audio/mpeg":"audio/ogg");this.audioWrapper.loop=false;this.audioWrapper.doLoop=(loop?true:false);this.audioWrapper.preload="auto";this.audioWrapper.load();this.busy=true;this.audioWrapper.addEventListener("ended",this.controlPlay,false);if(this.delayPlay)this.audioWrapper.addEventListener("canplay",this.readyToPlay);else this.audioWrapper.play();this.startPlayTime=new Date().getTime();};this.readyToPlay=function(e)
{e.currentTarget.play();}
this.stop=function()
{this.busy=false;try
{this.audioWrapper.removeEventListener("canplay",this.readyToPlay);this.audioWrapper.pause();this.audioWrapper.currentTime=0.0;this.audioWrapper=null;}
catch(e){};};this.controlPlay=function()
{if(self.audioWrapper.doLoop)
{self.audioWrapper.pause();self.audioWrapper.currentTime=0.0;self.audioWrapper.play();}
else
{self.busy=false;if(typeof self.onend=="function")self.onend();}}}
function AudioMixer(path,channelsCount)
{this.channels=[];this.init=function(path,channelsCount)
{this.path=path;this.channels=[];for(var i=0;i<channelsCount;i++)
{this.channels[i]=new AudioPlayer(path);this.channels[i].init(path);}};this.play=function(file,loop,soft,channelID)
{var cID=-1;if(typeof channelID=="number")cID=channelID;else cID=this.getFreeChannel(soft);if(cID>=0&&cID<this.channels.length)
{this.channels[cID].stop();this.channels[cID].play(file,loop);}
return this.channels[cID];};this.stop=function(cID)
{if(cID>=0&&cID<this.channels.length)this.channels[cID].stop();};this.getFreeChannel=function(soft)
{var cID=-1;var freeChannels=[];var maxID=-1;var max=-1;var t=0;for(var i=0;i<this.channels.length;i++)
{if(!this.channels[i].locked)
{if(!this.channels[i].busy)freeChannels.push(i);else
{t=new Date().getTime();t-=this.channels[i].startPlayTime;if(t>max)
{max=t;maxID=i;}}}}
if(freeChannels.length==0)
{if(!soft&&max>=0)cID=max;}
else cID=freeChannels[0];return cID;};this.init(path,channelsCount);};var stage;var world;var GET;var LANDSCAPE_MODE=true;var bitmaps;var width=480;var height=320;var fps=25;var gameState=0;var STATE_GAME=1;var STATE_MENU=2;var STATE_SELECT_LEVEL=3;var STATE_GAME_LOGO=4;var STATE_ABOUT=5;var STATE_SPLASH=6;var field;var pause=false;var currentLevel=0;var screenWidthCoef;var screenHeightCoef;window.onload=function(){GET=Utils.parseGet();Utils.addMobileListeners(LANDSCAPE_MODE);Utils.mobileCorrectPixelRatio();Utils.addFitLayoutListeners();setTimeout(startLoad,600);}
function startLoad(){var resolution=Utils.getMobileScreenResolution(LANDSCAPE_MODE);if(GET["debug"]==1)resolution=Utils.getScaleScreenResolution(1,LANDSCAPE_MODE);Utils.globalScale=resolution.scale;var ratioCoefs=[1.5,1.6,1.66,1.7,1.78,1.33,1.52];var ratioWidth=[1,1.0666,1.106,1.133,1.187,1.0666,1.0666];var ratioHeight=[1,1,1,1,1,1.2,1.05];if(window.innerWidth>window.innerHeight)var coef=window.innerWidth/window.innerHeight;else var coef=window.innerHeight/window.innerWidth;var min=100000,minPos=-1,diff;for(var i=0;i<ratioCoefs.length-1;i++)
{diff=Math.abs(coef-ratioCoefs[i]);if(diff<min)
{min=diff;minPos=i;}}
if(window.innerHeight==768){minPos=5;}
else if(window.innerHeight==672)
{minPos=6;}
screenWidthCoef=ratioWidth[minPos];screenHeightCoef=ratioHeight[minPos];screenWidthRatioPos=minPos;resolution.width=Math.round(resolution.width*screenWidthCoef);resolution.height=Math.round(resolution.height*screenHeightCoef);Utils.createLayout(document.getElementById("main_container"),resolution);Utils.addEventListener("fitlayout",function(){if(stage){stage.drawScene(document.getElementById("screen"));buildBackground();}});Utils.addEventListener("lockscreen",function(){if(stage&&stage.started)stage.stop();});Utils.addEventListener("unlockscreen",function(){if(stage&&!stage.started)stage.start();});Utils.mobileHideAddressBar();if(GET["debug"]!=1)Utils.checkOrientation(LANDSCAPE_MODE);mixer=new AudioMixer("music",1);var preloader=new ImagesPreloader();var data=[];var path=Utils.imagesRoot+"/"+Utils.globalScale+"/";data.push({name:"splash_back",src:path+"splash.jpg"});data.push({name:'b1',src:path+'b1.png'});data.push({name:'b2',src:path+'b2.png'});data.push({name:'b3',src:path+'b3.png'});data.push({name:'b4',src:path+'b4.png'});data.push({name:'b5',src:path+'b5.png'});data.push({name:'b6',src:path+'b6.png'});data.push({name:'b7',src:path+'b7.png'});data.push({name:'b8',src:path+'b8.png'});data.push({name:'p50',src:path+'p50.png'});data.push({name:'p100',src:path+'p100.png'});data.push({name:'p150',src:path+'p150.png'});data.push({name:'b1_blured',src:path+'b1_blured.png'});data.push({name:'b2_blured',src:path+'b2_blured.png'});data.push({name:'b3_blured',src:path+'b3_blured.png'});data.push({name:'b4_blured',src:path+'b4_blured.png'});data.push({name:'b5_blured',src:path+'b5_blured.png'});data.push({name:'b6_blured',src:path+'b6_blured.png'});data.push({name:'b7_blured',src:path+'b7_blured.png'});data.push({name:'b8_blured',src:path+'b8_blured.png'});data.push({name:'platform',src:path+'platform.png'});data.push({name:'platform2',src:path+'platform2.png'});data.push({name:'platform3',src:path+'platform3.png'});data.push({name:'platform4',src:path+'platform4.png'});data.push({name:'platform5',src:path+'platform5.png'});data.push({name:'platform6',src:path+'platform6.png'});data.push({name:'platform7',src:path+'platform7.png'});data.push({name:'platform8',src:path+'platform8.png'});data.push({name:'blue_normal',src:path+'blue_normal.png'});data.push({name:'blue_large',src:path+'blue_large.png'});data.push({name:'blue_small',src:path+'blue_small.png'});data.push({name:'pink_normal',src:path+'pink_normal.png'});data.push({name:'pink_large',src:path+'pink_large.png'});data.push({name:'pink_small',src:path+'pink_small.png'});data.push({name:'coin',src:path+'coin.png'});data.push({name:'element1',src:path+'element1.png'});data.push({name:'element2',src:path+'element2.png'});data.push({name:'element3',src:path+'element3.png'});data.push({name:'element4',src:path+'element4.png'});data.push({name:'element5',src:path+'element5.png'});data.push({name:'element6',src:path+'element6.png'});data.push({name:'element7',src:path+'element7.png'});data.push({name:'element8',src:path+'element8.png'});data.push({name:'element9',src:path+'element9.png'});data.push({name:'element10',src:path+'element10.png'});data.push({name:'element11',src:path+'element11.png'});data.push({name:'element12',src:path+'element12.png'});data.push({name:'element13',src:path+'element13.png'});data.push({name:'element14',src:path+'element14.png'});data.push({name:'element15',src:path+'element15.png'});data.push({name:'element19',src:path+'element19.png'});data.push({name:'element20',src:path+'element20.png'});data.push({name:'element21',src:path+'element21.png'});data.push({name:'element22',src:path+'element22.png'});data.push({name:'element23',src:path+'element23.png'});data.push({name:'element24',src:path+'element24.png'});data.push({name:'element25',src:path+'element25.png'});data.push({name:'element26',src:path+'element26.png'});data.push({name:'element27',src:path+'element27.png'});data.push({name:'element28',src:path+'element28.png'});data.push({name:'element29',src:path+'element29.png'});data.push({name:'element30',src:path+'element30.png'});data.push({name:'element31',src:path+'element31.png'});data.push({name:'element32',src:path+'element32.png'});data.push({name:'element33',src:path+'element33.png'});data.push({name:'element34',src:path+'element34.png'});data.push({name:'element35',src:path+'element35.png'});data.push({name:'element36',src:path+'element36.png'});data.push({name:'element37',src:path+'element37.png'});data.push({name:'element38',src:path+'element38.png'});data.push({name:'element39',src:path+'element39.png'});data.push({name:'sound',src:path+'sound.png'});data.push({name:'back',src:path+'back.png'});data.push({name:'menu_round',src:path+'menu_round.png'});data.push({name:'blue_explosion',src:path+'blue_explosion.png'});data.push({name:'pink_explosion',src:path+'pink_explosion.png'});data.push({name:'track',src:path+'track.png'});data.push({name:'star',src:path+'star.png'});data.push({name:'icon_life',src:path+'icon_life.png'});data.push({name:'replay',src:path+'replay.png'});data.push({name:'play',src:path+'play.png'});data.push({name:'about_btn',src:path+'about_btn.png'});data.push({name:'pause_btn',src:path+'pause_btn.png'});data.push({name:'next',src:path+'next.png'});data.push({name:'level_select',src:path+'level_select.png'});data.push({name:'level_select2',src:path+'level_select2.png'});data.push({name:'blue_extralife',src:path+'blue_extralife.png'});data.push({name:'blue_plus',src:path+'blue+.png'});data.push({name:'blue2',src:path+'blue2.png'});data.push({name:'blue3',src:path+'blue3.png'});data.push({name:'pink_minus',src:path+'pink-.png'});data.push({name:'pink_extralife',src:path+'pink_extralife.png'});data.push({name:'pink_split',src:path+'pink_split.png'});data.push({name:'pink_plus',src:path+'pink+.png'});data.push({name:'pink2',src:path+'pink2.png'});data.push({name:'pink3',src:path+'pink3.png'});data.push({name:'shooter',src:path+'shooter.png'});data.push({name:'enemy_large',src:path+'enemy_large.png'});data.push({name:'enemy_normal',src:path+'enemy_normal.png'});data.push({name:'enemy_small',src:path+'enemy_small.png'});data.push({name:'platform_bubble',src:path+'platform_bubble.png'});data.push({name:'platform_bubble2',src:path+'platform_bubble2.png'});data.push({name:'back_menu',src:path+'back_menu.png'});data.push({name:'Bubble_Jumper_cover',src:path+"ratios/"+screenWidthRatioPos+'/Bubble-Jumper-cover.jpg'});data.push({name:'Level_Failed',src:path+"ratios/"+screenWidthRatioPos+'/Bubble_Jumper_Level_Failed.png'});data.push({name:'Level_Cleared',src:path+"ratios/"+screenWidthRatioPos+'/Bubble_Jumper_Level_Cleared.png'});data.push({name:'Pause_back',src:path+"ratios/"+screenWidthRatioPos+'/Bubble-Jumper-Pause.png'});data.push({name:'LvlBack1',src:path+"ratios/"+screenWidthRatioPos+'/LvlBack1.png'});data.push({name:'LvlBack2',src:path+"ratios/"+screenWidthRatioPos+'/LvlBack2.png'});data.push({name:'LvlBack3',src:path+"ratios/"+screenWidthRatioPos+'/LvlBack3.png'});data.push({name:'LvlBack4',src:path+"ratios/"+screenWidthRatioPos+'/LvlBack4.png'});data.push({name:'lvl_text',src:path+'lvl_text.png'});data.push({name:'score_text',src:path+'score_text.png'});data.push({name:'Select_lvl1',src:path+"ratios/"+screenWidthRatioPos+'/Select_lvl1.png'});data.push({name:'Select_lvl2',src:path+"ratios/"+screenWidthRatioPos+'/Select_lvl2.png'});data.push({name:'Select_lvl3',src:path+"ratios/"+screenWidthRatioPos+'/Select_lvl3.png'});data.push({name:'Instruction1',src:path+"ratios/"+screenWidthRatioPos+'/Bubble-Jumper-Instruction1.png'});data.push({name:'Instruction2',src:path+"ratios/"+screenWidthRatioPos+'/Bubble-Jumper-Instruction2.png'});data.push({name:'Instruction3',src:path+"ratios/"+screenWidthRatioPos+'/Bubble-Jumper-Instruction3.png'});data.push({name:'menu',src:path+"ratios/"+screenWidthRatioPos+'/menu.png'});data.push({name:'blue_normal_blur',src:path+'blue_normal_blur.png'});data.push({name:'blue_large_blur',src:path+'blue_large_blur.png'});data.push({name:'blue_small_blur',src:path+'blue_small_blur.png'});data.push({name:'pink_normal_blur',src:path+'pink_normal_blur.png'});data.push({name:'pink_large_blur',src:path+'pink_large_blur.png'});data.push({name:'pink_small_blur',src:path+'pink_small_blur.png'});data.push({name:'blue_double',src:path+'blue_double.png'});data.push({name:'blue_triple',src:path+'blue_triple.png'});data.push({name:'pink_double',src:path+'pink_double.png'});data.push({name:'pink_triple',src:path+'pink_triple.png'});data.push({name:'blue_double_blur',src:path+'blue_double_blur.png'});data.push({name:'blue_triple_blur',src:path+'blue_triple_blur.png'});data.push({name:'pink_double_blur',src:path+'pink_double_blur.png'});data.push({name:'pink_triple_blur',src:path+'pink_triple_blur.png'});data.push({name:'font1',src:path+'font1.png'});data.push({name:'about',src:path+'about.jpg'});data.push({name:'platform_horizontal_big',src:path+'platform_horizontal_big.png'});data.push({name:'platform_horizontal_small',src:path+'platform_horizontal_small.png'});data.push({name:'platform_vertical_big',src:path+'platform_vertical_big.png'});data.push({name:'platform2_vertical_triple',src:path+'platform2_vertical_triple.png'});data.push({name:'platform2_vertical_single',src:path+'platform2_vertical_single.png'});data.push({name:'platform2_horizontal_single',src:path+'platform2_horizontal_single.png'});data.push({name:'platform7_horizontal_short',src:path+'platform7_horizontal_short.png'});data.push({name:'platform7_horizontal_long',src:path+'platform7_horizontal_long.png'});data.push({name:'platform7_vertical',src:path+'platform7_vertical.png'});data.push({name:'enemy_moving_horizontal',src:path+'enemy_moving_horizontal.png'});data.push({name:'enemy_moving_vertical',src:path+'enemy_moving_vertical.png'});data.push({name:'element28_vertical',src:path+'element28_vertical.png'});data.push({name:'check',src:path+'check.png'});data.push({name:'lock',src:path+'lock.png'});data.push({name:'star_blue',src:path+'star_blue.png'});data.push({name:'star_yellow',src:path+'star_yellow.png'});preloader.load(data,loadImagesEnd,Utils.showLoadProgress);}
function loadImagesEnd(data){document.getElementById('progress_container').style.display='none';document.getElementById('screen_container').style.display='block';document.getElementById('screen_background_container').style.display='block';bitmaps=data;if(GET["debug"]!=1){showSplash();}}
function showSplash()
{gameState=STATE_SPLASH;createScene();}
function getStageWidth(){return Math.floor(480*screenWidthCoef);}
function getStageHeight(){return Math.floor(320*screenHeightCoef);}
function getStageCenter(){return getStageWidth()/2;}
function getStageHeightCenter(){return getStageHeight()/2;}
function createScene(){createStage();if(gameState==STATE_SPLASH){setBackColor("#fee002");mc=new Sprite(bitmaps.splash_back,480,getStageHeight());mc.x=getStageCenter();mc.y=getStageHeightCenter();mc.static=true;stage.addChild(mc);stage.setTimeout(function(){gameState=STATE_GAME_LOGO;createScene();},fps*3);}
if(gameState==STATE_GAME_LOGO){setBackColor("#4DDEFF");showGameLogo();}
if(gameState==STATE_MENU){setBackColor("#4DDEFF");showMenu();}
if(gameState==STATE_GAME){field=new GameField();field.init(currentLevel);}
if(gameState==STATE_SELECT_LEVEL){setBackColor("#EE60BA");showLevelSelect(1);}
if(gameState==STATE_ABOUT){setBackColor("#fee002");mc=new Sprite(bitmaps.about,480,getStageHeight());mc.x=getStageCenter();mc.y=getStageHeightCenter();mc.static=true;mc.onclick=function(){gameState=STATE_MENU;createScene();}
stage.addChild(mc);}
buildBackground();stage.start();}
function createStage(){if(stage){stage.destroy();stage.stop();}
stage=new Stage('screen',Math.round(480*screenWidthCoef),Math.round(320*screenHeightCoef));stage.delay=1000/fps;stage.showFPS=false;stage.pixelMouseDownEvent=true;}
function showGameLogo(){var logo=new Sprite(bitmaps.Bubble_Jumper_cover,getStageWidth(),getStageHeight());logo.x=getStageCenter();logo.y=getStageHeightCenter();logo.onclick=function(){gameState=STATE_MENU;createScene();}
stage.addChild(logo);}
function showMenu(){var background=new Sprite(bitmaps.menu,getStageWidth(),getStageHeight());background.x=getStageCenter();background.y=getStageHeightCenter();stage.addChild(background);var playButton=new Sprite(bitmaps.play,94,54);playButton.x=getStageCenter();playButton.y=getStageHeightCenter()+130;playButton.onclick=function(){createStage();showInstructions(1);buildBackground();stage.start();}
stage.addChild(playButton);var moreButton=new Sprite(bitmaps.more_btn,94,54);moreButton.x=getStageCenter()+180;moreButton.y=getStageHeightCenter()+130;moreButton.onclick=showMoreGames;stage.addChild(moreButton);var aboutButton=new Sprite(bitmaps.about_btn,94,54);aboutButton.x=getStageCenter()-180;aboutButton.y=getStageHeightCenter()+130;aboutButton.onclick=function(){gameState=STATE_ABOUT;createScene();}
stage.addChild(aboutButton);if(Utils.getCookie('soundOn')!=1){mixer.play('main_theme',true,false,0);}
addSoundIcon();}
function showInstructions(n){var background=new Sprite(bitmaps["Instruction"+n],getStageWidth(),getStageHeight());background.x=getStageCenter();background.y=getStageHeightCenter();background.onclick=function(){if(n==1){createStage();showInstructions(2);buildBackground();stage.start();}else if(n==2){createStage();showInstructions(3);buildBackground();stage.start();}else if(n==3){gameState=STATE_SELECT_LEVEL;createScene();}}
stage.addChild(background);var back_menu=new Sprite(bitmaps.back_menu,71,37);back_menu.x=getStageCenter()-190;back_menu.y=35;back_menu.onclick=function(){if(n==1){gameState=STATE_MENU;createScene();}else if(n==2){createStage();showInstructions(1);buildBackground();stage.start();}else if(n==3){createStage();showInstructions(2);buildBackground();stage.start();}}
stage.addChild(back_menu);var next=new Sprite(bitmaps.next,48,47);next.x=getStageCenter()+210;next.y=35;next.onclick=function(){if(n==1){createStage();showInstructions(2);buildBackground();stage.start();}else if(n==2){createStage();showInstructions(3);buildBackground();stage.start();}else if(n==3){gameState=STATE_SELECT_LEVEL;createScene();}}
stage.addChild(next);}
function getXLevelPosition(i){var n=[2,69,140,211,281,349,414,2,69,140,211,281,349,414,2,69,140,211,281,349,414,2,69,140,211,281,349,414,2,69,140,211,281,349,414,2,69,140,211,281,349,414,2,69,140,211,281,349,414,2,69,140,211,281,349,414,2,69,140,211,281,349,414,];return n[i]+getStageCenter()-190;}
function showLevelSelect(n){var background=new Sprite(bitmaps["Select_lvl"+n],getStageWidth(),getStageHeight());background.x=getStageCenter();background.y=getStageHeightCenter();stage.addChild(background);if(Utils.getCookie('maxLevelUnlocked')==undefined){Utils.setCookie('maxLevelUnlocked',1);}
var j;for(var i=21*(n-1);i<(21*n);i++){if((i>=0&&i<7)||(i>=21&&i<28)||(i>=42&&i<49)){if(i<7)j=getXLevelPosition(i);if(i>=21&&i<28)j=getXLevelPosition(i-21);if(i>=42&&i<49)j=getXLevelPosition(i-42);addTextAndSprite(j,getStageHeightCenter()-112,i);}else
if((i>=7&&i<14)||(i>=28&&i<35)||(i>=49&&i<56)){if(i<14)j=getXLevelPosition(i);if(i>=28&&i<35)j=getXLevelPosition(i-21);if(i>=49&&i<56)j=getXLevelPosition(i-42);addTextAndSprite(j,getStageHeightCenter()-19,i);}else
if((i>=14&&i<=20)||(i>=35&&i<=41)||(i>=56&&i<64)){if(i<21)j=getXLevelPosition(i);if(i>=35&&i<42)j=getXLevelPosition(i-21);if(i>=56&&i<64)j=getXLevelPosition(i-42);addTextAndSprite(j,getStageHeightCenter()+72,i);}}
var back_menu=new Sprite(bitmaps.back_menu,71,37);back_menu.x=getStageCenter()-190;back_menu.y=getStageHeightCenter()+135;back_menu.onclick=function(){if(n==1){gameState=STATE_MENU;createScene();}else if(n==2){createStage();setBackColor("#EE60BA");showLevelSelect(1);buildBackground();stage.start();}else if(n==3){createStage();setBackColor("#FF8D4D");showLevelSelect(2);buildBackground();stage.start();}}
stage.addChild(back_menu);if(n!=3){var next=new Sprite(bitmaps.next,48,47);next.x=getStageWidth()-30;next.y=getStageHeightCenter()+135;next.onclick=function(){if(n==1){createStage();setBackColor("#FF8D4D");showLevelSelect(2);buildBackground();stage.start();}else if(n==2){createStage();setBackColor("#57944E");showLevelSelect(3);buildBackground();stage.start();}}
stage.addChild(next);}
var total_score=(Utils.getCookie("total_score"))?Utils.getCookie("total_score"):0;showNumbers(total_score,getStageCenter()+170,getStageHeightCenter()+140);}
function addTextAndSprite(x,y,i){var l_u=Utils.getCookie('maxLevelUnlocked');var image=new Sprite(null,50,50);image.x=x-20;image.y=y;image.index=i+1;if(image.index<=l_u){image.onclick=function(e){currentLevel=e.target.index-1;gameState=STATE_GAME;createScene();}}
stage.addChild(image);if(l_u>image.index){var check=new Sprite(bitmaps.check,23,23);check.x=x;check.y=y+12;stage.addChild(check);}else if(l_u<image.index){var lock=new Sprite(bitmaps.lock,16,19);lock.x=x+3;lock.y=y-12;stage.addChild(lock);}
var stars=Utils.getCookie('starsOn'+image.index);stars=(stars==undefined)?0:stars;var star1=(stars>0)?new Sprite(bitmaps.star_yellow,16,16):new Sprite(bitmaps.star_blue,17,16);star1.setPosition(x-35,y+35);stage.addChild(star1);var star2=(stars>1)?new Sprite(bitmaps.star_yellow,16,16):new Sprite(bitmaps.star_blue,17,16);star2.setPosition(x-20,y+35);stage.addChild(star2);var star3=(stars>2)?new Sprite(bitmaps.star_yellow,16,16):new Sprite(bitmaps.star_blue,17,16);star3.setPosition(x-5,y+35);stage.addChild(star3);if(i>8)x+=8;showNumbers(image.index,x,y);}
function setCommonButtons(){var replay=new Sprite(bitmaps.replay,48,47);replay.x=getStageCenter();replay.y=getStageHeightCenter()+87;replay.onclick=function(){gameState=STATE_GAME;createScene();};stage.addChild(replay);var level_select=new Sprite(bitmaps.level_select,48,47);level_select.x=getStageCenter()-60;level_select.y=getStageHeightCenter()+87;level_select.onclick=function(){gameState=STATE_SELECT_LEVEL;createScene();};stage.addChild(level_select);}
function checkVictory(){if((field.levelBirdsSetting.length==0)&&(field.livesNumber>0)&&!field.figureOnField){var victory=new Sprite(bitmaps.Level_Cleared,getStageWidth(),getStageHeight());victory.x=getStageCenter();victory.y=getStageHeightCenter();victory.onclick=function(){return false;}
stage.addChild(victory);setCommonButtons();if(currentLevel!=63){var next=new Sprite(bitmaps.next,48,47);next.x=getStageCenter()+60;next.y=getStageHeightCenter()+87;next.onclick=function(){currentLevel++;gameState=STATE_GAME;createScene();};stage.addChild(next);}
var highscore=Utils.getCookie("highscore"+currentLevel);if(field.levelScore>=highscore){Utils.setCookie("highscore"+currentLevel,field.levelScore);var current_score=eval(Utils.getCookie("total_score"));var total_score=current_score+field.levelScore;Utils.setCookie("total_score",total_score);}
showNumbers(currentLevel+1,getStageCenter()+75,getStageHeightCenter()-120);showNumbers(field.levelScore,getStageCenter()+115,195);showNumbers(Utils.getCookie("highscore"+currentLevel),getStageCenter()+120,getStageHeightCenter()+130);if(Utils.getCookie('maxLevelUnlocked')<currentLevel+2){Utils.setCookie('maxLevelUnlocked',currentLevel+2);}
Utils.setCookie('starsOn'+parseInt(currentLevel+1),field.livesNumber);field.gameIsFinished=true;field.locked=true;return;}
if((field.levelBirdsSetting.length>=0)&&(field.livesNumber==0)){var gameOver=new Sprite(bitmaps.Level_Failed,getStageWidth(),getStageHeight());gameOver.x=getStageCenter();gameOver.y=getStageHeightCenter();gameOver.onclick=function(){return false;}
stage.addChild(gameOver);showNumbers(currentLevel+1,getStageCenter()+80,getStageHeightCenter()-83);setCommonButtons();field.locked=true;}}
function step(){if(field.locked)return;checkVictory();field.addRandomFigures();field.checkIfHit();for(var i=0;i<stage.objects.length;i++){var spr=stage.objects[i];if(spr.isBubble){var dY=42+(getStageHeight()-320);if((spr.isBubble)&&(Math.floor(spr.y)<dY)){spr.toDestroy=true;field.bubbleArray.shift();}
for(n=0;n<stage.objects.length;n++){if(i!=n&&stage.objects[n].ignoreHit&&!stage.objects[n].isBonus&&stage.hitTest(spr,stage.objects[n])){spr.toDestroy=true;field.bubbleArray.shift();}}}
if(spr.isSticky)spr.rotateBy(Math.PI/100);if(spr.shadow&&!spr.isSticked){var linVel=spr.box2dBody.m_linearVelocity.y;var shift=(spr.direction=='right')?-5:5;spr.shadow.visible=((linVel>150)||(linVel<-150))?true:false;spr.shadow.x=(spr.isBird)?spr.x+shift:spr.x;spr.shadow.y=spr.y;if(spr.isBird&&!spr.toDestroy){if(spr.y<20)continue;var pos=spr.box2dBody.GetCenterPosition();pos.y-=((linVel>=1)||(linVel<=-1))?1:0;pos.y-=(linVel==0)?1:0;spr.box2dBody.SetCenterPosition(pos,0);}}
if(spr.isMoving){if(spr.box2dBody)var pos=spr.box2dBody.GetCenterPosition();var mPoint=spr.movingPoint;switch(mPoint.direction){case'right':if(spr.x>=mPoint.destination){mPoint.direction='left';mPoint.destination-=mPoint.length;}else{if(spr.box2dBody){pos.x+=1;spr.box2dBody.SetCenterPosition(pos,0);}else{spr.x+=1;}}
break;case'left':if(spr.x<=mPoint.destination){mPoint.direction='right';mPoint.destination+=mPoint.length;}else{if(spr.box2dBody){pos.x-=1;spr.box2dBody.SetCenterPosition(pos,0);}else{spr.x-=1;}}
break;case'up':if(spr.y<=mPoint.destination){mPoint.direction='down';mPoint.destination+=mPoint.length;}else{if(spr.box2dBody){pos.y-=1;spr.box2dBody.SetCenterPosition(pos,0);}else{spr.y-=1;}}
break;case'down':if(spr.y>=mPoint.destination){mPoint.direction='up';mPoint.destination-=mPoint.length;}else{if(spr.box2dBody){pos.y+=1;spr.box2dBody.SetCenterPosition(pos,0);}else{spr.y+=1;}}
break;}}}
for(var i=0,j=field.birdsArray.length;i<j;i++){var obj=field.birdsArray[i];if(obj==undefined||obj.toDestroy||obj.isSticked)continue;var pos=obj.box2dBody.GetCenterPosition();var vel=obj.box2dBody.m_linearVelocity;if((obj.direction=='right')&&(vel.x<0))vel.x=0;else if((obj.direction=='left')&&(vel.x>0))vel.x=0;pos.x+=(obj.direction=='right')?field.levelSpeed:-field.levelSpeed;obj.box2dBody.SetCenterPosition(pos,0);}
for(var i=0,j=stage.objects.length;i<j;i++){var obj=stage.objects[i];if(obj.y>getStageHeight()-60){if(obj.isBird&&!obj.toDestroy){if(field.livesNumber>0){field.livesNumber-=1;field.livesImageArray[field.livesImageArray.length-1].destroy=true;field.livesImageArray.pop();obj.toDestroy=true;}}
if(obj.y>getStageHeight())obj.toDestroy=true;}else if((obj.x>(getStageWidth()+50)||obj.x<-50)){if(obj.isBird&&!obj.toDestroy){if(obj.y>=getStageHeightCenter()-20&&obj.y<getStageHeightCenter()+50){field.levelScore+=50;addPointAnimation(obj,50);}else if(obj.y>=getStageHeightCenter()-90&&obj.y<getStageHeightCenter()-20){field.levelScore+=100;addPointAnimation(obj,100);}else if(obj.y<=70){field.levelScore+=150;addPointAnimation(obj,150);}}
obj.toDestroy=true;field.showScore();}
if(obj.addingInitianted||currentLevel<24)continue;if((obj.x>getStageWidth()-30&&obj.direction=='right')||(obj.x<30&&obj.direction=='left')){if(field.birdsArray.length<2){obj.addingInitianted=true;field.figureOnField=false;}}}}
function mainLoop(){if(gameState!=STATE_GAME)return;if(pause)return false;if(field.locked)return false;world.Step(1/38,1);step();world.Step(1/38,1);step();stage.box2dSync(world);}
function buildBackground(){if(stage)stage.drawScene(document.getElementById("screen_background"),true);}
function findObject(name){for(var i=0;i<objects.length;i++){if(objects[i].name==name)return objects[i];}
return false;}
function deleteObject(sprite){if(sprite.index!=undefined)
field.gunsArray[sprite.index].isLocked=false;if(sprite.isBird){for(var i=0;i<field.birdsArray.length;i++){if(field.birdsArray[i].guid==sprite.guid){field.birdsArray.splice(i,1);}}}
sprite.destroy=true;if(sprite.shadow)sprite.shadow.destroy=true;if(sprite.track)sprite.track.destroy=true;if(sprite.box2dBody){world.DestroyBody(sprite.box2dBody);}}
function debugDraw(){if(field.locked||pause)return false;for(var i=0;i<stage.objects.length;i++){if(stage.objects[i].toDestroy){deleteObject(stage.objects[i]);}}
if(field.birdsArray.length<1)field.figureOnField=false;}
function startLevel(n,data){createStage();field=new GameField();field.init(n,data);buildBackground();stage.start();}
var cY;var GameField=function(){var self=this;this.impulse=150000*1.5*20;var angle=-1.570796;this.bubbleArray=[];this.birdsArray=[];this.gunsArray=[];this.spawnArray=[];this.rotatingArray=[];this.movingPlatformArray=[];this.stickyArray=[];this.figureOnField=false;this.locked=false;this.levelBirdsSetting=[];this.levelScore=0;this.scoreTextArray=[];this.shellType='normal';this.init=function(id,data){world=box2DCreateWorld();b2Settings.b2_timeToSleep=0.05;b2Settings.b2_linearSleepTolerance=1;b2Settings.b2_angularSleepTolerance=0.1;createStage();pause=false;self.fillSpawnArray();self.fillGameBackground();self.createLevelObjects(id,data);self.livesNumber=3;self.levelBirdsSetting=levelSet[currentLevel].slice();self.levelSpeed=self.getSpeed();self.addRandomFigures();gameState=STATE_GAME;buildBackground();stage.start();}
this.fillGameBackground=function(){self.backColor=getBackColor(currentLevel+1);switch(self.backColor){case 1:setBackColor("#EE60BA");break;case 2:setBackColor("#FF8D4D");break;case 3:setBackColor("#57944E");break;case 4:setBackColor("#5489C9");break;}
var bImage=new Sprite(bitmaps["LvlBack"+self.backColor],getStageWidth(),getStageHeight());bImage.x=getStageCenter();bImage.y=getStageHeightCenter();bImage.static=true;stage.addChild(bImage);var lvl_text=new Sprite(bitmaps.lvl_text,57,22);lvl_text.x=getStageCenter()-165;lvl_text.y=15;lvl_text.static=true;stage.addChild(lvl_text);showNumbers(currentLevel+1,getStageCenter()-93,15);self.showScore();stage.onpretick=mainLoop;stage.onposttick=debugDraw;self.livesImageArray=[];for(var i=0;i<3;i++){var health=new Sprite(bitmaps.icon_life,17,21);health.x=getStageCenter()-90+i*20;health.y=15;self.livesImageArray.push(health);stage.addChild(health);}
var pause_btn=new Sprite(bitmaps.pause_btn,39,38);pause_btn.x=20;pause_btn.y=20;pause_btn.onclick=function(){if(pause){pause=false;}
else if(!pause){pause=true;var pause_back=new Sprite(bitmaps.Pause_back,getStageWidth(),getStageHeight());pause_back.x=getStageCenter();pause_back.y=getStageHeightCenter();pause_back.onclick=function(){return false};stage.addChild(pause_back);var menu_r=new Sprite(bitmaps.menu_round,49,48);menu_r.x=getStageCenter()+80;menu_r.y=getStageHeightCenter();menu_r.onclick=function(){gameState=STATE_SELECT_LEVEL;createScene();}
stage.addChild(menu_r);var back=new Sprite(bitmaps.back,49,48);back.x=getStageCenter()-80;back.y=getStageHeightCenter();back.onclick=function(e){e.target.destroy=true;pause_back.destroy=true;menu_r.destroy=true;replay.destroy=true;sound.destroy=true;pause=false;}
stage.addChild(back);var replay=new Sprite(bitmaps.replay,49,48);replay.x=getStageCenter();replay.y=getStageHeightCenter();replay.onclick=function(){pause=false;gameState=STATE_GAME;createScene();};stage.addChild(replay);var sound=addSoundIcon(getStageCenter(),getStageHeightCenter()+80);}}
stage.addChild(pause_btn);var level_select2=new Sprite(bitmaps.level_select2,36,35);level_select2.x=getStageWidth()-20;level_select2.y=20;level_select2.onclick=function(){gameState=STATE_SELECT_LEVEL;createScene();};stage.addChild(level_select2);self.score_text=new Sprite(bitmaps.score_text,63,22);self.score_text.x=getStageCenter()+80;self.score_text.y=15;stage.addChild(self.score_text);}
this.showScore=function(){self.clearScore();showNumbers(field.levelScore,getStageCenter()+190,15,true);}
this.clearScore=function(){if(self.scoreTextArray.length>0){for(var i=0,j=self.scoreTextArray.length;i<j;i++){self.scoreTextArray[i].destroy=true;}
self.scoreTextArray=[];}}
this.createGun=function(gun){gun.index=self.gunsArray.length;gun.isLocked=false;gun.onclick=function(e){self.shootBubble(e);}
self.gunsArray.push(gun);stage.setZIndex(gun,100);}
this.shootBubble=function(e){if(e.target.isLocked)return;if(self.locked)return;var color=(self.backColor!=1)?"pink_":"blue_";var type=color+self.shellType;var mc=self.createObject({type:type,x:e.target.x+2,y:e.target.y-10,rotation:0},true);mc.isBubble=true;mc.index=e.target.index;self.bubbleArray.push(mc);stage.setZIndex(mc,50);var w,h;switch(self.shellType){case"normal":w=31;h=40;break;case"large":w=39;h=50;break;case"small":w=21;h=33;break;case"double":w=48;h=42;break;case"triple":w=64;h=42;break;}
mc.shadow=new Sprite(bitmaps[color+field.shellType
+"_blur"],w,h);mc.shadow.x=mc.x;mc.shadow.y=mc.y;mc.shadow.visible=true;stage.addChild(mc.shadow);var ball=mc.box2dBody;ball.ApplyImpulse(new b2Vec2(Math.cos(angle)*self.impulse,Math.sin(angle)*self.impulse),new b2Vec2(500,500));ball.SetAngularVelocity(0);ball.m_rotation0=0;ball.m_rotation=0;mc.track=new Sprite(bitmaps.track,24,71);mc.track.x=e.target.x+2;mc.track.y=e.target.y-50;stage.addChild(mc.track);stage.setZIndex(mc.track,-100);e.target.isLocked=true;}
this.createLevelObjects=function(id,data){var levelObjs;if(data){levelObjs=data.objects;levels=[data];gameState=STATE_GAME;}
else levelObjs=levels[id].objects;for(var i=0;i<levelObjs.length;i++){self.createObject(levelObjs[i]);}
createMovingPlatforms();}
this.createObject=function(obj,relative){var lo,ob,body,points,density,restitution,friction,x,y,width,height;lo=obj;ob=findObject(lo.type);mc=new Sprite(bitmaps[ob.name],ob.width,ob.height,ob.frames);var cX=(relative)?0:(getStageWidth()-480)/2;cY=(relative)?0:(getStageHeight()-320);mc.x=lo.x+cX;mc.y=lo.y+cY;mc.rotation=lo.rotation;stage.addChild(mc);stage.setZIndex(mc,10);mc.ignoreHit=true;density=lo.density?lo.density:ob.density;restitution=lo.restitution?lo.restitution:ob.restitution;friction=lo.friction?lo.friction:ob.friction;width=ob.bodyWidth?ob.bodyWidth:ob.width;height=ob.bodyHeight?ob.bodyHeight:ob.height;x=lo.x+cX;y=lo.y+cY;if(ob.bodyPosCorrect){x+=ob.bodyPosCorrect.x;y+=ob.bodyPosCorrect.y;mc.syncX=ob.bodyPosCorrect.x;mc.syncY=ob.bodyPosCorrect.y;mc.onbox2dsync=spritesSync;}
if(ob.bodyType==BOX)body=box2DCreateBox(world,x,y,width/2,height/2,lo.rotation,ob.fixed,density,restitution,friction);if(ob.bodyType==CIRCLE)body=box2DCreateCircle(world,x,y,width/2,lo.rotation,ob.fixed,density,restitution,friction);if(ob.bodyType==POLY)body=box2DCreatePoly(world,x,y,ob.points,lo.rotation,ob.fixed,density,restitution,friction);if(ob.bodyType==DOUBLE_CIRCLE)body=box2DCreateDoubleCircle(world,x,y,width/2,lo.rotation,ob.fixed,density,restitution,friction);if(ob.bodyType==TRIPLE_CIRCLE)body=box2DCreateTripleCircle(world,x,y,width/2,lo.rotation,ob.fixed,density,restitution,friction);if(ob.type==BONUS){mc.isBonus=true;mc.bonusType=ob.bonusType;stage.setZIndex(mc,500);}
if(ob.type==JUMP)mc.isJump=true;if(ob.type==STICKY){mc.isSticky=true;self.stickyArray.push(mc);}
if(ob.type==GUN){mc.ignoreHit=false;self.createGun(mc);}
if(ob.isMoving){mc.forJump=ob.forJump;mc.length=ob.length;mc.upLimit=lo.custom;mc.moveType=ob.moveType;mc.jumpSmall=ob.jumpSmall;mc.isTriple=ob.isTriple;self.movingPlatformArray.push(mc);}
if(ob.joints){for(var n=0;n<ob.joints.length;n++)
{if(ob.joints[n].type=="pivot")
{var point=new Vector(ob.joints[n].x,ob.joints[n].y);if(lo.rotation!=0)point.rotate(-lo.rotation);point.x+=lo.x;point.y+=lo.y;var pivot=box2DCreateCircle(world,point.x+cX,point.y+cY,1,0,true,0.01,0,0);box2DCreateRevoluteJoint(world,pivot,body,pivot.GetCenterPosition());}}}
if(body)body.sprite=mc;mc.box2dBody=body;mc.obType=ob.type;if(mc.obType==PLATFORM)stage.setZIndex(mc,100);else if(mc.obType==BIRD)stage.setZIndex(mc,600);mc.grav=false;return mc;}
this.addRandomFigures=function(){if(self.figureOnField||self.locked)return;rand=Math.floor(Math.random()*self.spawnArray.length);var ySpawn=self.spawnArray[rand]-45;rand=Math.floor(Math.random()*self.levelBirdsSetting.length);var direction=(Math.random()<=0.7)?'right':'left';var xSpawn=(direction=='right')?-15:getStageWidth();var obj=self.createObject({type:"b"+self.levelBirdsSetting[rand],x:xSpawn,y:ySpawn,rotation:0});obj.isBird=true;obj.guid=(new Date().getMilliseconds())*Math.random();obj.birdNumber=self.levelBirdsSetting[rand];obj.scaleX=(direction=='right')?1:-1;obj.direction=direction;obj.box2dBody.fixedRotation=true;obj.onclick=function(e){if(e.target.isSticked){e.target.isSticked=false;e.target.angle=undefined;var ball=e.target.box2dBody;ball.WakeUp();var force=new b2Vec2(0,-100);ball.SetLinearVelocity(force);ball.SetAngularVelocity(0);ball.m_rotation0=0;ball.m_rotation=0;setTimeout(function(){e.target.isSticked=undefined;},600);}}
obj.shadow=new Sprite(bitmaps["b"+self.levelBirdsSetting[rand]+"_blured"],41,36);obj.shadow.x=obj.x;obj.shadow.y=obj.y;obj.shadow.scaleX=(direction=='right')?1:-1;obj.shadow.visible=false;stage.addChild(obj.shadow);stage.setZIndex(obj.shadow,-50);self.levelBirdsSetting.splice(rand,1);self.birdsArray.push(obj);self.figureOnField=true;}
this.getSpeed=function(){var s;s=speed[currentLevel]/2.85;return s;}
this.fillSpawnArray=function(){self.spawnArray=[];for(var i=0,j=levels[currentLevel].objects.length;i<j;i++){var levelObj=levels[currentLevel].objects;if((levelObj[i].type.indexOf("platform")!=-1)&&(levelObj[i].x<80)){self.spawnArray.push(levelObj[i].y);}
if((levelObj[i].type.indexOf("platform")!=-1)&&(levelObj[i].x<(getStageCenter()+160))){self.spawnArray.push(levelObj[i].y);}}}
this.checkIfHit=function(){for(i=0;i<stage.objects.length;i++){for(n=0;n<stage.objects.length;n++){if(i!=n&&stage.objects[i].isBird&&stage.objects[n].isBubble){if(self.checkDistanceRound(stage.objects[i],stage.objects[n],11)){stage.objects[n].toDestroy=true;var ball=stage.objects[i].box2dBody;var force=new b2Vec2(0,-200);ball.SetLinearVelocity(force);var explosion=new Sprite(bitmaps.blue_explosion,48,40);explosion.x=(stage.objects[i].x+stage.objects[n].x)/2;explosion.y=(stage.objects[i].y+stage.objects[n].y)/2;stage.addChild(explosion);explosion.toDestroy=true;ball.SetAngularVelocity(0);ball.m_rotation0=0;ball.m_rotation=0;}}
if(i!=n&&stage.objects[i].isBird&&stage.objects[n].isBonus){if(stage.hitTest(stage.objects[i],stage.objects[n])){stage.objects[n].toDestroy=true;stage.objects[n].isBonus=false;getBonus(stage.objects[n],stage.objects[i]);}}
if(i!=n&&stage.objects[i].isBird&&stage.objects[n].isJump){if(self.checkDistanceRound(stage.objects[i],stage.objects[n],3)&&((stage.objects[i].y-2)<stage.objects[n].y)){var ball=stage.objects[i].box2dBody;var force=new b2Vec2(0,-200);ball.SetLinearVelocity(force);ball.SetAngularVelocity(0);var explosion=new Sprite(bitmaps.pink_explosion,48,40);explosion.x=(stage.objects[i].x+stage.objects[n].x)/2;explosion.y=(stage.objects[i].y+stage.objects[n].y)/2;stage.addChild(explosion);explosion.toDestroy=true;}}
if(i!=n&&stage.objects[i].isBird&&stage.objects[n].isSticky){if(stage.hitTest(stage.objects[i],stage.objects[n])){if(stage.objects[i].isSticked==undefined){stage.objects[i].box2dBody.GoToSleep();stage.objects[i].isSticked=true;stage.objects[i].shadow.visible=false;}else if(stage.objects[i].isSticked){var pos1=getRotatingPosition(stage.objects[n],stage.objects[i]);stage.objects[i].box2dBody.SetCenterPosition(pos1,0);}}}}}}
this.checkDistance=function(obj1,obj2){var centerDistance=getDistance(obj1,obj2);var distanceToHit=obj1.width/2+obj2.width/2+7;if(centerDistance<=distanceToHit)return true;}
this.checkDistanceRound=function(obj1,obj2,dist){if(!dist)dist=0;var centerDistance=getDistance(obj1,obj2);var distanceToHit=obj1.box2dBody.m_shapeList.m_radius+
obj2.box2dBody.m_shapeList.m_radius+dist;if(centerDistance<=distanceToHit)return true;}}
function getRotatingPosition(obj1,obj2){if(!obj2.angle){var pos_1=obj2.box2dBody.GetCenterPosition();var dx=obj1.x-pos_1.x;var dy=obj1.y-pos_1.y;var pos={x:pos_1.x+dx/2,y:pos_1.y+dy/2};var dx_1=obj1.x-pos.x;var dy_1=obj1.y-pos.y;if(dx_1>0&&dy_1<0)obj2.angle=90+45;else if(dx_1>0&&dy_1>0)obj2.angle=65+90;else if(dx_1<0&&dy_1<0)obj2.angle=65-90;else if(dx_1<0&&dy_1>0)obj2.angle=65-180;else obj2.angle=Math.floor(Math.atan(dy_1/dx_1)*180/Math.PI);}
var R1=obj1.width/3;var R2=obj2.width/3;if(obj2.angle>=180)obj2.angle=-360;obj2.angle+=0.03;var dx1=Math.cos(obj2.angle)*(R1+R2);var dy1=Math.sin(obj2.angle)*(R1+R2);var x2=obj1.x+dx1;var y2=obj1.y+dy1;return{x:x2,y:y2};}
function getDistance(obj1,obj2){return Math.sqrt((obj2.x-obj1.x)*(obj2.x-obj1.x)
+(obj2.y-obj1.y)*(obj2.y-obj1.y));}
function getAngle(dx,dy){return Math.atan2(dy,dx);}
function addPointAnimation(obj,n){var a=Math.floor(obj.x);var b=Math.floor(obj.y);if(a<30)a=30;if(a>(getStageWidth()-30))a=getStageWidth()-30;var spr=new Sprite(bitmaps["p"+n],33,15);spr.x=a;spr.y=b-10;stage.addChild(spr);spr.moveBy(0,-5,10,20,function(){spr.destroy=true;},null);}
function getBonus(spr,bird){var a=spr.bonusType;switch(a){case 1:field.levelScore+=100;field.showScore();addPointAnimation(spr,100);break;case 2:field.levelScore+=50;field.showScore();addPointAnimation(spr,50);break;case 3:field.livesNumber+=1;var health=new Sprite(bitmaps.icon_life,17,21);health.x=getStageCenter()-90+field.livesImageArray.length*20;health.y=15;field.livesImageArray.push(health);stage.addChild(health);break;case 4:var obj=field.createObject({type:"b"+bird.birdNumber,x:spr.x,y:spr.y,rotation:0});obj.isBird=true;obj.scaleX=bird.scaleX;obj.guid=(new Date().getMilliseconds())*Math.random();obj.shadow=new Sprite(bitmaps["b"+bird.birdNumber+"_blur"],46,41);obj.shadow.x=obj.x;obj.shadow.y=obj.y;obj.shadow.visible=false;obj.direction=bird.direction;obj.onclick=function(e){if(e.target.isSticked){e.target.isSticked=false;var ball=e.target.box2dBody;ball.WakeUp();var force=new b2Vec2(0,-100);ball.SetLinearVelocity(force);ball.SetAngularVelocity(0);ball.m_rotation0=0;ball.m_rotation=0;setTimeout(function(){e.target.isSticked=undefined;},600);}}
stage.addChild(obj.shadow);obj.isBonusFigure=true;field.birdsArray.push(obj);field.figureOnField=true;break;case 5:field.shellType="large";field.impulse=4500000*1.585;setTimeout(function(){field.shellType="normal";field.impulse=4500000;},20000);break;case 6:field.shellType="double";field.impulse=4500000*2;setTimeout(function(){field.shellType="normal";field.impulse=4500000;},20000);break;case 7:field.shellType="triple";field.impulse=4500000*3;setTimeout(function(){field.shellType="normal";field.impulse=4500000;},20000);break;case 8:field.shellType="small";field.impulse=4500000*0.396;setTimeout(function(){field.shellType="normal";field.impulse=4500000;},20000);break;case 9:field.livesNumber-=1;field.livesImageArray[field.livesImageArray.length-1].destroy=true;field.livesImageArray.pop();bird.toDestroy=true;break;default:break;}}
function addSoundIcon(x,y){var sound=new Sprite(bitmaps.sound,35,35);sound.x=(x==undefined)?30:x;sound.y=(y==undefined)?20:y;if(Utils.getCookie('soundOn')==1)sound.gotoAndStop(0);else sound.gotoAndStop(1);sound.state=1;sound.onclick=function(){if(Utils.getCookie('soundOn')==1){sound.gotoAndStop(1);mixer.play('main_theme',true,false,0);Utils.setCookie('soundOn',0);}else{sound.gotoAndStop(0);mixer.stop(0);Utils.setCookie('soundOn',1);}}
stage.addChild(sound);return sound;}
function box2DCreateDoubleCircle(world,x,y,radius,rotation,fixed,density,restitution,friction)
{if(typeof(fixed)=='undefined')fixed=true;var ballSd=new b2CircleDef();ballSd.localPosition.x-=8;if(!fixed)
{ballSd.density=density?density:0.8;ballSd.restitution=restitution?restitution:0.1;ballSd.friction=friction?friction:3;}
ballSd.radius=radius;var ballSd2=new b2CircleDef();ballSd2.localPosition.x+=8;if(!fixed)
{ballSd2.density=density?density:0.8;ballSd2.restitution=restitution?restitution:0.1;ballSd2.friction=friction?friction:3;}
ballSd2.radius=radius;var ballBd=new b2BodyDef();ballBd.rotation=rotation;ballBd.AddShape(ballSd);ballBd.AddShape(ballSd2);ballBd.position.Set(x,y);return world.CreateBody(ballBd);}
function box2DCreateTripleCircle(world,x,y,radius,rotation,fixed,density,restitution,friction)
{if(typeof(fixed)=='undefined')fixed=true;var ballSd=new b2CircleDef();if(!fixed)
{ballSd.density=density?density:0.8;ballSd.restitution=restitution?restitution:0.1;ballSd.friction=friction?friction:3;}
ballSd.radius=radius;var ballSd2=new b2CircleDef();ballSd2.localPosition.x+=16;if(!fixed)
{ballSd2.density=density?density:0.8;ballSd2.restitution=restitution?restitution:0.1;ballSd2.friction=friction?friction:3;}
ballSd2.radius=radius;var ballSd3=new b2CircleDef();ballSd3.localPosition.x-=16;if(!fixed)
{ballSd3.density=density?density:0.8;ballSd3.restitution=restitution?restitution:0.1;ballSd3.friction=friction?friction:3;}
ballSd3.radius=radius;var ballBd=new b2BodyDef();ballBd.rotation=rotation;ballBd.AddShape(ballSd);ballBd.AddShape(ballSd2);ballBd.AddShape(ballSd3);ballBd.position.Set(x,y);return world.CreateBody(ballBd);}
function showNumbers(text,x,y,n){var font=bitmaps.font1;text+="";for(var i=text.length;i>0;i--){mc=new Sprite(font,17,30,10);mc.gotoAndStop(text.substr(text.length-i,1));mc.x=x-i*17;mc.y=y;stage.addChild(mc);if(n)field.scoreTextArray.push(mc);}}
function getBackColor(n){var i;switch(n){case 1:case 2:case 3:case 4:case 5:case 16:case 17:case 18:case 19:case 20:case 31:case 32:case 33:case 34:case 35:case 46:case 47:case 48:case 49:case 50:i=1;break;case 6:case 7:case 8:case 9:case 10:case 21:case 22:case 23:case 24:case 25:case 36:case 37:case 38:case 39:case 40:i=2;break;case 11:case 12:case 13:case 14:case 15:case 26:case 27:case 28:case 29:case 30:case 41:case 42:case 43:case 44:case 45:i=3;break;case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 58:case 59:case 60:case 61:case 62:case 63:i=4;break;}
return i;}
function setBackColor(color){document.getElementById("screen_background_container").style.background=color;document.body.style.background=color;}
function showMoreGames(){window.open(MORE_GAMES_URL);}
function createMovingPlatforms(){if(field.movingPlatformArray.length>0){for(var i=0;i<field.movingPlatformArray.length;i++){var spr=field.movingPlatformArray[i];var direction;var length=spr.length;var dest,dest2;var cX=(getStageWidth()-480)/2;if(spr.moveType==0){direction=(spr.x>=getStageCenter())?"right":"left";var x=cX+parseInt(spr.upLimit);dest=(direction=='right')?x:x-length;dest2=(direction=='right')?x:x-length;}else{direction=(spr.y<=getStageHeightCenter())?"up":"down";dest=(direction=='up')?spr.upLimit-length:spr.upLimit;dest2=(direction=='up')?spr.upLimit-length-16:spr.upLimit-16;}
spr.isMoving=true;spr.movingPoint={direction:direction,destination:dest,length:length};if(spr.forJump){var type=(spr.jumpSmall)?"platform_bubble2":"platform_bubble";spr.jumpElem=field.createObject({type:type,x:spr.x,y:spr.y-16,rotation:0},true);stage.setZIndex(spr.jumpElem,5);spr.jumpElem.isMoving=true;spr.jumpElem.movingPoint={direction:direction,destination:dest2,length:length};if(spr.isTriple){spr.jumpElem2=field.createObject({type:'platform_bubble',x:spr.x-45,y:spr.y-16,rotation:0},true);stage.setZIndex(spr.jumpElem2,5);spr.jumpElem2.isMoving=true;spr.jumpElem2.movingPoint={direction:direction,destination:dest2,length:length};spr.jumpElem3=field.createObject({type:'platform_bubble',x:spr.x+45,y:spr.y-16,rotation:0},true);stage.setZIndex(spr.jumpElem3,5);spr.jumpElem3.isMoving=true;spr.jumpElem3.movingPoint={direction:direction,destination:dest2,length:length};}}}}};var levels=[{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:240,y:167,rotation:0},{type:"star",x:240,y:117,rotation:0},{type:"star",x:239,y:218,rotation:0},{type:"star",x:240,y:67,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:240,y:167,rotation:0},{type:"star",x:240,y:117,rotation:0},{type:"star",x:239,y:218,rotation:0},{type:"star",x:240,y:67,rotation:0},{type:"star",x:305,y:167,rotation:0},{type:"star",x:305,y:117,rotation:0},{type:"star",x:175,y:167,rotation:0},{type:"star",x:175,y:117,rotation:0},{type:"coin",x:305,y:67,rotation:0},{type:"coin",x:175,y:67,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:240,y:167,rotation:0},{type:"star",x:240,y:117,rotation:0},{type:"star",x:120,y:210,rotation:0},{type:"star",x:120,y:70,rotation:0},{type:"star",x:305,y:167,rotation:0},{type:"star",x:305,y:117,rotation:0},{type:"star",x:175,y:167,rotation:0},{type:"star",x:175,y:117,rotation:0},{type:"star",x:360,y:210,rotation:0},{type:"star",x:360,y:70,rotation:0},{type:"coin",x:360,y:143,rotation:0},{type:"coin",x:120,y:143,rotation:0},{type:"blue_extralife",x:239,y:67,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:240,y:156,rotation:0},{type:"star",x:240,y:100,rotation:0},{type:"star",x:150,y:100,rotation:0},{type:"star",x:180,y:100,rotation:0},{type:"star",x:305,y:167,rotation:0},{type:"star",x:270,y:100,rotation:0},{type:"star",x:175,y:167,rotation:0},{type:"star",x:210,y:100,rotation:0},{type:"star",x:330,y:100,rotation:0},{type:"star",x:300,y:100,rotation:0},{type:"star",x:240,y:55,rotation:0},{type:"platform_bubble2",x:241,y:195,rotation:0},{type:"platform7",x:241,y:211,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:240,y:156,rotation:0},{type:"star",x:150,y:100,rotation:0},{type:"star",x:180,y:70,rotation:0},{type:"star",x:305,y:167,rotation:0},{type:"star",x:270,y:100,rotation:0},{type:"star",x:175,y:167,rotation:0},{type:"star",x:210,y:100,rotation:0},{type:"star",x:330,y:100,rotation:0},{type:"star",x:300,y:70,rotation:0},{type:"star",x:240,y:55,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform7_horizontal_long",x:239,y:205,rotation:0,custom:"345"},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:480,y:70,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"platform2",x:0,y:70,rotation:0},{type:"star",x:240,y:140,rotation:0},{type:"star",x:330,y:140,rotation:0},{type:"star",x:300,y:140,rotation:0},{type:"star",x:270,y:140,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"star",x:240,y:80,rotation:0},{type:"star",x:240,y:110,rotation:0},{type:"star",x:240,y:230,rotation:0},{type:"star",x:240,y:200,rotation:0},{type:"star",x:241,y:170,rotation:0},{type:"star",x:150,y:142,rotation:0},{type:"star",x:180,y:140,rotation:0},{type:"star",x:210,y:140,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:480,y:70,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"platform2",x:0,y:70,rotation:0},{type:"star",x:240,y:140,rotation:0},{type:"star",x:330,y:140,rotation:0},{type:"star",x:300,y:85,rotation:0},{type:"star",x:270,y:140,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"star",x:240,y:95,rotation:0},{type:"star",x:240,y:230,rotation:0},{type:"star",x:240,y:185,rotation:0},{type:"star",x:180,y:195,rotation:0},{type:"star",x:150,y:142,rotation:0},{type:"star",x:180,y:85,rotation:0},{type:"star",x:210,y:140,rotation:0},{type:"star",x:300,y:195,rotation:0},{type:"element1",x:300,y:142,rotation:0},{type:"element1",x:180,y:142,rotation:0},{type:"pink2",x:240,y:18,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:480,y:70,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"platform2",x:0,y:70,rotation:0},{type:"star",x:370,y:210,rotation:0},{type:"star",x:330,y:140,rotation:0},{type:"star",x:370,y:50,rotation:0},{type:"star",x:270,y:140,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"star",x:240,y:95,rotation:0},{type:"star",x:240,y:230,rotation:0},{type:"star",x:110,y:210,rotation:0},{type:"star",x:180,y:195,rotation:0},{type:"star",x:150,y:142,rotation:0},{type:"star",x:110,y:50,rotation:0},{type:"star",x:210,y:140,rotation:0},{type:"star",x:300,y:195,rotation:0},{type:"element1",x:300,y:142,rotation:0},{type:"element1",x:180,y:142,rotation:0},{type:"element1",x:240,y:142,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:480,y:70,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"platform2",x:0,y:70,rotation:0},{type:"star",x:370,y:135,rotation:0},{type:"star",x:370,y:50,rotation:0},{type:"star",x:270,y:140,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"star",x:240,y:95,rotation:0},{type:"star",x:110,y:135,rotation:0},{type:"star",x:145,y:105,rotation:0},{type:"star",x:110,y:50,rotation:0},{type:"star",x:210,y:140,rotation:0},{type:"star",x:335,y:105,rotation:0},{type:"element1",x:300,y:142,rotation:0},{type:"element1",x:180,y:142,rotation:0},{type:"element1",x:240,y:206,rotation:0},{type:"platform_bubble2",x:146,y:130,rotation:0},{type:"platform7",x:146,y:147,rotation:0},{type:"platform_bubble2",x:336,y:130,rotation:0},{type:"platform7",x:336,y:147,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:480,y:70,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"platform2",x:0,y:70,rotation:0},{type:"star",x:370,y:135,rotation:0},{type:"star",x:376,y:50,rotation:0},{type:"star",x:270,y:140,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"star",x:110,y:135,rotation:0},{type:"star",x:105,y:50,rotation:0},{type:"star",x:210,y:140,rotation:0},{type:"element1",x:240,y:206,rotation:0},{type:"star",x:175,y:50,rotation:0},{type:"star",x:240,y:176,rotation:0},{type:"star",x:370,y:207,rotation:0},{type:"star",x:110,y:207,rotation:0},{type:"star",x:306,y:50,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform7_horizontal_short",x:138,y:86,rotation:0,custom:"180"},{type:"star",x:142,y:105,rotation:0},{type:"platform7_horizontal_short",x:350,y:86,rotation:0,custom:"360"},{type:"star",x:342,y:105,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"star",x:130,y:205,rotation:0},{type:"star",x:350,y:205,rotation:0},{type:"platform_bubble",x:242,y:115,rotation:0},{type:"platform2",x:241,y:126,rotation:0},{type:"pink_plus",x:241,y:32,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"star",x:100,y:168,rotation:0},{type:"star",x:380,y:168,rotation:0},{type:"star",x:380,y:55,rotation:0},{type:"star",x:100,y:55,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform2_horizontal_single",x:246,y:172,rotation:0,custom:"300"},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"star",x:100,y:168,rotation:0},{type:"star",x:380,y:168,rotation:0},{type:"coin",x:130,y:80,rotation:0},{type:"coin",x:350,y:80,rotation:0},{type:"star",x:380,y:55,rotation:0},{type:"star",x:100,y:55,rotation:0},{type:"element23",x:240,y:140,rotation:0},{type:"star",x:280,y:180,rotation:0},{type:"star",x:280,y:100,rotation:0},{type:"star",x:200,y:100,rotation:0},{type:"star",x:200,y:180,rotation:0},{type:"star",x:240,y:200,rotation:0},{type:"star",x:240,y:80,rotation:0},{type:"star",x:300,y:140,rotation:0},{type:"star",x:180,y:140,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"star",x:100,y:168,rotation:0},{type:"star",x:380,y:168,rotation:0},{type:"coin",x:125,y:135,rotation:0},{type:"coin",x:355,y:135,rotation:0},{type:"star",x:380,y:55,rotation:0},{type:"star",x:100,y:55,rotation:0},{type:"element23",x:240,y:210,rotation:0},{type:"star",x:280,y:210,rotation:0},{type:"star",x:280,y:100,rotation:0},{type:"star",x:200,y:100,rotation:0},{type:"star",x:198,y:209,rotation:0},{type:"star",x:240,y:250,rotation:0},{type:"star",x:240,y:80,rotation:0},{type:"star",x:300,y:140,rotation:0},{type:"star",x:180,y:140,rotation:0},{type:"star",x:240,y:168,rotation:0},{type:"star",x:365,y:215,rotation:0},{type:"star",x:115,y:215,rotation:0},{type:"pink_minus",x:156,y:47,rotation:0},{type:"pink_plus",x:317,y:47,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:140,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:140,rotation:0},{type:"star",x:100,y:168,rotation:0},{type:"star",x:380,y:168,rotation:0},{type:"coin",x:125,y:135,rotation:0},{type:"coin",x:355,y:135,rotation:0},{type:"star",x:380,y:55,rotation:0},{type:"star",x:100,y:55,rotation:0},{type:"star",x:280,y:210,rotation:0},{type:"star",x:280,y:100,rotation:0},{type:"star",x:200,y:100,rotation:0},{type:"star",x:198,y:209,rotation:0},{type:"star",x:240,y:210,rotation:0},{type:"star",x:240,y:103,rotation:0},{type:"star",x:300,y:140,rotation:0},{type:"star",x:180,y:140,rotation:0},{type:"star",x:240,y:143,rotation:0},{type:"star",x:365,y:215,rotation:0},{type:"star",x:115,y:215,rotation:0},{type:"pink_extralife",x:241,y:47,rotation:0},{type:"pink_minus",x:136,y:82,rotation:0},{type:"pink_plus",x:336,y:82,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"star",x:290,y:210,rotation:0},{type:"star",x:290,y:160,rotation:0},{type:"star",x:290,y:110,rotation:0},{type:"star",x:190,y:210,rotation:0},{type:"star",x:190,y:110,rotation:0},{type:"star",x:190,y:160,rotation:0},{type:"star",x:240,y:210,rotation:0},{type:"star",x:240,y:160,rotation:0},{type:"star",x:240,y:110,rotation:0},{type:"element28",x:155,y:165,rotation:0},{type:"element28",x:325,y:165,rotation:0},{type:"coin",x:130,y:210,rotation:0},{type:"coin",x:350,y:210,rotation:0},{type:"coin",x:390,y:85,rotation:0},{type:"coin",x:90,y:85,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"star",x:290,y:210,rotation:0},{type:"star",x:290,y:160,rotation:0},{type:"star",x:290,y:110,rotation:0},{type:"star",x:190,y:210,rotation:0},{type:"star",x:190,y:110,rotation:0},{type:"star",x:190,y:160,rotation:0},{type:"star",x:240,y:210,rotation:0},{type:"star",x:240,y:160,rotation:0},{type:"star",x:240,y:110,rotation:0},{type:"blue2",x:242,y:49,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"element28_vertical",x:154,y:215,rotation:0,custom:"215"},{type:"element28_vertical",x:343,y:112,rotation:0,custom:"215"},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"coin",x:385,y:80,rotation:0},{type:"coin",x:95,y:80,rotation:0},{type:"coin",x:385,y:170,rotation:0},{type:"coin",x:95,y:170,rotation:0},{type:"element28",x:240,y:215,rotation:0},{type:"element28",x:240,y:100,rotation:0},{type:"star",x:275,y:215,rotation:0},{type:"star",x:275,y:100,rotation:0},{type:"star",x:205,y:100,rotation:0},{type:"star",x:205,y:215,rotation:0},{type:"star",x:240,y:246,rotation:0},{type:"star",x:240,y:180,rotation:0},{type:"star",x:240,y:131,rotation:0},{type:"star",x:240,y:65,rotation:0},{type:"blue2",x:239,y:31,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"coin",x:315,y:110,rotation:0},{type:"coin",x:165,y:110,rotation:0},{type:"coin",x:315,y:145,rotation:0},{type:"coin",x:165,y:145,rotation:0},{type:"element28",x:240,y:78,rotation:0},{type:"star",x:275,y:73,rotation:0},{type:"star",x:205,y:73,rotation:0},{type:"star",x:240,y:109,rotation:0},{type:"star",x:240,y:45,rotation:0},{type:"platform_bubble2",x:166,y:172,rotation:0},{type:"platform7",x:165,y:189,rotation:0},{type:"platform_bubble2",x:317,y:172,rotation:0},{type:"platform7",x:317,y:189,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:210,rotation:0},{type:"platform2",x:480,y:140,rotation:0},{type:"platform2",x:0,y:210,rotation:0},{type:"platform2",x:0,y:140,rotation:0},{type:"element22",x:240,y:70,rotation:0},{type:"star",x:205,y:180,rotation:0},{type:"star",x:275,y:180,rotation:0},{type:"star",x:284,y:65,rotation:0},{type:"star",x:195,y:65,rotation:0},{type:"star",x:240,y:180,rotation:0},{type:"star",x:240,y:150,rotation:0},{type:"star",x:240,y:120,rotation:0},{type:"star",x:240,y:25,rotation:0},{type:"blue_extralife",x:110,y:59,rotation:0},{type:"blue_extralife",x:356,y:59,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:165,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:325,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform7_vertical",x:153,y:111,rotation:0,custom:"170"},{type:"platform7_vertical",x:336,y:193,rotation:0,custom:"250"},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:360,y:200,rotation:0},{type:"star",x:120,y:200,rotation:0},{type:"star",x:335,y:135,rotation:0},{type:"star",x:145,y:135,rotation:0},{type:"star",x:415,y:140,rotation:0},{type:"star",x:350,y:85,rotation:0},{type:"star",x:290,y:85,rotation:0},{type:"star",x:65,y:140,rotation:0},{type:"star",x:130,y:85,rotation:0},{type:"star",x:240,y:60,rotation:0},{type:"star",x:190,y:85,rotation:0},{type:"blue_extralife",x:163,y:209,rotation:0},{type:"blue_extralife",x:310,y:209,rotation:0},{type:"platform_bubble",x:242,y:129,rotation:0},{type:"platform2",x:238,y:139,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:360,y:200,rotation:0},{type:"star",x:120,y:200,rotation:0},{type:"star",x:335,y:125,rotation:0},{type:"star",x:145,y:125,rotation:0},{type:"star",x:390,y:165,rotation:0},{type:"star",x:350,y:85,rotation:0},{type:"star",x:290,y:70,rotation:0},{type:"star",x:90,y:165,rotation:0},{type:"star",x:130,y:85,rotation:0},{type:"star",x:240,y:70,rotation:0},{type:"star",x:190,y:70,rotation:0},{type:"pink_plus",x:205,y:199,rotation:0},{type:"pink_plus",x:273,y:199,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform2_vertical_single",x:241,y:115,rotation:0,custom:"200"},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"coin",x:240,y:170,rotation:0},{type:"star",x:360,y:200,rotation:0},{type:"star",x:120,y:200,rotation:0},{type:"star",x:321,y:102,rotation:0},{type:"star",x:157,y:105,rotation:0},{type:"star",x:390,y:165,rotation:0},{type:"star",x:350,y:85,rotation:0},{type:"star",x:290,y:70,rotation:0},{type:"star",x:90,y:165,rotation:0},{type:"star",x:130,y:85,rotation:0},{type:"star",x:240,y:70,rotation:0},{type:"star",x:190,y:70,rotation:0},{type:"star",x:290,y:115,rotation:0},{type:"star",x:240,y:108,rotation:0},{type:"star",x:190,y:115,rotation:0},{type:"star",x:291,y:220,rotation:0},{type:"star",x:240,y:216,rotation:0},{type:"star",x:190,y:220,rotation:0},{type:"blue2",x:238,y:30,rotation:0},{type:"platform_bubble2",x:153,y:152,rotation:0},{type:"platform3",x:152,y:171,rotation:0},{type:"coin",x:190,y:170,rotation:0},{type:"platform_bubble2",x:329,y:152,rotation:0},{type:"platform3",x:329,y:171,rotation:0},{type:"coin",x:293,y:170,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"coin",x:240,y:170,rotation:0},{type:"star",x:360,y:200,rotation:0},{type:"star",x:120,y:200,rotation:0},{type:"star",x:321,y:102,rotation:0},{type:"star",x:157,y:105,rotation:0},{type:"star",x:390,y:165,rotation:0},{type:"star",x:350,y:85,rotation:0},{type:"star",x:290,y:70,rotation:0},{type:"star",x:90,y:165,rotation:0},{type:"star",x:130,y:85,rotation:0},{type:"star",x:240,y:70,rotation:0},{type:"star",x:190,y:70,rotation:0},{type:"star",x:290,y:115,rotation:0},{type:"star",x:240,y:108,rotation:0},{type:"star",x:190,y:115,rotation:0},{type:"star",x:291,y:220,rotation:0},{type:"star",x:240,y:216,rotation:0},{type:"star",x:190,y:220,rotation:0},{type:"platform_bubble2",x:153,y:152,rotation:0},{type:"platform3",x:152,y:171,rotation:0},{type:"coin",x:190,y:170,rotation:0},{type:"platform_bubble2",x:329,y:152,rotation:0},{type:"platform3",x:329,y:171,rotation:0},{type:"coin",x:293,y:170,rotation:0},{type:"pink_minus",x:239,y:34,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"star",x:120,y:200,rotation:0},{type:"star",x:323,y:102,rotation:0},{type:"star",x:390,y:165,rotation:0},{type:"star",x:355,y:85,rotation:0},{type:"star",x:290,y:70,rotation:0},{type:"star",x:90,y:165,rotation:0},{type:"star",x:240,y:70,rotation:0},{type:"star",x:190,y:70,rotation:0},{type:"star",x:290,y:115,rotation:0},{type:"star",x:240,y:108,rotation:0},{type:"star",x:190,y:115,rotation:0},{type:"star",x:240,y:216,rotation:0},{type:"star",x:190,y:220,rotation:0},{type:"pink3",x:239,y:35,rotation:0},{type:"star",x:155,y:102,rotation:0},{type:"star",x:289,y:220,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform_horizontal_big",x:178,y:72,rotation:0,custom:"250"},{type:"star",x:121,y:86,rotation:0},{type:"platform_horizontal_big",x:315,y:212,rotation:0,custom:"327"},{type:"star",x:363,y:198,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"coin",x:165,y:165,rotation:0},{type:"element36",x:240,y:150,rotation:0},{type:"coin",x:315,y:165,rotation:0},{type:"star",x:190,y:130,rotation:0},{type:"star",x:165,y:115,rotation:0},{type:"star",x:317,y:225,rotation:0},{type:"star",x:292,y:205,rotation:0},{type:"star",x:312,y:115,rotation:0},{type:"star",x:185,y:205,rotation:0},{type:"star",x:140,y:100,rotation:0},{type:"star",x:337,y:100,rotation:0},{type:"star",x:287,y:130,rotation:0},{type:"star",x:160,y:225,rotation:0},{type:"star",x:267,y:185,rotation:0},{type:"star",x:210,y:185,rotation:0},{type:"star",x:240,y:40,rotation:0},{type:"star",x:240,y:70,rotation:0},{type:"star",x:240,y:100,rotation:0},{type:"pink_split",x:192,y:84,rotation:0},{type:"pink2",x:285,y:84,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"coin",x:165,y:55,rotation:0},{type:"element36",x:315,y:155,rotation:0},{type:"coin",x:315,y:55,rotation:0},{type:"star",x:240,y:190,rotation:0},{type:"star",x:164,y:115,rotation:0},{type:"star",x:338,y:183,rotation:0},{type:"star",x:277,y:143,rotation:0},{type:"star",x:240,y:160,rotation:0},{type:"star",x:201,y:143,rotation:0},{type:"star",x:127,y:144,rotation:0},{type:"star",x:313,y:115,rotation:0},{type:"star",x:240,y:130,rotation:0},{type:"star",x:143,y:184,rotation:0},{type:"star",x:352,y:144,rotation:0},{type:"star",x:185,y:185,rotation:0},{type:"star",x:240,y:40,rotation:0},{type:"star",x:240,y:70,rotation:0},{type:"star",x:241,y:100,rotation:0},{type:"element36",x:165,y:155,rotation:0},{type:"star",x:292,y:183,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"coin",x:360,y:70,rotation:0},{type:"element30",x:240,y:175,rotation:0},{type:"element30",x:165,y:95,rotation:0},{type:"element30",x:315,y:95,rotation:0},{type:"coin",x:120,y:70,rotation:0},{type:"star",x:110,y:210,rotation:0},{type:"star",x:190,y:70,rotation:0},{type:"star",x:370,y:210,rotation:0},{type:"star",x:290,y:70,rotation:0},{type:"star",x:285,y:220,rotation:0},{type:"star",x:263,y:200,rotation:0},{type:"star",x:285,y:130,rotation:0},{type:"star",x:263,y:148,rotation:0},{type:"star",x:195,y:220,rotation:0},{type:"star",x:213,y:200,rotation:0},{type:"star",x:195,y:130,rotation:0},{type:"star",x:215,y:150,rotation:0},{type:"pink_extralife",x:237,y:121,rotation:0},{type:"enemy_large",x:150,y:236,rotation:0},{type:"enemy_large",x:321,y:236,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"coin",x:360,y:70,rotation:0},{type:"element30",x:315,y:185,rotation:0},{type:"element30",x:165,y:95,rotation:0},{type:"element30",x:315,y:95,rotation:0},{type:"coin",x:120,y:70,rotation:0},{type:"star",x:110,y:210,rotation:0},{type:"star",x:190,y:70,rotation:0},{type:"star",x:370,y:210,rotation:0},{type:"star",x:290,y:70,rotation:0},{type:"star",x:285,y:220,rotation:0},{type:"star",x:263,y:200,rotation:0},{type:"star",x:285,y:130,rotation:0},{type:"star",x:263,y:148,rotation:0},{type:"star",x:195,y:220,rotation:0},{type:"star",x:213,y:200,rotation:0},{type:"star",x:195,y:130,rotation:0},{type:"star",x:215,y:150,rotation:0},{type:"element30",x:165,y:185,rotation:0},{type:"star",x:345,y:145,rotation:0},{type:"star",x:135,y:145,rotation:0},{type:"star",x:260,y:90,rotation:0},{type:"star",x:220,y:90,rotation:0},{type:"enemy_large",x:240,y:124,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:466,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:14,y:70,rotation:0},{type:"coin",x:360,y:70,rotation:0},{type:"element30",x:240,y:145,rotation:0},{type:"element30",x:335,y:145,rotation:0},{type:"coin",x:120,y:70,rotation:0},{type:"star",x:110,y:210,rotation:0},{type:"star",x:190,y:70,rotation:0},{type:"star",x:370,y:210,rotation:0},{type:"star",x:290,y:70,rotation:0},{type:"star",x:285,y:220,rotation:0},{type:"star",x:263,y:200,rotation:0},{type:"star",x:195,y:220,rotation:0},{type:"star",x:213,y:200,rotation:0},{type:"element30",x:145,y:145,rotation:0},{type:"star",x:300,y:142,rotation:0},{type:"star",x:180,y:142,rotation:0},{type:"star",x:260,y:90,rotation:0},{type:"star",x:220,y:90,rotation:0},{type:"star",x:148,y:231,rotation:0},{type:"enemy_large",x:239,y:53,rotation:0},{type:"pink2",x:240,y:183,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"coin",x:160,y:210,rotation:0},{type:"coin",x:240,y:70,rotation:0},{type:"coin",x:320,y:210,rotation:0},{type:"coin",x:71,y:181,rotation:0},{type:"element6",x:240,y:140,rotation:0},{type:"star",x:332,y:162,rotation:0},{type:"star",x:332,y:112,rotation:0},{type:"star",x:357,y:137,rotation:0},{type:"star",x:332,y:137,rotation:0},{type:"star",x:307,y:137,rotation:0},{type:"star",x:282,y:137,rotation:0},{type:"star",x:145,y:162,rotation:0},{type:"star",x:145,y:112,rotation:0},{type:"star",x:120,y:137,rotation:0},{type:"star",x:145,y:137,rotation:0},{type:"star",x:170,y:137,rotation:0},{type:"star",x:195,y:137,rotation:0},{type:"enemy_large",x:240,y:201,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"coin",x:160,y:210,rotation:0},{type:"coin",x:240,y:70,rotation:0},{type:"coin",x:320,y:210,rotation:0},{type:"coin",x:240,y:210,rotation:0},{type:"element6",x:148,y:140,rotation:0},{type:"star",x:332,y:162,rotation:0},{type:"star",x:332,y:112,rotation:0},{type:"star",x:375,y:137,rotation:0},{type:"star",x:293,y:137,rotation:0},{type:"star",x:255,y:137,rotation:0},{type:"star",x:145,y:162,rotation:0},{type:"star",x:145,y:112,rotation:0},{type:"star",x:107,y:137,rotation:0},{type:"star",x:187,y:137,rotation:0},{type:"star",x:225,y:137,rotation:0},{type:"element6",x:335,y:140,rotation:0},{type:"blue_extralife",x:240,y:173,rotation:0},{type:"enemy_small",x:141,y:41,rotation:0},{type:"enemy_small",x:330,y:41,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"coin",x:160,y:210,rotation:0},{type:"coin",x:240,y:70,rotation:0},{type:"coin",x:320,y:210,rotation:0},{type:"coin",x:240,y:210,rotation:0},{type:"element6",x:148,y:70,rotation:0},{type:"star",x:332,y:162,rotation:0},{type:"star",x:332,y:112,rotation:0},{type:"star",x:375,y:137,rotation:0},{type:"star",x:293,y:137,rotation:0},{type:"star",x:255,y:137,rotation:0},{type:"star",x:145,y:162,rotation:0},{type:"star",x:145,y:112,rotation:0},{type:"star",x:107,y:137,rotation:0},{type:"star",x:187,y:137,rotation:0},{type:"star",x:225,y:137,rotation:0},{type:"element6",x:335,y:70,rotation:0},{type:"element4",x:160,y:240,rotation:0},{type:"element4",x:320,y:240,rotation:0},{type:"enemy_small",x:204,y:233,rotation:0},{type:"enemy_small",x:282,y:233,rotation:0},{type:"blue_extralife",x:240,y:31,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"coin",x:160,y:210,rotation:0},{type:"coin",x:240,y:70,rotation:0},{type:"coin",x:320,y:210,rotation:0},{type:"coin",x:240,y:210,rotation:0},{type:"element6",x:148,y:139,rotation:0},{type:"star",x:332,y:162,rotation:0},{type:"star",x:332,y:80,rotation:0},{type:"star",x:145,y:162,rotation:0},{type:"star",x:145,y:80,rotation:0},{type:"element6",x:335,y:139,rotation:0},{type:"element4",x:160,y:240,rotation:0},{type:"element4",x:320,y:240,rotation:0},{type:"element4",x:240,y:150,rotation:0},{type:"blue_extralife",x:145,y:42,rotation:0},{type:"blue_extralife",x:333,y:42,rotation:0},{type:"enemy_small",x:204,y:192,rotation:0},{type:"enemy_small",x:280,y:192,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:210,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:210,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"coin",x:160,y:210,rotation:0},{type:"coin",x:240,y:59,rotation:0},{type:"coin",x:320,y:210,rotation:0},{type:"coin",x:240,y:210,rotation:0},{type:"star",x:332,y:162,rotation:0},{type:"star",x:332,y:80,rotation:0},{type:"star",x:145,y:162,rotation:0},{type:"star",x:145,y:80,rotation:0},{type:"element4",x:105,y:140,rotation:0},{type:"element4",x:375,y:140,rotation:0},{type:"element12",x:240,y:87,rotation:0},{type:"star",x:290,y:162,rotation:0},{type:"star",x:190,y:162,rotation:0},{type:"blue2",x:241,y:148,rotation:0},{type:"enemy_small",x:240,y:238,rotation:0},{type:"enemy_small",x:111,y:27,rotation:0},{type:"enemy_small",x:365,y:27,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"coin",x:360,y:175,rotation:0},{type:"coin",x:120,y:175,rotation:0},{type:"jump_element",x:240,y:204,rotation:0},{type:"star",x:240,y:170,rotation:0},{type:"star",x:240,y:140,rotation:0},{type:"star",x:240,y:110,rotation:0},{type:"star",x:240,y:80,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"blue_extralife",x:335,y:52,rotation:0},{type:"blue3",x:150,y:52,rotation:0},{type:"enemy_normal",x:149,y:118,rotation:0},{type:"enemy_normal",x:336,y:118,rotation:0},{type:"platform_bubble",x:242,y:214,rotation:0},{type:"platform3",x:241,y:228,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"star",x:240,y:170,rotation:0},{type:"star",x:240,y:140,rotation:0},{type:"star",x:240,y:110,rotation:0},{type:"star",x:240,y:80,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"blue_extralife",x:335,y:52,rotation:0},{type:"blue_extralife",x:151,y:52,rotation:0},{type:"star",x:92,y:53,rotation:0},{type:"star",x:397,y:53,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform_horizontal_big",x:242,y:220,rotation:0,custom:"250"},{type:"enemy_moving_horizontal",x:335,y:121,rotation:0,custom:"360"},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"star",x:240,y:170,rotation:0},{type:"star",x:240,y:140,rotation:0},{type:"star",x:240,y:110,rotation:0},{type:"star",x:240,y:80,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"star",x:400,y:120,rotation:0},{type:"star",x:80,y:120,rotation:0},{type:"star",x:270,y:80,rotation:0},{type:"star",x:270,y:50,rotation:0},{type:"star",x:210,y:184,rotation:0},{type:"star",x:210,y:153,rotation:0},{type:"star",x:210,y:80,rotation:0},{type:"star",x:210,y:50,rotation:0},{type:"star",x:270,y:184,rotation:0},{type:"star",x:270,y:153,rotation:0},{type:"blue_plus",x:207,y:117,rotation:0},{type:"pink_split",x:272,y:117,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},{type:"platform_vertical_big",x:146,y:224,rotation:0,custom:"224"},{type:"coin",x:85,y:209,rotation:0},{type:"platform_vertical_big",x:345,y:79,rotation:0,custom:"200"},{type:"coin",x:395,y:210,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"coin",x:390,y:220,rotation:0},{type:"coin",x:90,y:220,rotation:0},{type:"star",x:240,y:170,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"star",x:400,y:120,rotation:0},{type:"star",x:80,y:120,rotation:0},{type:"star",x:270,y:50,rotation:0},{type:"star",x:210,y:170,rotation:0},{type:"star",x:210,y:50,rotation:0},{type:"star",x:270,y:170,rotation:0},{type:"platform2",x:209,y:126,rotation:0},{type:"platform2",x:275,y:214,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:500,y:70,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"platform2",x:-20,y:70,rotation:0},{type:"star",x:234,y:170,rotation:0},{type:"star",x:250,y:50,rotation:0},{type:"star",x:400,y:120,rotation:0},{type:"star",x:80,y:120,rotation:0},{type:"star",x:287,y:50,rotation:0},{type:"star",x:197,y:170,rotation:0},{type:"star",x:210,y:50,rotation:0},{type:"star",x:270,y:170,rotation:0},{type:"platform_bubble",x:208,y:97,rotation:0},{type:"platform2",x:206,y:107,rotation:0},{type:"platform_bubble",x:279,y:216,rotation:0},{type:"platform2",x:276,y:226,rotation:0},{type:"shooter",x:85,y:305,rotation:0},{type:"shooter",x:125,y:305,rotation:0},{type:"shooter",x:205,y:305,rotation:0},{type:"shooter",x:245,y:305,rotation:0},{type:"shooter",x:285,y:305,rotation:0},{type:"shooter",x:365,y:306,rotation:0},{type:"shooter",x:405,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"element35",x:240,y:170,rotation:0},{type:"star",x:160,y:190,rotation:0},{type:"star",x:320,y:190,rotation:0},{type:"star",x:390,y:120,rotation:0},{type:"star",x:390,y:80,rotation:0},{type:"star",x:300,y:110,rotation:0},{type:"star",x:265,y:110,rotation:0},{type:"star",x:180,y:110,rotation:0},{type:"star",x:215,y:110,rotation:0},{type:"star",x:90,y:120,rotation:0},{type:"star",x:300,y:50,rotation:0},{type:"star",x:180,y:50,rotation:0},{type:"star",x:90,y:80,rotation:0},{type:"star",x:265,y:50,rotation:0},{type:"star",x:215,y:50,rotation:0},{type:"pink_extralife",x:129,y:47,rotation:0},{type:"pink2",x:353,y:47,rotation:0},{type:"platform_bubble2",x:161,y:218,rotation:0},{type:"platform7",x:160,y:234,rotation:0},{type:"platform_bubble2",x:321,y:218,rotation:0},{type:"platform7",x:320,y:234,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"coin",x:280,y:83,rotation:0},{type:"coin",x:200,y:83,rotation:0},{type:"star",x:160,y:190,rotation:0},{type:"star",x:320,y:190,rotation:0},{type:"star",x:390,y:120,rotation:0},{type:"star",x:390,y:80,rotation:0},{type:"star",x:265,y:110,rotation:0},{type:"star",x:215,y:110,rotation:0},{type:"star",x:90,y:120,rotation:0},{type:"star",x:300,y:50,rotation:0},{type:"star",x:180,y:50,rotation:0},{type:"star",x:90,y:80,rotation:0},{type:"star",x:265,y:50,rotation:0},{type:"star",x:215,y:50,rotation:0},{type:"coin",x:240,y:83,rotation:0},{type:"star",x:284,y:190,rotation:0},{type:"star",x:196,y:190,rotation:0},{type:"pink3",x:240,y:141,rotation:0},{type:"platform_bubble2",x:150,y:98,rotation:0},{type:"platform7",x:150,y:115,rotation:0},{type:"platform_bubble2",x:330,y:98,rotation:0},{type:"platform7",x:330,y:115,rotation:0},{type:"platform_bubble2",x:243,y:186,rotation:0},{type:"platform7",x:243,y:203,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"star",x:160,y:190,rotation:0},{type:"star",x:320,y:190,rotation:0},{type:"star",x:390,y:120,rotation:0},{type:"star",x:390,y:80,rotation:0},{type:"star",x:265,y:110,rotation:0},{type:"star",x:215,y:110,rotation:0},{type:"star",x:90,y:120,rotation:0},{type:"star",x:300,y:50,rotation:0},{type:"star",x:180,y:50,rotation:0},{type:"star",x:90,y:80,rotation:0},{type:"star",x:265,y:50,rotation:0},{type:"star",x:215,y:50,rotation:0},{type:"star",x:284,y:190,rotation:0},{type:"star",x:196,y:190,rotation:0},{type:"pink_plus",x:346,y:66,rotation:0},{type:"platform_bubble2",x:150,y:143,rotation:0},{type:"platform7",x:150,y:159,rotation:0},{type:"platform_bubble2",x:331,y:143,rotation:0},{type:"platform7",x:331,y:159,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},{type:"platform7_vertical",x:243,y:159,rotation:0,custom:"230"},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"coin",x:280,y:225,rotation:0},{type:"coin",x:200,y:225,rotation:0},{type:"star",x:160,y:190,rotation:0},{type:"star",x:320,y:190,rotation:0},{type:"star",x:390,y:120,rotation:0},{type:"star",x:390,y:80,rotation:0},{type:"star",x:265,y:110,rotation:0},{type:"star",x:215,y:110,rotation:0},{type:"star",x:90,y:120,rotation:0},{type:"star",x:300,y:50,rotation:0},{type:"star",x:180,y:50,rotation:0},{type:"star",x:90,y:80,rotation:0},{type:"star",x:265,y:50,rotation:0},{type:"star",x:215,y:50,rotation:0},{type:"coin",x:240,y:225,rotation:0},{type:"star",x:284,y:190,rotation:0},{type:"star",x:196,y:190,rotation:0},{type:"element13",x:243,y:155,rotation:0},{type:"star",x:240,y:190,rotation:0},{type:"pink3",x:239,y:81,rotation:0},{type:"platform_bubble2",x:152,y:91,rotation:0},{type:"platform",x:152,y:107,rotation:0},{type:"platform_bubble2",x:338,y:91,rotation:0},{type:"platform",x:338,y:107,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:466,y:175,rotation:0},{type:"platform2",x:14,y:175,rotation:0},{type:"coin",x:280,y:83,rotation:0},{type:"coin",x:200,y:83,rotation:0},{type:"star",x:160,y:190,rotation:0},{type:"star",x:320,y:190,rotation:0},{type:"star",x:390,y:120,rotation:0},{type:"star",x:390,y:80,rotation:0},{type:"star",x:265,y:110,rotation:0},{type:"star",x:215,y:110,rotation:0},{type:"star",x:90,y:120,rotation:0},{type:"star",x:311,y:50,rotation:0},{type:"star",x:166,y:50,rotation:0},{type:"star",x:90,y:80,rotation:0},{type:"star",x:265,y:50,rotation:0},{type:"star",x:215,y:50,rotation:0},{type:"coin",x:240,y:83,rotation:0},{type:"star",x:284,y:190,rotation:0},{type:"star",x:196,y:190,rotation:0},{type:"element13",x:159,y:155,rotation:0},{type:"element13",x:327,y:155,rotation:0},{type:"star",x:240,y:190,rotation:0},{type:"pink_extralife",x:167,y:93,rotation:0},{type:"pink2",x:310,y:93,rotation:0},{type:"platform_bubble2",x:244,y:138,rotation:0},{type:"platform",x:243,y:153,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:150,rotation:0},{type:"platform2",x:0,y:150,rotation:0},{type:"star",x:390,y:200,rotation:0},{type:"star",x:330,y:200,rotation:0},{type:"star",x:150,y:200,rotation:0},{type:"star",x:210,y:200,rotation:0},{type:"star",x:270,y:200,rotation:0},{type:"element6",x:207,y:120,rotation:0},{type:"element6",x:296,y:120,rotation:0},{type:"coin",x:360,y:165,rotation:0},{type:"coin",x:300,y:165,rotation:0},{type:"coin",x:180,y:165,rotation:0},{type:"coin",x:240,y:165,rotation:0},{type:"blue_extralife",x:163,y:75,rotation:0},{type:"blue_extralife",x:341,y:75,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:150,rotation:0},{type:"platform2",x:0,y:150,rotation:0},{type:"coin",x:335,y:105,rotation:0},{type:"coin",x:305,y:70,rotation:0},{type:"coin",x:175,y:70,rotation:0},{type:"coin",x:145,y:105,rotation:0},{type:"star",x:400,y:195,rotation:0},{type:"star",x:350,y:160,rotation:0},{type:"star",x:320,y:130,rotation:0},{type:"star",x:295,y:105,rotation:0},{type:"star",x:265,y:70,rotation:0},{type:"star",x:80,y:195,rotation:0},{type:"star",x:130,y:160,rotation:0},{type:"star",x:160,y:130,rotation:0},{type:"star",x:185,y:105,rotation:0},{type:"star",x:215,y:70,rotation:0},{type:"star",x:240,y:40,rotation:0},{type:"element6",x:242,y:104,rotation:0},{type:"element4",x:160,y:165,rotation:0},{type:"element4",x:320,y:165,rotation:0},{type:"blue_extralife",x:286,y:137,rotation:0},{type:"blue_plus",x:195,y:137,rotation:0},{type:"enemy_large",x:241,y:187,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:150,rotation:0},{type:"platform2",x:0,y:150,rotation:0},{type:"coin",x:275,y:110,rotation:0},{type:"element25",x:320,y:95,rotation:0},{type:"element25",x:160,y:95,rotation:0},{type:"element4",x:240,y:175,rotation:0},{type:"star",x:310,y:200,rotation:0},{type:"star",x:240,y:200,rotation:0},{type:"star",x:170,y:200,rotation:0},{type:"star",x:310,y:145,rotation:0},{type:"star",x:170,y:145,rotation:0},{type:"star",x:240,y:145,rotation:0},{type:"star",x:240,y:80,rotation:0},{type:"coin",x:135,y:175,rotation:0},{type:"coin",x:205,y:110,rotation:0},{type:"coin",x:275,y:175,rotation:0},{type:"coin",x:205,y:175,rotation:0},{type:"coin",x:345,y:175,rotation:0},{type:"blue_extralife",x:240,y:113,rotation:0},{type:"blue2",x:241,y:37,rotation:0},{type:"enemy_normal",x:115,y:221,rotation:0},{type:"enemy_normal",x:365,y:221,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:150,rotation:0},{type:"platform2",x:0,y:150,rotation:0},{type:"element15",x:242,y:97,rotation:0},{type:"element2",x:310,y:95,rotation:0},{type:"element2",x:170,y:95,rotation:0},{type:"element28",x:320,y:170,rotation:0},{type:"element28",x:160,y:170,rotation:0},{type:"coin",x:345,y:95,rotation:0},{type:"coin",x:135,y:95,rotation:0},{type:"star",x:240,y:205,rotation:0},{type:"star",x:280,y:170,rotation:0},{type:"star",x:240,y:170,rotation:0},{type:"star",x:200,y:170,rotation:0},{type:"star",x:320,y:130,rotation:0},{type:"star",x:160,y:130,rotation:0},{type:"star",x:415,y:70,rotation:0},{type:"star",x:320,y:60,rotation:0},{type:"star",x:280,y:60,rotation:0},{type:"star",x:65,y:70,rotation:0},{type:"star",x:160,y:60,rotation:0},{type:"star",x:200,y:60,rotation:0},{type:"blue_extralife",x:242,y:61,rotation:0},{type:"blue_extralife",x:242,y:130,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:480,y:150,rotation:0},{type:"platform2",x:0,y:150,rotation:0},{type:"coin",x:295,y:50,rotation:0},{type:"coin",x:185,y:50,rotation:0},{type:"coin",x:365,y:215,rotation:0},{type:"coin",x:115,y:215,rotation:0},{type:"element30",x:175,y:185,rotation:0},{type:"element30",x:305,y:185,rotation:0},{type:"element36",x:242,y:108,rotation:0},{type:"star",x:365,y:153,rotation:0},{type:"star",x:115,y:153,rotation:0},{type:"star",x:305,y:100,rotation:0},{type:"star",x:175,y:100,rotation:0},{type:"star",x:240,y:153,rotation:0},{type:"star",x:355,y:60,rotation:0},{type:"star",x:125,y:60,rotation:0},{type:"star",x:240,y:60,rotation:0},{type:"blue_extralife",x:240,y:197,rotation:0},{type:"enemy_small",x:215,y:25,rotation:0},{type:"enemy_small",x:263,y:25,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:94,y:237,rotation:0},{type:"coin",x:378,y:235,rotation:0},{type:"coin",x:240,y:153,rotation:0},{type:"coin",x:220,y:110,rotation:0},{type:"coin",x:260,y:110,rotation:0},{type:"enemy_small",x:331,y:232,rotation:0},{type:"enemy_small",x:149,y:230,rotation:0},{type:"pink_extralife",x:240,y:60,rotation:0},{type:"element23",x:150,y:155,rotation:0},{type:"element23",x:330,y:155,rotation:0},{type:"pink_extralife",x:240,y:197,rotation:0},{type:"star",x:280,y:230,rotation:0},{type:"star",x:200,y:230,rotation:0},{type:"star",x:387,y:152,rotation:0},{type:"star",x:331,y:201,rotation:0},{type:"star",x:331,y:107,rotation:0},{type:"star",x:285,y:154,rotation:0},{type:"star",x:92,y:153,rotation:0},{type:"star",x:197,y:153,rotation:0},{type:"star",x:149,y:202,rotation:0},{type:"star",x:151,y:107,rotation:0},{type:"star",x:280,y:70,rotation:0},{type:"star",x:200,y:70,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:190,y:205,rotation:0},{type:"coin",x:290,y:205,rotation:0},{type:"element3",x:190,y:162,rotation:0},{type:"element3",x:290,y:162,rotation:0},{type:"coin",x:240,y:130,rotation:0},{type:"pink_minus",x:370,y:50,rotation:0},{type:"pink3",x:110,y:50,rotation:0},{type:"pink_extralife",x:240,y:50,rotation:0},{type:"star",x:330,y:150,rotation:0},{type:"star",x:150,y:150,rotation:0},{type:"star",x:370,y:196,rotation:0},{type:"star",x:110,y:196,rotation:0},{type:"star",x:370,y:93,rotation:0},{type:"star",x:270,y:130,rotation:0},{type:"star",x:208,y:130,rotation:0},{type:"star",x:241,y:162,rotation:0},{type:"star",x:240,y:99,rotation:0},{type:"star",x:110,y:93,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},{type:"platform_bubble2",x:110,y:137,rotation:0},{type:"platform7",x:109,y:153,rotation:0},{type:"platform_bubble2",x:370,y:137,rotation:0},{type:"platform7",x:369,y:153,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:140,y:150,rotation:0},{type:"element33",x:242,y:225,rotation:0},{type:"pink_minus",x:340,y:80,rotation:0},{type:"pink_extralife",x:140,y:80,rotation:0},{type:"element5",x:100,y:150,rotation:0},{type:"element5",x:380,y:150,rotation:0},{type:"coin",x:140,y:234,rotation:0},{type:"coin",x:340,y:231,rotation:0},{type:"coin",x:340,y:150,rotation:0},{type:"star",x:380,y:179,rotation:0},{type:"star",x:380,y:118,rotation:0},{type:"star",x:100,y:180,rotation:0},{type:"star",x:100,y:119,rotation:0},{type:"star",x:290,y:150,rotation:0},{type:"star",x:190,y:150,rotation:0},{type:"star",x:290,y:90,rotation:0},{type:"star",x:190,y:90,rotation:0},{type:"star",x:240,y:180,rotation:0},{type:"star",x:240,y:150,rotation:0},{type:"star",x:240,y:120,rotation:0},{type:"star",x:240,y:90,rotation:0},{type:"star",x:240,y:60,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:85,y:225,rotation:0},{type:"pink_minus",x:130,y:80,rotation:0},{type:"pink3",x:350,y:80,rotation:0},{type:"star",x:360,y:153,rotation:0},{type:"star",x:360,y:190,rotation:0},{type:"star",x:360,y:225,rotation:0},{type:"star",x:130,y:225,rotation:0},{type:"star",x:130,y:190,rotation:0},{type:"star",x:130,y:155,rotation:0},{type:"star",x:270,y:70,rotation:0},{type:"star",x:210,y:70,rotation:0},{type:"coin",x:405,y:225,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},{type:"platform2_vertical_triple",x:249,y:253,rotation:0,custom:"253"},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:240,y:129,rotation:0},{type:"star",x:360,y:153,rotation:0},{type:"star",x:360,y:190,rotation:0},{type:"star",x:360,y:225,rotation:0},{type:"star",x:130,y:225,rotation:0},{type:"star",x:130,y:190,rotation:0},{type:"star",x:130,y:155,rotation:0},{type:"star",x:270,y:70,rotation:0},{type:"star",x:210,y:70,rotation:0},{type:"enemy_large",x:290,y:190,rotation:0},{type:"enemy_large",x:190,y:190,rotation:0},{type:"pink_extralife",x:240,y:70,rotation:0},{type:"star",x:392,y:213,rotation:0},{type:"star",x:391,y:173,rotation:0},{type:"star",x:95,y:209,rotation:0},{type:"star",x:96,y:173,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:80,y:195,rotation:0},{type:"star",x:240,y:100,rotation:0},{type:"star",x:240,y:135,rotation:0},{type:"star",x:200,y:135,rotation:0},{type:"star",x:200,y:100,rotation:0},{type:"star",x:240,y:65,rotation:0},{type:"star",x:280,y:100,rotation:0},{type:"star",x:280,y:135,rotation:0},{type:"coin",x:400,y:195,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},{type:"platform_bubble2",x:135,y:104,rotation:0},{type:"platform7",x:134,y:120,rotation:0},{type:"platform_bubble2",x:345,y:104,rotation:0},{type:"platform7",x:345,y:120,rotation:0},{type:"platform_bubble2",x:241,y:229,rotation:0},{type:"platform7",x:241,y:246,rotation:0},{type:"enemy_moving_horizontal",x:125,y:195,rotation:0,custom:"335"},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:394,y:151,rotation:0},{type:"enemy_normal",x:164,y:217,rotation:0},{type:"enemy_normal",x:315,y:219,rotation:0},{type:"pink_extralife",x:311,y:54,rotation:0},{type:"pink_extralife",x:172,y:52,rotation:0},{type:"element13",x:315,y:150,rotation:0},{type:"element13",x:170,y:150,rotation:0},{type:"coin",x:88,y:148,rotation:0},{type:"star",x:367,y:214,rotation:0},{type:"star",x:110,y:209,rotation:0},{type:"star",x:334,y:101,rotation:0},{type:"star",x:291,y:101,rotation:0},{type:"star",x:148,y:100,rotation:0},{type:"star",x:191,y:100,rotation:0},{type:"star",x:240,y:236,rotation:0},{type:"star",x:240,y:194,rotation:0},{type:"star",x:240,y:150,rotation:0},{type:"star",x:240,y:100,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:240,y:120,rotation:0},{type:"pink_extralife",x:240,y:60,rotation:0},{type:"enemy_large",x:240,y:227,rotation:0},{type:"enemy_large",x:140,y:227,rotation:0},{type:"enemy_large",x:340,y:227,rotation:0},{type:"star",x:340,y:170,rotation:0},{type:"star",x:290,y:170,rotation:0},{type:"star",x:340,y:120,rotation:0},{type:"star",x:290,y:120,rotation:0},{type:"star",x:340,y:60,rotation:0},{type:"star",x:290,y:60,rotation:0},{type:"star",x:140,y:170,rotation:0},{type:"star",x:190,y:170,rotation:0},{type:"star",x:140,y:120,rotation:0},{type:"star",x:190,y:120,rotation:0},{type:"star",x:140,y:60,rotation:0},{type:"star",x:190,y:60,rotation:0},{type:"star",x:241,y:170,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:83,y:195,rotation:0},{type:"pink_plus",x:145,y:83,rotation:0},{type:"pink_extralife",x:332,y:85,rotation:0},{type:"coin",x:392,y:193,rotation:0},{type:"star",x:391,y:142,rotation:0},{type:"star",x:86,y:146,rotation:0},{type:"star",x:300,y:197,rotation:0},{type:"star",x:170,y:197,rotation:0},{type:"star",x:300,y:150,rotation:0},{type:"star",x:170,y:150,rotation:0},{type:"star",x:275,y:94,rotation:0},{type:"star",x:202,y:90,rotation:0},{type:"star",x:390,y:65,rotation:0},{type:"star",x:90,y:65,rotation:0},{type:"star",x:240,y:65,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},{type:"platform_bubble2",x:240,y:164,rotation:0},{type:"platform7",x:239,y:180,rotation:0},{type:"enemy_moving_vertical",x:129,y:242,rotation:0,custom:"242"},{type:"enemy_moving_vertical",x:344,y:137,rotation:0,custom:"242"},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:75,y:220,rotation:0},{type:"enemy_small",x:104,y:221,rotation:0},{type:"enemy_small",x:373,y:228,rotation:0},{type:"element35",x:242,y:238,rotation:0},{type:"element35",x:242,y:100,rotation:0},{type:"coin",x:405,y:230,rotation:0},{type:"coin",x:405,y:140,rotation:0},{type:"coin",x:405,y:67,rotation:0},{type:"coin",x:75,y:141,rotation:0},{type:"coin",x:75,y:67,rotation:0},{type:"star",x:165,y:236,rotation:0},{type:"star",x:356,y:130,rotation:0},{type:"star",x:315,y:234,rotation:0},{type:"star",x:315,y:168,rotation:0},{type:"star",x:315,y:95,rotation:0},{type:"star",x:165,y:170,rotation:0},{type:"star",x:127,y:134,rotation:0},{type:"star",x:165,y:93,rotation:0},{type:"star",x:275,y:197,rotation:0},{type:"star",x:275,y:140,rotation:0},{type:"star",x:205,y:196,rotation:0},{type:"star",x:205,y:139,rotation:0},{type:"star",x:275,y:50,rotation:0},{type:"star",x:205,y:50,rotation:0},{type:"pink_minus",x:240,y:171,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:95,y:211,rotation:0},{type:"enemy_normal",x:132,y:209,rotation:0},{type:"enemy_normal",x:345,y:206,rotation:0},{type:"enemy_large",x:240,y:113,rotation:0},{type:"pink_extralife",x:340,y:74,rotation:0},{type:"pink_extralife",x:134,y:73,rotation:0},{type:"platform7",x:241,y:214,rotation:0},{type:"coin",x:95,y:111,rotation:0},{type:"coin",x:385,y:110,rotation:0},{type:"coin",x:385,y:207,rotation:0},{type:"star",x:170,y:244,rotation:0},{type:"star",x:300,y:246,rotation:0},{type:"star",x:343,y:145,rotation:0},{type:"star",x:133,y:140,rotation:0},{type:"star",x:240,y:154,rotation:0},{type:"star",x:300,y:176,rotation:0},{type:"star",x:300,y:110,rotation:0},{type:"star",x:170,y:176,rotation:0},{type:"star",x:170,y:110,rotation:0},{type:"star",x:385,y:50,rotation:0},{type:"star",x:300,y:50,rotation:0},{type:"star",x:95,y:50,rotation:0},{type:"star",x:170,y:49,rotation:0},{type:"star",x:240,y:70,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:400,y:146,rotation:0},{type:"element33",x:140,y:150,rotation:0},{type:"element33",x:340,y:150,rotation:0},{type:"enemy_normal",x:174,y:228,rotation:0},{type:"enemy_normal",x:303,y:226,rotation:0},{type:"pink2",x:140,y:50,rotation:0},{type:"pink_extralife",x:340,y:50,rotation:0},{type:"element3",x:240,y:221,rotation:0},{type:"element3",x:240,y:100,rotation:0},{type:"coin",x:80,y:143,rotation:0},{type:"star",x:275,y:174,rotation:0},{type:"star",x:206,y:173,rotation:0},{type:"star",x:292,y:120,rotation:0},{type:"star",x:340,y:96,rotation:0},{type:"star",x:141,y:97,rotation:0},{type:"star",x:187,y:119,rotation:0},{type:"star",x:400,y:218,rotation:0},{type:"star",x:400,y:68,rotation:0},{type:"star",x:339,y:203,rotation:0},{type:"star",x:137,y:201,rotation:0},{type:"star",x:80,y:227,rotation:0},{type:"star",x:80,y:68,rotation:0},{type:"star",x:205,y:70,rotation:0},{type:"star",x:275,y:70,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]},{objects:[{type:"platform2",x:-34,y:195,rotation:0},{type:"platform2",x:-24,y:105,rotation:0},{type:"platform2",x:514,y:195,rotation:0},{type:"platform2",x:504,y:105,rotation:0},{type:"coin",x:400,y:195,rotation:0},{type:"pink_extralife",x:140,y:60,rotation:0},{type:"pink_extralife",x:341,y:60,rotation:0},{type:"enemy_large",x:340,y:144,rotation:0},{type:"enemy_large",x:140,y:141,rotation:0},{type:"enemy_normal",x:240,y:213,rotation:0},{type:"enemy_small",x:400,y:236,rotation:0},{type:"enemy_small",x:80,y:236,rotation:0},{type:"element2",x:240,y:93,rotation:0},{type:"element2",x:240,y:175,rotation:0},{type:"element28",x:340,y:223,rotation:0},{type:"element28",x:140,y:224,rotation:0},{type:"coin",x:80,y:197,rotation:0},{type:"star",x:340,y:101,rotation:0},{type:"star",x:400,y:147,rotation:0},{type:"star",x:400,y:75,rotation:0},{type:"star",x:80,y:149,rotation:0},{type:"star",x:140,y:100,rotation:0},{type:"star",x:240,y:250,rotation:0},{type:"star",x:240,y:131,rotation:0},{type:"star",x:290,y:230,rotation:0},{type:"star",x:290,y:180,rotation:0},{type:"star",x:290,y:130,rotation:0},{type:"star",x:290,y:80,rotation:0},{type:"star",x:190,y:230,rotation:0},{type:"star",x:190,y:180,rotation:0},{type:"star",x:190,y:130,rotation:0},{type:"star",x:80,y:75,rotation:0},{type:"star",x:190,y:80,rotation:0},{type:"star",x:240,y:50,rotation:0},{type:"shooter",x:104,y:305,rotation:0},{type:"shooter",x:159,y:305,rotation:0},{type:"shooter",x:214,y:305,rotation:0},{type:"shooter",x:269,y:305,rotation:0},{type:"shooter",x:324,y:306,rotation:0},{type:"shooter",x:379,y:305,rotation:0},],joints:[]}];var NONE=0;var BOX=1;var CIRCLE=2;var POLY=3;var DOUBLE_CIRCLE=4;var TRIPLE_CIRCLE=5;var NORMAL=0;var BIRD=1;var SHELL=2;var JUMP=3;var PLATFORM=4;var BONUS=5;var STICKY=6;var ROTATING_PLATFORM=7;var GUN=8;var verticalMoving=1;var horizontalMoving=0;function spritesSync(e,x,y){var p=new Vector(-e.target.syncX,-e.target.syncY);p.rotate(-e.target.rotation);e.target.x+=p.x;e.target.y+=p.y;}
var stone_density=6.0;var stone_restitution=0;var stone_friction=1;var ice_density=5.0;var ice_restitution=0;var ice_friction=0.1;var platform_density=30.0;var platform_restitution=5;var platform_friction=10;var sand_density=30.0;var sand_restitution=0.2;var sand_friction=10;var bird_density=50;var bird_restitution=0.2;var bird_friction=1;var bullet_density=18;var bullet_restitution=0.2;var bullet_friction=0;var bonus_density=0;var bonus_restitution=0;var bonus_friction=0;var jump_density=10.0;var jump_restitution=0.1;var jump_friction=10.0;var sticky_density=0;var sticky_restitution=0.1;var sticky_friction=0;var rotate_element_density=20;var rotate_element_restitution=0;var objects=[{name:"b1",image:"b1.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:0,restitution:0,friction:0},{name:"b2",image:"b2.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:bird_density,restitution:bird_restitution,friction:bird_friction},{name:"b3",image:"b3.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:bird_density,restitution:bird_restitution,friction:bird_friction},{name:"b4",image:"b4.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:bird_density,restitution:bird_restitution,friction:bird_friction},{name:"b5",image:"b5.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:bird_density,restitution:bird_restitution,friction:bird_friction},{name:"b6",image:"b6.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:bird_density,restitution:bird_restitution,friction:bird_friction},{name:"b7",image:"b7.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:bird_density,restitution:bird_restitution,friction:bird_friction},{name:"b8",image:"b8.png",type:BIRD,width:34,height:41,bodyWidth:30,bodyHeight:30,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:5},remove:false,fixed:false,density:bird_density,restitution:bird_restitution,friction:bird_friction},{name:"blue_normal",image:"blue_normal.png",type:SHELL,points:250,width:31,height:31,bodyWidth:27,bodyHeight:27,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"blue_large",image:"blue_large.png",type:SHELL,points:250,width:39,height:39,bodyWidth:34,bodyHeight:34,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"blue_small",image:"blue_small.png",type:SHELL,points:250,width:21,height:21,bodyWidth:17,bodyHeight:17,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"pink_normal",image:"pink_normal.png",type:SHELL,points:250,width:31,height:31,bodyWidth:27,bodyHeight:27,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"pink_large",image:"pink_large.png",type:SHELL,points:250,width:39,height:39,bodyWidth:34,bodyHeight:34,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"pink_small",image:"pink_small.png",type:SHELL,points:250,width:21,height:21,bodyWidth:17,bodyHeight:17,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"blue_double",image:"blue_double.png",type:SHELL,points:250,width:48,height:31,bodyWidth:27,bodyHeight:27,frames:1,bodyType:DOUBLE_CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"pink_double",image:"pink_double.png",type:SHELL,points:250,width:48,height:31,bodyWidth:27,bodyHeight:27,frames:1,bodyType:DOUBLE_CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"blue_triple",image:"blue_triple.png",type:SHELL,points:250,width:64,height:31,bodyWidth:27,bodyHeight:27,frames:1,bodyType:TRIPLE_CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"pink_triple",image:"pink_triple.png",type:SHELL,points:250,width:64,height:31,bodyWidth:27,bodyHeight:27,frames:1,bodyType:TRIPLE_CIRCLE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:bullet_density,restitution:bullet_restitution,friction:bullet_friction},{name:"coin",image:"coin.png",type:BONUS,points:250,width:24,height:24,bodyWidth:24,bodyHeight:24,frames:1,bodyType:NONE,bodyPosCorrect:{x:0,y:0},remove:false,fixed:true,density:bonus_density,restitution:bonus_restitution,friction:bonus_friction,bonusType:1},{name:"element1",image:"element1.png",type:PLATFORM,width:22,height:22,bodyWidth:20,bodyHeight:20,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element2",image:"element2.png",type:PLATFORM,width:22,height:22,bodyWidth:20,bodyHeight:20,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element3",image:"element3.png",type:PLATFORM,width:22,height:22,bodyWidth:20,bodyHeight:20,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element4",image:"element4.png",type:PLATFORM,width:22,height:22,bodyWidth:20,bodyHeight:20,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element5",image:"element5.png",type:PLATFORM,width:22,height:22,bodyWidth:20,bodyHeight:20,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element6",image:"element6.png",type:ROTATING_PLATFORM,width:56,height:25,bodyWidth:52,bodyHeight:20,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-1}]},{name:"element7",image:"element7.png",type:ROTATING_PLATFORM,width:56,height:25,bodyWidth:52,bodyHeight:20,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-1}]},{name:"element8",image:"element8.png",type:ROTATING_PLATFORM,width:56,height:25,bodyWidth:52,bodyHeight:20,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-1}]},{name:"element9",image:"element9.png",type:ROTATING_PLATFORM,width:56,height:25,bodyWidth:52,bodyHeight:20,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-1}]},{name:"element10",image:"element10.png",type:ROTATING_PLATFORM,width:56,height:25,bodyWidth:52,bodyHeight:20,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-1}]},{name:"element11",image:"element11.png",type:ROTATING_PLATFORM,width:102,height:25,bodyWidth:96,bodyHeight:21,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-2},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-2}]},{name:"element12",image:"element12.png",type:ROTATING_PLATFORM,width:99,height:22,bodyWidth:98,bodyHeight:21,frames:1,bodyType:BOX,bodyPosCorrect:{x:0,y:0},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:0,y:0}]},{name:"element13",image:"element13.png",type:ROTATING_PLATFORM,width:102,height:25,bodyWidth:96,bodyHeight:21,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-2},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-2}]},{name:"element14",image:"element14.png",type:ROTATING_PLATFORM,width:102,height:25,bodyWidth:96,bodyHeight:21,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-2},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-2}]},{name:"element15",image:"element15.png",type:ROTATING_PLATFORM,width:102,height:25,bodyWidth:96,bodyHeight:21,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-2},remove:false,fixed:false,density:rotate_element_density,restitution:rotate_element_restitution,friction:platform_friction,joints:[{type:"pivot",x:-1,y:-2}]},{name:"element19",image:"element19.png",type:STICKY,width:61,height:61,bodyWidth:56,bodyHeight:56,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element20",image:"element20.png",type:STICKY,width:61,height:61,bodyWidth:56,bodyHeight:56,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element21",image:"element21.png",type:STICKY,width:61,height:61,bodyWidth:56,bodyHeight:56,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element22",image:"element22.png",type:STICKY,width:61,height:61,bodyWidth:56,bodyHeight:56,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element23",image:"element23.png",type:STICKY,width:61,height:61,bodyWidth:56,bodyHeight:56,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element24",image:"element24.png",type:STICKY,width:61,height:61,bodyWidth:56,bodyHeight:56,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element25",image:"element25.png",type:STICKY,width:40,height:41,bodyWidth:35,bodyHeight:35,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:-3},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element26",image:"element26.png",type:STICKY,width:40,height:41,bodyWidth:38,bodyHeight:38,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-3},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element27",image:"element27.png",type:STICKY,width:40,height:41,bodyWidth:38,bodyHeight:38,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-3},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element28",image:"element28.png",type:STICKY,width:40,height:41,bodyWidth:34,bodyHeight:34,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element28_vertical",image:"element28_vertical.png",type:STICKY,width:40,height:41,bodyWidth:34,bodyHeight:34,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,isMoving:true,moveType:verticalMoving,length:100,},{name:"element29",image:"element29.png",type:STICKY,width:40,height:41,bodyWidth:38,bodyHeight:38,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-3},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element30",image:"element30.png",type:STICKY,width:40,height:41,bodyWidth:38,bodyHeight:38,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-3},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element31",image:"element31.png",type:STICKY,width:61,height:61,bodyWidth:57,bodyHeight:57,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element32",image:"element32.png",type:STICKY,width:61,height:61,bodyWidth:57,bodyHeight:57,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element33",image:"element33.png",type:STICKY,width:61,height:61,bodyWidth:57,bodyHeight:57,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element34",image:"element34.png",type:STICKY,width:61,height:61,bodyWidth:57,bodyHeight:57,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element35",image:"element35.png",type:STICKY,width:61,height:61,bodyWidth:57,bodyHeight:57,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element36",image:"element36.png",type:STICKY,width:61,height:61,bodyWidth:57,bodyHeight:57,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element37",image:"element37.png",type:STICKY,width:40,height:41,bodyWidth:36,bodyHeight:36,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element38",image:"element38.png",type:STICKY,width:55,height:54,bodyWidth:52,bodyHeight:52,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"element39",image:"element39.png",type:STICKY,width:41,height:40,bodyWidth:38,bodyHeight:38,frames:1,bodyType:NONE,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform",image:"platform.png",type:PLATFORM,width:69,height:32,bodyWidth:64,bodyHeight:28,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform_horizontal_big",image:"platform_horizontal_big.png",type:PLATFORM,width:69,height:32,bodyWidth:64,bodyHeight:28,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:false,moveType:horizontalMoving,length:100,},{name:"platform_horizontal_small",image:"platform_horizontal_small.png",type:PLATFORM,width:69,height:32,bodyWidth:64,bodyHeight:28,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:true,moveType:horizontalMoving,length:50,},{name:"platform_vertical_big",image:"platform_vertical_big.png",type:PLATFORM,width:69,height:32,bodyWidth:64,bodyHeight:28,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:false,moveType:verticalMoving,length:100,},{name:"platform2",image:"platform2.png",type:PLATFORM,width:156,height:28,bodyWidth:150,bodyHeight:24,frames:1,bodyType:BOX,bodyPosCorrect:{x:0,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform2_horizontal_single",image:"platform2_horizontal_single.png",type:PLATFORM,width:156,height:28,bodyWidth:150,bodyHeight:24,frames:1,bodyType:BOX,bodyPosCorrect:{x:0,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:false,moveType:horizontalMoving,length:100,},{name:"platform2_vertical_single",image:"platform2_vertical_single.png",type:PLATFORM,width:156,height:28,bodyWidth:150,bodyHeight:24,frames:1,bodyType:BOX,bodyPosCorrect:{x:0,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:false,moveType:verticalMoving,length:100,},{name:"platform2_vertical_triple",image:"platform2_vertical_triple.png",type:PLATFORM,width:156,height:28,bodyWidth:150,bodyHeight:24,frames:1,bodyType:BOX,bodyPosCorrect:{x:0,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,isTriple:true,jumpSmall:false,moveType:verticalMoving,length:100,},{name:"platform3",image:"platform3.png",type:PLATFORM,width:69,height:38,bodyWidth:64,bodyHeight:35,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform4",image:"platform4.png",type:PLATFORM,width:156,height:42,bodyWidth:154,bodyHeight:40,frames:1,bodyType:BOX,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform5",image:"platform5.png",type:PLATFORM,width:156,height:42,bodyWidth:154,bodyHeight:40,frames:1,bodyType:BOX,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform6",image:"platform6.png",type:PLATFORM,width:157,height:42,bodyWidth:156,bodyHeight:40,frames:1,bodyType:BOX,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform7",image:"platform7.png",type:PLATFORM,width:40,height:38,bodyWidth:35,bodyHeight:35,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"platform7_horizontal_short",image:"platform7_horizontal_short.png",type:PLATFORM,width:40,height:38,bodyWidth:35,bodyHeight:35,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:true,moveType:horizontalMoving,length:50,},{name:"platform7_horizontal_long",image:"platform7_horizontal_long.png",type:PLATFORM,width:40,height:38,bodyWidth:35,bodyHeight:35,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:true,moveType:horizontalMoving,length:200,},{name:"platform7_vertical",image:"platform7_vertical.png",type:PLATFORM,width:40,height:38,bodyWidth:35,bodyHeight:35,frames:1,bodyType:BOX,bodyPosCorrect:{x:-1,y:-1},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction,forJump:true,isMoving:true,jumpSmall:true,moveType:verticalMoving,length:50,},{name:"platform8",image:"platform8.png",type:PLATFORM,width:40,height:46,bodyWidth:38,bodyHeight:44,frames:1,bodyType:BOX,bodyPosCorrect:{x:-2,y:-2},remove:false,fixed:true,density:platform_density,restitution:platform_restitution,friction:platform_friction},{name:"star",image:"star.png",type:BONUS,width:24,height:22,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:2},{name:"platform_bubble",image:"platform_bubble.png",type:JUMP,width:60,height:35,bodyWidth:55,bodyHeight:55,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:-1,y:13},remove:false,fixed:true,density:jump_density,restitution:jump_restitution,friction:jump_friction},{name:"platform_bubble2",image:"platform_bubble2.png",type:JUMP,width:34,height:21,bodyWidth:27,bodyHeight:27,frames:1,bodyType:CIRCLE,bodyPosCorrect:{x:-2,y:5},remove:false,fixed:true,density:jump_density,restitution:jump_restitution,friction:jump_friction},{name:"blue_plus",image:"blue+.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:5},{name:"blue2",image:"blue2.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:6},{name:"blue3",image:"blue3.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:7},{name:"blue_extralife",image:"blue_extralife.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:3},{name:"pink_plus",image:"pink+.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:5},{name:"pink_minus",image:"pink-.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:8},{name:"pink2",image:"pink2.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:6},{name:"pink3",image:"pink3.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:7},{name:"pink_extralife",image:"pink_extralife.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:3},{name:"pink_split",image:"pink_split.png",type:BONUS,width:31,height:31,bodyWidth:22,bodyHeight:22,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:4},{name:"shooter",image:"shooter.png",type:GUN,width:38,height:47,bodyWidth:30,bodyHeight:30,frames:1,bodyType:BOX,bodyPosCorrect:{x:2,y:3},remove:false,fixed:true,density:0,restitution:platform_restitution,friction:platform_friction,},{name:"enemy_large",image:"enemy_large.png",type:BONUS,width:39,height:39,bodyWidth:39,bodyHeight:39,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:9},{name:"enemy_normal",image:"enemy_normal.png",type:BONUS,width:29,height:29,bodyWidth:29,bodyHeight:29,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:9},{name:"enemy_small",image:"enemy_small.png",type:BONUS,width:20,height:20,bodyWidth:20,bodyHeight:20,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,bonusType:9},{name:"enemy_moving_horizontal",image:"enemy_moving_horizontal.png",type:BONUS,width:20,height:20,bodyWidth:20,bodyHeight:20,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,isMoving:true,bonusType:9,moveType:horizontalMoving,length:100,},{name:"enemy_moving_vertical",image:"enemy_moving_vertical.png",type:BONUS,width:20,height:20,bodyWidth:20,bodyHeight:20,frames:1,bodyType:NONE,bodyPosCorrect:{x:-1,y:0},remove:false,fixed:true,density:0,restitution:bonus_restitution,friction:bonus_friction,isMoving:true,bonusType:9,moveType:verticalMoving,length:100,},];;